//////////////////////////////////////////////////////////////////////////
//                                                                      //
// This is a generated file. You can view the original                  //
// source in your browser if your browser supports source maps.         //
// Source maps are supported by all recent versions of Chrome, Safari,  //
// and Firefox, and by Internet Explorer 11.                            //
//                                                                      //
//////////////////////////////////////////////////////////////////////////


(function () {

/* Imports */
var Meteor = Package.meteor.Meteor;
var global = Package.meteor.global;
var meteorEnv = Package.meteor.meteorEnv;
var _ = Package.underscore._;
var Accounts = Package['accounts-base'].Accounts;
var moment = Package['momentjs:moment'].moment;
var Roles = Package['alanning:roles'].Roles;
var FastRender = Package['meteorhacks:fast-render'].FastRender;
var __init_fast_render = Package['meteorhacks:fast-render'].__init_fast_render;
var SubsManager = Package['meteorhacks:subs-manager'].SubsManager;
var Session = Package.session.Session;
var Template = Package.templating.Template;
var Tracker = Package.tracker.Tracker;
var Deps = Package.tracker.Deps;
var ReactiveVar = Package['reactive-var'].ReactiveVar;
var ShareIt = Package['liberation:shareit'].ShareIt;
var Symbol = Package['ecmascript-runtime'].Symbol;
var Map = Package['ecmascript-runtime'].Map;
var Set = Package['ecmascript-runtime'].Set;
var meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;
var Promise = Package.promise.Promise;
var Iron = Package['iron:core'].Iron;
var FS = Package['cfs:base-package'].FS;
var Blaze = Package.blaze.Blaze;
var UI = Package.blaze.UI;
var Handlebars = Package.blaze.Handlebars;
var Spacebars = Package.spacebars.Spacebars;
var Spiderable = Package.spiderable.Spiderable;
var HTML = Package.htmljs.HTML;

/* Package-scope variables */
var __coffeescriptShare, k, wrapperNode, input_char;

(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/lib/boot.coffee.js                                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
this.Blog = {};                                                                                                        // 1
                                                                                                                       //
Blog.settings = {                                                                                                      // 3
  shareit: {},                                                                                                         //
  comments: {},                                                                                                        //
  rss: {},                                                                                                             //
  language: {}                                                                                                         //
};                                                                                                                     //
                                                                                                                       //
Blog.config = function(appConfig) {                                                                                    // 9
  var i, key, len, ref;                                                                                                // 11
  ref = ['shareit', 'comments', 'rss', 'language'];                                                                    // 11
  for (i = 0, len = ref.length; i < len; i++) {                                                                        // 11
    key = ref[i];                                                                                                      //
    if (appConfig[key]) {                                                                                              //
      this.settings[key] = _.extend(this.settings[key], appConfig[key]);                                               //
      delete appConfig[key];                                                                                           //
    }                                                                                                                  //
  }                                                                                                                    // 11
  return this.settings = _.extend(this.settings, appConfig);                                                           //
};                                                                                                                     // 9
                                                                                                                       //
if (Meteor.isServer) {                                                                                                 // 24
  Blog.config({                                                                                                        //
    adminRole: null,                                                                                                   //
    adminGroup: null,                                                                                                  //
    authorRole: null,                                                                                                  //
    authorGroup: null,                                                                                                 //
    rss: {                                                                                                             //
      title: '',                                                                                                       //
      description: ''                                                                                                  //
    }                                                                                                                  //
  });                                                                                                                  //
}                                                                                                                      //
                                                                                                                       //
if (Meteor.isClient) {                                                                                                 // 40
  Blog.config({                                                                                                        //
    title: '',                                                                                                         //
    blogIndexTemplate: null,                                                                                           //
    blogShowTemplate: null,                                                                                            //
    blogNotFoundTemplate: null,                                                                                        //
    blogAdminTemplate: null,                                                                                           //
    blogAdminEditTemplate: null,                                                                                       //
    blogLayoutTemplate: null,                                                                                          //
    pageSize: 20,                                                                                                      //
    excerptFunction: null,                                                                                             //
    syntaxHighlighting: false,                                                                                         //
    syntaxHighlightingTheme: 'github',                                                                                 //
    cdnFontAwesome: true,                                                                                              //
    dateFormat: 'MMM Do, YYYY',                                                                                        //
    shareit: {                                                                                                         //
      siteOrder: ['facebook', 'twitter']                                                                               //
    },                                                                                                                 //
    comments: {                                                                                                        //
      allowAnonymous: false,                                                                                           //
      useSideComments: false,                                                                                          //
      defaultImg: '/packages/blog/public/default-user.png',                                                            //
      userImg: 'avatar',                                                                                               //
      disqusShortname: null                                                                                            //
    },                                                                                                                 //
    language: {                                                                                                        //
      blogEmpty: 'This blog is looking pretty empty...',                                                               //
      backToBlogIndex: 'Back to the Blog',                                                                             //
      loadMore: 'Load More',                                                                                           //
      tags: 'Tags',                                                                                                    //
      slug: 'Slug',                                                                                                    //
      metaDescription: 'Meta Description',                                                                             //
      body: 'Body',                                                                                                    //
      showAsVisual: 'Visual',                                                                                          //
      showAsHtml: 'HTML',                                                                                              //
      save: 'Save',                                                                                                    //
      cancel: 'Cancel',                                                                                                //
      "delete": 'Delete',                                                                                              //
      metaAuthorBy: 'By',                                                                                              //
      metaAuthorOn: 'on',                                                                                              //
      edit: 'Edit',                                                                                                    //
      areYouSure: 'Are you sure?',                                                                                     //
      disqusPoweredBy: 'comments powered by',                                                                          //
      adminHeader: 'Blog Admin',                                                                                       //
      addPost: 'Add Blog Post',                                                                                        //
      allPosts: 'All Posts',                                                                                           //
      myPosts: 'My Posts',                                                                                             //
      addPost: 'Add Post',                                                                                             //
      editPost: 'Edit Post',                                                                                           //
      title: 'Title',                                                                                                  //
      author: 'Author',                                                                                                //
      updatedAt: 'Updated At',                                                                                         //
      publishedAt: 'Published At',                                                                                     //
      visibleTo: 'Visible To',                                                                                         //
      featuredImage: 'Featured Image',                                                                                 //
      selectFile: 'Select File',                                                                                       //
      imageAsBackground: 'Use as background for title',                                                                //
      enterTag: 'Type in a tag & hit enter',                                                                           //
      postCreateFirst: 'Create the first blog',                                                                        //
      postVisibilityAdmins: 'Me & Admins only',                                                                        //
      postVisibilityLink: 'Anyone with link',                                                                          //
      postVisibilityAnyone: 'The world',                                                                               //
      saved: 'Saved',                                                                                                  //
      editFeaturedImageSaved: 'Featured image saved',                                                                  //
      editErrorSlugExists: 'Blog with this slug already exists',                                                       //
      editErrorBodyRequired: 'Blog body is required'                                                                   //
    }                                                                                                                  //
  });                                                                                                                  //
}                                                                                                                      //
                                                                                                                       //
Blog.config({                                                                                                          // 111
  basePath: '/blog',                                                                                                   //
  adminBasePath: '/admin/blog'                                                                                         //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/collections/author.coffee.js                                                                      //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;                                                                                         //
                                                                                                                       //
Blog.Author = (function(superClass) {                                                                                  // 1
  extend(Author, superClass);                                                                                          //
                                                                                                                       //
  function Author() {                                                                                                  //
    return Author.__super__.constructor.apply(this, arguments);                                                        //
  }                                                                                                                    //
                                                                                                                       //
  Author._collection = Meteor.users;                                                                                   //
                                                                                                                       //
  Author.prototype.posts = function() {                                                                                //
    return Blog.Post.where({                                                                                           //
      userId: this.id                                                                                                  //
    });                                                                                                                //
  };                                                                                                                   //
                                                                                                                       //
  Author.current = function() {                                                                                        //
    if (Meteor.userId()) {                                                                                             //
      return Blog.Author.init(Meteor.user());                                                                          //
    }                                                                                                                  //
  };                                                                                                                   //
                                                                                                                       //
  return Author;                                                                                                       //
                                                                                                                       //
})(Minimongoid);                                                                                                       //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/collections/post.coffee.js                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;                                                                                         //
                                                                                                                       //
Blog.Post = (function(superClass) {                                                                                    // 1
  extend(Post, superClass);                                                                                            //
                                                                                                                       //
  function Post() {                                                                                                    //
    return Post.__super__.constructor.apply(this, arguments);                                                          //
  }                                                                                                                    //
                                                                                                                       //
  Post._collection = new Meteor.Collection('blog_posts');                                                              //
                                                                                                                       //
  Post.after_save = function(post) {                                                                                   //
    post.tags = Blog.Post.splitTags(post.tags);                                                                        //
    if (post.body) {                                                                                                   //
      post.excerpt = Blog.Post.excerpt(post.body);                                                                     //
    }                                                                                                                  //
    return this._collection.update({                                                                                   //
      _id: post.id                                                                                                     //
    }, {                                                                                                               //
      $set: {                                                                                                          //
        tags: post.tags,                                                                                               //
        excerpt: post.excerpt                                                                                          //
      }                                                                                                                //
    });                                                                                                                //
  };                                                                                                                   //
                                                                                                                       //
  Post.replace_foreign_charts = function(str) {                                                                        //
    var charts, foreign, local, regex;                                                                                 // 15
    charts = {                                                                                                         //
      'ä|æ|ǽ': 'ae',                                                                                                   //
      'ö|œ': 'oe',                                                                                                     //
      'ü': 'ue',                                                                                                       //
      'Ä': 'Ae',                                                                                                       //
      'Ü': 'Ue',                                                                                                       //
      'Ö': 'Oe',                                                                                                       //
      'À|Á|Â|Ã|Ä|Å|Ǻ|Ā|Ă|Ą|Ǎ': 'A',                                                                                    //
      'à|á|â|ã|å|ǻ|ā|ă|ą|ǎ|ª': 'a',                                                                                    //
      'Ç|Ć|Ĉ|Ċ|Č': 'C',                                                                                                //
      'ç|ć|ĉ|ċ|č': 'c',                                                                                                //
      'Ð|Ď|Đ': 'D',                                                                                                    //
      'ð|ď|đ': 'd',                                                                                                    //
      'È|É|Ê|Ë|Ē|Ĕ|Ė|Ę|Ě': 'E',                                                                                        //
      'è|é|ê|ë|ē|ĕ|ė|ę|ě': 'e',                                                                                        //
      'Ĝ|Ğ|Ġ|Ģ': 'G',                                                                                                  //
      'ĝ|ğ|ġ|ģ': 'g',                                                                                                  //
      'Ĥ|Ħ': 'H',                                                                                                      //
      'ĥ|ħ': 'h',                                                                                                      //
      'Ì|Í|Î|Ï|Ĩ|Ī|Ĭ|Ǐ|Į|İ': 'I',                                                                                      //
      'ì|í|î|ï|ĩ|ī|ĭ|ǐ|į|ı': 'i',                                                                                      //
      'Ĵ': 'J',                                                                                                        //
      'ĵ': 'j',                                                                                                        //
      'Ķ': 'K',                                                                                                        //
      'ķ': 'k',                                                                                                        //
      'Ĺ|Ļ|Ľ|Ŀ|Ł': 'L',                                                                                                //
      'ĺ|ļ|ľ|ŀ|ł': 'l',                                                                                                //
      'Ñ|Ń|Ņ|Ň': 'N',                                                                                                  //
      'ñ|ń|ņ|ň|ŉ': 'n',                                                                                                //
      'Ò|Ó|Ô|Õ|Ō|Ŏ|Ǒ|Ő|Ơ|Ø|Ǿ': 'O',                                                                                    //
      'ò|ó|ô|õ|ō|ŏ|ǒ|ő|ơ|ø|ǿ|º': 'o',                                                                                  //
      'Ŕ|Ŗ|Ř': 'R',                                                                                                    //
      'ŕ|ŗ|ř': 'r',                                                                                                    //
      'Ś|Ŝ|Ş|Š': 'S',                                                                                                  //
      'ś|ŝ|ş|š|ſ': 's',                                                                                                //
      'Ţ|Ť|Ŧ': 'T',                                                                                                    //
      'ţ|ť|ŧ': 't',                                                                                                    //
      'Ù|Ú|Û|Ũ|Ū|Ŭ|Ů|Ű|Ų|Ư|Ǔ|Ǖ|Ǘ|Ǚ|Ǜ': 'U',                                                                            //
      'ù|ú|û|ũ|ū|ŭ|ů|ű|ų|ư|ǔ|ǖ|ǘ|ǚ|ǜ': 'u',                                                                            //
      'Ý|Ÿ|Ŷ': 'Y',                                                                                                    //
      'ý|ÿ|ŷ': 'y',                                                                                                    //
      'Ŵ': 'W',                                                                                                        //
      'ŵ': 'w',                                                                                                        //
      'Ź|Ż|Ž': 'Z',                                                                                                    //
      'ź|ż|ž': 'z',                                                                                                    //
      'Æ|Ǽ': 'AE',                                                                                                     //
      'ß': 'ss',                                                                                                       //
      'Ĳ': 'IJ',                                                                                                       //
      'ĳ': 'ij',                                                                                                       //
      'Œ': 'OE',                                                                                                       //
      'ƒ': 'f'                                                                                                         //
    };                                                                                                                 //
    for (foreign in charts) {                                                                                          // 66
      local = charts[foreign];                                                                                         //
      regex = new RegExp(foreign, 'g');                                                                                //
      str = str.replace(regex, local);                                                                                 //
    }                                                                                                                  // 66
    return str;                                                                                                        //
  };                                                                                                                   //
                                                                                                                       //
  Post.slugify = function(str) {                                                                                       //
    var from, i, j, l, ref, to;                                                                                        // 74
    str = this.replace_foreign_charts(str);                                                                            //
    str = str.replace(/^\s+|\s+$/g, '');                                                                               //
    str = str.toLowerCase();                                                                                           //
    from = "·/_,:;";                                                                                                   //
    to = "------";                                                                                                     //
    l = from.length;                                                                                                   //
    for (i = j = 0, ref = l; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {                               // 80
      str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));                                                //
    }                                                                                                                  // 80
    return str.replace(/[^a-z0-9 -]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-');                                   //
  };                                                                                                                   //
                                                                                                                       //
  Post.splitTags = function(str) {                                                                                     //
    if (str && typeof str === 'string') {                                                                              //
      return str.split(/,\s*/);                                                                                        // 86
    }                                                                                                                  //
    return str;                                                                                                        //
  };                                                                                                                   //
                                                                                                                       //
  Post.prototype.validate = function() {                                                                               //
    if (!this.title) {                                                                                                 //
      this.error('title', "Blog title is required");                                                                   //
    }                                                                                                                  //
    if (!this.slug) {                                                                                                  //
      return this.error('slug', "Blog slug is required");                                                              //
    }                                                                                                                  //
  };                                                                                                                   //
                                                                                                                       //
  Post.prototype.html = function() {                                                                                   //
    return this.body;                                                                                                  //
  };                                                                                                                   //
                                                                                                                       //
  Post.prototype.thumbnail = function() {                                                                              //
    var match, ref, ref1, ref2, regex;                                                                                 // 100
    if (this.featuredImage != null) {                                                                                  //
      if ((ref = Meteor.settings) != null ? (ref1 = ref["public"]) != null ? (ref2 = ref1.blog) != null ? ref2.useS3 : void 0 : void 0 : void 0) {
        return this.featuredImage;                                                                                     //
      } else {                                                                                                         //
        return Meteor.absoluteUrl() + this.featuredImage.slice(1);                                                     //
      }                                                                                                                //
    } else {                                                                                                           //
      regex = new RegExp(/img src=[\'"]([^\'"]+)/ig);                                                                  //
      while (match = regex.exec(this.body)) {                                                                          // 107
        return match[1];                                                                                               // 108
      }                                                                                                                //
    }                                                                                                                  //
  };                                                                                                                   //
                                                                                                                       //
  Post.excerpt = function(html) {                                                                                      //
    var i, matches, ret;                                                                                               // 111
    if (Blog.settings.excerptFunction != null) {                                                                       //
      return Blog.settings.excerptFunction(html);                                                                      //
    } else {                                                                                                           //
      matches = html != null ? html.split(/<\/div>|<\/p>|<\/blockquote>|<br><br>|\\n\\n|\\r\\n\\r\\n/m) : void 0;      //
      i = 0;                                                                                                           //
      ret = '';                                                                                                        //
      while (!ret && (matches != null ? matches[i] : void 0)) {                                                        // 119
        ret += matches[i++].replace(/(<([^>]+)>)/ig, ' ').replace(/(\s\.)/, '.').replace('&nbsp;', ' ').trim();        //
      }                                                                                                                //
      return ret;                                                                                                      //
    }                                                                                                                  //
  };                                                                                                                   //
                                                                                                                       //
  Post.prototype.author = function() {                                                                                 //
    return Blog.Author.first(this.userId);                                                                             //
  };                                                                                                                   //
                                                                                                                       //
  Post.prototype.authorName = function() {                                                                             //
    var author;                                                                                                        // 128
    author = this.author();                                                                                            //
    if (author) {                                                                                                      //
      if (author.profile && author.profile.name) {                                                                     //
        return author.profile.name;                                                                                    // 132
      } else if (author.profile && author.profile.firstName && author.profile.lastName) {                              //
        return author.profile.firstName + " " + author.profile.lastName;                                               // 135
      } else if (author.profile && author.profile.twitter) {                                                           //
        return "<a href=\"http://twitter.com/" + author.profile.twitter + "\">" + author.profile.twitter + "</a>";     // 138
      } else if (author.username) {                                                                                    //
        return author.username;                                                                                        // 141
      } else if (author.emails && author.emails[0]) {                                                                  //
        return author.emails[0].address;                                                                               // 144
      }                                                                                                                //
    }                                                                                                                  //
    return 'Mystery blogger';                                                                                          //
  };                                                                                                                   //
                                                                                                                       //
  return Post;                                                                                                         //
                                                                                                                       //
})(Minimongoid);                                                                                                       //
                                                                                                                       //
if (Meteor.isServer) {                                                                                                 // 153
  Meteor.methods({                                                                                                     //
    doesBlogExist: function(slug) {                                                                                    //
      check(slug, String);                                                                                             //
      return !!Blog.Post.first({                                                                                       //
        slug: slug                                                                                                     //
      });                                                                                                              //
    },                                                                                                                 //
    isBlogAuthorized: function() {                                                                                     //
      var post;                                                                                                        // 161
      check(arguments[0], Match.OneOf(Object, Number, String, null, void 0));                                          //
      if (!Meteor.user()) {                                                                                            //
        return false;                                                                                                  // 164
      }                                                                                                                //
      if (!Blog.settings.adminRole && !Blog.settings.authorRole) {                                                     //
        return true;                                                                                                   // 168
      }                                                                                                                //
      if (Blog.settings.adminRole) {                                                                                   //
        if (Blog.settings.adminGroup) {                                                                                //
          if (Roles.userIsInRole(this.userId, Blog.settings.adminRole, Blog.settings.adminGroup)) {                    //
            return true;                                                                                               // 177
          }                                                                                                            //
        } else if (Roles.userIsInRole(this.userId, Blog.settings.adminRole)) {                                         //
          return true;                                                                                                 // 182
        }                                                                                                              //
      }                                                                                                                //
      if (Blog.settings.authorRole) {                                                                                  //
        if (_.isObject(arguments[0])) {                                                                                //
          post = arguments[0];                                                                                         //
        } else if (_.isNumber(arguments[0]) || _.isString(arguments[0])) {                                             //
          post = Blog.Post.first(arguments[0]);                                                                        //
        } else {                                                                                                       //
          post = null;                                                                                                 //
        }                                                                                                              //
        if (Blog.settings.authorGroup) {                                                                               //
          if (Roles.userIsInRole(this.userId, Blog.settings.authorRole, Blog.settings.authorGroup)) {                  //
            if (post) {                                                                                                //
              if (Meteor.userId() === post.userId) {                                                                   //
                return true;                                                                                           // 203
              }                                                                                                        //
            } else {                                                                                                   //
              return true;                                                                                             // 205
            }                                                                                                          //
          }                                                                                                            //
        } else if (Roles.userIsInRole(this.userId, Blog.settings.authorRole)) {                                        //
          if (post) {                                                                                                  //
            if (Meteor.userId() === post.userId) {                                                                     //
              return true;                                                                                             // 212
            }                                                                                                          //
          } else {                                                                                                     //
            return true;                                                                                               // 214
          }                                                                                                            //
        }                                                                                                              //
      }                                                                                                                //
      return false;                                                                                                    //
    }                                                                                                                  //
  });                                                                                                                  //
}                                                                                                                      //
                                                                                                                       //
Blog.Post._collection.allow({                                                                                          // 224
  insert: function(userId, item) {                                                                                     //
    return Meteor.call('isBlogAuthorized', item);                                                                      //
  },                                                                                                                   //
  update: function(userId, item, fields) {                                                                             //
    return Meteor.call('isBlogAuthorized', item);                                                                      //
  },                                                                                                                   //
  remove: function(userId, item) {                                                                                     //
    return Meteor.call('isBlogAuthorized', item);                                                                      //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/collections/comment.coffee.js                                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;                                                                                         //
                                                                                                                       //
Blog.Comment = (function(superClass) {                                                                                 // 1
  extend(Comment, superClass);                                                                                         //
                                                                                                                       //
  function Comment() {                                                                                                 //
    return Comment.__super__.constructor.apply(this, arguments);                                                       //
  }                                                                                                                    //
                                                                                                                       //
  Comment._collection = new Meteor.Collection('blog_comments');                                                        //
                                                                                                                       //
  Comment.prototype.post = function() {                                                                                //
    return Blog.Post.first(this.postId);                                                                               //
  };                                                                                                                   //
                                                                                                                       //
  return Comment;                                                                                                      //
                                                                                                                       //
})(Minimongoid);                                                                                                       //
                                                                                                                       //
Blog.Comment._collection.allow({                                                                                       // 8
  insert: function(userId, doc) {                                                                                      //
    return !!userId;                                                                                                   //
  },                                                                                                                   //
  update: function(userId, doc, fields, modifier) {                                                                    //
    return doc.comment.authorId === userId;                                                                            //
  },                                                                                                                   //
  remove: function(userId, doc) {                                                                                      //
    return doc.comment.authorId === userId;                                                                            //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/collections/tag.coffee.js                                                                         //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;                                                                                         //
                                                                                                                       //
Blog.Tag = (function(superClass) {                                                                                     // 1
  extend(Tag, superClass);                                                                                             //
                                                                                                                       //
  function Tag() {                                                                                                     //
    return Tag.__super__.constructor.apply(this, arguments);                                                           //
  }                                                                                                                    //
                                                                                                                       //
  Tag._collection = new Meteor.Collection('blog_tags');                                                                //
                                                                                                                       //
  return Tag;                                                                                                          //
                                                                                                                       //
})(Minimongoid);                                                                                                       //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/collections/files.coffee.js                                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var filesStore, ref, ref1, ref2, ref3, ref4, ref5, s3Config, s3ImportStore, useS3;                                     // 4
                                                                                                                       //
filesStore = new FS.Store.GridFS('blog_images');                                                                       // 4
                                                                                                                       //
Blog.FilesLocal = new FS.Collection('blog_images', {                                                                   // 6
  stores: [filesStore],                                                                                                //
  filter: {                                                                                                            //
    allow: {                                                                                                           //
      contentTypes: ['image/*']                                                                                        //
    }                                                                                                                  //
  },                                                                                                                   //
  onInvalid: function(message) {                                                                                       //
    return console.log(message);                                                                                       //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
if (Meteor.isClient) {                                                                                                 // 17
  Meteor.subscribe("blog.images");                                                                                     //
} else {                                                                                                               //
  Meteor.publish('blog.images', function() {                                                                           //
    return Blog.FilesLocal.find();                                                                                     //
  });                                                                                                                  //
  Blog.FilesLocal.allow({                                                                                              //
    insert: function(userId, file) {                                                                                   //
      return !!userId;                                                                                                 //
    },                                                                                                                 //
    remove: function(userId, file) {                                                                                   //
      return file.metadata && file.metadata.userId && file.metadata.userId === userId;                                 // 26
    },                                                                                                                 //
    update: function() {                                                                                               //
      return true;                                                                                                     //
    },                                                                                                                 //
    download: function(userId, file) {                                                                                 //
      return true;                                                                                                     //
    }                                                                                                                  //
  });                                                                                                                  //
}                                                                                                                      //
                                                                                                                       //
useS3 = (ref = Meteor.settings) != null ? (ref1 = ref["public"]) != null ? (ref2 = ref1.blog) != null ? ref2.useS3 : void 0 : void 0 : void 0;
                                                                                                                       //
if (Meteor.isClient && useS3) {                                                                                        // 40
  s3ImportStore = new FS.Store.S3("blog_s3Imports");                                                                   //
  Blog.S3Files = new FS.Collection("blog_s3Imports", {                                                                 //
    stores: [s3ImportStore],                                                                                           //
    filter: {                                                                                                          //
      allow: {                                                                                                         //
        contentTypes: ['image/*']                                                                                      //
      }                                                                                                                //
    },                                                                                                                 //
    onInvalid: function(message) {                                                                                     //
      return console.log(message);                                                                                     //
    }                                                                                                                  //
  });                                                                                                                  //
  Meteor.subscribe("blog.s3Imports");                                                                                  //
}                                                                                                                      //
                                                                                                                       //
if (Meteor.isServer && useS3) {                                                                                        // 56
  s3Config = (ref3 = Meteor.settings) != null ? (ref4 = ref3["private"]) != null ? (ref5 = ref4.blog) != null ? ref5.s3Config : void 0 : void 0 : void 0;
  s3ImportStore = new FS.Store.S3("blog_s3Imports", {                                                                  //
    accessKeyId: s3Config.accessKeyId,                                                                                 //
    secretAccessKey: s3Config.secretAccessKey,                                                                         //
    bucket: s3Config.bucket,                                                                                           //
    ACL: s3Config.s3ACL,                                                                                               //
    maxTries: s3Config.s3MaxTries,                                                                                     //
    region: s3Config.region                                                                                            //
  });                                                                                                                  //
  Blog.S3Files = new FS.Collection("blog_s3Imports", {                                                                 //
    stores: [s3ImportStore],                                                                                           //
    filter: {                                                                                                          //
      allow: {                                                                                                         //
        contentTypes: ['image/*']                                                                                      //
      }                                                                                                                //
    },                                                                                                                 //
    onInvalid: function(message) {                                                                                     //
      return console.log(message);                                                                                     //
    }                                                                                                                  //
  });                                                                                                                  //
  Meteor.publish('blog.s3Imports', function() {                                                                        //
    return Blog.S3Files.find();                                                                                        //
  });                                                                                                                  //
  Blog.S3Files.allow({                                                                                                 //
    insert: function(userId, file) {                                                                                   //
      return userId;                                                                                                   //
    },                                                                                                                 //
    remove: function(userId, file) {                                                                                   //
      return file.metadata && file.metadata.userId && file.metadata.userId === userId;                                 // 83
    },                                                                                                                 //
    update: function() {                                                                                               //
      return true;                                                                                                     //
    },                                                                                                                 //
    download: function(userId, file) {                                                                                 //
      return true;                                                                                                     //
    }                                                                                                                  //
  });                                                                                                                  //
}                                                                                                                      //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/router.coffee.js                                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Blog.Router = {                                                                                                        // 3
  routes: [],                                                                                                          //
  getNotFoundTemplate: function() {                                                                                    //
    if (Package['iron:router']) {                                                                                      //
      return Router.lookupNotFoundTemplate();                                                                          //
    }                                                                                                                  //
  },                                                                                                                   //
  notFound: function() {                                                                                               //
    if (Package['kadira:flow-router']) {                                                                               //
      return FlowRouter._notfoundRoute(FlowRouter.current());                                                          //
    }                                                                                                                  //
  },                                                                                                                   //
  replaceState: function(path) {                                                                                       //
    if (Package['iron:router']) {                                                                                      //
      return Iron.Location.go(path, {                                                                                  //
        replaceState: true,                                                                                            //
        skipReactive: true                                                                                             //
      });                                                                                                              //
    } else if (Package['kadira:flow-router']) {                                                                        //
      return FlowRouter.withReplaceState(function() {                                                                  //
        return FlowRouter.go(path);                                                                                    //
      });                                                                                                              //
    }                                                                                                                  //
  },                                                                                                                   //
  go: function(nameOrPath, params, options) {                                                                          //
    var path, route, router, url;                                                                                      // 21
    router = Package['iron:router'] ? Package['iron:router'].Router : Package['kadira:flow-router'] ? Package['kadira:flow-router'].FlowRouter : void 0;
    if (/^\/|http/.test(nameOrPath)) {                                                                                 //
      path = nameOrPath;                                                                                               //
    } else {                                                                                                           //
      route = _.findWhere(this.routes, {                                                                               //
        name: nameOrPath                                                                                               //
      });                                                                                                              //
      if (!route) {                                                                                                    //
        throw new Meteor.Error(500, "Route named '" + nameOrPath + "' not found");                                     // 32
      }                                                                                                                //
      if (options == null) {                                                                                           //
        options = {};                                                                                                  //
      }                                                                                                                //
      url = new Iron.Url(route.path);                                                                                  //
      path = url.resolve(params, options);                                                                             //
    }                                                                                                                  //
    return router.go(path);                                                                                            //
  },                                                                                                                   //
  getLocation: function() {                                                                                            //
    if (Package['iron:router']) {                                                                                      //
      return '/' + Router.current().params[0];                                                                         //
    } else if (Package['kadira:flow-router']) {                                                                        //
      FlowRouter.watchPathChange();                                                                                    //
      return FlowRouter.current().path;                                                                                //
    }                                                                                                                  //
  },                                                                                                                   //
  getParam: function(key) {                                                                                            //
    var location, match, params, url;                                                                                  // 46
    location = this.getLocation();                                                                                     //
    url = null;                                                                                                        //
    match = _.find(this.routes, function(route) {                                                                      //
      url = new Iron.Url(route.path);                                                                                  //
      return url.test(location);                                                                                       //
    });                                                                                                                //
    if (match) {                                                                                                       //
      params = url.params(location);                                                                                   //
      return params[key];                                                                                              // 53
    }                                                                                                                  //
  },                                                                                                                   //
  pathFor: function(name, params, options) {                                                                           //
    var opts, route, url;                                                                                              // 56
    route = _.findWhere(this.routes, {                                                                                 //
      name: name                                                                                                       //
    });                                                                                                                //
    if (!route) {                                                                                                      //
      throw new Meteor.Error(500, "Route named '" + name + "' not found");                                             // 58
    }                                                                                                                  //
    opts = options && (options.hash || {});                                                                            //
    url = new Iron.Url(route.path);                                                                                    //
    return url.resolve(params, opts);                                                                                  //
  },                                                                                                                   //
  getTemplate: function() {                                                                                            //
    var location, match, name, url;                                                                                    // 64
    location = this.getLocation();                                                                                     //
    url = null;                                                                                                        //
    match = _.find(this.routes, function(route) {                                                                      //
      url = new Iron.Url(route.path);                                                                                  //
      return url.test(location);                                                                                       //
    });                                                                                                                //
    if (match) {                                                                                                       //
      name = match.name;                                                                                               //
      if (name === 'blogTagged') {                                                                                     //
        name = 'blogIndex';                                                                                            //
      }                                                                                                                //
      if (Blog.settings[name + "Template"]) {                                                                          //
        name = Blog.settings[name + "Template"];                                                                       //
      }                                                                                                                //
      return name;                                                                                                     // 79
    }                                                                                                                  //
  },                                                                                                                   //
  routeAll: function(routes) {                                                                                         //
    var catchAll, catchAllHook;                                                                                        // 82
    this.routes = routes;                                                                                              //
    if (Package['iron:router']) {                                                                                      //
      if (Meteor.isServer) {                                                                                           //
        routes.forEach(function(route) {                                                                               //
          if (route.fastRender) {                                                                                      //
            return FastRender.route(route.path, route.fastRender);                                                     //
          }                                                                                                            //
        });                                                                                                            //
      }                                                                                                                //
      catchAll = _.findWhere(Package['iron:router'].Router.routes, {                                                   //
        _path: '/(.*)'                                                                                                 //
      });                                                                                                              //
      if (catchAll) {                                                                                                  //
        catchAllHook = catchAll.options.onBeforeAction;                                                                //
        return catchAll.options.onBeforeAction = function() {                                                          // 100
          var template;                                                                                                // 101
          template = Blog.Router.getTemplate();                                                                        //
          if (template) {                                                                                              //
            if (Blog.settings.blogLayoutTemplate) {                                                                    //
              this.layout(Blog.settings.blogLayoutTemplate);                                                           //
            }                                                                                                          //
            return this.render(template);                                                                              //
          } else if (catchAllHook) {                                                                                   //
            return catchAllHook.call(this);                                                                            //
          } else {                                                                                                     //
            return this.next();                                                                                        //
          }                                                                                                            //
        };                                                                                                             //
      }                                                                                                                //
      return Package['iron:router'].Router.route('/(.*)', {                                                            //
        onBeforeAction: function() {                                                                                   //
          var template;                                                                                                // 113
          template = Blog.Router.getTemplate();                                                                        //
          if (template) {                                                                                              //
            if (Blog.settings.blogLayoutTemplate) {                                                                    //
              this.layout(Blog.settings.blogLayoutTemplate);                                                           //
            }                                                                                                          //
            return this.render(template);                                                                              //
          } else {                                                                                                     //
            return this.next();                                                                                        //
          }                                                                                                            //
        },                                                                                                             //
        action: function() {                                                                                           //
          return this.next();                                                                                          //
        }                                                                                                              //
      });                                                                                                              //
    } else if (Package['kadira:flow-router']) {                                                                        //
      return Package['kadira:flow-router'].FlowRouter.route('/:any*', {                                                //
        action: function() {                                                                                           //
          var layout, template;                                                                                        // 129
          template = Blog.Router.getTemplate();                                                                        //
          if (template) {                                                                                              //
            if (Blog.settings.blogLayoutTemplate) {                                                                    //
              layout = Blog.settings.blogLayoutTemplate;                                                               //
              return BlazeLayout.render(layout, {                                                                      //
                template: template                                                                                     //
              });                                                                                                      //
            } else {                                                                                                   //
              return BlazeLayout.render(template);                                                                     //
            }                                                                                                          //
          } else {                                                                                                     //
            return Blog.Router.notFound();                                                                             //
          }                                                                                                            //
        }                                                                                                              //
      });                                                                                                              //
    } else {                                                                                                           //
      throw new Meteor.Error(500, 'Blog requires either iron:router or kadira:flow-router');                           // 141
    }                                                                                                                  //
  }                                                                                                                    //
};                                                                                                                     //
                                                                                                                       //
if (Package['kadira:flow-router']) {                                                                                   // 144
  Package['kadira:flow-router'].FlowRouter.wait();                                                                     //
}                                                                                                                      //
                                                                                                                       //
Meteor.startup(function() {                                                                                            // 147
  var adminBasePath, basePath, routes;                                                                                 // 149
  routes = [];                                                                                                         //
  basePath = Blog.settings.basePath === '/' ? '' : Blog.settings.basePath;                                             //
  adminBasePath = Blog.settings.adminBasePath === '/' ? '' : Blog.settings.adminBasePath;                              //
  routes.push({                                                                                                        //
    path: basePath || '/',                                                                                             //
    name: 'blogIndex',                                                                                                 //
    fastRender: function() {                                                                                           //
      this.subscribe('blog.authors');                                                                                  //
      return this.subscribe('blog.posts');                                                                             //
    }                                                                                                                  //
  });                                                                                                                  //
  routes.push({                                                                                                        //
    path: basePath + '/tag/:tag',                                                                                      //
    name: 'blogTagged',                                                                                                //
    fastRender: function(params) {                                                                                     //
      this.subscribe('blog.authors');                                                                                  //
      return this.subscribe('blog.taggedPosts', params.tag);                                                           //
    }                                                                                                                  //
  });                                                                                                                  //
  routes.push({                                                                                                        //
    path: basePath + '/:slug',                                                                                         //
    name: 'blogShow',                                                                                                  //
    fastRender: function(params) {                                                                                     //
      this.subscribe('blog.authors');                                                                                  //
      this.subscribe('blog.singlePostBySlug', params.slug);                                                            //
      return this.subscribe('blog.commentsBySlug', params.slug);                                                       //
    }                                                                                                                  //
  });                                                                                                                  //
  routes.push({                                                                                                        //
    path: adminBasePath,                                                                                               //
    name: 'blogAdmin'                                                                                                  //
  });                                                                                                                  //
  routes.push({                                                                                                        //
    path: adminBasePath + '/edit/:id',                                                                                 //
    name: 'blogAdminEdit'                                                                                              //
  });                                                                                                                  //
  if (Meteor.isServer) {                                                                                               //
    JsonRoutes.add('GET', '/rss/posts', function(req, res, next) {                                                     //
      res.write(Meteor.call('serveRSS'));                                                                              //
      return res.end();                                                                                                //
    });                                                                                                                //
  }                                                                                                                    //
  Blog.Router.routeAll(routes);                                                                                        //
  if (Package['kadira:flow-router']) {                                                                                 //
    return FlowRouter.initialize();                                                                                    //
  }                                                                                                                    //
});                                                                                                                    // 147
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/boot.coffee.js                                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Blog.subs = new SubsManager({                                                                                          // 6
  cacheLimit: 10,                                                                                                      //
  expireIn: 5                                                                                                          //
});                                                                                                                    //
                                                                                                                       //
Meteor.startup(function() {                                                                                            // 10
  ShareIt.init(Blog.settings.shareit);                                                                                 //
  if (Blog.settings.syntaxHighlightingTheme) {                                                                         //
    $('<link>', {                                                                                                      //
      href: '//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/' + Blog.settings.syntaxHighlightingTheme + '.min.css',
      rel: 'stylesheet'                                                                                                //
    }).appendTo('head');                                                                                               //
  }                                                                                                                    //
  if (Blog.settings.cdnFontAwesome) {                                                                                  //
    $('<link>', {                                                                                                      //
      href: '//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css',                                       //
      rel: 'stylesheet'                                                                                                //
    }).appendTo('head');                                                                                               //
  }                                                                                                                    //
  return $('body').on('click', '.blog-load-more', function(e) {                                                        //
    e.preventDefault();                                                                                                //
    if (Session.get('blog.postLimit')) {                                                                               //
      return Session.set('blog.postLimit', Session.get('blog.postLimit') + Blog.settings.pageSize);                    //
    }                                                                                                                  //
  });                                                                                                                  //
});                                                                                                                    // 10
                                                                                                                       //
Template.registerHelper('BlogLanguage', function() {                                                                   // 37
  return Blog.settings.language;                                                                                       // 38
});                                                                                                                    // 37
                                                                                                                       //
Template.registerHelper("blogFormatDate", function(date) {                                                             // 40
  return moment(new Date(date)).format(Blog.settings.dateFormat);                                                      //
});                                                                                                                    // 40
                                                                                                                       //
Template.registerHelper("blogFormatTags", function(tags) {                                                             // 43
  var i, len, path, str, tag;                                                                                          // 44
  if (tags == null) {                                                                                                  //
    return;                                                                                                            // 44
  }                                                                                                                    //
  for (i = 0, len = tags.length; i < len; i++) {                                                                       // 46
    tag = tags[i];                                                                                                     //
    path = Blog.Router.pathFor('blogTagged', {                                                                         //
      tag: tag                                                                                                         //
    });                                                                                                                //
    if (typeof str !== "undefined" && str !== null) {                                                                  //
      str += ", <a href=\"" + path + "\">" + tag + "</a>";                                                             //
    } else {                                                                                                           //
      str = "<a href=\"" + path + "\">" + tag + "</a>";                                                                //
    }                                                                                                                  //
  }                                                                                                                    // 46
  return new Spacebars.SafeString(str);                                                                                // 52
});                                                                                                                    // 43
                                                                                                                       //
Template.registerHelper("blogJoinTags", function(list) {                                                               // 54
  if (list) {                                                                                                          //
    return list.join(', ');                                                                                            //
  }                                                                                                                    //
});                                                                                                                    // 54
                                                                                                                       //
Template.registerHelper("blogPager", function() {                                                                      // 58
  var loadMore;                                                                                                        // 59
  if (Blog.Post.count() === Session.get('blog.postLimit')) {                                                           //
    loadMore = Blog.settings.language.loadMore;                                                                        //
    return new Spacebars.SafeString('<a class="blog-load-more btn" href="#">' + loadMore + '</a>');                    // 61
  }                                                                                                                    //
});                                                                                                                    // 58
                                                                                                                       //
Template.registerHelper('blogPathFor', function(name, options) {                                                       // 63
  return Blog.Router.pathFor(name, this, options);                                                                     // 64
});                                                                                                                    // 63
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/side-comments.js                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/**                                                                                                                    // 1
 * Require the given path.                                                                                             // 2
 *                                                                                                                     // 3
 * @param {String} path                                                                                                // 4
 * @return {Object} exports                                                                                            // 5
 * @api public                                                                                                         // 6
 */                                                                                                                    // 7
                                                                                                                       // 8
/*                                                                                                                     // 9
 * Wrapped to work with Meteor                                                                                         // 10
*/                                                                                                                     // 11
                                                                                                                       // 12
function requireClass(path, parent, orig) {                                                                            // 13
  var resolved = require.resolve(path);                                                                                // 14
                                                                                                                       // 15
  // lookup failed                                                                                                     // 16
  if (null == resolved) {                                                                                              // 17
    orig = orig || path;                                                                                               // 18
    parent = parent || 'root';                                                                                         // 19
    var err = new Error('Failed to require "' + orig + '" from "' + parent + '"');                                     // 20
    err.path = orig;                                                                                                   // 21
    err.parent = parent;                                                                                               // 22
    err.require = true;                                                                                                // 23
    throw err;                                                                                                         // 24
  }                                                                                                                    // 25
                                                                                                                       // 26
  var module = require.modules[resolved];                                                                              // 27
                                                                                                                       // 28
  // perform real require()                                                                                            // 29
  // by invoking the module's                                                                                          // 30
  // registered function                                                                                               // 31
  if (!module._resolving && !module.exports) {                                                                         // 32
    var mod = {};                                                                                                      // 33
    mod.exports = {};                                                                                                  // 34
    mod.client = mod.component = true;                                                                                 // 35
    module._resolving = true;                                                                                          // 36
    module.call(this, mod.exports, require.relative(resolved), mod);                                                   // 37
    delete module._resolving;                                                                                          // 38
    module.exports = mod.exports;                                                                                      // 39
  }                                                                                                                    // 40
                                                                                                                       // 41
  return module.exports;                                                                                               // 42
}                                                                                                                      // 43
                                                                                                                       // 44
window.require = requireClass                                                                                          // 45
                                                                                                                       // 46
/**                                                                                                                    // 47
 * Registered modules.                                                                                                 // 48
 */                                                                                                                    // 49
                                                                                                                       // 50
require.modules = {};                                                                                                  // 51
                                                                                                                       // 52
/**                                                                                                                    // 53
 * Registered aliases.                                                                                                 // 54
 */                                                                                                                    // 55
                                                                                                                       // 56
require.aliases = {};                                                                                                  // 57
                                                                                                                       // 58
/**                                                                                                                    // 59
 * Resolve `path`.                                                                                                     // 60
 *                                                                                                                     // 61
 * Lookup:                                                                                                             // 62
 *                                                                                                                     // 63
 *   - PATH/index.js                                                                                                   // 64
 *   - PATH.js                                                                                                         // 65
 *   - PATH                                                                                                            // 66
 *                                                                                                                     // 67
 * @param {String} path                                                                                                // 68
 * @return {String} path or null                                                                                       // 69
 * @api private                                                                                                        // 70
 */                                                                                                                    // 71
                                                                                                                       // 72
require.resolve = function(path) {                                                                                     // 73
  if (path.charAt(0) === '/') path = path.slice(1);                                                                    // 74
                                                                                                                       // 75
  var paths = [                                                                                                        // 76
    path,                                                                                                              // 77
    path + '.js',                                                                                                      // 78
    path + '.json',                                                                                                    // 79
    path + '/index.js',                                                                                                // 80
    path + '/index.json'                                                                                               // 81
  ];                                                                                                                   // 82
                                                                                                                       // 83
  for (var i = 0; i < paths.length; i++) {                                                                             // 84
    var path = paths[i];                                                                                               // 85
    if (require.modules.hasOwnProperty(path)) return path;                                                             // 86
    if (require.aliases.hasOwnProperty(path)) return require.aliases[path];                                            // 87
  }                                                                                                                    // 88
};                                                                                                                     // 89
                                                                                                                       // 90
/**                                                                                                                    // 91
 * Normalize `path` relative to the current path.                                                                      // 92
 *                                                                                                                     // 93
 * @param {String} curr                                                                                                // 94
 * @param {String} path                                                                                                // 95
 * @return {String}                                                                                                    // 96
 * @api private                                                                                                        // 97
 */                                                                                                                    // 98
                                                                                                                       // 99
require.normalize = function(curr, path) {                                                                             // 100
  var segs = [];                                                                                                       // 101
                                                                                                                       // 102
  if ('.' != path.charAt(0)) return path;                                                                              // 103
                                                                                                                       // 104
  curr = curr.split('/');                                                                                              // 105
  path = path.split('/');                                                                                              // 106
                                                                                                                       // 107
  for (var i = 0; i < path.length; ++i) {                                                                              // 108
    if ('..' == path[i]) {                                                                                             // 109
      curr.pop();                                                                                                      // 110
    } else if ('.' != path[i] && '' != path[i]) {                                                                      // 111
      segs.push(path[i]);                                                                                              // 112
    }                                                                                                                  // 113
  }                                                                                                                    // 114
                                                                                                                       // 115
  return curr.concat(segs).join('/');                                                                                  // 116
};                                                                                                                     // 117
                                                                                                                       // 118
/**                                                                                                                    // 119
 * Register module at `path` with callback `definition`.                                                               // 120
 *                                                                                                                     // 121
 * @param {String} path                                                                                                // 122
 * @param {Function} definition                                                                                        // 123
 * @api private                                                                                                        // 124
 */                                                                                                                    // 125
                                                                                                                       // 126
require.register = function(path, definition) {                                                                        // 127
  require.modules[path] = definition;                                                                                  // 128
};                                                                                                                     // 129
                                                                                                                       // 130
/**                                                                                                                    // 131
 * Alias a module definition.                                                                                          // 132
 *                                                                                                                     // 133
 * @param {String} from                                                                                                // 134
 * @param {String} to                                                                                                  // 135
 * @api private                                                                                                        // 136
 */                                                                                                                    // 137
                                                                                                                       // 138
require.alias = function(from, to) {                                                                                   // 139
  if (!require.modules.hasOwnProperty(from)) {                                                                         // 140
    throw new Error('Failed to alias "' + from + '", it does not exist');                                              // 141
  }                                                                                                                    // 142
  require.aliases[to] = from;                                                                                          // 143
};                                                                                                                     // 144
                                                                                                                       // 145
/**                                                                                                                    // 146
 * Return a require function relative to the `parent` path.                                                            // 147
 *                                                                                                                     // 148
 * @param {String} parent                                                                                              // 149
 * @return {Function}                                                                                                  // 150
 * @api private                                                                                                        // 151
 */                                                                                                                    // 152
                                                                                                                       // 153
require.relative = function(parent) {                                                                                  // 154
  var p = require.normalize(parent, '..');                                                                             // 155
                                                                                                                       // 156
  /**                                                                                                                  // 157
   * lastIndexOf helper.                                                                                               // 158
   */                                                                                                                  // 159
                                                                                                                       // 160
  function lastIndexOf(arr, obj) {                                                                                     // 161
    var i = arr.length;                                                                                                // 162
    while (i--) {                                                                                                      // 163
      if (arr[i] === obj) return i;                                                                                    // 164
    }                                                                                                                  // 165
    return -1;                                                                                                         // 166
  }                                                                                                                    // 167
                                                                                                                       // 168
  /**                                                                                                                  // 169
   * The relative require() itself.                                                                                    // 170
   */                                                                                                                  // 171
                                                                                                                       // 172
  function localRequire(path) {                                                                                        // 173
    var resolved = localRequire.resolve(path);                                                                         // 174
    return require(resolved, parent, path);                                                                            // 175
  }                                                                                                                    // 176
                                                                                                                       // 177
  /**                                                                                                                  // 178
   * Resolve relative to the parent.                                                                                   // 179
   */                                                                                                                  // 180
                                                                                                                       // 181
  localRequire.resolve = function(path) {                                                                              // 182
    var c = path.charAt(0);                                                                                            // 183
    if ('/' == c) return path.slice(1);                                                                                // 184
    if ('.' == c) return require.normalize(p, path);                                                                   // 185
                                                                                                                       // 186
    // resolve deps by returning                                                                                       // 187
    // the dep in the nearest "deps"                                                                                   // 188
    // directory                                                                                                       // 189
    var segs = parent.split('/');                                                                                      // 190
    var i = lastIndexOf(segs, 'deps') + 1;                                                                             // 191
    if (!i) i = 0;                                                                                                     // 192
    path = segs.slice(0, i + 1).join('/') + '/deps/' + path;                                                           // 193
    return path;                                                                                                       // 194
  };                                                                                                                   // 195
                                                                                                                       // 196
  /**                                                                                                                  // 197
   * Check if module is defined at `path`.                                                                             // 198
   */                                                                                                                  // 199
                                                                                                                       // 200
  localRequire.exists = function(path) {                                                                               // 201
    return require.modules.hasOwnProperty(localRequire.resolve(path));                                                 // 202
  };                                                                                                                   // 203
                                                                                                                       // 204
  return localRequire;                                                                                                 // 205
};                                                                                                                     // 206
require.register("component-emitter/index.js", function(exports, require, module){                                     // 207
                                                                                                                       // 208
/**                                                                                                                    // 209
 * Expose `Emitter`.                                                                                                   // 210
 */                                                                                                                    // 211
                                                                                                                       // 212
module.exports = Emitter;                                                                                              // 213
                                                                                                                       // 214
/**                                                                                                                    // 215
 * Initialize a new `Emitter`.                                                                                         // 216
 *                                                                                                                     // 217
 * @api public                                                                                                         // 218
 */                                                                                                                    // 219
                                                                                                                       // 220
function Emitter(obj) {                                                                                                // 221
  if (obj) return mixin(obj);                                                                                          // 222
};                                                                                                                     // 223
                                                                                                                       // 224
/**                                                                                                                    // 225
 * Mixin the emitter properties.                                                                                       // 226
 *                                                                                                                     // 227
 * @param {Object} obj                                                                                                 // 228
 * @return {Object}                                                                                                    // 229
 * @api private                                                                                                        // 230
 */                                                                                                                    // 231
                                                                                                                       // 232
function mixin(obj) {                                                                                                  // 233
  for (var key in Emitter.prototype) {                                                                                 // 234
    obj[key] = Emitter.prototype[key];                                                                                 // 235
  }                                                                                                                    // 236
  return obj;                                                                                                          // 237
}                                                                                                                      // 238
                                                                                                                       // 239
/**                                                                                                                    // 240
 * Listen on the given `event` with `fn`.                                                                              // 241
 *                                                                                                                     // 242
 * @param {String} event                                                                                               // 243
 * @param {Function} fn                                                                                                // 244
 * @return {Emitter}                                                                                                   // 245
 * @api public                                                                                                         // 246
 */                                                                                                                    // 247
                                                                                                                       // 248
Emitter.prototype.on =                                                                                                 // 249
Emitter.prototype.addEventListener = function(event, fn){                                                              // 250
  this._callbacks = this._callbacks || {};                                                                             // 251
  (this._callbacks[event] = this._callbacks[event] || [])                                                              // 252
    .push(fn);                                                                                                         // 253
  return this;                                                                                                         // 254
};                                                                                                                     // 255
                                                                                                                       // 256
/**                                                                                                                    // 257
 * Adds an `event` listener that will be invoked a single                                                              // 258
 * time then automatically removed.                                                                                    // 259
 *                                                                                                                     // 260
 * @param {String} event                                                                                               // 261
 * @param {Function} fn                                                                                                // 262
 * @return {Emitter}                                                                                                   // 263
 * @api public                                                                                                         // 264
 */                                                                                                                    // 265
                                                                                                                       // 266
Emitter.prototype.once = function(event, fn){                                                                          // 267
  var self = this;                                                                                                     // 268
  this._callbacks = this._callbacks || {};                                                                             // 269
                                                                                                                       // 270
  function on() {                                                                                                      // 271
    self.off(event, on);                                                                                               // 272
    fn.apply(this, arguments);                                                                                         // 273
  }                                                                                                                    // 274
                                                                                                                       // 275
  on.fn = fn;                                                                                                          // 276
  this.on(event, on);                                                                                                  // 277
  return this;                                                                                                         // 278
};                                                                                                                     // 279
                                                                                                                       // 280
/**                                                                                                                    // 281
 * Remove the given callback for `event` or all                                                                        // 282
 * registered callbacks.                                                                                               // 283
 *                                                                                                                     // 284
 * @param {String} event                                                                                               // 285
 * @param {Function} fn                                                                                                // 286
 * @return {Emitter}                                                                                                   // 287
 * @api public                                                                                                         // 288
 */                                                                                                                    // 289
                                                                                                                       // 290
Emitter.prototype.off =                                                                                                // 291
Emitter.prototype.removeListener =                                                                                     // 292
Emitter.prototype.removeAllListeners =                                                                                 // 293
Emitter.prototype.removeEventListener = function(event, fn){                                                           // 294
  this._callbacks = this._callbacks || {};                                                                             // 295
                                                                                                                       // 296
  // all                                                                                                               // 297
  if (0 == arguments.length) {                                                                                         // 298
    this._callbacks = {};                                                                                              // 299
    return this;                                                                                                       // 300
  }                                                                                                                    // 301
                                                                                                                       // 302
  // specific event                                                                                                    // 303
  var callbacks = this._callbacks[event];                                                                              // 304
  if (!callbacks) return this;                                                                                         // 305
                                                                                                                       // 306
  // remove all handlers                                                                                               // 307
  if (1 == arguments.length) {                                                                                         // 308
    delete this._callbacks[event];                                                                                     // 309
    return this;                                                                                                       // 310
  }                                                                                                                    // 311
                                                                                                                       // 312
  // remove specific handler                                                                                           // 313
  var cb;                                                                                                              // 314
  for (var i = 0; i < callbacks.length; i++) {                                                                         // 315
    cb = callbacks[i];                                                                                                 // 316
    if (cb === fn || cb.fn === fn) {                                                                                   // 317
      callbacks.splice(i, 1);                                                                                          // 318
      break;                                                                                                           // 319
    }                                                                                                                  // 320
  }                                                                                                                    // 321
  return this;                                                                                                         // 322
};                                                                                                                     // 323
                                                                                                                       // 324
/**                                                                                                                    // 325
 * Emit `event` with the given args.                                                                                   // 326
 *                                                                                                                     // 327
 * @param {String} event                                                                                               // 328
 * @param {Mixed} ...                                                                                                  // 329
 * @return {Emitter}                                                                                                   // 330
 */                                                                                                                    // 331
                                                                                                                       // 332
Emitter.prototype.emit = function(event){                                                                              // 333
  this._callbacks = this._callbacks || {};                                                                             // 334
  var args = [].slice.call(arguments, 1)                                                                               // 335
    , callbacks = this._callbacks[event];                                                                              // 336
                                                                                                                       // 337
  if (callbacks) {                                                                                                     // 338
    callbacks = callbacks.slice(0);                                                                                    // 339
    for (var i = 0, len = callbacks.length; i < len; ++i) {                                                            // 340
      callbacks[i].apply(this, args);                                                                                  // 341
    }                                                                                                                  // 342
  }                                                                                                                    // 343
                                                                                                                       // 344
  return this;                                                                                                         // 345
};                                                                                                                     // 346
                                                                                                                       // 347
/**                                                                                                                    // 348
 * Return array of callbacks for `event`.                                                                              // 349
 *                                                                                                                     // 350
 * @param {String} event                                                                                               // 351
 * @return {Array}                                                                                                     // 352
 * @api public                                                                                                         // 353
 */                                                                                                                    // 354
                                                                                                                       // 355
Emitter.prototype.listeners = function(event){                                                                         // 356
  this._callbacks = this._callbacks || {};                                                                             // 357
  return this._callbacks[event] || [];                                                                                 // 358
};                                                                                                                     // 359
                                                                                                                       // 360
/**                                                                                                                    // 361
 * Check if this emitter has `event` handlers.                                                                         // 362
 *                                                                                                                     // 363
 * @param {String} event                                                                                               // 364
 * @return {Boolean}                                                                                                   // 365
 * @api public                                                                                                         // 366
 */                                                                                                                    // 367
                                                                                                                       // 368
Emitter.prototype.hasListeners = function(event){                                                                      // 369
  return !! this.listeners(event).length;                                                                              // 370
};                                                                                                                     // 371
                                                                                                                       // 372
});                                                                                                                    // 373
require.register("side-comments/js/main.js", function(exports, require, module){                                       // 374
var _ = require('./vendor/lodash-custom.js');                                                                          // 375
var Section = require('./section.js');                                                                                 // 376
var Emitter = require('emitter');                                                                                      // 377
var eventPipe = new Emitter;                                                                                           // 378
                                                                                                                       // 379
/**                                                                                                                    // 380
 * Creates a new SideComments instance.                                                                                // 381
 * @param {Object} el               The selector for the element for                                                   // 382
 *                                  which side comments need to be initialized                                         // 383
 * @param {Object} currentUser      An object defining the current user. Used                                          // 384
 *                                  for posting new comments and deciding                                              // 385
 *                                  whether existing ones can be deleted                                               // 386
 *                                  or not.                                                                            // 387
 * @param {Array} existingComments An array of existing comments, in                                                   // 388
 *                                 the proper structure.                                                               // 389
 *                                                                                                                     // 390
 * TODO: **GIVE EXAMPLE OF STRUCTURE HERE***                                                                           // 391
 */                                                                                                                    // 392
function SideComments( el, currentUser, existingComments ) {                                                           // 393
  this.$el = $(el);                                                                                                    // 394
  this.$body = $('body');                                                                                              // 395
  this.eventPipe = eventPipe;                                                                                          // 396
                                                                                                                       // 397
  this.currentUser = _.clone(currentUser) || null;                                                                     // 398
  this.existingComments = _.cloneDeep(existingComments) || [];                                                         // 399
  this.sections = [];                                                                                                  // 400
  this.activeSection = null;                                                                                           // 401
                                                                                                                       // 402
  // Event bindings                                                                                                    // 403
  this.eventPipe.on('showComments', _.bind(this.showComments, this));                                                  // 404
  this.eventPipe.on('hideComments', _.bind(this.hideComments, this));                                                  // 405
  this.eventPipe.on('sectionSelected', _.bind(this.sectionSelected, this));                                            // 406
  this.eventPipe.on('sectionDeselected', _.bind(this.sectionDeselected, this));                                        // 407
  this.eventPipe.on('commentPosted', _.bind(this.commentPosted, this));                                                // 408
  this.eventPipe.on('commentDeleted', _.bind(this.commentDeleted, this));                                              // 409
  this.eventPipe.on('addCommentAttempted', _.bind(this.addCommentAttempted, this));                                    // 410
  this.$body.on('click', _.bind(this.bodyClick, this));                                                                // 411
                                                                                                                       // 412
  this.initialize(this.existingComments);                                                                              // 413
}                                                                                                                      // 414
                                                                                                                       // 415
// Mix in Emitter                                                                                                      // 416
Emitter(SideComments.prototype);                                                                                       // 417
                                                                                                                       // 418
/**                                                                                                                    // 419
 * Adds the comments beside each commentable section.                                                                  // 420
 */                                                                                                                    // 421
SideComments.prototype.initialize = function( existingComments ) {                                                     // 422
  _.each(this.$el.find('.commentable-section'), function( section ){                                                   // 423
    var $section = $(section);                                                                                         // 424
    var sectionId = $section.data('section-id').toString();                                                            // 425
    var sectionComments = _.find(this.existingComments, { sectionId: sectionId });                                     // 426
                                                                                                                       // 427
    this.sections.push(new Section(this.eventPipe, $section, this.currentUser, sectionComments));                      // 428
  }, this);                                                                                                            // 429
};                                                                                                                     // 430
                                                                                                                       // 431
/**                                                                                                                    // 432
 * Shows the side comments.                                                                                            // 433
 */                                                                                                                    // 434
SideComments.prototype.showComments = function() {                                                                     // 435
  this.$el.addClass('side-comments-open');                                                                             // 436
};                                                                                                                     // 437
                                                                                                                       // 438
/**                                                                                                                    // 439
 * Hide the comments.                                                                                                  // 440
 */                                                                                                                    // 441
SideComments.prototype.hideComments = function() {                                                                     // 442
  if (this.activeSection) {                                                                                            // 443
    this.activeSection.deselect();                                                                                     // 444
    this.activeSection = null;                                                                                         // 445
  }                                                                                                                    // 446
                                                                                                                       // 447
  this.$el.removeClass('side-comments-open');                                                                          // 448
};                                                                                                                     // 449
                                                                                                                       // 450
/**                                                                                                                    // 451
 * Callback after a section has been selected.                                                                         // 452
 * @param  {Object} section The Section object to be selected.                                                         // 453
 */                                                                                                                    // 454
SideComments.prototype.sectionSelected = function( section ) {                                                         // 455
  this.showComments();                                                                                                 // 456
                                                                                                                       // 457
  if (this.activeSection) {                                                                                            // 458
    this.activeSection.deselect();                                                                                     // 459
  }                                                                                                                    // 460
                                                                                                                       // 461
  this.activeSection = section;                                                                                        // 462
};                                                                                                                     // 463
                                                                                                                       // 464
/**                                                                                                                    // 465
 * Callback after a section has been deselected.                                                                       // 466
 * @param  {Object} section The Section object to be selected.                                                         // 467
 */                                                                                                                    // 468
SideComments.prototype.sectionDeselected = function( section ) {                                                       // 469
  this.hideComments();                                                                                                 // 470
  this.activeSection = null;                                                                                           // 471
};                                                                                                                     // 472
                                                                                                                       // 473
/**                                                                                                                    // 474
 * Fired when the commentPosted event is triggered.                                                                    // 475
 * @param  {Object} comment  The comment object to be posted.                                                          // 476
 */                                                                                                                    // 477
SideComments.prototype.commentPosted = function( comment ) {                                                           // 478
  this.emit('commentPosted', comment);                                                                                 // 479
};                                                                                                                     // 480
                                                                                                                       // 481
/**                                                                                                                    // 482
 * Fired when the commentDeleted event is triggered.                                                                   // 483
 * @param  {Object} comment  The commentId of the deleted comment.                                                     // 484
 */                                                                                                                    // 485
SideComments.prototype.commentDeleted = function( comment ) {                                                          // 486
  this.emit('commentDeleted', comment);                                                                                // 487
};                                                                                                                     // 488
                                                                                                                       // 489
/**                                                                                                                    // 490
 * Fire an event to to signal that a comment as attempted to be added without                                          // 491
 * a currentUser.                                                                                                      // 492
 */                                                                                                                    // 493
SideComments.prototype.addCommentAttempted = function() {                                                              // 494
  this.emit('addCommentAttempted');                                                                                    // 495
};                                                                                                                     // 496
                                                                                                                       // 497
/**                                                                                                                    // 498
 * Inserts the given comment into the right section.                                                                   // 499
 * @param  {Object} comment A comment to be inserted.                                                                  // 500
 */                                                                                                                    // 501
SideComments.prototype.insertComment = function( comment ) {                                                           // 502
  var section = _.find(this.sections, { id: comment.sectionId });                                                      // 503
  section.insertComment(comment);                                                                                      // 504
};                                                                                                                     // 505
                                                                                                                       // 506
/**                                                                                                                    // 507
 * Removes the given comment from the right section.                                                                   // 508
 * @param sectionId The ID of the section where the comment exists.                                                    // 509
 * @param commentId The ID of the comment to be removed.                                                               // 510
 */                                                                                                                    // 511
SideComments.prototype.removeComment = function( sectionId, commentId ) {                                              // 512
  var section = _.find(this.sections, { id: sectionId });                                                              // 513
  section.removeComment(commentId);                                                                                    // 514
};                                                                                                                     // 515
                                                                                                                       // 516
/**                                                                                                                    // 517
 * Delete the comment specified by the given sectionID and commentID.                                                  // 518
 * @param sectionId The section the comment belongs to.                                                                // 519
 * @param commentId The comment's ID                                                                                   // 520
 */                                                                                                                    // 521
SideComments.prototype.deleteComment = function( sectionId, commentId ) {                                              // 522
  var section = _.find(this.sections, { id: sectionId });                                                              // 523
  section.deleteComment(commentId);                                                                                    // 524
};                                                                                                                     // 525
                                                                                                                       // 526
/**                                                                                                                    // 527
 * Checks if comments are visible or not.                                                                              // 528
 * @return {Boolean} Whether or not the comments are visible.                                                          // 529
 */                                                                                                                    // 530
SideComments.prototype.commentsAreVisible = function() {                                                               // 531
  return this.$el.hasClass('side-comments-open');                                                                      // 532
};                                                                                                                     // 533
                                                                                                                       // 534
/**                                                                                                                    // 535
 * Callback for body clicks. We hide the comments if someone clicks outside of the comments section.                   // 536
 * @param  {Object} event The event object.                                                                            // 537
 */                                                                                                                    // 538
SideComments.prototype.bodyClick = function( event ) {                                                                 // 539
  var $target = $(event.target);                                                                                       // 540
                                                                                                                       // 541
  // We do a check on $('body') existing here because if the $target has                                               // 542
  // no parent body then it's because it belongs to a deleted comment and                                              // 543
  // we should NOT hide the SideComments.                                                                              // 544
  if ($target.closest('.side-comment').length < 1 && $target.closest('body').length > 0) {                             // 545
    if (this.activeSection) {                                                                                          // 546
      this.activeSection.deselect();                                                                                   // 547
    }                                                                                                                  // 548
    this.hideComments();                                                                                               // 549
  }                                                                                                                    // 550
};                                                                                                                     // 551
                                                                                                                       // 552
/**                                                                                                                    // 553
 * Set the currentUser and update the UI as necessary.                                                                 // 554
 * @param {Object} currentUser The currentUser to be used.                                                             // 555
 */                                                                                                                    // 556
SideComments.prototype.setCurrentUser = function( currentUser ) {                                                      // 557
  this.hideComments();                                                                                                 // 558
  this.currentUser = currentUser;                                                                                      // 559
  _.each(this.sections, function( section ) {                                                                          // 560
    section.currentUser = this.currentUser;                                                                            // 561
    section.render();                                                                                                  // 562
  });                                                                                                                  // 563
};                                                                                                                     // 564
                                                                                                                       // 565
/**                                                                                                                    // 566
 * Remove the currentUser and update the UI as necessary.                                                              // 567
 */                                                                                                                    // 568
SideComments.prototype.removeCurrentUser = function() {                                                                // 569
  this.hideComments();                                                                                                 // 570
  this.currentUser = null;                                                                                             // 571
  _.each(this.sections, function( section ) {                                                                          // 572
    section.currentUser = null;                                                                                        // 573
    section.render();                                                                                                  // 574
  });                                                                                                                  // 575
};                                                                                                                     // 576
                                                                                                                       // 577
/**                                                                                                                    // 578
 * Destroys the instance of SideComments, including unbinding from DOM events.                                         // 579
 */                                                                                                                    // 580
SideComments.prototype.destroy = function() {                                                                          // 581
  this.hideComments();                                                                                                 // 582
  this.$el.off();                                                                                                      // 583
};                                                                                                                     // 584
                                                                                                                       // 585
module.exports = SideComments;                                                                                         // 586
});                                                                                                                    // 587
require.register("side-comments/js/section.js", function(exports, require, module){                                    // 588
var _ = require('./vendor/lodash-custom.js');                                                                          // 589
var Template = require('../templates/section.html');                                                                   // 590
var CommentTemplate = require('../templates/comment.html');                                                            // 591
                                                                                                                       // 592
/**                                                                                                                    // 593
 * Creates a new Section object, which is responsible for managing a                                                   // 594
 * single comment section.                                                                                             // 595
 * @param {Object} eventPipe The Emitter object used for passing around events.                                        // 596
 * @param {Array} comments   The array of comments for this section. Optional.                                         // 597
 */                                                                                                                    // 598
function Section( eventPipe, $el, currentUser, comments ) {                                                            // 599
	this.eventPipe = eventPipe;                                                                                           // 600
	this.$el = $el;                                                                                                       // 601
	this.comments = comments ? comments.comments : [];                                                                    // 602
	this.currentUser = currentUser || null;                                                                               // 603
                                                                                                                       // 604
	this.id = $el.data('section-id');                                                                                     // 605
                                                                                                                       // 606
	this.$el.on('click', '.side-comment .marker', _.bind(this.markerClick, this));                                        // 607
	this.$el.on('click', '.side-comment .add-comment', _.bind(this.addCommentClick, this));                               // 608
	this.$el.on('click', '.side-comment .post', _.bind(this.postCommentClick, this));                                     // 609
	this.$el.on('click', '.side-comment .cancel', _.bind(this.cancelCommentClick, this));                                 // 610
	this.$el.on('click', '.side-comment .delete', _.bind(this.deleteCommentClick, this));                                 // 611
                                                                                                                       // 612
	this.render();                                                                                                        // 613
}                                                                                                                      // 614
                                                                                                                       // 615
/**                                                                                                                    // 616
 * Click callback event on markers.                                                                                    // 617
 * @param  {Object} event The event object.                                                                            // 618
 */                                                                                                                    // 619
Section.prototype.markerClick = function( event ) {                                                                    // 620
	event.preventDefault();                                                                                               // 621
                                                                                                                       // 622
	if (this.isSelected()) {                                                                                              // 623
		this.deselect();                                                                                                     // 624
		this.eventPipe.emit('sectionDeselected', this);                                                                      // 625
	} else {                                                                                                              // 626
		this.select();                                                                                                       // 627
		this.eventPipe.emit('sectionSelected', this);                                                                        // 628
	}                                                                                                                     // 629
}                                                                                                                      // 630
                                                                                                                       // 631
/**                                                                                                                    // 632
 * Callback for the comment button click event.                                                                        // 633
 * @param {Object} event The event object.                                                                             // 634
 */                                                                                                                    // 635
Section.prototype.addCommentClick = function( event ) {                                                                // 636
  event.preventDefault();                                                                                              // 637
  if (this.currentUser) {                                                                                              // 638
  	this.showCommentForm();                                                                                             // 639
  } else {                                                                                                             // 640
  	this.eventPipe.emit('addCommentAttempted');                                                                         // 641
  }                                                                                                                    // 642
};                                                                                                                     // 643
                                                                                                                       // 644
/**                                                                                                                    // 645
 * Show the comment form for this section.                                                                             // 646
 */                                                                                                                    // 647
Section.prototype.showCommentForm = function() {                                                                       // 648
  if (this.comments.length > 0) {                                                                                      // 649
    this.$el.find('.add-comment').addClass('hide');                                                                    // 650
    this.$el.find('.comment-form').addClass('active');                                                                 // 651
  }                                                                                                                    // 652
                                                                                                                       // 653
  this.focusCommentBox();                                                                                              // 654
};                                                                                                                     // 655
                                                                                                                       // 656
/**                                                                                                                    // 657
 * Hides the comment form for this section.                                                                            // 658
 */                                                                                                                    // 659
Section.prototype.hideCommentForm = function() {                                                                       // 660
  if (this.comments.length > 0) {                                                                                      // 661
    this.$el.find('.add-comment').removeClass('hide');                                                                 // 662
    this.$el.find('.comment-form').removeClass('active');                                                              // 663
  }                                                                                                                    // 664
                                                                                                                       // 665
  this.$el.find('.comment-box').empty();                                                                               // 666
};                                                                                                                     // 667
                                                                                                                       // 668
/**                                                                                                                    // 669
 * Focus on the comment box in the comment form.                                                                       // 670
 */                                                                                                                    // 671
Section.prototype.focusCommentBox = function() {                                                                       // 672
	this.$el.find('.comment-box').get(0).focus();                                                                         // 673
};                                                                                                                     // 674
                                                                                                                       // 675
/**                                                                                                                    // 676
 * Cancel comment callback.                                                                                            // 677
 * @param  {Object} event The event object.                                                                            // 678
 */                                                                                                                    // 679
Section.prototype.cancelCommentClick = function( event ) {                                                             // 680
  event.preventDefault();                                                                                              // 681
  this.cancelComment();                                                                                                // 682
};                                                                                                                     // 683
                                                                                                                       // 684
/**                                                                                                                    // 685
 * Cancel adding of a comment.                                                                                         // 686
 */                                                                                                                    // 687
Section.prototype.cancelComment = function() {                                                                         // 688
  if (this.comments.length > 0) {                                                                                      // 689
    this.hideCommentForm();                                                                                            // 690
  } else {                                                                                                             // 691
  	this.deselect();                                                                                                    // 692
    this.eventPipe.emit('hideComments');                                                                               // 693
  }                                                                                                                    // 694
};                                                                                                                     // 695
                                                                                                                       // 696
/**                                                                                                                    // 697
 * Post comment callback.                                                                                              // 698
 * @param  {Object} event The event object.                                                                            // 699
 */                                                                                                                    // 700
Section.prototype.postCommentClick = function( event ) {                                                               // 701
  event.preventDefault();                                                                                              // 702
  this.postComment();                                                                                                  // 703
};                                                                                                                     // 704
                                                                                                                       // 705
/**                                                                                                                    // 706
 * Post a comment to this section.                                                                                     // 707
 */                                                                                                                    // 708
Section.prototype.postComment = function() {                                                                           // 709
	this.$el.find(".comment-box").children().not("br").each(function() {                                                  // 710
		$(this).replaceWith(this.innerHTML);                                                                                 // 711
	});                                                                                                                   // 712
  var commentBody = this.$el.find('.comment-box').html();                                                              // 713
  var comment = {                                                                                                      // 714
  	sectionId: this.id,                                                                                                 // 715
  	comment: commentBody,                                                                                               // 716
  	authorAvatarUrl: this.currentUser.avatarUrl,                                                                        // 717
  	authorName: this.currentUser.name,                                                                                  // 718
  	authorId: this.currentUser.id                                                                                       // 719
  };                                                                                                                   // 720
  this.eventPipe.emit('commentPosted', comment);                                                                       // 721
};                                                                                                                     // 722
                                                                                                                       // 723
/**                                                                                                                    // 724
 * Insert a comment into this sections comment list.                                                                   // 725
 * @param  {Object} comment A comment object.                                                                          // 726
 */                                                                                                                    // 727
Section.prototype.insertComment = function( comment ) {                                                                // 728
	this.comments.push(comment);                                                                                          // 729
	var newCommentHtml = _.template(CommentTemplate, {                                                                    // 730
		comment: comment,                                                                                                    // 731
		currentUser: this.currentUser                                                                                        // 732
	});                                                                                                                   // 733
	this.$el.find('.comments').append(newCommentHtml);                                                                    // 734
	this.$el.find('.side-comment').addClass('has-comments');                                                              // 735
	this.updateCommentCount();                                                                                            // 736
	this.hideCommentForm();                                                                                               // 737
};                                                                                                                     // 738
                                                                                                                       // 739
/**                                                                                                                    // 740
 * Increments the comment count for a given section.                                                                   // 741
 */                                                                                                                    // 742
Section.prototype.updateCommentCount = function() {                                                                    // 743
	this.$el.find('.marker span').text(this.comments.length);                                                             // 744
};                                                                                                                     // 745
                                                                                                                       // 746
/**                                                                                                                    // 747
 * Event handler for delete comment clicks.                                                                            // 748
 * @param  {Object} event The event object.                                                                            // 749
 */                                                                                                                    // 750
Section.prototype.deleteCommentClick = function( event ) {                                                             // 751
	event.preventDefault();                                                                                               // 752
	var commentId = $(event.target).closest('li').data('comment-id');                                                     // 753
                                                                                                                       // 754
	if (window.confirm("Are you sure you want to delete this comment?")) {                                                // 755
		this.deleteComment(commentId);                                                                                       // 756
	}                                                                                                                     // 757
};                                                                                                                     // 758
                                                                                                                       // 759
/**                                                                                                                    // 760
 * Finds the comment and emits an event with the comment to be deleted.                                                // 761
 */                                                                                                                    // 762
Section.prototype.deleteComment = function( commentId ) {                                                              // 763
	var comment = _.find(this.comments, { id: commentId });                                                               // 764
	comment.sectionId = this.id;                                                                                          // 765
	this.eventPipe.emit('commentDeleted', comment);                                                                       // 766
};                                                                                                                     // 767
                                                                                                                       // 768
/**                                                                                                                    // 769
 * Removes the comment from the list of comments and the comment array.                                                // 770
 * @param commentId The ID of the comment to be removed from this section.                                             // 771
 */                                                                                                                    // 772
Section.prototype.removeComment = function( commentId ) {                                                              // 773
	this.comments = _.reject(this.comments, { id: commentId });                                                           // 774
	this.$el.find('.side-comment .comments li[data-comment-id="'+commentId+'"]').remove();                                // 775
	this.updateCommentCount();                                                                                            // 776
	if (this.comments.length < 1) {                                                                                       // 777
		this.$el.find('.side-comment').removeClass('has-comments');                                                          // 778
	}                                                                                                                     // 779
};                                                                                                                     // 780
                                                                                                                       // 781
/**                                                                                                                    // 782
 * Mark this section as selected.                                                                                      // 783
 */                                                                                                                    // 784
Section.prototype.select = function() {                                                                                // 785
	this.$el.find('.side-comment').addClass('active');                                                                    // 786
                                                                                                                       // 787
	if (this.comments.length === 0 && this.currentUser) {                                                                 // 788
	  this.focusCommentBox();                                                                                             // 789
	}                                                                                                                     // 790
};                                                                                                                     // 791
                                                                                                                       // 792
/**                                                                                                                    // 793
 * Deselect this section.                                                                                              // 794
 */                                                                                                                    // 795
Section.prototype.deselect = function() {                                                                              // 796
	this.$el.find('.side-comment').removeClass('active');                                                                 // 797
	this.hideCommentForm();                                                                                               // 798
};                                                                                                                     // 799
                                                                                                                       // 800
Section.prototype.isSelected = function() {                                                                            // 801
	return this.$el.find('.side-comment').hasClass('active');                                                             // 802
};                                                                                                                     // 803
                                                                                                                       // 804
/**                                                                                                                    // 805
 * Get the class to be used on the side comment section wrapper.                                                       // 806
 * @return {String} The class names to use.                                                                            // 807
 */                                                                                                                    // 808
Section.prototype.sectionClasses = function() {                                                                        // 809
	var classes = '';                                                                                                     // 810
                                                                                                                       // 811
	if (this.comments.length > 0) {                                                                                       // 812
		classes = classes + ' has-comments';                                                                                 // 813
	}                                                                                                                     // 814
	if (!this.currentUser) {                                                                                              // 815
		classes = classes + ' no-current-user'                                                                               // 816
	}                                                                                                                     // 817
                                                                                                                       // 818
	return classes;                                                                                                       // 819
};                                                                                                                     // 820
                                                                                                                       // 821
/**                                                                                                                    // 822
 * Render this section into the DOM.                                                                                   // 823
 */                                                                                                                    // 824
Section.prototype.render = function() {                                                                                // 825
	this.$el.find('.side-comment').remove();                                                                              // 826
	$(_.template(Template, {                                                                                              // 827
	  commentTemplate: CommentTemplate,                                                                                   // 828
	  comments: this.comments,                                                                                            // 829
	  sectionClasses: this.sectionClasses(),                                                                              // 830
	  currentUser: this.currentUser                                                                                       // 831
	})).appendTo(this.$el);                                                                                               // 832
};                                                                                                                     // 833
                                                                                                                       // 834
/**                                                                                                                    // 835
 * Desttroy this Section object. Generally meaning unbind events.                                                      // 836
 */                                                                                                                    // 837
Section.prototype.destroy = function() {                                                                               // 838
	this.$el.off();                                                                                                       // 839
}                                                                                                                      // 840
                                                                                                                       // 841
module.exports = Section;                                                                                              // 842
});                                                                                                                    // 843
require.register("side-comments/js/vendor/lodash-custom.js", function(exports, require, module){                       // 844
/**                                                                                                                    // 845
 * @license                                                                                                            // 846
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>                                                                   // 847
 * Build: `lodash exports="node,commonjs" include="each,bind,find,template,reject,clone,cloneDeep"`                    // 848
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>                                                // 849
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>                                                      // 850
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors                            // 851
 * Available under MIT license <http://lodash.com/license>                                                             // 852
 */                                                                                                                    // 853
;(function() {                                                                                                         // 854
                                                                                                                       // 855
  /** Used as a safe reference for `undefined` in pre ES5 environments */                                              // 856
  var undefined;                                                                                                       // 857
                                                                                                                       // 858
  /** Used to pool arrays and objects used internally */                                                               // 859
  var arrayPool = [];                                                                                                  // 860
                                                                                                                       // 861
  /** Used internally to indicate various things */                                                                    // 862
  var indicatorObject = {};                                                                                            // 863
                                                                                                                       // 864
  /** Used as the max size of the `arrayPool` and `objectPool` */                                                      // 865
  var maxPoolSize = 40;                                                                                                // 866
                                                                                                                       // 867
  /** Used to match empty string literals in compiled template source */                                               // 868
  var reEmptyStringLeading = /\b__p \+= '';/g,                                                                         // 869
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,                                                                      // 870
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;                                                         // 871
                                                                                                                       // 872
  /**                                                                                                                  // 873
   * Used to match ES6 template delimiters                                                                             // 874
   * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-literals-string-literals                                 // 875
   */                                                                                                                  // 876
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;                                                                // 877
                                                                                                                       // 878
  /** Used to match regexp flags from their coerced string values */                                                   // 879
  var reFlags = /\w*$/;                                                                                                // 880
                                                                                                                       // 881
  /** Used to detected named functions */                                                                              // 882
  var reFuncName = /^\s*function[ \n\r\t]+\w/;                                                                         // 883
                                                                                                                       // 884
  /** Used to match "interpolate" template delimiters */                                                               // 885
  var reInterpolate = /<%=([\s\S]+?)%>/g;                                                                              // 886
                                                                                                                       // 887
  /** Used to ensure capturing order of template delimiters */                                                         // 888
  var reNoMatch = /($^)/;                                                                                              // 889
                                                                                                                       // 890
  /** Used to detect functions containing a `this` reference */                                                        // 891
  var reThis = /\bthis\b/;                                                                                             // 892
                                                                                                                       // 893
  /** Used to match unescaped characters in compiled string literals */                                                // 894
  var reUnescapedString = /['\n\r\t\u2028\u2029\\]/g;                                                                  // 895
                                                                                                                       // 896
  /** Used to fix the JScript [[DontEnum]] bug */                                                                      // 897
  var shadowedProps = [                                                                                                // 898
    'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',                                          // 899
    'toLocaleString', 'toString', 'valueOf'                                                                            // 900
  ];                                                                                                                   // 901
                                                                                                                       // 902
  /** Used to make template sourceURLs easier to identify */                                                           // 903
  var templateCounter = 0;                                                                                             // 904
                                                                                                                       // 905
  /** `Object#toString` result shortcuts */                                                                            // 906
  var argsClass = '[object Arguments]',                                                                                // 907
      arrayClass = '[object Array]',                                                                                   // 908
      boolClass = '[object Boolean]',                                                                                  // 909
      dateClass = '[object Date]',                                                                                     // 910
      errorClass = '[object Error]',                                                                                   // 911
      funcClass = '[object Function]',                                                                                 // 912
      numberClass = '[object Number]',                                                                                 // 913
      objectClass = '[object Object]',                                                                                 // 914
      regexpClass = '[object RegExp]',                                                                                 // 915
      stringClass = '[object String]';                                                                                 // 916
                                                                                                                       // 917
  /** Used to identify object classifications that `_.clone` supports */                                               // 918
  var cloneableClasses = {};                                                                                           // 919
  cloneableClasses[funcClass] = false;                                                                                 // 920
  cloneableClasses[argsClass] = cloneableClasses[arrayClass] =                                                         // 921
  cloneableClasses[boolClass] = cloneableClasses[dateClass] =                                                          // 922
  cloneableClasses[numberClass] = cloneableClasses[objectClass] =                                                      // 923
  cloneableClasses[regexpClass] = cloneableClasses[stringClass] = true;                                                // 924
                                                                                                                       // 925
  /** Used as the property descriptor for `__bindData__` */                                                            // 926
  var descriptor = {                                                                                                   // 927
    'configurable': false,                                                                                             // 928
    'enumerable': false,                                                                                               // 929
    'value': null,                                                                                                     // 930
    'writable': false                                                                                                  // 931
  };                                                                                                                   // 932
                                                                                                                       // 933
  /** Used as the data object for `iteratorTemplate` */                                                                // 934
  var iteratorData = {                                                                                                 // 935
    'args': '',                                                                                                        // 936
    'array': null,                                                                                                     // 937
    'bottom': '',                                                                                                      // 938
    'firstArg': '',                                                                                                    // 939
    'init': '',                                                                                                        // 940
    'keys': null,                                                                                                      // 941
    'loop': '',                                                                                                        // 942
    'shadowedProps': null,                                                                                             // 943
    'support': null,                                                                                                   // 944
    'top': '',                                                                                                         // 945
    'useHas': false                                                                                                    // 946
  };                                                                                                                   // 947
                                                                                                                       // 948
  /** Used to determine if values are of the language type Object */                                                   // 949
  var objectTypes = {                                                                                                  // 950
    'boolean': false,                                                                                                  // 951
    'function': true,                                                                                                  // 952
    'object': true,                                                                                                    // 953
    'number': false,                                                                                                   // 954
    'string': false,                                                                                                   // 955
    'undefined': false                                                                                                 // 956
  };                                                                                                                   // 957
                                                                                                                       // 958
  /** Used to escape characters for inclusion in compiled string literals */                                           // 959
  var stringEscapes = {                                                                                                // 960
    '\\': '\\',                                                                                                        // 961
    "'": "'",                                                                                                          // 962
    '\n': 'n',                                                                                                         // 963
    '\r': 'r',                                                                                                         // 964
    '\t': 't',                                                                                                         // 965
    '\u2028': 'u2028',                                                                                                 // 966
    '\u2029': 'u2029'                                                                                                  // 967
  };                                                                                                                   // 968
                                                                                                                       // 969
  /** Used as a reference to the global object */                                                                      // 970
  var root = (objectTypes[typeof window] && window) || this;                                                           // 971
                                                                                                                       // 972
  /** Detect free variable `exports` */                                                                                // 973
  var freeExports = objectTypes[typeof exports] && exports && !exports.nodeType && exports;                            // 974
                                                                                                                       // 975
  /** Detect free variable `module` */                                                                                 // 976
  var freeModule = objectTypes[typeof module] && module && !module.nodeType && module;                                 // 977
                                                                                                                       // 978
  /** Detect the popular CommonJS extension `module.exports` */                                                        // 979
  var moduleExports = freeModule && freeModule.exports === freeExports && freeExports;                                 // 980
                                                                                                                       // 981
  /** Detect free variable `global` from Node.js or Browserified code and use it as `root` */                          // 982
  var freeGlobal = objectTypes[typeof global] && global;                                                               // 983
  if (freeGlobal && (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal)) {                          // 984
    root = freeGlobal;                                                                                                 // 985
  }                                                                                                                    // 986
                                                                                                                       // 987
  /*--------------------------------------------------------------------------*/                                       // 988
                                                                                                                       // 989
  /**                                                                                                                  // 990
   * Used by `template` to escape characters for inclusion in compiled                                                 // 991
   * string literals.                                                                                                  // 992
   *                                                                                                                   // 993
   * @private                                                                                                          // 994
   * @param {string} match The matched character to escape.                                                            // 995
   * @returns {string} Returns the escaped character.                                                                  // 996
   */                                                                                                                  // 997
  function escapeStringChar(match) {                                                                                   // 998
    return '\\' + stringEscapes[match];                                                                                // 999
  }                                                                                                                    // 1000
                                                                                                                       // 1001
  /**                                                                                                                  // 1002
   * Gets an array from the array pool or creates a new one if the pool is empty.                                      // 1003
   *                                                                                                                   // 1004
   * @private                                                                                                          // 1005
   * @returns {Array} The array from the pool.                                                                         // 1006
   */                                                                                                                  // 1007
  function getArray() {                                                                                                // 1008
    return arrayPool.pop() || [];                                                                                      // 1009
  }                                                                                                                    // 1010
                                                                                                                       // 1011
  /**                                                                                                                  // 1012
   * Checks if `value` is a DOM node in IE < 9.                                                                        // 1013
   *                                                                                                                   // 1014
   * @private                                                                                                          // 1015
   * @param {*} value The value to check.                                                                              // 1016
   * @returns {boolean} Returns `true` if the `value` is a DOM node, else `false`.                                     // 1017
   */                                                                                                                  // 1018
  function isNode(value) {                                                                                             // 1019
    // IE < 9 presents DOM nodes as `Object` objects except they have `toString`                                       // 1020
    // methods that are `typeof` "string" and still can coerce nodes to strings                                        // 1021
    return typeof value.toString != 'function' && typeof (value + '') == 'string';                                     // 1022
  }                                                                                                                    // 1023
                                                                                                                       // 1024
  /**                                                                                                                  // 1025
   * Releases the given array back to the array pool.                                                                  // 1026
   *                                                                                                                   // 1027
   * @private                                                                                                          // 1028
   * @param {Array} [array] The array to release.                                                                      // 1029
   */                                                                                                                  // 1030
  function releaseArray(array) {                                                                                       // 1031
    array.length = 0;                                                                                                  // 1032
    if (arrayPool.length < maxPoolSize) {                                                                              // 1033
      arrayPool.push(array);                                                                                           // 1034
    }                                                                                                                  // 1035
  }                                                                                                                    // 1036
                                                                                                                       // 1037
  /**                                                                                                                  // 1038
   * Slices the `collection` from the `start` index up to, but not including,                                          // 1039
   * the `end` index.                                                                                                  // 1040
   *                                                                                                                   // 1041
   * Note: This function is used instead of `Array#slice` to support node lists                                        // 1042
   * in IE < 9 and to ensure dense arrays are returned.                                                                // 1043
   *                                                                                                                   // 1044
   * @private                                                                                                          // 1045
   * @param {Array|Object|string} collection The collection to slice.                                                  // 1046
   * @param {number} start The start index.                                                                            // 1047
   * @param {number} end The end index.                                                                                // 1048
   * @returns {Array} Returns the new array.                                                                           // 1049
   */                                                                                                                  // 1050
  function slice(array, start, end) {                                                                                  // 1051
    start || (start = 0);                                                                                              // 1052
    if (typeof end == 'undefined') {                                                                                   // 1053
      end = array ? array.length : 0;                                                                                  // 1054
    }                                                                                                                  // 1055
    var index = -1,                                                                                                    // 1056
        length = end - start || 0,                                                                                     // 1057
        result = Array(length < 0 ? 0 : length);                                                                       // 1058
                                                                                                                       // 1059
    while (++index < length) {                                                                                         // 1060
      result[index] = array[start + index];                                                                            // 1061
    }                                                                                                                  // 1062
    return result;                                                                                                     // 1063
  }                                                                                                                    // 1064
                                                                                                                       // 1065
  /*--------------------------------------------------------------------------*/                                       // 1066
                                                                                                                       // 1067
  /**                                                                                                                  // 1068
   * Used for `Array` method references.                                                                               // 1069
   *                                                                                                                   // 1070
   * Normally `Array.prototype` would suffice, however, using an array literal                                         // 1071
   * avoids issues in Narwhal.                                                                                         // 1072
   */                                                                                                                  // 1073
  var arrayRef = [];                                                                                                   // 1074
                                                                                                                       // 1075
  /** Used for native method references */                                                                             // 1076
  var errorProto = Error.prototype,                                                                                    // 1077
      objectProto = Object.prototype,                                                                                  // 1078
      stringProto = String.prototype;                                                                                  // 1079
                                                                                                                       // 1080
  /** Used to resolve the internal [[Class]] of values */                                                              // 1081
  var toString = objectProto.toString;                                                                                 // 1082
                                                                                                                       // 1083
  /** Used to detect if a method is native */                                                                          // 1084
  var reNative = RegExp('^' +                                                                                          // 1085
    String(toString)                                                                                                   // 1086
      .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')                                                                          // 1087
      .replace(/toString| for [^\]]+/g, '.*?') + '$'                                                                   // 1088
  );                                                                                                                   // 1089
                                                                                                                       // 1090
  /** Native method shortcuts */                                                                                       // 1091
  var fnToString = Function.prototype.toString,                                                                        // 1092
      hasOwnProperty = objectProto.hasOwnProperty,                                                                     // 1093
      push = arrayRef.push,                                                                                            // 1094
      propertyIsEnumerable = objectProto.propertyIsEnumerable,                                                         // 1095
      unshift = arrayRef.unshift;                                                                                      // 1096
                                                                                                                       // 1097
  /** Used to set meta data on functions */                                                                            // 1098
  var defineProperty = (function() {                                                                                   // 1099
    // IE 8 only accepts DOM elements                                                                                  // 1100
    try {                                                                                                              // 1101
      var o = {},                                                                                                      // 1102
          func = isNative(func = Object.defineProperty) && func,                                                       // 1103
          result = func(o, o, o) && func;                                                                              // 1104
    } catch(e) { }                                                                                                     // 1105
    return result;                                                                                                     // 1106
  }());                                                                                                                // 1107
                                                                                                                       // 1108
  /* Native method shortcuts for methods with the same name as other `lodash` methods */                               // 1109
  var nativeCreate = isNative(nativeCreate = Object.create) && nativeCreate,                                           // 1110
      nativeIsArray = isNative(nativeIsArray = Array.isArray) && nativeIsArray,                                        // 1111
      nativeKeys = isNative(nativeKeys = Object.keys) && nativeKeys;                                                   // 1112
                                                                                                                       // 1113
  /** Used to lookup a built-in constructor by [[Class]] */                                                            // 1114
  var ctorByClass = {};                                                                                                // 1115
  ctorByClass[arrayClass] = Array;                                                                                     // 1116
  ctorByClass[boolClass] = Boolean;                                                                                    // 1117
  ctorByClass[dateClass] = Date;                                                                                       // 1118
  ctorByClass[funcClass] = Function;                                                                                   // 1119
  ctorByClass[objectClass] = Object;                                                                                   // 1120
  ctorByClass[numberClass] = Number;                                                                                   // 1121
  ctorByClass[regexpClass] = RegExp;                                                                                   // 1122
  ctorByClass[stringClass] = String;                                                                                   // 1123
                                                                                                                       // 1124
  /** Used to avoid iterating non-enumerable properties in IE < 9 */                                                   // 1125
  var nonEnumProps = {};                                                                                               // 1126
  nonEnumProps[arrayClass] = nonEnumProps[dateClass] = nonEnumProps[numberClass] = { 'constructor': true, 'toLocaleString': true, 'toString': true, 'valueOf': true };
  nonEnumProps[boolClass] = nonEnumProps[stringClass] = { 'constructor': true, 'toString': true, 'valueOf': true };    // 1128
  nonEnumProps[errorClass] = nonEnumProps[funcClass] = nonEnumProps[regexpClass] = { 'constructor': true, 'toString': true };
  nonEnumProps[objectClass] = { 'constructor': true };                                                                 // 1130
                                                                                                                       // 1131
  (function() {                                                                                                        // 1132
    var length = shadowedProps.length;                                                                                 // 1133
    while (length--) {                                                                                                 // 1134
      var key = shadowedProps[length];                                                                                 // 1135
      for (var className in nonEnumProps) {                                                                            // 1136
        if (hasOwnProperty.call(nonEnumProps, className) && !hasOwnProperty.call(nonEnumProps[className], key)) {      // 1137
          nonEnumProps[className][key] = false;                                                                        // 1138
        }                                                                                                              // 1139
      }                                                                                                                // 1140
    }                                                                                                                  // 1141
  }());                                                                                                                // 1142
                                                                                                                       // 1143
  /*--------------------------------------------------------------------------*/                                       // 1144
                                                                                                                       // 1145
  /**                                                                                                                  // 1146
   * Creates a `lodash` object which wraps the given value to enable intuitive                                         // 1147
   * method chaining.                                                                                                  // 1148
   *                                                                                                                   // 1149
   * In addition to Lo-Dash methods, wrappers also have the following `Array` methods:                                 // 1150
   * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,                                   // 1151
   * and `unshift`                                                                                                     // 1152
   *                                                                                                                   // 1153
   * Chaining is supported in custom builds as long as the `value` method is                                           // 1154
   * implicitly or explicitly included in the build.                                                                   // 1155
   *                                                                                                                   // 1156
   * The chainable wrapper functions are:                                                                              // 1157
   * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`,                                              // 1158
   * `compose`, `concat`, `countBy`, `create`, `createCallback`, `curry`,                                              // 1159
   * `debounce`, `defaults`, `defer`, `delay`, `difference`, `filter`, `flatten`,                                      // 1160
   * `forEach`, `forEachRight`, `forIn`, `forInRight`, `forOwn`, `forOwnRight`,                                        // 1161
   * `functions`, `groupBy`, `indexBy`, `initial`, `intersection`, `invert`,                                           // 1162
   * `invoke`, `keys`, `map`, `max`, `memoize`, `merge`, `min`, `object`, `omit`,                                      // 1163
   * `once`, `pairs`, `partial`, `partialRight`, `pick`, `pluck`, `pull`, `push`,                                      // 1164
   * `range`, `reject`, `remove`, `rest`, `reverse`, `shuffle`, `slice`, `sort`,                                       // 1165
   * `sortBy`, `splice`, `tap`, `throttle`, `times`, `toArray`, `transform`,                                           // 1166
   * `union`, `uniq`, `unshift`, `unzip`, `values`, `where`, `without`, `wrap`,                                        // 1167
   * and `zip`                                                                                                         // 1168
   *                                                                                                                   // 1169
   * The non-chainable wrapper functions are:                                                                          // 1170
   * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `findIndex`,                                         // 1171
   * `findKey`, `findLast`, `findLastIndex`, `findLastKey`, `has`, `identity`,                                         // 1172
   * `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`, `isElement`,                                          // 1173
   * `isEmpty`, `isEqual`, `isFinite`, `isFunction`, `isNaN`, `isNull`, `isNumber`,                                    // 1174
   * `isObject`, `isPlainObject`, `isRegExp`, `isString`, `isUndefined`, `join`,                                       // 1175
   * `lastIndexOf`, `mixin`, `noConflict`, `parseInt`, `pop`, `random`, `reduce`,                                      // 1176
   * `reduceRight`, `result`, `shift`, `size`, `some`, `sortedIndex`, `runInContext`,                                  // 1177
   * `template`, `unescape`, `uniqueId`, and `value`                                                                   // 1178
   *                                                                                                                   // 1179
   * The wrapper functions `first` and `last` return wrapped values when `n` is                                        // 1180
   * provided, otherwise they return unwrapped values.                                                                 // 1181
   *                                                                                                                   // 1182
   * Explicit chaining can be enabled by using the `_.chain` method.                                                   // 1183
   *                                                                                                                   // 1184
   * @name _                                                                                                           // 1185
   * @constructor                                                                                                      // 1186
   * @category Chaining                                                                                                // 1187
   * @param {*} value The value to wrap in a `lodash` instance.                                                        // 1188
   * @returns {Object} Returns a `lodash` instance.                                                                    // 1189
   * @example                                                                                                          // 1190
   *                                                                                                                   // 1191
   * var wrapped = _([1, 2, 3]);                                                                                       // 1192
   *                                                                                                                   // 1193
   * // returns an unwrapped value                                                                                     // 1194
   * wrapped.reduce(function(sum, num) {                                                                               // 1195
   *   return sum + num;                                                                                               // 1196
   * });                                                                                                               // 1197
   * // => 6                                                                                                           // 1198
   *                                                                                                                   // 1199
   * // returns a wrapped value                                                                                        // 1200
   * var squares = wrapped.map(function(num) {                                                                         // 1201
   *   return num * num;                                                                                               // 1202
   * });                                                                                                               // 1203
   *                                                                                                                   // 1204
   * _.isArray(squares);                                                                                               // 1205
   * // => false                                                                                                       // 1206
   *                                                                                                                   // 1207
   * _.isArray(squares.value());                                                                                       // 1208
   * // => true                                                                                                        // 1209
   */                                                                                                                  // 1210
  function lodash() {                                                                                                  // 1211
    // no operation performed                                                                                          // 1212
  }                                                                                                                    // 1213
                                                                                                                       // 1214
  /**                                                                                                                  // 1215
   * An object used to flag environments features.                                                                     // 1216
   *                                                                                                                   // 1217
   * @static                                                                                                           // 1218
   * @memberOf _                                                                                                       // 1219
   * @type Object                                                                                                      // 1220
   */                                                                                                                  // 1221
  var support = lodash.support = {};                                                                                   // 1222
                                                                                                                       // 1223
  (function() {                                                                                                        // 1224
    var ctor = function() { this.x = 1; },                                                                             // 1225
        object = { '0': 1, 'length': 1 },                                                                              // 1226
        props = [];                                                                                                    // 1227
                                                                                                                       // 1228
    ctor.prototype = { 'valueOf': 1, 'y': 1 };                                                                         // 1229
    for (var key in new ctor) { props.push(key); }                                                                     // 1230
    for (key in arguments) { }                                                                                         // 1231
                                                                                                                       // 1232
    /**                                                                                                                // 1233
     * Detect if an `arguments` object's [[Class]] is resolvable (all but Firefox < 4, IE < 9).                        // 1234
     *                                                                                                                 // 1235
     * @memberOf _.support                                                                                             // 1236
     * @type boolean                                                                                                   // 1237
     */                                                                                                                // 1238
    support.argsClass = toString.call(arguments) == argsClass;                                                         // 1239
                                                                                                                       // 1240
    /**                                                                                                                // 1241
     * Detect if `arguments` objects are `Object` objects (all but Narwhal and Opera < 10.5).                          // 1242
     *                                                                                                                 // 1243
     * @memberOf _.support                                                                                             // 1244
     * @type boolean                                                                                                   // 1245
     */                                                                                                                // 1246
    support.argsObject = arguments.constructor == Object && !(arguments instanceof Array);                             // 1247
                                                                                                                       // 1248
    /**                                                                                                                // 1249
     * Detect if `name` or `message` properties of `Error.prototype` are                                               // 1250
     * enumerable by default. (IE < 9, Safari < 5.1)                                                                   // 1251
     *                                                                                                                 // 1252
     * @memberOf _.support                                                                                             // 1253
     * @type boolean                                                                                                   // 1254
     */                                                                                                                // 1255
    support.enumErrorProps = propertyIsEnumerable.call(errorProto, 'message') || propertyIsEnumerable.call(errorProto, 'name');
                                                                                                                       // 1257
    /**                                                                                                                // 1258
     * Detect if `prototype` properties are enumerable by default.                                                     // 1259
     *                                                                                                                 // 1260
     * Firefox < 3.6, Opera > 9.50 - Opera < 11.60, and Safari < 5.1                                                   // 1261
     * (if the prototype or a property on the prototype has been set)                                                  // 1262
     * incorrectly sets a function's `prototype` property [[Enumerable]]                                               // 1263
     * value to `true`.                                                                                                // 1264
     *                                                                                                                 // 1265
     * @memberOf _.support                                                                                             // 1266
     * @type boolean                                                                                                   // 1267
     */                                                                                                                // 1268
    support.enumPrototypes = propertyIsEnumerable.call(ctor, 'prototype');                                             // 1269
                                                                                                                       // 1270
    /**                                                                                                                // 1271
     * Detect if functions can be decompiled by `Function#toString`                                                    // 1272
     * (all but PS3 and older Opera mobile browsers & avoided in Windows 8 apps).                                      // 1273
     *                                                                                                                 // 1274
     * @memberOf _.support                                                                                             // 1275
     * @type boolean                                                                                                   // 1276
     */                                                                                                                // 1277
    support.funcDecomp = !isNative(root.WinRTError) && reThis.test(function() { return this; });                       // 1278
                                                                                                                       // 1279
    /**                                                                                                                // 1280
     * Detect if `Function#name` is supported (all but IE).                                                            // 1281
     *                                                                                                                 // 1282
     * @memberOf _.support                                                                                             // 1283
     * @type boolean                                                                                                   // 1284
     */                                                                                                                // 1285
    support.funcNames = typeof Function.name == 'string';                                                              // 1286
                                                                                                                       // 1287
    /**                                                                                                                // 1288
     * Detect if `arguments` object indexes are non-enumerable                                                         // 1289
     * (Firefox < 4, IE < 9, PhantomJS, Safari < 5.1).                                                                 // 1290
     *                                                                                                                 // 1291
     * @memberOf _.support                                                                                             // 1292
     * @type boolean                                                                                                   // 1293
     */                                                                                                                // 1294
    support.nonEnumArgs = key != 0;                                                                                    // 1295
                                                                                                                       // 1296
    /**                                                                                                                // 1297
     * Detect if properties shadowing those on `Object.prototype` are non-enumerable.                                  // 1298
     *                                                                                                                 // 1299
     * In IE < 9 an objects own properties, shadowing non-enumerable ones, are                                         // 1300
     * made non-enumerable as well (a.k.a the JScript [[DontEnum]] bug).                                               // 1301
     *                                                                                                                 // 1302
     * @memberOf _.support                                                                                             // 1303
     * @type boolean                                                                                                   // 1304
     */                                                                                                                // 1305
    support.nonEnumShadows = !/valueOf/.test(props);                                                                   // 1306
                                                                                                                       // 1307
    /**                                                                                                                // 1308
     * Detect if `Array#shift` and `Array#splice` augment array-like objects correctly.                                // 1309
     *                                                                                                                 // 1310
     * Firefox < 10, IE compatibility mode, and IE < 9 have buggy Array `shift()`                                      // 1311
     * and `splice()` functions that fail to remove the last element, `value[0]`,                                      // 1312
     * of array-like objects even though the `length` property is set to `0`.                                          // 1313
     * The `shift()` method is buggy in IE 8 compatibility mode, while `splice()`                                      // 1314
     * is buggy regardless of mode in IE < 9 and buggy in compatibility mode in IE 9.                                  // 1315
     *                                                                                                                 // 1316
     * @memberOf _.support                                                                                             // 1317
     * @type boolean                                                                                                   // 1318
     */                                                                                                                // 1319
    support.spliceObjects = (arrayRef.splice.call(object, 0, 1), !object[0]);                                          // 1320
                                                                                                                       // 1321
    /**                                                                                                                // 1322
     * Detect lack of support for accessing string characters by index.                                                // 1323
     *                                                                                                                 // 1324
     * IE < 8 can't access characters by index and IE 8 can only access                                                // 1325
     * characters by index on string literals.                                                                         // 1326
     *                                                                                                                 // 1327
     * @memberOf _.support                                                                                             // 1328
     * @type boolean                                                                                                   // 1329
     */                                                                                                                // 1330
    support.unindexedChars = ('x'[0] + Object('x')[0]) != 'xx';                                                        // 1331
                                                                                                                       // 1332
    /**                                                                                                                // 1333
     * Detect if a DOM node's [[Class]] is resolvable (all but IE < 9)                                                 // 1334
     * and that the JS engine errors when attempting to coerce an object to                                            // 1335
     * a string without a `toString` function.                                                                         // 1336
     *                                                                                                                 // 1337
     * @memberOf _.support                                                                                             // 1338
     * @type boolean                                                                                                   // 1339
     */                                                                                                                // 1340
    try {                                                                                                              // 1341
      support.nodeClass = !(toString.call(document) == objectClass && !({ 'toString': 0 } + ''));                      // 1342
    } catch(e) {                                                                                                       // 1343
      support.nodeClass = true;                                                                                        // 1344
    }                                                                                                                  // 1345
  }(1));                                                                                                               // 1346
                                                                                                                       // 1347
  /**                                                                                                                  // 1348
   * By default, the template delimiters used by Lo-Dash are similar to those in                                       // 1349
   * embedded Ruby (ERB). Change the following template settings to use alternative                                    // 1350
   * delimiters.                                                                                                       // 1351
   *                                                                                                                   // 1352
   * @static                                                                                                           // 1353
   * @memberOf _                                                                                                       // 1354
   * @type Object                                                                                                      // 1355
   */                                                                                                                  // 1356
  lodash.templateSettings = {                                                                                          // 1357
                                                                                                                       // 1358
    /**                                                                                                                // 1359
     * Used to detect `data` property values to be HTML-escaped.                                                       // 1360
     *                                                                                                                 // 1361
     * @memberOf _.templateSettings                                                                                    // 1362
     * @type RegExp                                                                                                    // 1363
     */                                                                                                                // 1364
    'escape': /<%-([\s\S]+?)%>/g,                                                                                      // 1365
                                                                                                                       // 1366
    /**                                                                                                                // 1367
     * Used to detect code to be evaluated.                                                                            // 1368
     *                                                                                                                 // 1369
     * @memberOf _.templateSettings                                                                                    // 1370
     * @type RegExp                                                                                                    // 1371
     */                                                                                                                // 1372
    'evaluate': /<%([\s\S]+?)%>/g,                                                                                     // 1373
                                                                                                                       // 1374
    /**                                                                                                                // 1375
     * Used to detect `data` property values to inject.                                                                // 1376
     *                                                                                                                 // 1377
     * @memberOf _.templateSettings                                                                                    // 1378
     * @type RegExp                                                                                                    // 1379
     */                                                                                                                // 1380
    'interpolate': reInterpolate,                                                                                      // 1381
                                                                                                                       // 1382
    /**                                                                                                                // 1383
     * Used to reference the data object in the template text.                                                         // 1384
     *                                                                                                                 // 1385
     * @memberOf _.templateSettings                                                                                    // 1386
     * @type string                                                                                                    // 1387
     */                                                                                                                // 1388
    'variable': '',                                                                                                    // 1389
                                                                                                                       // 1390
    /**                                                                                                                // 1391
     * Used to import variables into the compiled template.                                                            // 1392
     *                                                                                                                 // 1393
     * @memberOf _.templateSettings                                                                                    // 1394
     * @type Object                                                                                                    // 1395
     */                                                                                                                // 1396
    'imports': {                                                                                                       // 1397
                                                                                                                       // 1398
      /**                                                                                                              // 1399
       * A reference to the `lodash` function.                                                                         // 1400
       *                                                                                                               // 1401
       * @memberOf _.templateSettings.imports                                                                          // 1402
       * @type Function                                                                                                // 1403
       */                                                                                                              // 1404
      '_': lodash                                                                                                      // 1405
    }                                                                                                                  // 1406
  };                                                                                                                   // 1407
                                                                                                                       // 1408
  /*--------------------------------------------------------------------------*/                                       // 1409
                                                                                                                       // 1410
  /**                                                                                                                  // 1411
   * The template used to create iterator functions.                                                                   // 1412
   *                                                                                                                   // 1413
   * @private                                                                                                          // 1414
   * @param {Object} data The data object used to populate the text.                                                   // 1415
   * @returns {string} Returns the interpolated text.                                                                  // 1416
   */                                                                                                                  // 1417
  var iteratorTemplate = function(obj) {                                                                               // 1418
                                                                                                                       // 1419
    var __p = 'var index, iterable = ' +                                                                               // 1420
    (obj.firstArg) +                                                                                                   // 1421
    ', result = ' +                                                                                                    // 1422
    (obj.init) +                                                                                                       // 1423
    ';\nif (!iterable) return result;\n' +                                                                             // 1424
    (obj.top) +                                                                                                        // 1425
    ';';                                                                                                               // 1426
     if (obj.array) {                                                                                                  // 1427
    __p += '\nvar length = iterable.length; index = -1;\nif (' +                                                       // 1428
    (obj.array) +                                                                                                      // 1429
    ') {  ';                                                                                                           // 1430
     if (support.unindexedChars) {                                                                                     // 1431
    __p += '\n  if (isString(iterable)) {\n    iterable = iterable.split(\'\')\n  }  ';                                // 1432
     }                                                                                                                 // 1433
    __p += '\n  while (++index < length) {\n    ' +                                                                    // 1434
    (obj.loop) +                                                                                                       // 1435
    ';\n  }\n}\nelse {  ';                                                                                             // 1436
     } else if (support.nonEnumArgs) {                                                                                 // 1437
    __p += '\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += \'\';\n      ' +
    (obj.loop) +                                                                                                       // 1439
    ';\n    }\n  } else {  ';                                                                                          // 1440
     }                                                                                                                 // 1441
                                                                                                                       // 1442
     if (support.enumPrototypes) {                                                                                     // 1443
    __p += '\n  var skipProto = typeof iterable == \'function\';\n  ';                                                 // 1444
     }                                                                                                                 // 1445
                                                                                                                       // 1446
     if (support.enumErrorProps) {                                                                                     // 1447
    __p += '\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ';                       // 1448
     }                                                                                                                 // 1449
                                                                                                                       // 1450
        var conditions = [];    if (support.enumPrototypes) { conditions.push('!(skipProto && index == "prototype")'); }    if (support.enumErrorProps)  { conditions.push('!(skipErrorProps && (index == "message" || index == "name"))'); }
                                                                                                                       // 1452
     if (obj.useHas && obj.keys) {                                                                                     // 1453
    __p += '\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n';
        if (conditions.length) {                                                                                       // 1455
    __p += '    if (' +                                                                                                // 1456
    (conditions.join(' && ')) +                                                                                        // 1457
    ') {\n  ';                                                                                                         // 1458
     }                                                                                                                 // 1459
    __p +=                                                                                                             // 1460
    (obj.loop) +                                                                                                       // 1461
    ';    ';                                                                                                           // 1462
     if (conditions.length) {                                                                                          // 1463
    __p += '\n    }';                                                                                                  // 1464
     }                                                                                                                 // 1465
    __p += '\n  }  ';                                                                                                  // 1466
     } else {                                                                                                          // 1467
    __p += '\n  for (index in iterable) {\n';                                                                          // 1468
        if (obj.useHas) { conditions.push("hasOwnProperty.call(iterable, index)"); }    if (conditions.length) {       // 1469
    __p += '    if (' +                                                                                                // 1470
    (conditions.join(' && ')) +                                                                                        // 1471
    ') {\n  ';                                                                                                         // 1472
     }                                                                                                                 // 1473
    __p +=                                                                                                             // 1474
    (obj.loop) +                                                                                                       // 1475
    ';    ';                                                                                                           // 1476
     if (conditions.length) {                                                                                          // 1477
    __p += '\n    }';                                                                                                  // 1478
     }                                                                                                                 // 1479
    __p += '\n  }    ';                                                                                                // 1480
     if (support.nonEnumShadows) {                                                                                     // 1481
    __p += '\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ';
     for (k = 0; k < 7; k++) {                                                                                         // 1483
    __p += '\n    index = \'' +                                                                                        // 1484
    (obj.shadowedProps[k]) +                                                                                           // 1485
    '\';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))';                             // 1486
            if (!obj.useHas) {                                                                                         // 1487
    __p += ' || (!nonEnum[index] && iterable[index] !== objectProto[index])';                                          // 1488
     }                                                                                                                 // 1489
    __p += ') {\n      ' +                                                                                             // 1490
    (obj.loop) +                                                                                                       // 1491
    ';\n    }      ';                                                                                                  // 1492
     }                                                                                                                 // 1493
    __p += '\n  }    ';                                                                                                // 1494
     }                                                                                                                 // 1495
                                                                                                                       // 1496
     }                                                                                                                 // 1497
                                                                                                                       // 1498
     if (obj.array || support.nonEnumArgs) {                                                                           // 1499
    __p += '\n}';                                                                                                      // 1500
     }                                                                                                                 // 1501
    __p +=                                                                                                             // 1502
    (obj.bottom) +                                                                                                     // 1503
    ';\nreturn result';                                                                                                // 1504
                                                                                                                       // 1505
    return __p                                                                                                         // 1506
  };                                                                                                                   // 1507
                                                                                                                       // 1508
  /*--------------------------------------------------------------------------*/                                       // 1509
                                                                                                                       // 1510
  /**                                                                                                                  // 1511
   * The base implementation of `_.bind` that creates the bound function and                                           // 1512
   * sets its meta data.                                                                                               // 1513
   *                                                                                                                   // 1514
   * @private                                                                                                          // 1515
   * @param {Array} bindData The bind data array.                                                                      // 1516
   * @returns {Function} Returns the new bound function.                                                               // 1517
   */                                                                                                                  // 1518
  function baseBind(bindData) {                                                                                        // 1519
    var func = bindData[0],                                                                                            // 1520
        partialArgs = bindData[2],                                                                                     // 1521
        thisArg = bindData[4];                                                                                         // 1522
                                                                                                                       // 1523
    function bound() {                                                                                                 // 1524
      // `Function#bind` spec                                                                                          // 1525
      // http://es5.github.io/#x15.3.4.5                                                                               // 1526
      if (partialArgs) {                                                                                               // 1527
        // avoid `arguments` object deoptimizations by using `slice` instead                                           // 1528
        // of `Array.prototype.slice.call` and not assigning `arguments` to a                                          // 1529
        // variable as a ternary expression                                                                            // 1530
        var args = slice(partialArgs);                                                                                 // 1531
        push.apply(args, arguments);                                                                                   // 1532
      }                                                                                                                // 1533
      // mimic the constructor's `return` behavior                                                                     // 1534
      // http://es5.github.io/#x13.2.2                                                                                 // 1535
      if (this instanceof bound) {                                                                                     // 1536
        // ensure `new bound` is an instance of `func`                                                                 // 1537
        var thisBinding = baseCreate(func.prototype),                                                                  // 1538
            result = func.apply(thisBinding, args || arguments);                                                       // 1539
        return isObject(result) ? result : thisBinding;                                                                // 1540
      }                                                                                                                // 1541
      return func.apply(thisArg, args || arguments);                                                                   // 1542
    }                                                                                                                  // 1543
    setBindData(bound, bindData);                                                                                      // 1544
    return bound;                                                                                                      // 1545
  }                                                                                                                    // 1546
                                                                                                                       // 1547
  /**                                                                                                                  // 1548
   * The base implementation of `_.clone` without argument juggling or support                                         // 1549
   * for `thisArg` binding.                                                                                            // 1550
   *                                                                                                                   // 1551
   * @private                                                                                                          // 1552
   * @param {*} value The value to clone.                                                                              // 1553
   * @param {boolean} [isDeep=false] Specify a deep clone.                                                             // 1554
   * @param {Function} [callback] The function to customize cloning values.                                            // 1555
   * @param {Array} [stackA=[]] Tracks traversed source objects.                                                       // 1556
   * @param {Array} [stackB=[]] Associates clones with source counterparts.                                            // 1557
   * @returns {*} Returns the cloned value.                                                                            // 1558
   */                                                                                                                  // 1559
  function baseClone(value, isDeep, callback, stackA, stackB) {                                                        // 1560
    if (callback) {                                                                                                    // 1561
      var result = callback(value);                                                                                    // 1562
      if (typeof result != 'undefined') {                                                                              // 1563
        return result;                                                                                                 // 1564
      }                                                                                                                // 1565
    }                                                                                                                  // 1566
    // inspect [[Class]]                                                                                               // 1567
    var isObj = isObject(value);                                                                                       // 1568
    if (isObj) {                                                                                                       // 1569
      var className = toString.call(value);                                                                            // 1570
      if (!cloneableClasses[className] || (!support.nodeClass && isNode(value))) {                                     // 1571
        return value;                                                                                                  // 1572
      }                                                                                                                // 1573
      var ctor = ctorByClass[className];                                                                               // 1574
      switch (className) {                                                                                             // 1575
        case boolClass:                                                                                                // 1576
        case dateClass:                                                                                                // 1577
          return new ctor(+value);                                                                                     // 1578
                                                                                                                       // 1579
        case numberClass:                                                                                              // 1580
        case stringClass:                                                                                              // 1581
          return new ctor(value);                                                                                      // 1582
                                                                                                                       // 1583
        case regexpClass:                                                                                              // 1584
          result = ctor(value.source, reFlags.exec(value));                                                            // 1585
          result.lastIndex = value.lastIndex;                                                                          // 1586
          return result;                                                                                               // 1587
      }                                                                                                                // 1588
    } else {                                                                                                           // 1589
      return value;                                                                                                    // 1590
    }                                                                                                                  // 1591
    var isArr = isArray(value);                                                                                        // 1592
    if (isDeep) {                                                                                                      // 1593
      // check for circular references and return corresponding clone                                                  // 1594
      var initedStack = !stackA;                                                                                       // 1595
      stackA || (stackA = getArray());                                                                                 // 1596
      stackB || (stackB = getArray());                                                                                 // 1597
                                                                                                                       // 1598
      var length = stackA.length;                                                                                      // 1599
      while (length--) {                                                                                               // 1600
        if (stackA[length] == value) {                                                                                 // 1601
          return stackB[length];                                                                                       // 1602
        }                                                                                                              // 1603
      }                                                                                                                // 1604
      result = isArr ? ctor(value.length) : {};                                                                        // 1605
    }                                                                                                                  // 1606
    else {                                                                                                             // 1607
      result = isArr ? slice(value) : assign({}, value);                                                               // 1608
    }                                                                                                                  // 1609
    // add array properties assigned by `RegExp#exec`                                                                  // 1610
    if (isArr) {                                                                                                       // 1611
      if (hasOwnProperty.call(value, 'index')) {                                                                       // 1612
        result.index = value.index;                                                                                    // 1613
      }                                                                                                                // 1614
      if (hasOwnProperty.call(value, 'input')) {                                                                       // 1615
        result.input = value.input;                                                                                    // 1616
      }                                                                                                                // 1617
    }                                                                                                                  // 1618
    // exit for shallow clone                                                                                          // 1619
    if (!isDeep) {                                                                                                     // 1620
      return result;                                                                                                   // 1621
    }                                                                                                                  // 1622
    // add the source value to the stack of traversed objects                                                          // 1623
    // and associate it with its clone                                                                                 // 1624
    stackA.push(value);                                                                                                // 1625
    stackB.push(result);                                                                                               // 1626
                                                                                                                       // 1627
    // recursively populate clone (susceptible to call stack limits)                                                   // 1628
    (isArr ? baseEach : forOwn)(value, function(objValue, key) {                                                       // 1629
      result[key] = baseClone(objValue, isDeep, callback, stackA, stackB);                                             // 1630
    });                                                                                                                // 1631
                                                                                                                       // 1632
    if (initedStack) {                                                                                                 // 1633
      releaseArray(stackA);                                                                                            // 1634
      releaseArray(stackB);                                                                                            // 1635
    }                                                                                                                  // 1636
    return result;                                                                                                     // 1637
  }                                                                                                                    // 1638
                                                                                                                       // 1639
  /**                                                                                                                  // 1640
   * The base implementation of `_.create` without support for assigning                                               // 1641
   * properties to the created object.                                                                                 // 1642
   *                                                                                                                   // 1643
   * @private                                                                                                          // 1644
   * @param {Object} prototype The object to inherit from.                                                             // 1645
   * @returns {Object} Returns the new object.                                                                         // 1646
   */                                                                                                                  // 1647
  function baseCreate(prototype, properties) {                                                                         // 1648
    return isObject(prototype) ? nativeCreate(prototype) : {};                                                         // 1649
  }                                                                                                                    // 1650
  // fallback for browsers without `Object.create`                                                                     // 1651
  if (!nativeCreate) {                                                                                                 // 1652
    baseCreate = (function() {                                                                                         // 1653
      function Object() {}                                                                                             // 1654
      return function(prototype) {                                                                                     // 1655
        if (isObject(prototype)) {                                                                                     // 1656
          Object.prototype = prototype;                                                                                // 1657
          var result = new Object;                                                                                     // 1658
          Object.prototype = null;                                                                                     // 1659
        }                                                                                                              // 1660
        return result || root.Object();                                                                                // 1661
      };                                                                                                               // 1662
    }());                                                                                                              // 1663
  }                                                                                                                    // 1664
                                                                                                                       // 1665
  /**                                                                                                                  // 1666
   * The base implementation of `_.createCallback` without support for creating                                        // 1667
   * "_.pluck" or "_.where" style callbacks.                                                                           // 1668
   *                                                                                                                   // 1669
   * @private                                                                                                          // 1670
   * @param {*} [func=identity] The value to convert to a callback.                                                    // 1671
   * @param {*} [thisArg] The `this` binding of the created callback.                                                  // 1672
   * @param {number} [argCount] The number of arguments the callback accepts.                                          // 1673
   * @returns {Function} Returns a callback function.                                                                  // 1674
   */                                                                                                                  // 1675
  function baseCreateCallback(func, thisArg, argCount) {                                                               // 1676
    if (typeof func != 'function') {                                                                                   // 1677
      return identity;                                                                                                 // 1678
    }                                                                                                                  // 1679
    // exit early for no `thisArg` or already bound by `Function#bind`                                                 // 1680
    if (typeof thisArg == 'undefined' || !('prototype' in func)) {                                                     // 1681
      return func;                                                                                                     // 1682
    }                                                                                                                  // 1683
    var bindData = func.__bindData__;                                                                                  // 1684
    if (typeof bindData == 'undefined') {                                                                              // 1685
      if (support.funcNames) {                                                                                         // 1686
        bindData = !func.name;                                                                                         // 1687
      }                                                                                                                // 1688
      bindData = bindData || !support.funcDecomp;                                                                      // 1689
      if (!bindData) {                                                                                                 // 1690
        var source = fnToString.call(func);                                                                            // 1691
        if (!support.funcNames) {                                                                                      // 1692
          bindData = !reFuncName.test(source);                                                                         // 1693
        }                                                                                                              // 1694
        if (!bindData) {                                                                                               // 1695
          // checks if `func` references the `this` keyword and stores the result                                      // 1696
          bindData = reThis.test(source);                                                                              // 1697
          setBindData(func, bindData);                                                                                 // 1698
        }                                                                                                              // 1699
      }                                                                                                                // 1700
    }                                                                                                                  // 1701
    // exit early if there are no `this` references or `func` is bound                                                 // 1702
    if (bindData === false || (bindData !== true && bindData[1] & 1)) {                                                // 1703
      return func;                                                                                                     // 1704
    }                                                                                                                  // 1705
    switch (argCount) {                                                                                                // 1706
      case 1: return function(value) {                                                                                 // 1707
        return func.call(thisArg, value);                                                                              // 1708
      };                                                                                                               // 1709
      case 2: return function(a, b) {                                                                                  // 1710
        return func.call(thisArg, a, b);                                                                               // 1711
      };                                                                                                               // 1712
      case 3: return function(value, index, collection) {                                                              // 1713
        return func.call(thisArg, value, index, collection);                                                           // 1714
      };                                                                                                               // 1715
      case 4: return function(accumulator, value, index, collection) {                                                 // 1716
        return func.call(thisArg, accumulator, value, index, collection);                                              // 1717
      };                                                                                                               // 1718
    }                                                                                                                  // 1719
    return bind(func, thisArg);                                                                                        // 1720
  }                                                                                                                    // 1721
                                                                                                                       // 1722
  /**                                                                                                                  // 1723
   * The base implementation of `createWrapper` that creates the wrapper and                                           // 1724
   * sets its meta data.                                                                                               // 1725
   *                                                                                                                   // 1726
   * @private                                                                                                          // 1727
   * @param {Array} bindData The bind data array.                                                                      // 1728
   * @returns {Function} Returns the new function.                                                                     // 1729
   */                                                                                                                  // 1730
  function baseCreateWrapper(bindData) {                                                                               // 1731
    var func = bindData[0],                                                                                            // 1732
        bitmask = bindData[1],                                                                                         // 1733
        partialArgs = bindData[2],                                                                                     // 1734
        partialRightArgs = bindData[3],                                                                                // 1735
        thisArg = bindData[4],                                                                                         // 1736
        arity = bindData[5];                                                                                           // 1737
                                                                                                                       // 1738
    var isBind = bitmask & 1,                                                                                          // 1739
        isBindKey = bitmask & 2,                                                                                       // 1740
        isCurry = bitmask & 4,                                                                                         // 1741
        isCurryBound = bitmask & 8,                                                                                    // 1742
        key = func;                                                                                                    // 1743
                                                                                                                       // 1744
    function bound() {                                                                                                 // 1745
      var thisBinding = isBind ? thisArg : this;                                                                       // 1746
      if (partialArgs) {                                                                                               // 1747
        var args = slice(partialArgs);                                                                                 // 1748
        push.apply(args, arguments);                                                                                   // 1749
      }                                                                                                                // 1750
      if (partialRightArgs || isCurry) {                                                                               // 1751
        args || (args = slice(arguments));                                                                             // 1752
        if (partialRightArgs) {                                                                                        // 1753
          push.apply(args, partialRightArgs);                                                                          // 1754
        }                                                                                                              // 1755
        if (isCurry && args.length < arity) {                                                                          // 1756
          bitmask |= 16 & ~32;                                                                                         // 1757
          return baseCreateWrapper([func, (isCurryBound ? bitmask : bitmask & ~3), args, null, thisArg, arity]);       // 1758
        }                                                                                                              // 1759
      }                                                                                                                // 1760
      args || (args = arguments);                                                                                      // 1761
      if (isBindKey) {                                                                                                 // 1762
        func = thisBinding[key];                                                                                       // 1763
      }                                                                                                                // 1764
      if (this instanceof bound) {                                                                                     // 1765
        thisBinding = baseCreate(func.prototype);                                                                      // 1766
        var result = func.apply(thisBinding, args);                                                                    // 1767
        return isObject(result) ? result : thisBinding;                                                                // 1768
      }                                                                                                                // 1769
      return func.apply(thisBinding, args);                                                                            // 1770
    }                                                                                                                  // 1771
    setBindData(bound, bindData);                                                                                      // 1772
    return bound;                                                                                                      // 1773
  }                                                                                                                    // 1774
                                                                                                                       // 1775
  /**                                                                                                                  // 1776
   * The base implementation of `_.isEqual`, without support for `thisArg` binding,                                    // 1777
   * that allows partial "_.where" style comparisons.                                                                  // 1778
   *                                                                                                                   // 1779
   * @private                                                                                                          // 1780
   * @param {*} a The value to compare.                                                                                // 1781
   * @param {*} b The other value to compare.                                                                          // 1782
   * @param {Function} [callback] The function to customize comparing values.                                          // 1783
   * @param {Function} [isWhere=false] A flag to indicate performing partial comparisons.                              // 1784
   * @param {Array} [stackA=[]] Tracks traversed `a` objects.                                                          // 1785
   * @param {Array} [stackB=[]] Tracks traversed `b` objects.                                                          // 1786
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.                                     // 1787
   */                                                                                                                  // 1788
  function baseIsEqual(a, b, callback, isWhere, stackA, stackB) {                                                      // 1789
    // used to indicate that when comparing objects, `a` has at least the properties of `b`                            // 1790
    if (callback) {                                                                                                    // 1791
      var result = callback(a, b);                                                                                     // 1792
      if (typeof result != 'undefined') {                                                                              // 1793
        return !!result;                                                                                               // 1794
      }                                                                                                                // 1795
    }                                                                                                                  // 1796
    // exit early for identical values                                                                                 // 1797
    if (a === b) {                                                                                                     // 1798
      // treat `+0` vs. `-0` as not equal                                                                              // 1799
      return a !== 0 || (1 / a == 1 / b);                                                                              // 1800
    }                                                                                                                  // 1801
    var type = typeof a,                                                                                               // 1802
        otherType = typeof b;                                                                                          // 1803
                                                                                                                       // 1804
    // exit early for unlike primitive values                                                                          // 1805
    if (a === a &&                                                                                                     // 1806
        !(a && objectTypes[type]) &&                                                                                   // 1807
        !(b && objectTypes[otherType])) {                                                                              // 1808
      return false;                                                                                                    // 1809
    }                                                                                                                  // 1810
    // exit early for `null` and `undefined` avoiding ES3's Function#call behavior                                     // 1811
    // http://es5.github.io/#x15.3.4.4                                                                                 // 1812
    if (a == null || b == null) {                                                                                      // 1813
      return a === b;                                                                                                  // 1814
    }                                                                                                                  // 1815
    // compare [[Class]] names                                                                                         // 1816
    var className = toString.call(a),                                                                                  // 1817
        otherClass = toString.call(b);                                                                                 // 1818
                                                                                                                       // 1819
    if (className == argsClass) {                                                                                      // 1820
      className = objectClass;                                                                                         // 1821
    }                                                                                                                  // 1822
    if (otherClass == argsClass) {                                                                                     // 1823
      otherClass = objectClass;                                                                                        // 1824
    }                                                                                                                  // 1825
    if (className != otherClass) {                                                                                     // 1826
      return false;                                                                                                    // 1827
    }                                                                                                                  // 1828
    switch (className) {                                                                                               // 1829
      case boolClass:                                                                                                  // 1830
      case dateClass:                                                                                                  // 1831
        // coerce dates and booleans to numbers, dates to milliseconds and booleans                                    // 1832
        // to `1` or `0` treating invalid dates coerced to `NaN` as not equal                                          // 1833
        return +a == +b;                                                                                               // 1834
                                                                                                                       // 1835
      case numberClass:                                                                                                // 1836
        // treat `NaN` vs. `NaN` as equal                                                                              // 1837
        return (a != +a)                                                                                               // 1838
          ? b != +b                                                                                                    // 1839
          // but treat `+0` vs. `-0` as not equal                                                                      // 1840
          : (a == 0 ? (1 / a == 1 / b) : a == +b);                                                                     // 1841
                                                                                                                       // 1842
      case regexpClass:                                                                                                // 1843
      case stringClass:                                                                                                // 1844
        // coerce regexes to strings (http://es5.github.io/#x15.10.6.4)                                                // 1845
        // treat string primitives and their corresponding object instances as equal                                   // 1846
        return a == String(b);                                                                                         // 1847
    }                                                                                                                  // 1848
    var isArr = className == arrayClass;                                                                               // 1849
    if (!isArr) {                                                                                                      // 1850
      // unwrap any `lodash` wrapped values                                                                            // 1851
      var aWrapped = hasOwnProperty.call(a, '__wrapped__'),                                                            // 1852
          bWrapped = hasOwnProperty.call(b, '__wrapped__');                                                            // 1853
                                                                                                                       // 1854
      if (aWrapped || bWrapped) {                                                                                      // 1855
        return baseIsEqual(aWrapped ? a.__wrapped__ : a, bWrapped ? b.__wrapped__ : b, callback, isWhere, stackA, stackB);
      }                                                                                                                // 1857
      // exit for functions and DOM nodes                                                                              // 1858
      if (className != objectClass || (!support.nodeClass && (isNode(a) || isNode(b)))) {                              // 1859
        return false;                                                                                                  // 1860
      }                                                                                                                // 1861
      // in older versions of Opera, `arguments` objects have `Array` constructors                                     // 1862
      var ctorA = !support.argsObject && isArguments(a) ? Object : a.constructor,                                      // 1863
          ctorB = !support.argsObject && isArguments(b) ? Object : b.constructor;                                      // 1864
                                                                                                                       // 1865
      // non `Object` object instances with different constructors are not equal                                       // 1866
      if (ctorA != ctorB &&                                                                                            // 1867
            !(isFunction(ctorA) && ctorA instanceof ctorA && isFunction(ctorB) && ctorB instanceof ctorB) &&           // 1868
            ('constructor' in a && 'constructor' in b)                                                                 // 1869
          ) {                                                                                                          // 1870
        return false;                                                                                                  // 1871
      }                                                                                                                // 1872
    }                                                                                                                  // 1873
    // assume cyclic structures are equal                                                                              // 1874
    // the algorithm for detecting cyclic structures is adapted from ES 5.1                                            // 1875
    // section 15.12.3, abstract operation `JO` (http://es5.github.io/#x15.12.3)                                       // 1876
    var initedStack = !stackA;                                                                                         // 1877
    stackA || (stackA = getArray());                                                                                   // 1878
    stackB || (stackB = getArray());                                                                                   // 1879
                                                                                                                       // 1880
    var length = stackA.length;                                                                                        // 1881
    while (length--) {                                                                                                 // 1882
      if (stackA[length] == a) {                                                                                       // 1883
        return stackB[length] == b;                                                                                    // 1884
      }                                                                                                                // 1885
    }                                                                                                                  // 1886
    var size = 0;                                                                                                      // 1887
    result = true;                                                                                                     // 1888
                                                                                                                       // 1889
    // add `a` and `b` to the stack of traversed objects                                                               // 1890
    stackA.push(a);                                                                                                    // 1891
    stackB.push(b);                                                                                                    // 1892
                                                                                                                       // 1893
    // recursively compare objects and arrays (susceptible to call stack limits)                                       // 1894
    if (isArr) {                                                                                                       // 1895
      // compare lengths to determine if a deep comparison is necessary                                                // 1896
      length = a.length;                                                                                               // 1897
      size = b.length;                                                                                                 // 1898
      result = size == length;                                                                                         // 1899
                                                                                                                       // 1900
      if (result || isWhere) {                                                                                         // 1901
        // deep compare the contents, ignoring non-numeric properties                                                  // 1902
        while (size--) {                                                                                               // 1903
          var index = length,                                                                                          // 1904
              value = b[size];                                                                                         // 1905
                                                                                                                       // 1906
          if (isWhere) {                                                                                               // 1907
            while (index--) {                                                                                          // 1908
              if ((result = baseIsEqual(a[index], value, callback, isWhere, stackA, stackB))) {                        // 1909
                break;                                                                                                 // 1910
              }                                                                                                        // 1911
            }                                                                                                          // 1912
          } else if (!(result = baseIsEqual(a[size], value, callback, isWhere, stackA, stackB))) {                     // 1913
            break;                                                                                                     // 1914
          }                                                                                                            // 1915
        }                                                                                                              // 1916
      }                                                                                                                // 1917
    }                                                                                                                  // 1918
    else {                                                                                                             // 1919
      // deep compare objects using `forIn`, instead of `forOwn`, to avoid `Object.keys`                               // 1920
      // which, in this case, is more costly                                                                           // 1921
      forIn(b, function(value, key, b) {                                                                               // 1922
        if (hasOwnProperty.call(b, key)) {                                                                             // 1923
          // count the number of properties.                                                                           // 1924
          size++;                                                                                                      // 1925
          // deep compare each property value.                                                                         // 1926
          return (result = hasOwnProperty.call(a, key) && baseIsEqual(a[key], value, callback, isWhere, stackA, stackB));
        }                                                                                                              // 1928
      });                                                                                                              // 1929
                                                                                                                       // 1930
      if (result && !isWhere) {                                                                                        // 1931
        // ensure both objects have the same number of properties                                                      // 1932
        forIn(a, function(value, key, a) {                                                                             // 1933
          if (hasOwnProperty.call(a, key)) {                                                                           // 1934
            // `size` will be `-1` if `a` has more properties than `b`                                                 // 1935
            return (result = --size > -1);                                                                             // 1936
          }                                                                                                            // 1937
        });                                                                                                            // 1938
      }                                                                                                                // 1939
    }                                                                                                                  // 1940
    stackA.pop();                                                                                                      // 1941
    stackB.pop();                                                                                                      // 1942
                                                                                                                       // 1943
    if (initedStack) {                                                                                                 // 1944
      releaseArray(stackA);                                                                                            // 1945
      releaseArray(stackB);                                                                                            // 1946
    }                                                                                                                  // 1947
    return result;                                                                                                     // 1948
  }                                                                                                                    // 1949
                                                                                                                       // 1950
  /**                                                                                                                  // 1951
   * Creates a function that, when called, either curries or invokes `func`                                            // 1952
   * with an optional `this` binding and partially applied arguments.                                                  // 1953
   *                                                                                                                   // 1954
   * @private                                                                                                          // 1955
   * @param {Function|string} func The function or method name to reference.                                           // 1956
   * @param {number} bitmask The bitmask of method flags to compose.                                                   // 1957
   *  The bitmask may be composed of the following flags:                                                              // 1958
   *  1 - `_.bind`                                                                                                     // 1959
   *  2 - `_.bindKey`                                                                                                  // 1960
   *  4 - `_.curry`                                                                                                    // 1961
   *  8 - `_.curry` (bound)                                                                                            // 1962
   *  16 - `_.partial`                                                                                                 // 1963
   *  32 - `_.partialRight`                                                                                            // 1964
   * @param {Array} [partialArgs] An array of arguments to prepend to those                                            // 1965
   *  provided to the new function.                                                                                    // 1966
   * @param {Array} [partialRightArgs] An array of arguments to append to those                                        // 1967
   *  provided to the new function.                                                                                    // 1968
   * @param {*} [thisArg] The `this` binding of `func`.                                                                // 1969
   * @param {number} [arity] The arity of `func`.                                                                      // 1970
   * @returns {Function} Returns the new function.                                                                     // 1971
   */                                                                                                                  // 1972
  function createWrapper(func, bitmask, partialArgs, partialRightArgs, thisArg, arity) {                               // 1973
    var isBind = bitmask & 1,                                                                                          // 1974
        isBindKey = bitmask & 2,                                                                                       // 1975
        isCurry = bitmask & 4,                                                                                         // 1976
        isCurryBound = bitmask & 8,                                                                                    // 1977
        isPartial = bitmask & 16,                                                                                      // 1978
        isPartialRight = bitmask & 32;                                                                                 // 1979
                                                                                                                       // 1980
    if (!isBindKey && !isFunction(func)) {                                                                             // 1981
      throw new TypeError;                                                                                             // 1982
    }                                                                                                                  // 1983
    if (isPartial && !partialArgs.length) {                                                                            // 1984
      bitmask &= ~16;                                                                                                  // 1985
      isPartial = partialArgs = false;                                                                                 // 1986
    }                                                                                                                  // 1987
    if (isPartialRight && !partialRightArgs.length) {                                                                  // 1988
      bitmask &= ~32;                                                                                                  // 1989
      isPartialRight = partialRightArgs = false;                                                                       // 1990
    }                                                                                                                  // 1991
    var bindData = func && func.__bindData__;                                                                          // 1992
    if (bindData && bindData !== true) {                                                                               // 1993
      // clone `bindData`                                                                                              // 1994
      bindData = slice(bindData);                                                                                      // 1995
      if (bindData[2]) {                                                                                               // 1996
        bindData[2] = slice(bindData[2]);                                                                              // 1997
      }                                                                                                                // 1998
      if (bindData[3]) {                                                                                               // 1999
        bindData[3] = slice(bindData[3]);                                                                              // 2000
      }                                                                                                                // 2001
      // set `thisBinding` is not previously bound                                                                     // 2002
      if (isBind && !(bindData[1] & 1)) {                                                                              // 2003
        bindData[4] = thisArg;                                                                                         // 2004
      }                                                                                                                // 2005
      // set if previously bound but not currently (subsequent curried functions)                                      // 2006
      if (!isBind && bindData[1] & 1) {                                                                                // 2007
        bitmask |= 8;                                                                                                  // 2008
      }                                                                                                                // 2009
      // set curried arity if not yet set                                                                              // 2010
      if (isCurry && !(bindData[1] & 4)) {                                                                             // 2011
        bindData[5] = arity;                                                                                           // 2012
      }                                                                                                                // 2013
      // append partial left arguments                                                                                 // 2014
      if (isPartial) {                                                                                                 // 2015
        push.apply(bindData[2] || (bindData[2] = []), partialArgs);                                                    // 2016
      }                                                                                                                // 2017
      // append partial right arguments                                                                                // 2018
      if (isPartialRight) {                                                                                            // 2019
        unshift.apply(bindData[3] || (bindData[3] = []), partialRightArgs);                                            // 2020
      }                                                                                                                // 2021
      // merge flags                                                                                                   // 2022
      bindData[1] |= bitmask;                                                                                          // 2023
      return createWrapper.apply(null, bindData);                                                                      // 2024
    }                                                                                                                  // 2025
    // fast path for `_.bind`                                                                                          // 2026
    var creater = (bitmask == 1 || bitmask === 17) ? baseBind : baseCreateWrapper;                                     // 2027
    return creater([func, bitmask, partialArgs, partialRightArgs, thisArg, arity]);                                    // 2028
  }                                                                                                                    // 2029
                                                                                                                       // 2030
  /**                                                                                                                  // 2031
   * Creates compiled iteration functions.                                                                             // 2032
   *                                                                                                                   // 2033
   * @private                                                                                                          // 2034
   * @param {...Object} [options] The compile options object(s).                                                       // 2035
   * @param {string} [options.array] Code to determine if the iterable is an array or array-like.                      // 2036
   * @param {boolean} [options.useHas] Specify using `hasOwnProperty` checks in the object loop.                       // 2037
   * @param {Function} [options.keys] A reference to `_.keys` for use in own property iteration.                       // 2038
   * @param {string} [options.args] A comma separated string of iteration function arguments.                          // 2039
   * @param {string} [options.top] Code to execute before the iteration branches.                                      // 2040
   * @param {string} [options.loop] Code to execute in the object loop.                                                // 2041
   * @param {string} [options.bottom] Code to execute after the iteration branches.                                    // 2042
   * @returns {Function} Returns the compiled function.                                                                // 2043
   */                                                                                                                  // 2044
  function createIterator() {                                                                                          // 2045
    // data properties                                                                                                 // 2046
    iteratorData.shadowedProps = shadowedProps;                                                                        // 2047
                                                                                                                       // 2048
    // iterator options                                                                                                // 2049
    iteratorData.array = iteratorData.bottom = iteratorData.loop = iteratorData.top = '';                              // 2050
    iteratorData.init = 'iterable';                                                                                    // 2051
    iteratorData.useHas = true;                                                                                        // 2052
                                                                                                                       // 2053
    // merge options into a template data object                                                                       // 2054
    for (var object, index = 0; object = arguments[index]; index++) {                                                  // 2055
      for (var key in object) {                                                                                        // 2056
        iteratorData[key] = object[key];                                                                               // 2057
      }                                                                                                                // 2058
    }                                                                                                                  // 2059
    var args = iteratorData.args;                                                                                      // 2060
    iteratorData.firstArg = /^[^,]+/.exec(args)[0];                                                                    // 2061
                                                                                                                       // 2062
    // create the function factory                                                                                     // 2063
    var factory = Function(                                                                                            // 2064
        'baseCreateCallback, errorClass, errorProto, hasOwnProperty, ' +                                               // 2065
        'indicatorObject, isArguments, isArray, isString, keys, objectProto, ' +                                       // 2066
        'objectTypes, nonEnumProps, stringClass, stringProto, toString',                                               // 2067
      'return function(' + args + ') {\n' + iteratorTemplate(iteratorData) + '\n}'                                     // 2068
    );                                                                                                                 // 2069
                                                                                                                       // 2070
    // return the compiled function                                                                                    // 2071
    return factory(                                                                                                    // 2072
      baseCreateCallback, errorClass, errorProto, hasOwnProperty,                                                      // 2073
      indicatorObject, isArguments, isArray, isString, iteratorData.keys, objectProto,                                 // 2074
      objectTypes, nonEnumProps, stringClass, stringProto, toString                                                    // 2075
    );                                                                                                                 // 2076
  }                                                                                                                    // 2077
                                                                                                                       // 2078
  /**                                                                                                                  // 2079
   * Used by `escape` to convert characters to HTML entities.                                                          // 2080
   *                                                                                                                   // 2081
   * @private                                                                                                          // 2082
   * @param {string} match The matched character to escape.                                                            // 2083
   * @returns {string} Returns the escaped character.                                                                  // 2084
   */                                                                                                                  // 2085
  function escapeHtmlChar(match) {                                                                                     // 2086
    return htmlEscapes[match];                                                                                         // 2087
  }                                                                                                                    // 2088
                                                                                                                       // 2089
  /**                                                                                                                  // 2090
   * Checks if `value` is a native function.                                                                           // 2091
   *                                                                                                                   // 2092
   * @private                                                                                                          // 2093
   * @param {*} value The value to check.                                                                              // 2094
   * @returns {boolean} Returns `true` if the `value` is a native function, else `false`.                              // 2095
   */                                                                                                                  // 2096
  function isNative(value) {                                                                                           // 2097
    return typeof value == 'function' && reNative.test(value);                                                         // 2098
  }                                                                                                                    // 2099
                                                                                                                       // 2100
  /**                                                                                                                  // 2101
   * Sets `this` binding data on a given function.                                                                     // 2102
   *                                                                                                                   // 2103
   * @private                                                                                                          // 2104
   * @param {Function} func The function to set data on.                                                               // 2105
   * @param {Array} value The data array to set.                                                                       // 2106
   */                                                                                                                  // 2107
  var setBindData = !defineProperty ? noop : function(func, value) {                                                   // 2108
    descriptor.value = value;                                                                                          // 2109
    defineProperty(func, '__bindData__', descriptor);                                                                  // 2110
  };                                                                                                                   // 2111
                                                                                                                       // 2112
  /*--------------------------------------------------------------------------*/                                       // 2113
                                                                                                                       // 2114
  /**                                                                                                                  // 2115
   * Checks if `value` is an `arguments` object.                                                                       // 2116
   *                                                                                                                   // 2117
   * @static                                                                                                           // 2118
   * @memberOf _                                                                                                       // 2119
   * @category Objects                                                                                                 // 2120
   * @param {*} value The value to check.                                                                              // 2121
   * @returns {boolean} Returns `true` if the `value` is an `arguments` object, else `false`.                          // 2122
   * @example                                                                                                          // 2123
   *                                                                                                                   // 2124
   * (function() { return _.isArguments(arguments); })(1, 2, 3);                                                       // 2125
   * // => true                                                                                                        // 2126
   *                                                                                                                   // 2127
   * _.isArguments([1, 2, 3]);                                                                                         // 2128
   * // => false                                                                                                       // 2129
   */                                                                                                                  // 2130
  function isArguments(value) {                                                                                        // 2131
    return value && typeof value == 'object' && typeof value.length == 'number' &&                                     // 2132
      toString.call(value) == argsClass || false;                                                                      // 2133
  }                                                                                                                    // 2134
  // fallback for browsers that can't detect `arguments` objects by [[Class]]                                          // 2135
  if (!support.argsClass) {                                                                                            // 2136
    isArguments = function(value) {                                                                                    // 2137
      return value && typeof value == 'object' && typeof value.length == 'number' &&                                   // 2138
        hasOwnProperty.call(value, 'callee') && !propertyIsEnumerable.call(value, 'callee') || false;                  // 2139
    };                                                                                                                 // 2140
  }                                                                                                                    // 2141
                                                                                                                       // 2142
  /**                                                                                                                  // 2143
   * Checks if `value` is an array.                                                                                    // 2144
   *                                                                                                                   // 2145
   * @static                                                                                                           // 2146
   * @memberOf _                                                                                                       // 2147
   * @type Function                                                                                                    // 2148
   * @category Objects                                                                                                 // 2149
   * @param {*} value The value to check.                                                                              // 2150
   * @returns {boolean} Returns `true` if the `value` is an array, else `false`.                                       // 2151
   * @example                                                                                                          // 2152
   *                                                                                                                   // 2153
   * (function() { return _.isArray(arguments); })();                                                                  // 2154
   * // => false                                                                                                       // 2155
   *                                                                                                                   // 2156
   * _.isArray([1, 2, 3]);                                                                                             // 2157
   * // => true                                                                                                        // 2158
   */                                                                                                                  // 2159
  var isArray = nativeIsArray || function(value) {                                                                     // 2160
    return value && typeof value == 'object' && typeof value.length == 'number' &&                                     // 2161
      toString.call(value) == arrayClass || false;                                                                     // 2162
  };                                                                                                                   // 2163
                                                                                                                       // 2164
  /**                                                                                                                  // 2165
   * A fallback implementation of `Object.keys` which produces an array of the                                         // 2166
   * given object's own enumerable property names.                                                                     // 2167
   *                                                                                                                   // 2168
   * @private                                                                                                          // 2169
   * @type Function                                                                                                    // 2170
   * @param {Object} object The object to inspect.                                                                     // 2171
   * @returns {Array} Returns an array of property names.                                                              // 2172
   */                                                                                                                  // 2173
  var shimKeys = createIterator({                                                                                      // 2174
    'args': 'object',                                                                                                  // 2175
    'init': '[]',                                                                                                      // 2176
    'top': 'if (!(objectTypes[typeof object])) return result',                                                         // 2177
    'loop': 'result.push(index)'                                                                                       // 2178
  });                                                                                                                  // 2179
                                                                                                                       // 2180
  /**                                                                                                                  // 2181
   * Creates an array composed of the own enumerable property names of an object.                                      // 2182
   *                                                                                                                   // 2183
   * @static                                                                                                           // 2184
   * @memberOf _                                                                                                       // 2185
   * @category Objects                                                                                                 // 2186
   * @param {Object} object The object to inspect.                                                                     // 2187
   * @returns {Array} Returns an array of property names.                                                              // 2188
   * @example                                                                                                          // 2189
   *                                                                                                                   // 2190
   * _.keys({ 'one': 1, 'two': 2, 'three': 3 });                                                                       // 2191
   * // => ['one', 'two', 'three'] (property order is not guaranteed across environments)                              // 2192
   */                                                                                                                  // 2193
  var keys = !nativeKeys ? shimKeys : function(object) {                                                               // 2194
    if (!isObject(object)) {                                                                                           // 2195
      return [];                                                                                                       // 2196
    }                                                                                                                  // 2197
    if ((support.enumPrototypes && typeof object == 'function') ||                                                     // 2198
        (support.nonEnumArgs && object.length && isArguments(object))) {                                               // 2199
      return shimKeys(object);                                                                                         // 2200
    }                                                                                                                  // 2201
    return nativeKeys(object);                                                                                         // 2202
  };                                                                                                                   // 2203
                                                                                                                       // 2204
  /** Reusable iterator options shared by `each`, `forIn`, and `forOwn` */                                             // 2205
  var eachIteratorOptions = {                                                                                          // 2206
    'args': 'collection, callback, thisArg',                                                                           // 2207
    'top': "callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",
    'array': "typeof length == 'number'",                                                                              // 2209
    'keys': keys,                                                                                                      // 2210
    'loop': 'if (callback(iterable[index], index, collection) === false) return result'                                // 2211
  };                                                                                                                   // 2212
                                                                                                                       // 2213
  /** Reusable iterator options for `assign` and `defaults` */                                                         // 2214
  var defaultsIteratorOptions = {                                                                                      // 2215
    'args': 'object, source, guard',                                                                                   // 2216
    'top':                                                                                                             // 2217
      'var args = arguments,\n' +                                                                                      // 2218
      '    argsIndex = 0,\n' +                                                                                         // 2219
      "    argsLength = typeof guard == 'number' ? 2 : args.length;\n" +                                               // 2220
      'while (++argsIndex < argsLength) {\n' +                                                                         // 2221
      '  iterable = args[argsIndex];\n' +                                                                              // 2222
      '  if (iterable && objectTypes[typeof iterable]) {',                                                             // 2223
    'keys': keys,                                                                                                      // 2224
    'loop': "if (typeof result[index] == 'undefined') result[index] = iterable[index]",                                // 2225
    'bottom': '  }\n}'                                                                                                 // 2226
  };                                                                                                                   // 2227
                                                                                                                       // 2228
  /** Reusable iterator options for `forIn` and `forOwn` */                                                            // 2229
  var forOwnIteratorOptions = {                                                                                        // 2230
    'top': 'if (!objectTypes[typeof iterable]) return result;\n' + eachIteratorOptions.top,                            // 2231
    'array': false                                                                                                     // 2232
  };                                                                                                                   // 2233
                                                                                                                       // 2234
  /**                                                                                                                  // 2235
   * Used to convert characters to HTML entities:                                                                      // 2236
   *                                                                                                                   // 2237
   * Though the `>` character is escaped for symmetry, characters like `>` and `/`                                     // 2238
   * don't require escaping in HTML and have no special meaning unless they're part                                    // 2239
   * of a tag or an unquoted attribute value.                                                                          // 2240
   * http://mathiasbynens.be/notes/ambiguous-ampersands (under "semi-related fun fact")                                // 2241
   */                                                                                                                  // 2242
  var htmlEscapes = {                                                                                                  // 2243
    '&': '&amp;',                                                                                                      // 2244
    '<': '&lt;',                                                                                                       // 2245
    '>': '&gt;',                                                                                                       // 2246
    '"': '&quot;',                                                                                                     // 2247
    "'": '&#39;'                                                                                                       // 2248
  };                                                                                                                   // 2249
                                                                                                                       // 2250
  /** Used to match HTML entities and HTML characters */                                                               // 2251
  var reUnescapedHtml = RegExp('[' + keys(htmlEscapes).join('') + ']', 'g');                                           // 2252
                                                                                                                       // 2253
  /**                                                                                                                  // 2254
   * A function compiled to iterate `arguments` objects, arrays, objects, and                                          // 2255
   * strings consistenly across environments, executing the callback for each                                          // 2256
   * element in the collection. The callback is bound to `thisArg` and invoked                                         // 2257
   * with three arguments; (value, index|key, collection). Callbacks may exit                                          // 2258
   * iteration early by explicitly returning `false`.                                                                  // 2259
   *                                                                                                                   // 2260
   * @private                                                                                                          // 2261
   * @type Function                                                                                                    // 2262
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2263
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2264
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2265
   * @returns {Array|Object|string} Returns `collection`.                                                              // 2266
   */                                                                                                                  // 2267
  var baseEach = createIterator(eachIteratorOptions);                                                                  // 2268
                                                                                                                       // 2269
  /*--------------------------------------------------------------------------*/                                       // 2270
                                                                                                                       // 2271
  /**                                                                                                                  // 2272
   * Assigns own enumerable properties of source object(s) to the destination                                          // 2273
   * object. Subsequent sources will overwrite property assignments of previous                                        // 2274
   * sources. If a callback is provided it will be executed to produce the                                             // 2275
   * assigned values. The callback is bound to `thisArg` and invoked with two                                          // 2276
   * arguments; (objectValue, sourceValue).                                                                            // 2277
   *                                                                                                                   // 2278
   * @static                                                                                                           // 2279
   * @memberOf _                                                                                                       // 2280
   * @type Function                                                                                                    // 2281
   * @alias extend                                                                                                     // 2282
   * @category Objects                                                                                                 // 2283
   * @param {Object} object The destination object.                                                                    // 2284
   * @param {...Object} [source] The source objects.                                                                   // 2285
   * @param {Function} [callback] The function to customize assigning values.                                          // 2286
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2287
   * @returns {Object} Returns the destination object.                                                                 // 2288
   * @example                                                                                                          // 2289
   *                                                                                                                   // 2290
   * _.assign({ 'name': 'fred' }, { 'employer': 'slate' });                                                            // 2291
   * // => { 'name': 'fred', 'employer': 'slate' }                                                                     // 2292
   *                                                                                                                   // 2293
   * var defaults = _.partialRight(_.assign, function(a, b) {                                                          // 2294
   *   return typeof a == 'undefined' ? b : a;                                                                         // 2295
   * });                                                                                                               // 2296
   *                                                                                                                   // 2297
   * var object = { 'name': 'barney' };                                                                                // 2298
   * defaults(object, { 'name': 'fred', 'employer': 'slate' });                                                        // 2299
   * // => { 'name': 'barney', 'employer': 'slate' }                                                                   // 2300
   */                                                                                                                  // 2301
  var assign = createIterator(defaultsIteratorOptions, {                                                               // 2302
    'top':                                                                                                             // 2303
      defaultsIteratorOptions.top.replace(';',                                                                         // 2304
        ';\n' +                                                                                                        // 2305
        "if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n" +                                       // 2306
        '  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n' +                      // 2307
        "} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n" +                                // 2308
        '  callback = args[--argsLength];\n' +                                                                         // 2309
        '}'                                                                                                            // 2310
      ),                                                                                                               // 2311
    'loop': 'result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]'                    // 2312
  });                                                                                                                  // 2313
                                                                                                                       // 2314
  /**                                                                                                                  // 2315
   * Creates a clone of `value`. If `isDeep` is `true` nested objects will also                                        // 2316
   * be cloned, otherwise they will be assigned by reference. If a callback                                            // 2317
   * is provided it will be executed to produce the cloned values. If the                                              // 2318
   * callback returns `undefined` cloning will be handled by the method instead.                                       // 2319
   * The callback is bound to `thisArg` and invoked with one argument; (value).                                        // 2320
   *                                                                                                                   // 2321
   * @static                                                                                                           // 2322
   * @memberOf _                                                                                                       // 2323
   * @category Objects                                                                                                 // 2324
   * @param {*} value The value to clone.                                                                              // 2325
   * @param {boolean} [isDeep=false] Specify a deep clone.                                                             // 2326
   * @param {Function} [callback] The function to customize cloning values.                                            // 2327
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2328
   * @returns {*} Returns the cloned value.                                                                            // 2329
   * @example                                                                                                          // 2330
   *                                                                                                                   // 2331
   * var characters = [                                                                                                // 2332
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2333
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2334
   * ];                                                                                                                // 2335
   *                                                                                                                   // 2336
   * var shallow = _.clone(characters);                                                                                // 2337
   * shallow[0] === characters[0];                                                                                     // 2338
   * // => true                                                                                                        // 2339
   *                                                                                                                   // 2340
   * var deep = _.clone(characters, true);                                                                             // 2341
   * deep[0] === characters[0];                                                                                        // 2342
   * // => false                                                                                                       // 2343
   *                                                                                                                   // 2344
   * _.mixin({                                                                                                         // 2345
   *   'clone': _.partialRight(_.clone, function(value) {                                                              // 2346
   *     return _.isElement(value) ? value.cloneNode(false) : undefined;                                               // 2347
   *   })                                                                                                              // 2348
   * });                                                                                                               // 2349
   *                                                                                                                   // 2350
   * var clone = _.clone(document.body);                                                                               // 2351
   * clone.childNodes.length;                                                                                          // 2352
   * // => 0                                                                                                           // 2353
   */                                                                                                                  // 2354
  function clone(value, isDeep, callback, thisArg) {                                                                   // 2355
    // allows working with "Collections" methods without using their `index`                                           // 2356
    // and `collection` arguments for `isDeep` and `callback`                                                          // 2357
    if (typeof isDeep != 'boolean' && isDeep != null) {                                                                // 2358
      thisArg = callback;                                                                                              // 2359
      callback = isDeep;                                                                                               // 2360
      isDeep = false;                                                                                                  // 2361
    }                                                                                                                  // 2362
    return baseClone(value, isDeep, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));        // 2363
  }                                                                                                                    // 2364
                                                                                                                       // 2365
  /**                                                                                                                  // 2366
   * Creates a deep clone of `value`. If a callback is provided it will be                                             // 2367
   * executed to produce the cloned values. If the callback returns `undefined`                                        // 2368
   * cloning will be handled by the method instead. The callback is bound to                                           // 2369
   * `thisArg` and invoked with one argument; (value).                                                                 // 2370
   *                                                                                                                   // 2371
   * Note: This method is loosely based on the structured clone algorithm. Functions                                   // 2372
   * and DOM nodes are **not** cloned. The enumerable properties of `arguments` objects and                            // 2373
   * objects created by constructors other than `Object` are cloned to plain `Object` objects.                         // 2374
   * See http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm.                         // 2375
   *                                                                                                                   // 2376
   * @static                                                                                                           // 2377
   * @memberOf _                                                                                                       // 2378
   * @category Objects                                                                                                 // 2379
   * @param {*} value The value to deep clone.                                                                         // 2380
   * @param {Function} [callback] The function to customize cloning values.                                            // 2381
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2382
   * @returns {*} Returns the deep cloned value.                                                                       // 2383
   * @example                                                                                                          // 2384
   *                                                                                                                   // 2385
   * var characters = [                                                                                                // 2386
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2387
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2388
   * ];                                                                                                                // 2389
   *                                                                                                                   // 2390
   * var deep = _.cloneDeep(characters);                                                                               // 2391
   * deep[0] === characters[0];                                                                                        // 2392
   * // => false                                                                                                       // 2393
   *                                                                                                                   // 2394
   * var view = {                                                                                                      // 2395
   *   'label': 'docs',                                                                                                // 2396
   *   'node': element                                                                                                 // 2397
   * };                                                                                                                // 2398
   *                                                                                                                   // 2399
   * var clone = _.cloneDeep(view, function(value) {                                                                   // 2400
   *   return _.isElement(value) ? value.cloneNode(true) : undefined;                                                  // 2401
   * });                                                                                                               // 2402
   *                                                                                                                   // 2403
   * clone.node == view.node;                                                                                          // 2404
   * // => false                                                                                                       // 2405
   */                                                                                                                  // 2406
  function cloneDeep(value, callback, thisArg) {                                                                       // 2407
    return baseClone(value, true, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));          // 2408
  }                                                                                                                    // 2409
                                                                                                                       // 2410
  /**                                                                                                                  // 2411
   * Assigns own enumerable properties of source object(s) to the destination                                          // 2412
   * object for all destination properties that resolve to `undefined`. Once a                                         // 2413
   * property is set, additional defaults of the same property will be ignored.                                        // 2414
   *                                                                                                                   // 2415
   * @static                                                                                                           // 2416
   * @memberOf _                                                                                                       // 2417
   * @type Function                                                                                                    // 2418
   * @category Objects                                                                                                 // 2419
   * @param {Object} object The destination object.                                                                    // 2420
   * @param {...Object} [source] The source objects.                                                                   // 2421
   * @param- {Object} [guard] Allows working with `_.reduce` without using its                                         // 2422
   *  `key` and `object` arguments as sources.                                                                         // 2423
   * @returns {Object} Returns the destination object.                                                                 // 2424
   * @example                                                                                                          // 2425
   *                                                                                                                   // 2426
   * var object = { 'name': 'barney' };                                                                                // 2427
   * _.defaults(object, { 'name': 'fred', 'employer': 'slate' });                                                      // 2428
   * // => { 'name': 'barney', 'employer': 'slate' }                                                                   // 2429
   */                                                                                                                  // 2430
  var defaults = createIterator(defaultsIteratorOptions);                                                              // 2431
                                                                                                                       // 2432
  /**                                                                                                                  // 2433
   * Iterates over own and inherited enumerable properties of an object,                                               // 2434
   * executing the callback for each property. The callback is bound to `thisArg`                                      // 2435
   * and invoked with three arguments; (value, key, object). Callbacks may exit                                        // 2436
   * iteration early by explicitly returning `false`.                                                                  // 2437
   *                                                                                                                   // 2438
   * @static                                                                                                           // 2439
   * @memberOf _                                                                                                       // 2440
   * @type Function                                                                                                    // 2441
   * @category Objects                                                                                                 // 2442
   * @param {Object} object The object to iterate over.                                                                // 2443
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2444
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2445
   * @returns {Object} Returns `object`.                                                                               // 2446
   * @example                                                                                                          // 2447
   *                                                                                                                   // 2448
   * function Shape() {                                                                                                // 2449
   *   this.x = 0;                                                                                                     // 2450
   *   this.y = 0;                                                                                                     // 2451
   * }                                                                                                                 // 2452
   *                                                                                                                   // 2453
   * Shape.prototype.move = function(x, y) {                                                                           // 2454
   *   this.x += x;                                                                                                    // 2455
   *   this.y += y;                                                                                                    // 2456
   * };                                                                                                                // 2457
   *                                                                                                                   // 2458
   * _.forIn(new Shape, function(value, key) {                                                                         // 2459
   *   console.log(key);                                                                                               // 2460
   * });                                                                                                               // 2461
   * // => logs 'x', 'y', and 'move' (property order is not guaranteed across environments)                            // 2462
   */                                                                                                                  // 2463
  var forIn = createIterator(eachIteratorOptions, forOwnIteratorOptions, {                                             // 2464
    'useHas': false                                                                                                    // 2465
  });                                                                                                                  // 2466
                                                                                                                       // 2467
  /**                                                                                                                  // 2468
   * Iterates over own enumerable properties of an object, executing the callback                                      // 2469
   * for each property. The callback is bound to `thisArg` and invoked with three                                      // 2470
   * arguments; (value, key, object). Callbacks may exit iteration early by                                            // 2471
   * explicitly returning `false`.                                                                                     // 2472
   *                                                                                                                   // 2473
   * @static                                                                                                           // 2474
   * @memberOf _                                                                                                       // 2475
   * @type Function                                                                                                    // 2476
   * @category Objects                                                                                                 // 2477
   * @param {Object} object The object to iterate over.                                                                // 2478
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2479
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2480
   * @returns {Object} Returns `object`.                                                                               // 2481
   * @example                                                                                                          // 2482
   *                                                                                                                   // 2483
   * _.forOwn({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {                                           // 2484
   *   console.log(key);                                                                                               // 2485
   * });                                                                                                               // 2486
   * // => logs '0', '1', and 'length' (property order is not guaranteed across environments)                          // 2487
   */                                                                                                                  // 2488
  var forOwn = createIterator(eachIteratorOptions, forOwnIteratorOptions);                                             // 2489
                                                                                                                       // 2490
  /**                                                                                                                  // 2491
   * Checks if `value` is a function.                                                                                  // 2492
   *                                                                                                                   // 2493
   * @static                                                                                                           // 2494
   * @memberOf _                                                                                                       // 2495
   * @category Objects                                                                                                 // 2496
   * @param {*} value The value to check.                                                                              // 2497
   * @returns {boolean} Returns `true` if the `value` is a function, else `false`.                                     // 2498
   * @example                                                                                                          // 2499
   *                                                                                                                   // 2500
   * _.isFunction(_);                                                                                                  // 2501
   * // => true                                                                                                        // 2502
   */                                                                                                                  // 2503
  function isFunction(value) {                                                                                         // 2504
    return typeof value == 'function';                                                                                 // 2505
  }                                                                                                                    // 2506
  // fallback for older versions of Chrome and Safari                                                                  // 2507
  if (isFunction(/x/)) {                                                                                               // 2508
    isFunction = function(value) {                                                                                     // 2509
      return typeof value == 'function' && toString.call(value) == funcClass;                                          // 2510
    };                                                                                                                 // 2511
  }                                                                                                                    // 2512
                                                                                                                       // 2513
  /**                                                                                                                  // 2514
   * Checks if `value` is the language type of Object.                                                                 // 2515
   * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)                                 // 2516
   *                                                                                                                   // 2517
   * @static                                                                                                           // 2518
   * @memberOf _                                                                                                       // 2519
   * @category Objects                                                                                                 // 2520
   * @param {*} value The value to check.                                                                              // 2521
   * @returns {boolean} Returns `true` if the `value` is an object, else `false`.                                      // 2522
   * @example                                                                                                          // 2523
   *                                                                                                                   // 2524
   * _.isObject({});                                                                                                   // 2525
   * // => true                                                                                                        // 2526
   *                                                                                                                   // 2527
   * _.isObject([1, 2, 3]);                                                                                            // 2528
   * // => true                                                                                                        // 2529
   *                                                                                                                   // 2530
   * _.isObject(1);                                                                                                    // 2531
   * // => false                                                                                                       // 2532
   */                                                                                                                  // 2533
  function isObject(value) {                                                                                           // 2534
    // check if the value is the ECMAScript language type of Object                                                    // 2535
    // http://es5.github.io/#x8                                                                                        // 2536
    // and avoid a V8 bug                                                                                              // 2537
    // http://code.google.com/p/v8/issues/detail?id=2291                                                               // 2538
    return !!(value && objectTypes[typeof value]);                                                                     // 2539
  }                                                                                                                    // 2540
                                                                                                                       // 2541
  /**                                                                                                                  // 2542
   * Checks if `value` is a string.                                                                                    // 2543
   *                                                                                                                   // 2544
   * @static                                                                                                           // 2545
   * @memberOf _                                                                                                       // 2546
   * @category Objects                                                                                                 // 2547
   * @param {*} value The value to check.                                                                              // 2548
   * @returns {boolean} Returns `true` if the `value` is a string, else `false`.                                       // 2549
   * @example                                                                                                          // 2550
   *                                                                                                                   // 2551
   * _.isString('fred');                                                                                               // 2552
   * // => true                                                                                                        // 2553
   */                                                                                                                  // 2554
  function isString(value) {                                                                                           // 2555
    return typeof value == 'string' ||                                                                                 // 2556
      value && typeof value == 'object' && toString.call(value) == stringClass || false;                               // 2557
  }                                                                                                                    // 2558
                                                                                                                       // 2559
  /**                                                                                                                  // 2560
   * Creates an array composed of the own enumerable property values of `object`.                                      // 2561
   *                                                                                                                   // 2562
   * @static                                                                                                           // 2563
   * @memberOf _                                                                                                       // 2564
   * @category Objects                                                                                                 // 2565
   * @param {Object} object The object to inspect.                                                                     // 2566
   * @returns {Array} Returns an array of property values.                                                             // 2567
   * @example                                                                                                          // 2568
   *                                                                                                                   // 2569
   * _.values({ 'one': 1, 'two': 2, 'three': 3 });                                                                     // 2570
   * // => [1, 2, 3] (property order is not guaranteed across environments)                                            // 2571
   */                                                                                                                  // 2572
  function values(object) {                                                                                            // 2573
    var index = -1,                                                                                                    // 2574
        props = keys(object),                                                                                          // 2575
        length = props.length,                                                                                         // 2576
        result = Array(length);                                                                                        // 2577
                                                                                                                       // 2578
    while (++index < length) {                                                                                         // 2579
      result[index] = object[props[index]];                                                                            // 2580
    }                                                                                                                  // 2581
    return result;                                                                                                     // 2582
  }                                                                                                                    // 2583
                                                                                                                       // 2584
  /*--------------------------------------------------------------------------*/                                       // 2585
                                                                                                                       // 2586
  /**                                                                                                                  // 2587
   * Iterates over elements of a collection, returning an array of all elements                                        // 2588
   * the callback returns truey for. The callback is bound to `thisArg` and                                            // 2589
   * invoked with three arguments; (value, index|key, collection).                                                     // 2590
   *                                                                                                                   // 2591
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2592
   * callback will return the property value of the given element.                                                     // 2593
   *                                                                                                                   // 2594
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2595
   * will return `true` for elements that have the properties of the given object,                                     // 2596
   * else `false`.                                                                                                     // 2597
   *                                                                                                                   // 2598
   * @static                                                                                                           // 2599
   * @memberOf _                                                                                                       // 2600
   * @alias select                                                                                                     // 2601
   * @category Collections                                                                                             // 2602
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2603
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2604
   *  per iteration. If a property name or object is provided it will be used                                          // 2605
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2606
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2607
   * @returns {Array} Returns a new array of elements that passed the callback check.                                  // 2608
   * @example                                                                                                          // 2609
   *                                                                                                                   // 2610
   * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });                                 // 2611
   * // => [2, 4, 6]                                                                                                   // 2612
   *                                                                                                                   // 2613
   * var characters = [                                                                                                // 2614
   *   { 'name': 'barney', 'age': 36, 'blocked': false },                                                              // 2615
   *   { 'name': 'fred',   'age': 40, 'blocked': true }                                                                // 2616
   * ];                                                                                                                // 2617
   *                                                                                                                   // 2618
   * // using "_.pluck" callback shorthand                                                                             // 2619
   * _.filter(characters, 'blocked');                                                                                  // 2620
   * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]                                                            // 2621
   *                                                                                                                   // 2622
   * // using "_.where" callback shorthand                                                                             // 2623
   * _.filter(characters, { 'age': 36 });                                                                              // 2624
   * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]                                                         // 2625
   */                                                                                                                  // 2626
  function filter(collection, callback, thisArg) {                                                                     // 2627
    var result = [];                                                                                                   // 2628
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2629
                                                                                                                       // 2630
    if (isArray(collection)) {                                                                                         // 2631
      var index = -1,                                                                                                  // 2632
          length = collection.length;                                                                                  // 2633
                                                                                                                       // 2634
      while (++index < length) {                                                                                       // 2635
        var value = collection[index];                                                                                 // 2636
        if (callback(value, index, collection)) {                                                                      // 2637
          result.push(value);                                                                                          // 2638
        }                                                                                                              // 2639
      }                                                                                                                // 2640
    } else {                                                                                                           // 2641
      baseEach(collection, function(value, index, collection) {                                                        // 2642
        if (callback(value, index, collection)) {                                                                      // 2643
          result.push(value);                                                                                          // 2644
        }                                                                                                              // 2645
      });                                                                                                              // 2646
    }                                                                                                                  // 2647
    return result;                                                                                                     // 2648
  }                                                                                                                    // 2649
                                                                                                                       // 2650
  /**                                                                                                                  // 2651
   * Iterates over elements of a collection, returning the first element that                                          // 2652
   * the callback returns truey for. The callback is bound to `thisArg` and                                            // 2653
   * invoked with three arguments; (value, index|key, collection).                                                     // 2654
   *                                                                                                                   // 2655
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2656
   * callback will return the property value of the given element.                                                     // 2657
   *                                                                                                                   // 2658
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2659
   * will return `true` for elements that have the properties of the given object,                                     // 2660
   * else `false`.                                                                                                     // 2661
   *                                                                                                                   // 2662
   * @static                                                                                                           // 2663
   * @memberOf _                                                                                                       // 2664
   * @alias detect, findWhere                                                                                          // 2665
   * @category Collections                                                                                             // 2666
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2667
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2668
   *  per iteration. If a property name or object is provided it will be used                                          // 2669
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2670
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2671
   * @returns {*} Returns the found element, else `undefined`.                                                         // 2672
   * @example                                                                                                          // 2673
   *                                                                                                                   // 2674
   * var characters = [                                                                                                // 2675
   *   { 'name': 'barney',  'age': 36, 'blocked': false },                                                             // 2676
   *   { 'name': 'fred',    'age': 40, 'blocked': true },                                                              // 2677
   *   { 'name': 'pebbles', 'age': 1,  'blocked': false }                                                              // 2678
   * ];                                                                                                                // 2679
   *                                                                                                                   // 2680
   * _.find(characters, function(chr) {                                                                                // 2681
   *   return chr.age < 40;                                                                                            // 2682
   * });                                                                                                               // 2683
   * // => { 'name': 'barney', 'age': 36, 'blocked': false }                                                           // 2684
   *                                                                                                                   // 2685
   * // using "_.where" callback shorthand                                                                             // 2686
   * _.find(characters, { 'age': 1 });                                                                                 // 2687
   * // =>  { 'name': 'pebbles', 'age': 1, 'blocked': false }                                                          // 2688
   *                                                                                                                   // 2689
   * // using "_.pluck" callback shorthand                                                                             // 2690
   * _.find(characters, 'blocked');                                                                                    // 2691
   * // => { 'name': 'fred', 'age': 40, 'blocked': true }                                                              // 2692
   */                                                                                                                  // 2693
  function find(collection, callback, thisArg) {                                                                       // 2694
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2695
                                                                                                                       // 2696
    if (isArray(collection)) {                                                                                         // 2697
      var index = -1,                                                                                                  // 2698
          length = collection.length;                                                                                  // 2699
                                                                                                                       // 2700
      while (++index < length) {                                                                                       // 2701
        var value = collection[index];                                                                                 // 2702
        if (callback(value, index, collection)) {                                                                      // 2703
          return value;                                                                                                // 2704
        }                                                                                                              // 2705
      }                                                                                                                // 2706
    } else {                                                                                                           // 2707
      var result;                                                                                                      // 2708
      baseEach(collection, function(value, index, collection) {                                                        // 2709
        if (callback(value, index, collection)) {                                                                      // 2710
          result = value;                                                                                              // 2711
          return false;                                                                                                // 2712
        }                                                                                                              // 2713
      });                                                                                                              // 2714
      return result;                                                                                                   // 2715
    }                                                                                                                  // 2716
  }                                                                                                                    // 2717
                                                                                                                       // 2718
  /**                                                                                                                  // 2719
   * Iterates over elements of a collection, executing the callback for each                                           // 2720
   * element. The callback is bound to `thisArg` and invoked with three arguments;                                     // 2721
   * (value, index|key, collection). Callbacks may exit iteration early by                                             // 2722
   * explicitly returning `false`.                                                                                     // 2723
   *                                                                                                                   // 2724
   * Note: As with other "Collections" methods, objects with a `length` property                                       // 2725
   * are iterated like arrays. To avoid this behavior `_.forIn` or `_.forOwn`                                          // 2726
   * may be used for object iteration.                                                                                 // 2727
   *                                                                                                                   // 2728
   * @static                                                                                                           // 2729
   * @memberOf _                                                                                                       // 2730
   * @alias each                                                                                                       // 2731
   * @category Collections                                                                                             // 2732
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2733
   * @param {Function} [callback=identity] The function called per iteration.                                          // 2734
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2735
   * @returns {Array|Object|string} Returns `collection`.                                                              // 2736
   * @example                                                                                                          // 2737
   *                                                                                                                   // 2738
   * _([1, 2, 3]).forEach(function(num) { console.log(num); }).join(',');                                              // 2739
   * // => logs each number and returns '1,2,3'                                                                        // 2740
   *                                                                                                                   // 2741
   * _.forEach({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { console.log(num); });                               // 2742
   * // => logs each number and returns the object (property order is not guaranteed across environments)              // 2743
   */                                                                                                                  // 2744
  function forEach(collection, callback, thisArg) {                                                                    // 2745
    if (callback && typeof thisArg == 'undefined' && isArray(collection)) {                                            // 2746
      var index = -1,                                                                                                  // 2747
          length = collection.length;                                                                                  // 2748
                                                                                                                       // 2749
      while (++index < length) {                                                                                       // 2750
        if (callback(collection[index], index, collection) === false) {                                                // 2751
          break;                                                                                                       // 2752
        }                                                                                                              // 2753
      }                                                                                                                // 2754
    } else {                                                                                                           // 2755
      baseEach(collection, callback, thisArg);                                                                         // 2756
    }                                                                                                                  // 2757
    return collection;                                                                                                 // 2758
  }                                                                                                                    // 2759
                                                                                                                       // 2760
  /**                                                                                                                  // 2761
   * The opposite of `_.filter` this method returns the elements of a                                                  // 2762
   * collection that the callback does **not** return truey for.                                                       // 2763
   *                                                                                                                   // 2764
   * If a property name is provided for `callback` the created "_.pluck" style                                         // 2765
   * callback will return the property value of the given element.                                                     // 2766
   *                                                                                                                   // 2767
   * If an object is provided for `callback` the created "_.where" style callback                                      // 2768
   * will return `true` for elements that have the properties of the given object,                                     // 2769
   * else `false`.                                                                                                     // 2770
   *                                                                                                                   // 2771
   * @static                                                                                                           // 2772
   * @memberOf _                                                                                                       // 2773
   * @category Collections                                                                                             // 2774
   * @param {Array|Object|string} collection The collection to iterate over.                                           // 2775
   * @param {Function|Object|string} [callback=identity] The function called                                           // 2776
   *  per iteration. If a property name or object is provided it will be used                                          // 2777
   *  to create a "_.pluck" or "_.where" style callback, respectively.                                                 // 2778
   * @param {*} [thisArg] The `this` binding of `callback`.                                                            // 2779
   * @returns {Array} Returns a new array of elements that failed the callback check.                                  // 2780
   * @example                                                                                                          // 2781
   *                                                                                                                   // 2782
   * var odds = _.reject([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });                                  // 2783
   * // => [1, 3, 5]                                                                                                   // 2784
   *                                                                                                                   // 2785
   * var characters = [                                                                                                // 2786
   *   { 'name': 'barney', 'age': 36, 'blocked': false },                                                              // 2787
   *   { 'name': 'fred',   'age': 40, 'blocked': true }                                                                // 2788
   * ];                                                                                                                // 2789
   *                                                                                                                   // 2790
   * // using "_.pluck" callback shorthand                                                                             // 2791
   * _.reject(characters, 'blocked');                                                                                  // 2792
   * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]                                                         // 2793
   *                                                                                                                   // 2794
   * // using "_.where" callback shorthand                                                                             // 2795
   * _.reject(characters, { 'age': 36 });                                                                              // 2796
   * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]                                                            // 2797
   */                                                                                                                  // 2798
  function reject(collection, callback, thisArg) {                                                                     // 2799
    callback = lodash.createCallback(callback, thisArg, 3);                                                            // 2800
    return filter(collection, function(value, index, collection) {                                                     // 2801
      return !callback(value, index, collection);                                                                      // 2802
    });                                                                                                                // 2803
  }                                                                                                                    // 2804
                                                                                                                       // 2805
  /*--------------------------------------------------------------------------*/                                       // 2806
                                                                                                                       // 2807
  /**                                                                                                                  // 2808
   * Creates a function that, when called, invokes `func` with the `this`                                              // 2809
   * binding of `thisArg` and prepends any additional `bind` arguments to those                                        // 2810
   * provided to the bound function.                                                                                   // 2811
   *                                                                                                                   // 2812
   * @static                                                                                                           // 2813
   * @memberOf _                                                                                                       // 2814
   * @category Functions                                                                                               // 2815
   * @param {Function} func The function to bind.                                                                      // 2816
   * @param {*} [thisArg] The `this` binding of `func`.                                                                // 2817
   * @param {...*} [arg] Arguments to be partially applied.                                                            // 2818
   * @returns {Function} Returns the new bound function.                                                               // 2819
   * @example                                                                                                          // 2820
   *                                                                                                                   // 2821
   * var func = function(greeting) {                                                                                   // 2822
   *   return greeting + ' ' + this.name;                                                                              // 2823
   * };                                                                                                                // 2824
   *                                                                                                                   // 2825
   * func = _.bind(func, { 'name': 'fred' }, 'hi');                                                                    // 2826
   * func();                                                                                                           // 2827
   * // => 'hi fred'                                                                                                   // 2828
   */                                                                                                                  // 2829
  function bind(func, thisArg) {                                                                                       // 2830
    return arguments.length > 2                                                                                        // 2831
      ? createWrapper(func, 17, slice(arguments, 2), null, thisArg)                                                    // 2832
      : createWrapper(func, 1, null, null, thisArg);                                                                   // 2833
  }                                                                                                                    // 2834
                                                                                                                       // 2835
  /*--------------------------------------------------------------------------*/                                       // 2836
                                                                                                                       // 2837
  /**                                                                                                                  // 2838
   * Produces a callback bound to an optional `thisArg`. If `func` is a property                                       // 2839
   * name the created callback will return the property value for a given element.                                     // 2840
   * If `func` is an object the created callback will return `true` for elements                                       // 2841
   * that contain the equivalent object properties, otherwise it will return `false`.                                  // 2842
   *                                                                                                                   // 2843
   * @static                                                                                                           // 2844
   * @memberOf _                                                                                                       // 2845
   * @category Utilities                                                                                               // 2846
   * @param {*} [func=identity] The value to convert to a callback.                                                    // 2847
   * @param {*} [thisArg] The `this` binding of the created callback.                                                  // 2848
   * @param {number} [argCount] The number of arguments the callback accepts.                                          // 2849
   * @returns {Function} Returns a callback function.                                                                  // 2850
   * @example                                                                                                          // 2851
   *                                                                                                                   // 2852
   * var characters = [                                                                                                // 2853
   *   { 'name': 'barney', 'age': 36 },                                                                                // 2854
   *   { 'name': 'fred',   'age': 40 }                                                                                 // 2855
   * ];                                                                                                                // 2856
   *                                                                                                                   // 2857
   * // wrap to create custom callback shorthands                                                                      // 2858
   * _.createCallback = _.wrap(_.createCallback, function(func, callback, thisArg) {                                   // 2859
   *   var match = /^(.+?)__([gl]t)(.+)$/.exec(callback);                                                              // 2860
   *   return !match ? func(callback, thisArg) : function(object) {                                                    // 2861
   *     return match[2] == 'gt' ? object[match[1]] > match[3] : object[match[1]] < match[3];                          // 2862
   *   };                                                                                                              // 2863
   * });                                                                                                               // 2864
   *                                                                                                                   // 2865
   * _.filter(characters, 'age__gt38');                                                                                // 2866
   * // => [{ 'name': 'fred', 'age': 40 }]                                                                             // 2867
   */                                                                                                                  // 2868
  function createCallback(func, thisArg, argCount) {                                                                   // 2869
    var type = typeof func;                                                                                            // 2870
    if (func == null || type == 'function') {                                                                          // 2871
      return baseCreateCallback(func, thisArg, argCount);                                                              // 2872
    }                                                                                                                  // 2873
    // handle "_.pluck" style callback shorthands                                                                      // 2874
    if (type != 'object') {                                                                                            // 2875
      return property(func);                                                                                           // 2876
    }                                                                                                                  // 2877
    var props = keys(func),                                                                                            // 2878
        key = props[0],                                                                                                // 2879
        a = func[key];                                                                                                 // 2880
                                                                                                                       // 2881
    // handle "_.where" style callback shorthands                                                                      // 2882
    if (props.length == 1 && a === a && !isObject(a)) {                                                                // 2883
      // fast path the common case of providing an object with a single                                                // 2884
      // property containing a primitive value                                                                         // 2885
      return function(object) {                                                                                        // 2886
        var b = object[key];                                                                                           // 2887
        return a === b && (a !== 0 || (1 / a == 1 / b));                                                               // 2888
      };                                                                                                               // 2889
    }                                                                                                                  // 2890
    return function(object) {                                                                                          // 2891
      var length = props.length,                                                                                       // 2892
          result = false;                                                                                              // 2893
                                                                                                                       // 2894
      while (length--) {                                                                                               // 2895
        if (!(result = baseIsEqual(object[props[length]], func[props[length]], null, true))) {                         // 2896
          break;                                                                                                       // 2897
        }                                                                                                              // 2898
      }                                                                                                                // 2899
      return result;                                                                                                   // 2900
    };                                                                                                                 // 2901
  }                                                                                                                    // 2902
                                                                                                                       // 2903
  /**                                                                                                                  // 2904
   * Converts the characters `&`, `<`, `>`, `"`, and `'` in `string` to their                                          // 2905
   * corresponding HTML entities.                                                                                      // 2906
   *                                                                                                                   // 2907
   * @static                                                                                                           // 2908
   * @memberOf _                                                                                                       // 2909
   * @category Utilities                                                                                               // 2910
   * @param {string} string The string to escape.                                                                      // 2911
   * @returns {string} Returns the escaped string.                                                                     // 2912
   * @example                                                                                                          // 2913
   *                                                                                                                   // 2914
   * _.escape('Fred, Wilma, & Pebbles');                                                                               // 2915
   * // => 'Fred, Wilma, &amp; Pebbles'                                                                                // 2916
   */                                                                                                                  // 2917
  function escape(string) {                                                                                            // 2918
    return string == null ? '' : String(string).replace(reUnescapedHtml, escapeHtmlChar);                              // 2919
  }                                                                                                                    // 2920
                                                                                                                       // 2921
  /**                                                                                                                  // 2922
   * This method returns the first argument provided to it.                                                            // 2923
   *                                                                                                                   // 2924
   * @static                                                                                                           // 2925
   * @memberOf _                                                                                                       // 2926
   * @category Utilities                                                                                               // 2927
   * @param {*} value Any value.                                                                                       // 2928
   * @returns {*} Returns `value`.                                                                                     // 2929
   * @example                                                                                                          // 2930
   *                                                                                                                   // 2931
   * var object = { 'name': 'fred' };                                                                                  // 2932
   * _.identity(object) === object;                                                                                    // 2933
   * // => true                                                                                                        // 2934
   */                                                                                                                  // 2935
  function identity(value) {                                                                                           // 2936
    return value;                                                                                                      // 2937
  }                                                                                                                    // 2938
                                                                                                                       // 2939
  /**                                                                                                                  // 2940
   * A no-operation function.                                                                                          // 2941
   *                                                                                                                   // 2942
   * @static                                                                                                           // 2943
   * @memberOf _                                                                                                       // 2944
   * @category Utilities                                                                                               // 2945
   * @example                                                                                                          // 2946
   *                                                                                                                   // 2947
   * var object = { 'name': 'fred' };                                                                                  // 2948
   * _.noop(object) === undefined;                                                                                     // 2949
   * // => true                                                                                                        // 2950
   */                                                                                                                  // 2951
  function noop() {                                                                                                    // 2952
    // no operation performed                                                                                          // 2953
  }                                                                                                                    // 2954
                                                                                                                       // 2955
  /**                                                                                                                  // 2956
   * Creates a "_.pluck" style function, which returns the `key` value of a                                            // 2957
   * given object.                                                                                                     // 2958
   *                                                                                                                   // 2959
   * @static                                                                                                           // 2960
   * @memberOf _                                                                                                       // 2961
   * @category Utilities                                                                                               // 2962
   * @param {string} key The name of the property to retrieve.                                                         // 2963
   * @returns {Function} Returns the new function.                                                                     // 2964
   * @example                                                                                                          // 2965
   *                                                                                                                   // 2966
   * var characters = [                                                                                                // 2967
   *   { 'name': 'fred',   'age': 40 },                                                                                // 2968
   *   { 'name': 'barney', 'age': 36 }                                                                                 // 2969
   * ];                                                                                                                // 2970
   *                                                                                                                   // 2971
   * var getName = _.property('name');                                                                                 // 2972
   *                                                                                                                   // 2973
   * _.map(characters, getName);                                                                                       // 2974
   * // => ['barney', 'fred']                                                                                          // 2975
   *                                                                                                                   // 2976
   * _.sortBy(characters, getName);                                                                                    // 2977
   * // => [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred',   'age': 40 }]                                          // 2978
   */                                                                                                                  // 2979
  function property(key) {                                                                                             // 2980
    return function(object) {                                                                                          // 2981
      return object[key];                                                                                              // 2982
    };                                                                                                                 // 2983
  }                                                                                                                    // 2984
                                                                                                                       // 2985
  /**                                                                                                                  // 2986
   * A micro-templating method that handles arbitrary delimiters, preserves                                            // 2987
   * whitespace, and correctly escapes quotes within interpolated code.                                                // 2988
   *                                                                                                                   // 2989
   * Note: In the development build, `_.template` utilizes sourceURLs for easier                                       // 2990
   * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl                    // 2991
   *                                                                                                                   // 2992
   * For more information on precompiling templates see:                                                               // 2993
   * http://lodash.com/custom-builds                                                                                   // 2994
   *                                                                                                                   // 2995
   * For more information on Chrome extension sandboxes see:                                                           // 2996
   * http://developer.chrome.com/stable/extensions/sandboxingEval.html                                                 // 2997
   *                                                                                                                   // 2998
   * @static                                                                                                           // 2999
   * @memberOf _                                                                                                       // 3000
   * @category Utilities                                                                                               // 3001
   * @param {string} text The template text.                                                                           // 3002
   * @param {Object} data The data object used to populate the text.                                                   // 3003
   * @param {Object} [options] The options object.                                                                     // 3004
   * @param {RegExp} [options.escape] The "escape" delimiter.                                                          // 3005
   * @param {RegExp} [options.evaluate] The "evaluate" delimiter.                                                      // 3006
   * @param {Object} [options.imports] An object to import into the template as local variables.                       // 3007
   * @param {RegExp} [options.interpolate] The "interpolate" delimiter.                                                // 3008
   * @param {string} [sourceURL] The sourceURL of the template's compiled source.                                      // 3009
   * @param {string} [variable] The data object variable name.                                                         // 3010
   * @returns {Function|string} Returns a compiled function when no `data` object                                      // 3011
   *  is given, else it returns the interpolated text.                                                                 // 3012
   * @example                                                                                                          // 3013
   *                                                                                                                   // 3014
   * // using the "interpolate" delimiter to create a compiled template                                                // 3015
   * var compiled = _.template('hello <%= name %>');                                                                   // 3016
   * compiled({ 'name': 'fred' });                                                                                     // 3017
   * // => 'hello fred'                                                                                                // 3018
   *                                                                                                                   // 3019
   * // using the "escape" delimiter to escape HTML in data property values                                            // 3020
   * _.template('<b><%- value %></b>', { 'value': '<script>' });                                                       // 3021
   * // => '<b>&lt;script&gt;</b>'                                                                                     // 3022
   *                                                                                                                   // 3023
   * // using the "evaluate" delimiter to generate HTML                                                                // 3024
   * var list = '<% _.forEach(people, function(name) { %><li><%- name %></li><% }); %>';                               // 3025
   * _.template(list, { 'people': ['fred', 'barney'] });                                                               // 3026
   * // => '<li>fred</li><li>barney</li>'                                                                              // 3027
   *                                                                                                                   // 3028
   * // using the ES6 delimiter as an alternative to the default "interpolate" delimiter                               // 3029
   * _.template('hello ${ name }', { 'name': 'pebbles' });                                                             // 3030
   * // => 'hello pebbles'                                                                                             // 3031
   *                                                                                                                   // 3032
   * // using the internal `print` function in "evaluate" delimiters                                                   // 3033
   * _.template('<% print("hello " + name); %>!', { 'name': 'barney' });                                               // 3034
   * // => 'hello barney!'                                                                                             // 3035
   *                                                                                                                   // 3036
   * // using a custom template delimiters                                                                             // 3037
   * _.templateSettings = {                                                                                            // 3038
   *   'interpolate': /{{([\s\S]+?)}}/g                                                                                // 3039
   * };                                                                                                                // 3040
   *                                                                                                                   // 3041
   * _.template('hello {{ name }}!', { 'name': 'mustache' });                                                          // 3042
   * // => 'hello mustache!'                                                                                           // 3043
   *                                                                                                                   // 3044
   * // using the `imports` option to import jQuery                                                                    // 3045
   * var list = '<% jq.each(people, function(name) { %><li><%- name %></li><% }); %>';                                 // 3046
   * _.template(list, { 'people': ['fred', 'barney'] }, { 'imports': { 'jq': jQuery } });                              // 3047
   * // => '<li>fred</li><li>barney</li>'                                                                              // 3048
   *                                                                                                                   // 3049
   * // using the `sourceURL` option to specify a custom sourceURL for the template                                    // 3050
   * var compiled = _.template('hello <%= name %>', null, { 'sourceURL': '/basic/greeting.jst' });                     // 3051
   * compiled(data);                                                                                                   // 3052
   * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector             // 3053
   *                                                                                                                   // 3054
   * // using the `variable` option to ensure a with-statement isn't used in the compiled template                     // 3055
   * var compiled = _.template('hi <%= data.name %>!', null, { 'variable': 'data' });                                  // 3056
   * compiled.source;                                                                                                  // 3057
   * // => function(data) {                                                                                            // 3058
   *   var __t, __p = '', __e = _.escape;                                                                              // 3059
   *   __p += 'hi ' + ((__t = ( data.name )) == null ? '' : __t) + '!';                                                // 3060
   *   return __p;                                                                                                     // 3061
   * }                                                                                                                 // 3062
   *                                                                                                                   // 3063
   * // using the `source` property to inline compiled templates for meaningful                                        // 3064
   * // line numbers in error messages and a stack trace                                                               // 3065
   * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
   *   var JST = {\
   *     "main": ' + _.template(mainText).source + '\
   *   };\
   * ');                                                                                                               // 3070
   */                                                                                                                  // 3071
  function template(text, data, options) {                                                                             // 3072
    // based on John Resig's `tmpl` implementation                                                                     // 3073
    // http://ejohn.org/blog/javascript-micro-templating/                                                              // 3074
    // and Laura Doktorova's doT.js                                                                                    // 3075
    // https://github.com/olado/doT                                                                                    // 3076
    var settings = lodash.templateSettings;                                                                            // 3077
    text = String(text || '');                                                                                         // 3078
                                                                                                                       // 3079
    // avoid missing dependencies when `iteratorTemplate` is not defined                                               // 3080
    options = defaults({}, options, settings);                                                                         // 3081
                                                                                                                       // 3082
    var imports = defaults({}, options.imports, settings.imports),                                                     // 3083
        importsKeys = keys(imports),                                                                                   // 3084
        importsValues = values(imports);                                                                               // 3085
                                                                                                                       // 3086
    var isEvaluating,                                                                                                  // 3087
        index = 0,                                                                                                     // 3088
        interpolate = options.interpolate || reNoMatch,                                                                // 3089
        source = "__p += '";                                                                                           // 3090
                                                                                                                       // 3091
    // compile the regexp to match each delimiter                                                                      // 3092
    var reDelimiters = RegExp(                                                                                         // 3093
      (options.escape || reNoMatch).source + '|' +                                                                     // 3094
      interpolate.source + '|' +                                                                                       // 3095
      (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +                                        // 3096
      (options.evaluate || reNoMatch).source + '|$'                                                                    // 3097
    , 'g');                                                                                                            // 3098
                                                                                                                       // 3099
    text.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
      interpolateValue || (interpolateValue = esTemplateValue);                                                        // 3101
                                                                                                                       // 3102
      // escape characters that cannot be included in string literals                                                  // 3103
      source += text.slice(index, offset).replace(reUnescapedString, escapeStringChar);                                // 3104
                                                                                                                       // 3105
      // replace delimiters with snippets                                                                              // 3106
      if (escapeValue) {                                                                                               // 3107
        source += "' +\n__e(" + escapeValue + ") +\n'";                                                                // 3108
      }                                                                                                                // 3109
      if (evaluateValue) {                                                                                             // 3110
        isEvaluating = true;                                                                                           // 3111
        source += "';\n" + evaluateValue + ";\n__p += '";                                                              // 3112
      }                                                                                                                // 3113
      if (interpolateValue) {                                                                                          // 3114
        source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";                                 // 3115
      }                                                                                                                // 3116
      index = offset + match.length;                                                                                   // 3117
                                                                                                                       // 3118
      // the JS engine embedded in Adobe products requires returning the `match`                                       // 3119
      // string in order to produce the correct `offset` value                                                         // 3120
      return match;                                                                                                    // 3121
    });                                                                                                                // 3122
                                                                                                                       // 3123
    source += "';\n";                                                                                                  // 3124
                                                                                                                       // 3125
    // if `variable` is not specified, wrap a with-statement around the generated                                      // 3126
    // code to add the data object to the top of the scope chain                                                       // 3127
    var variable = options.variable,                                                                                   // 3128
        hasVariable = variable;                                                                                        // 3129
                                                                                                                       // 3130
    if (!hasVariable) {                                                                                                // 3131
      variable = 'obj';                                                                                                // 3132
      source = 'with (' + variable + ') {\n' + source + '\n}\n';                                                       // 3133
    }                                                                                                                  // 3134
    // cleanup code by stripping empty strings                                                                         // 3135
    source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)                                        // 3136
      .replace(reEmptyStringMiddle, '$1')                                                                              // 3137
      .replace(reEmptyStringTrailing, '$1;');                                                                          // 3138
                                                                                                                       // 3139
    // frame code as the function body                                                                                 // 3140
    source = 'function(' + variable + ') {\n' +                                                                        // 3141
      (hasVariable ? '' : variable + ' || (' + variable + ' = {});\n') +                                               // 3142
      "var __t, __p = '', __e = _.escape" +                                                                            // 3143
      (isEvaluating                                                                                                    // 3144
        ? ', __j = Array.prototype.join;\n' +                                                                          // 3145
          "function print() { __p += __j.call(arguments, '') }\n"                                                      // 3146
        : ';\n'                                                                                                        // 3147
      ) +                                                                                                              // 3148
      source +                                                                                                         // 3149
      'return __p\n}';                                                                                                 // 3150
                                                                                                                       // 3151
    // Use a sourceURL for easier debugging.                                                                           // 3152
    // http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl                                 // 3153
    var sourceURL = '\n/*\n//# sourceURL=' + (options.sourceURL || '/lodash/template/source[' + (templateCounter++) + ']') + '\n*/';
                                                                                                                       // 3155
    try {                                                                                                              // 3156
      var result = Function(importsKeys, 'return ' + source + sourceURL).apply(undefined, importsValues);              // 3157
    } catch(e) {                                                                                                       // 3158
      e.source = source;                                                                                               // 3159
      throw e;                                                                                                         // 3160
    }                                                                                                                  // 3161
    if (data) {                                                                                                        // 3162
      return result(data);                                                                                             // 3163
    }                                                                                                                  // 3164
    // provide the compiled function's source by its `toString` method, in                                             // 3165
    // supported environments, or the `source` property as a convenience for                                           // 3166
    // inlining compiled templates during the build process                                                            // 3167
    result.source = source;                                                                                            // 3168
    return result;                                                                                                     // 3169
  }                                                                                                                    // 3170
                                                                                                                       // 3171
  /*--------------------------------------------------------------------------*/                                       // 3172
                                                                                                                       // 3173
  lodash.assign = assign;                                                                                              // 3174
  lodash.bind = bind;                                                                                                  // 3175
  lodash.createCallback = createCallback;                                                                              // 3176
  lodash.defaults = defaults;                                                                                          // 3177
  lodash.filter = filter;                                                                                              // 3178
  lodash.forEach = forEach;                                                                                            // 3179
  lodash.forIn = forIn;                                                                                                // 3180
  lodash.forOwn = forOwn;                                                                                              // 3181
  lodash.keys = keys;                                                                                                  // 3182
  lodash.property = property;                                                                                          // 3183
  lodash.reject = reject;                                                                                              // 3184
  lodash.values = values;                                                                                              // 3185
                                                                                                                       // 3186
  lodash.each = forEach;                                                                                               // 3187
  lodash.extend = assign;                                                                                              // 3188
  lodash.select = filter;                                                                                              // 3189
                                                                                                                       // 3190
  /*--------------------------------------------------------------------------*/                                       // 3191
                                                                                                                       // 3192
  // add functions that return unwrapped values when chaining                                                          // 3193
  lodash.clone = clone;                                                                                                // 3194
  lodash.cloneDeep = cloneDeep;                                                                                        // 3195
  lodash.escape = escape;                                                                                              // 3196
  lodash.find = find;                                                                                                  // 3197
  lodash.identity = identity;                                                                                          // 3198
  lodash.isArguments = isArguments;                                                                                    // 3199
  lodash.isArray = isArray;                                                                                            // 3200
  lodash.isFunction = isFunction;                                                                                      // 3201
  lodash.isObject = isObject;                                                                                          // 3202
  lodash.isString = isString;                                                                                          // 3203
  lodash.noop = noop;                                                                                                  // 3204
  lodash.template = template;                                                                                          // 3205
                                                                                                                       // 3206
  lodash.detect = find;                                                                                                // 3207
  lodash.findWhere = find;                                                                                             // 3208
                                                                                                                       // 3209
  /*--------------------------------------------------------------------------*/                                       // 3210
                                                                                                                       // 3211
  /**                                                                                                                  // 3212
   * The semantic version number.                                                                                      // 3213
   *                                                                                                                   // 3214
   * @static                                                                                                           // 3215
   * @memberOf _                                                                                                       // 3216
   * @type string                                                                                                      // 3217
   */                                                                                                                  // 3218
  lodash.VERSION = '2.4.1';                                                                                            // 3219
                                                                                                                       // 3220
  /*--------------------------------------------------------------------------*/                                       // 3221
                                                                                                                       // 3222
  if (freeExports && freeModule) {                                                                                     // 3223
    // in Node.js or RingoJS                                                                                           // 3224
    if (moduleExports) {                                                                                               // 3225
      (freeModule.exports = lodash)._ = lodash;                                                                        // 3226
    }                                                                                                                  // 3227
    // in Narwhal or Rhino -require                                                                                    // 3228
    else {                                                                                                             // 3229
      freeExports._ = lodash;                                                                                          // 3230
    }                                                                                                                  // 3231
  }                                                                                                                    // 3232
                                                                                                                       // 3233
}.call(this));                                                                                                         // 3234
                                                                                                                       // 3235
});                                                                                                                    // 3236
require.register("side-comments/js/helpers/mobile-check.js", function(exports, require, module){                       // 3237
module.exports = function() {                                                                                          // 3238
	var check = false;                                                                                                    // 3239
	(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
	return check;                                                                                                         // 3241
}                                                                                                                      // 3242
});                                                                                                                    // 3243
                                                                                                                       // 3244
require.register("side-comments/templates/section.html", function(exports, require, module){                           // 3245
module.exports = '<div class="side-comment <%= sectionClasses %>">\n  <a href="#" class="marker">\n    <span><%= comments.length %></span>\n  </a>\n  \n  <div class="comments-wrapper">\n    <ul class="comments">\n      <% _.each(comments, function( comment ){ %>\n        <%= _.template(commentTemplate, { comment: comment, currentUser: currentUser }) %>\n      <% }) %>\n    </ul>\n    \n    <a href="#" class="add-comment">Leave a comment</a>\n    \n    <% if (currentUser){ %>\n      <div class="comment-form">\n        <div class="author-avatar">\n          <img src="<%= currentUser.avatarUrl %>">\n        </div>\n        <p class="author-name">\n          <%= currentUser.name %>\n        </p>\n        <div class="comment-box" contenteditable="true" data-placeholder-content="Leave a comment..."></div>\n        <div class="actions">\n          <a href="#" class="action-link post">Post</a>\n          <a href="#" class="action-link cancel">Cancel</a>\n        </div>\n      </div>\n    <% } %>\n  </div>\n</div>';
});                                                                                                                    // 3247
require.register("side-comments/templates/comment.html", function(exports, require, module){                           // 3248
module.exports = '<li data-comment-id="<%= comment.id %>">\n  <div class="author-avatar">\n    <img src="<%= comment.authorAvatarUrl %>">\n  </div>\n  <p class="author-name">\n    <%= comment.authorName %>\n  </p>\n  <p class="comment">\n    <%= comment.comment %>\n  </p>\n  <% if (currentUser && comment.authorId === currentUser.id){ %>\n  <a href="#" class="action-link delete">Delete</a>\n  <% } %>\n</li>';
});                                                                                                                    // 3250
require.alias("component-emitter/index.js", "side-comments/deps/emitter/index.js");                                    // 3251
require.alias("component-emitter/index.js", "emitter/index.js");                                                       // 3252
                                                                                                                       // 3253
require.alias("side-comments/js/main.js", "side-comments/index.js");                                                   // 3254
                                                                                                                       // 3255
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/medium-editor/dist/js/medium-editor.js                      //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*global self, document, DOMException */                                                                               // 1
                                                                                                                       // 2
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */                                    // 3
                                                                                                                       // 4
// Full polyfill for browsers with no classList support                                                                // 5
if (!("classList" in document.createElement("_"))) {                                                                   // 6
  (function (view) {                                                                                                   // 7
                                                                                                                       // 8
  "use strict";                                                                                                        // 9
                                                                                                                       // 10
  if (!('Element' in view)) return;                                                                                    // 11
                                                                                                                       // 12
  var                                                                                                                  // 13
      classListProp = "classList"                                                                                      // 14
    , protoProp = "prototype"                                                                                          // 15
    , elemCtrProto = view.Element[protoProp]                                                                           // 16
    , objCtr = Object                                                                                                  // 17
    , strTrim = String[protoProp].trim || function () {                                                                // 18
      return this.replace(/^\s+|\s+$/g, "");                                                                           // 19
    }                                                                                                                  // 20
    , arrIndexOf = Array[protoProp].indexOf || function (item) {                                                       // 21
      var                                                                                                              // 22
          i = 0                                                                                                        // 23
        , len = this.length                                                                                            // 24
      ;                                                                                                                // 25
      for (; i < len; i++) {                                                                                           // 26
        if (i in this && this[i] === item) {                                                                           // 27
          return i;                                                                                                    // 28
        }                                                                                                              // 29
      }                                                                                                                // 30
      return -1;                                                                                                       // 31
    }                                                                                                                  // 32
    // Vendors: please allow content code to instantiate DOMExceptions                                                 // 33
    , DOMEx = function (type, message) {                                                                               // 34
      this.name = type;                                                                                                // 35
      this.code = DOMException[type];                                                                                  // 36
      this.message = message;                                                                                          // 37
    }                                                                                                                  // 38
    , checkTokenAndGetIndex = function (classList, token) {                                                            // 39
      if (token === "") {                                                                                              // 40
        throw new DOMEx(                                                                                               // 41
            "SYNTAX_ERR"                                                                                               // 42
          , "An invalid or illegal string was specified"                                                               // 43
        );                                                                                                             // 44
      }                                                                                                                // 45
      if (/\s/.test(token)) {                                                                                          // 46
        throw new DOMEx(                                                                                               // 47
            "INVALID_CHARACTER_ERR"                                                                                    // 48
          , "String contains an invalid character"                                                                     // 49
        );                                                                                                             // 50
      }                                                                                                                // 51
      return arrIndexOf.call(classList, token);                                                                        // 52
    }                                                                                                                  // 53
    , ClassList = function (elem) {                                                                                    // 54
      var                                                                                                              // 55
          trimmedClasses = strTrim.call(elem.getAttribute("class") || "")                                              // 56
        , classes = trimmedClasses ? trimmedClasses.split(/\s+/) : []                                                  // 57
        , i = 0                                                                                                        // 58
        , len = classes.length                                                                                         // 59
      ;                                                                                                                // 60
      for (; i < len; i++) {                                                                                           // 61
        this.push(classes[i]);                                                                                         // 62
      }                                                                                                                // 63
      this._updateClassName = function () {                                                                            // 64
        elem.setAttribute("class", this.toString());                                                                   // 65
      };                                                                                                               // 66
    }                                                                                                                  // 67
    , classListProto = ClassList[protoProp] = []                                                                       // 68
    , classListGetter = function () {                                                                                  // 69
      return new ClassList(this);                                                                                      // 70
    }                                                                                                                  // 71
  ;                                                                                                                    // 72
  // Most DOMException implementations don't allow calling DOMException's toString()                                   // 73
  // on non-DOMExceptions. Error's toString() is sufficient here.                                                      // 74
  DOMEx[protoProp] = Error[protoProp];                                                                                 // 75
  classListProto.item = function (i) {                                                                                 // 76
    return this[i] || null;                                                                                            // 77
  };                                                                                                                   // 78
  classListProto.contains = function (token) {                                                                         // 79
    token += "";                                                                                                       // 80
    return checkTokenAndGetIndex(this, token) !== -1;                                                                  // 81
  };                                                                                                                   // 82
  classListProto.add = function () {                                                                                   // 83
    var                                                                                                                // 84
        tokens = arguments                                                                                             // 85
      , i = 0                                                                                                          // 86
      , l = tokens.length                                                                                              // 87
      , token                                                                                                          // 88
      , updated = false                                                                                                // 89
    ;                                                                                                                  // 90
    do {                                                                                                               // 91
      token = tokens[i] + "";                                                                                          // 92
      if (checkTokenAndGetIndex(this, token) === -1) {                                                                 // 93
        this.push(token);                                                                                              // 94
        updated = true;                                                                                                // 95
      }                                                                                                                // 96
    }                                                                                                                  // 97
    while (++i < l);                                                                                                   // 98
                                                                                                                       // 99
    if (updated) {                                                                                                     // 100
      this._updateClassName();                                                                                         // 101
    }                                                                                                                  // 102
  };                                                                                                                   // 103
  classListProto.remove = function () {                                                                                // 104
    var                                                                                                                // 105
        tokens = arguments                                                                                             // 106
      , i = 0                                                                                                          // 107
      , l = tokens.length                                                                                              // 108
      , token                                                                                                          // 109
      , updated = false                                                                                                // 110
      , index                                                                                                          // 111
    ;                                                                                                                  // 112
    do {                                                                                                               // 113
      token = tokens[i] + "";                                                                                          // 114
      index = checkTokenAndGetIndex(this, token);                                                                      // 115
      while (index !== -1) {                                                                                           // 116
        this.splice(index, 1);                                                                                         // 117
        updated = true;                                                                                                // 118
        index = checkTokenAndGetIndex(this, token);                                                                    // 119
      }                                                                                                                // 120
    }                                                                                                                  // 121
    while (++i < l);                                                                                                   // 122
                                                                                                                       // 123
    if (updated) {                                                                                                     // 124
      this._updateClassName();                                                                                         // 125
    }                                                                                                                  // 126
  };                                                                                                                   // 127
  classListProto.toggle = function (token, force) {                                                                    // 128
    token += "";                                                                                                       // 129
                                                                                                                       // 130
    var                                                                                                                // 131
        result = this.contains(token)                                                                                  // 132
      , method = result ?                                                                                              // 133
        force !== true && "remove"                                                                                     // 134
      :                                                                                                                // 135
        force !== false && "add"                                                                                       // 136
    ;                                                                                                                  // 137
                                                                                                                       // 138
    if (method) {                                                                                                      // 139
      this[method](token);                                                                                             // 140
    }                                                                                                                  // 141
                                                                                                                       // 142
    if (force === true || force === false) {                                                                           // 143
      return force;                                                                                                    // 144
    } else {                                                                                                           // 145
      return !result;                                                                                                  // 146
    }                                                                                                                  // 147
  };                                                                                                                   // 148
  classListProto.toString = function () {                                                                              // 149
    return this.join(" ");                                                                                             // 150
  };                                                                                                                   // 151
                                                                                                                       // 152
  if (objCtr.defineProperty) {                                                                                         // 153
    var classListPropDesc = {                                                                                          // 154
        get: classListGetter                                                                                           // 155
      , enumerable: true                                                                                               // 156
      , configurable: true                                                                                             // 157
    };                                                                                                                 // 158
    try {                                                                                                              // 159
      objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);                                           // 160
    } catch (ex) { // IE 8 doesn't support enumerable:true                                                             // 161
      if (ex.number === -0x7FF5EC54) {                                                                                 // 162
        classListPropDesc.enumerable = false;                                                                          // 163
        objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);                                         // 164
      }                                                                                                                // 165
    }                                                                                                                  // 166
  } else if (objCtr[protoProp].__defineGetter__) {                                                                     // 167
    elemCtrProto.__defineGetter__(classListProp, classListGetter);                                                     // 168
  }                                                                                                                    // 169
                                                                                                                       // 170
  }(self));                                                                                                            // 171
}                                                                                                                      // 172
                                                                                                                       // 173
/* Blob.js                                                                                                             // 174
 * A Blob implementation.                                                                                              // 175
 * 2014-07-24                                                                                                          // 176
 *                                                                                                                     // 177
 * By Eli Grey, http://eligrey.com                                                                                     // 178
 * By Devin Samarin, https://github.com/dsamarin                                                                       // 179
 * License: X11/MIT                                                                                                    // 180
 *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md                                                     // 181
 */                                                                                                                    // 182
                                                                                                                       // 183
/*global self, unescape */                                                                                             // 184
/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,                             // 185
  plusplus: true */                                                                                                    // 186
                                                                                                                       // 187
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */                                              // 188
                                                                                                                       // 189
(function (view) {                                                                                                     // 190
  "use strict";                                                                                                        // 191
                                                                                                                       // 192
  view.URL = view.URL || view.webkitURL;                                                                               // 193
                                                                                                                       // 194
  if (view.Blob && view.URL) {                                                                                         // 195
    try {                                                                                                              // 196
      new Blob;                                                                                                        // 197
      return;                                                                                                          // 198
    } catch (e) {}                                                                                                     // 199
  }                                                                                                                    // 200
                                                                                                                       // 201
  // Internally we use a BlobBuilder implementation to base Blob off of                                                // 202
  // in order to support older browsers that only have BlobBuilder                                                     // 203
  var BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (function(view) {             // 204
    var                                                                                                                // 205
        get_class = function(object) {                                                                                 // 206
        return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1];                                  // 207
      }                                                                                                                // 208
      , FakeBlobBuilder = function BlobBuilder() {                                                                     // 209
        this.data = [];                                                                                                // 210
      }                                                                                                                // 211
      , FakeBlob = function Blob(data, type, encoding) {                                                               // 212
        this.data = data;                                                                                              // 213
        this.size = data.length;                                                                                       // 214
        this.type = type;                                                                                              // 215
        this.encoding = encoding;                                                                                      // 216
      }                                                                                                                // 217
      , FBB_proto = FakeBlobBuilder.prototype                                                                          // 218
      , FB_proto = FakeBlob.prototype                                                                                  // 219
      , FileReaderSync = view.FileReaderSync                                                                           // 220
      , FileException = function(type) {                                                                               // 221
        this.code = this[this.name = type];                                                                            // 222
      }                                                                                                                // 223
      , file_ex_codes = (                                                                                              // 224
          "NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "                                        // 225
        + "NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR"                                                   // 226
      ).split(" ")                                                                                                     // 227
      , file_ex_code = file_ex_codes.length                                                                            // 228
      , real_URL = view.URL || view.webkitURL || view                                                                  // 229
      , real_create_object_URL = real_URL.createObjectURL                                                              // 230
      , real_revoke_object_URL = real_URL.revokeObjectURL                                                              // 231
      , URL = real_URL                                                                                                 // 232
      , btoa = view.btoa                                                                                               // 233
      , atob = view.atob                                                                                               // 234
                                                                                                                       // 235
      , ArrayBuffer = view.ArrayBuffer                                                                                 // 236
      , Uint8Array = view.Uint8Array                                                                                   // 237
                                                                                                                       // 238
      , origin = /^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/                                                              // 239
    ;                                                                                                                  // 240
    FakeBlob.fake = FB_proto.fake = true;                                                                              // 241
    while (file_ex_code--) {                                                                                           // 242
      FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + 1;                                         // 243
    }                                                                                                                  // 244
    // Polyfill URL                                                                                                    // 245
    if (!real_URL.createObjectURL) {                                                                                   // 246
      URL = view.URL = function(uri) {                                                                                 // 247
        var                                                                                                            // 248
            uri_info = document.createElementNS("http://www.w3.org/1999/xhtml", "a")                                   // 249
          , uri_origin                                                                                                 // 250
        ;                                                                                                              // 251
        uri_info.href = uri;                                                                                           // 252
        if (!("origin" in uri_info)) {                                                                                 // 253
          if (uri_info.protocol.toLowerCase() === "data:") {                                                           // 254
            uri_info.origin = null;                                                                                    // 255
          } else {                                                                                                     // 256
            uri_origin = uri.match(origin);                                                                            // 257
            uri_info.origin = uri_origin && uri_origin[1];                                                             // 258
          }                                                                                                            // 259
        }                                                                                                              // 260
        return uri_info;                                                                                               // 261
      };                                                                                                               // 262
    }                                                                                                                  // 263
    URL.createObjectURL = function(blob) {                                                                             // 264
      var                                                                                                              // 265
          type = blob.type                                                                                             // 266
        , data_URI_header                                                                                              // 267
      ;                                                                                                                // 268
      if (type === null) {                                                                                             // 269
        type = "application/octet-stream";                                                                             // 270
      }                                                                                                                // 271
      if (blob instanceof FakeBlob) {                                                                                  // 272
        data_URI_header = "data:" + type;                                                                              // 273
        if (blob.encoding === "base64") {                                                                              // 274
          return data_URI_header + ";base64," + blob.data;                                                             // 275
        } else if (blob.encoding === "URI") {                                                                          // 276
          return data_URI_header + "," + decodeURIComponent(blob.data);                                                // 277
        } if (btoa) {                                                                                                  // 278
          return data_URI_header + ";base64," + btoa(blob.data);                                                       // 279
        } else {                                                                                                       // 280
          return data_URI_header + "," + encodeURIComponent(blob.data);                                                // 281
        }                                                                                                              // 282
      } else if (real_create_object_URL) {                                                                             // 283
        return real_create_object_URL.call(real_URL, blob);                                                            // 284
      }                                                                                                                // 285
    };                                                                                                                 // 286
    URL.revokeObjectURL = function(object_URL) {                                                                       // 287
      if (object_URL.substring(0, 5) !== "data:" && real_revoke_object_URL) {                                          // 288
        real_revoke_object_URL.call(real_URL, object_URL);                                                             // 289
      }                                                                                                                // 290
    };                                                                                                                 // 291
    FBB_proto.append = function(data/*, endings*/) {                                                                   // 292
      var bb = this.data;                                                                                              // 293
      // decode data to a binary string                                                                                // 294
      if (Uint8Array && (data instanceof ArrayBuffer || data instanceof Uint8Array)) {                                 // 295
        var                                                                                                            // 296
            str = ""                                                                                                   // 297
          , buf = new Uint8Array(data)                                                                                 // 298
          , i = 0                                                                                                      // 299
          , buf_len = buf.length                                                                                       // 300
        ;                                                                                                              // 301
        for (; i < buf_len; i++) {                                                                                     // 302
          str += String.fromCharCode(buf[i]);                                                                          // 303
        }                                                                                                              // 304
        bb.push(str);                                                                                                  // 305
      } else if (get_class(data) === "Blob" || get_class(data) === "File") {                                           // 306
        if (FileReaderSync) {                                                                                          // 307
          var fr = new FileReaderSync;                                                                                 // 308
          bb.push(fr.readAsBinaryString(data));                                                                        // 309
        } else {                                                                                                       // 310
          // async FileReader won't work as BlobBuilder is sync                                                        // 311
          throw new FileException("NOT_READABLE_ERR");                                                                 // 312
        }                                                                                                              // 313
      } else if (data instanceof FakeBlob) {                                                                           // 314
        if (data.encoding === "base64" && atob) {                                                                      // 315
          bb.push(atob(data.data));                                                                                    // 316
        } else if (data.encoding === "URI") {                                                                          // 317
          bb.push(decodeURIComponent(data.data));                                                                      // 318
        } else if (data.encoding === "raw") {                                                                          // 319
          bb.push(data.data);                                                                                          // 320
        }                                                                                                              // 321
      } else {                                                                                                         // 322
        if (typeof data !== "string") {                                                                                // 323
          data += ""; // convert unsupported types to strings                                                          // 324
        }                                                                                                              // 325
        // decode UTF-16 to binary string                                                                              // 326
        bb.push(unescape(encodeURIComponent(data)));                                                                   // 327
      }                                                                                                                // 328
    };                                                                                                                 // 329
    FBB_proto.getBlob = function(type) {                                                                               // 330
      if (!arguments.length) {                                                                                         // 331
        type = null;                                                                                                   // 332
      }                                                                                                                // 333
      return new FakeBlob(this.data.join(""), type, "raw");                                                            // 334
    };                                                                                                                 // 335
    FBB_proto.toString = function() {                                                                                  // 336
      return "[object BlobBuilder]";                                                                                   // 337
    };                                                                                                                 // 338
    FB_proto.slice = function(start, end, type) {                                                                      // 339
      var args = arguments.length;                                                                                     // 340
      if (args < 3) {                                                                                                  // 341
        type = null;                                                                                                   // 342
      }                                                                                                                // 343
      return new FakeBlob(                                                                                             // 344
          this.data.slice(start, args > 1 ? end : this.data.length)                                                    // 345
        , type                                                                                                         // 346
        , this.encoding                                                                                                // 347
      );                                                                                                               // 348
    };                                                                                                                 // 349
    FB_proto.toString = function() {                                                                                   // 350
      return "[object Blob]";                                                                                          // 351
    };                                                                                                                 // 352
    FB_proto.close = function() {                                                                                      // 353
      this.size = 0;                                                                                                   // 354
      delete this.data;                                                                                                // 355
    };                                                                                                                 // 356
    return FakeBlobBuilder;                                                                                            // 357
  }(view));                                                                                                            // 358
                                                                                                                       // 359
  view.Blob = function(blobParts, options) {                                                                           // 360
    var type = options ? (options.type || "") : "";                                                                    // 361
    var builder = new BlobBuilder();                                                                                   // 362
    if (blobParts) {                                                                                                   // 363
      for (var i = 0, len = blobParts.length; i < len; i++) {                                                          // 364
        if (Uint8Array && blobParts[i] instanceof Uint8Array) {                                                        // 365
          builder.append(blobParts[i].buffer);                                                                         // 366
        }                                                                                                              // 367
        else {                                                                                                         // 368
          builder.append(blobParts[i]);                                                                                // 369
        }                                                                                                              // 370
      }                                                                                                                // 371
    }                                                                                                                  // 372
    var blob = builder.getBlob(type);                                                                                  // 373
    if (!blob.slice && blob.webkitSlice) {                                                                             // 374
      blob.slice = blob.webkitSlice;                                                                                   // 375
    }                                                                                                                  // 376
    return blob;                                                                                                       // 377
  };                                                                                                                   // 378
                                                                                                                       // 379
  var getPrototypeOf = Object.getPrototypeOf || function(object) {                                                     // 380
    return object.__proto__;                                                                                           // 381
  };                                                                                                                   // 382
  view.Blob.prototype = getPrototypeOf(new view.Blob());                                                               // 383
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this.content || this));            // 384
                                                                                                                       // 385
(function (root, factory) {                                                                                            // 386
    'use strict';                                                                                                      // 387
    if (typeof module === 'object') {                                                                                  // 388
        module.exports = factory;                                                                                      // 389
    } else if (typeof define === 'function' && define.amd) {                                                           // 390
        define(function () {                                                                                           // 391
            return factory;                                                                                            // 392
        });                                                                                                            // 393
    } else {                                                                                                           // 394
        root.MediumEditor = factory;                                                                                   // 395
    }                                                                                                                  // 396
}(this, function () {                                                                                                  // 397
                                                                                                                       // 398
    'use strict';                                                                                                      // 399
                                                                                                                       // 400
function MediumEditor(elements, options) {                                                                             // 401
    'use strict';                                                                                                      // 402
    return this.init(elements, options);                                                                               // 403
}                                                                                                                      // 404
                                                                                                                       // 405
MediumEditor.extensions = {};                                                                                          // 406
/*jshint unused: true */                                                                                               // 407
(function (window) {                                                                                                   // 408
    'use strict';                                                                                                      // 409
                                                                                                                       // 410
    function copyInto(overwrite, dest) {                                                                               // 411
        var prop,                                                                                                      // 412
            sources = Array.prototype.slice.call(arguments, 2);                                                        // 413
        dest = dest || {};                                                                                             // 414
        for (var i = 0; i < sources.length; i++) {                                                                     // 415
            var source = sources[i];                                                                                   // 416
            if (source) {                                                                                              // 417
                for (prop in source) {                                                                                 // 418
                    if (source.hasOwnProperty(prop) &&                                                                 // 419
                        typeof source[prop] !== 'undefined' &&                                                         // 420
                        (overwrite || dest.hasOwnProperty(prop) === false)) {                                          // 421
                        dest[prop] = source[prop];                                                                     // 422
                    }                                                                                                  // 423
                }                                                                                                      // 424
            }                                                                                                          // 425
        }                                                                                                              // 426
        return dest;                                                                                                   // 427
    }                                                                                                                  // 428
                                                                                                                       // 429
    // https://developer.mozilla.org/en-US/docs/Web/API/Node/contains                                                  // 430
    // Some browsers (including phantom) don't return true for Node.contains(child)                                    // 431
    // if child is a text node.  Detect these cases here and use a fallback                                            // 432
    // for calls to Util.isDescendant()                                                                                // 433
    var nodeContainsWorksWithTextNodes = false;                                                                        // 434
    try {                                                                                                              // 435
        var testParent = document.createElement('div'),                                                                // 436
            testText = document.createTextNode(' ');                                                                   // 437
        testParent.appendChild(testText);                                                                              // 438
        nodeContainsWorksWithTextNodes = testParent.contains(testText);                                                // 439
    } catch (exc) {}                                                                                                   // 440
                                                                                                                       // 441
    var Util = {                                                                                                       // 442
                                                                                                                       // 443
        // http://stackoverflow.com/questions/17907445/how-to-detect-ie11#comment30165888_17907562                     // 444
        // by rg89                                                                                                     // 445
        isIE: ((navigator.appName === 'Microsoft Internet Explorer') || ((navigator.appName === 'Netscape') && (new RegExp('Trident/.*rv:([0-9]{1,}[.0-9]{0,})').exec(navigator.userAgent) !== null))),
                                                                                                                       // 447
        // http://stackoverflow.com/a/11752084/569101                                                                  // 448
        isMac: (window.navigator.platform.toUpperCase().indexOf('MAC') >= 0),                                          // 449
                                                                                                                       // 450
        // https://github.com/jashkenas/underscore                                                                     // 451
        keyCode: {                                                                                                     // 452
            BACKSPACE: 8,                                                                                              // 453
            TAB: 9,                                                                                                    // 454
            ENTER: 13,                                                                                                 // 455
            ESCAPE: 27,                                                                                                // 456
            SPACE: 32,                                                                                                 // 457
            DELETE: 46,                                                                                                // 458
            K: 75, // K keycode, and not k                                                                             // 459
            M: 77                                                                                                      // 460
        },                                                                                                             // 461
                                                                                                                       // 462
        /**                                                                                                            // 463
         * Returns true if it's metaKey on Mac, or ctrlKey on non-Mac.                                                 // 464
         * See #591                                                                                                    // 465
         */                                                                                                            // 466
        isMetaCtrlKey: function (event) {                                                                              // 467
            if ((Util.isMac && event.metaKey) || (!Util.isMac && event.ctrlKey)) {                                     // 468
                return true;                                                                                           // 469
            }                                                                                                          // 470
                                                                                                                       // 471
            return false;                                                                                              // 472
        },                                                                                                             // 473
                                                                                                                       // 474
        /**                                                                                                            // 475
         * Returns true if the key associated to the event is inside keys array                                        // 476
         *                                                                                                             // 477
         * @see : https://github.com/jquery/jquery/blob/0705be475092aede1eddae01319ec931fb9c65fc/src/event.js#L473-L484
         * @see : http://stackoverflow.com/q/4471582/569101                                                            // 479
         */                                                                                                            // 480
        isKey: function (event, keys) {                                                                                // 481
            var keyCode = Util.getKeyCode(event);                                                                      // 482
                                                                                                                       // 483
            // it's not an array let's just compare strings!                                                           // 484
            if (false === Array.isArray(keys)) {                                                                       // 485
                return keyCode === keys;                                                                               // 486
            }                                                                                                          // 487
                                                                                                                       // 488
            if (-1 === keys.indexOf(keyCode)) {                                                                        // 489
                return false;                                                                                          // 490
            }                                                                                                          // 491
                                                                                                                       // 492
            return true;                                                                                               // 493
        },                                                                                                             // 494
                                                                                                                       // 495
        getKeyCode: function (event) {                                                                                 // 496
            var keyCode = event.which;                                                                                 // 497
                                                                                                                       // 498
            // getting the key code from event                                                                         // 499
            if (null === keyCode) {                                                                                    // 500
                keyCode = event.charCode !== null ? event.charCode : event.keyCode;                                    // 501
            }                                                                                                          // 502
                                                                                                                       // 503
            return keyCode;                                                                                            // 504
        },                                                                                                             // 505
                                                                                                                       // 506
        blockContainerElementNames: [                                                                                  // 507
            // elements our editor generates                                                                           // 508
            'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'li', 'ol',                            // 509
            // all other known block elements                                                                          // 510
            'address', 'article', 'aside', 'audio', 'canvas', 'dd', 'dl', 'dt', 'fieldset',                            // 511
            'figcaption', 'figure', 'footer', 'form', 'header', 'hgroup', 'main', 'nav',                               // 512
            'noscript', 'output', 'section', 'video',                                                                  // 513
            'table', 'thead', 'tbody', 'tfoot', 'tr', 'th', 'td'                                                       // 514
        ],                                                                                                             // 515
                                                                                                                       // 516
        emptyElementNames: ['br', 'col', 'colgroup', 'hr', 'img', 'input', 'source', 'wbr'],                           // 517
                                                                                                                       // 518
        extend: function extend(/* dest, source1, source2, ...*/) {                                                    // 519
            var args = [true].concat(Array.prototype.slice.call(arguments));                                           // 520
            return copyInto.apply(this, args);                                                                         // 521
        },                                                                                                             // 522
                                                                                                                       // 523
        defaults: function defaults(/*dest, source1, source2, ...*/) {                                                 // 524
            var args = [false].concat(Array.prototype.slice.call(arguments));                                          // 525
            return copyInto.apply(this, args);                                                                         // 526
        },                                                                                                             // 527
                                                                                                                       // 528
        /*                                                                                                             // 529
         * Create a link around the provided text nodes which must be adjacent to each other and all be                // 530
         * descendants of the same closest block container. If the preconditions are not met, unexpected               // 531
         * behavior will result.                                                                                       // 532
         */                                                                                                            // 533
        createLink: function (document, textNodes, href, target) {                                                     // 534
            var anchor = document.createElement('a');                                                                  // 535
            Util.moveTextRangeIntoElement(textNodes[0], textNodes[textNodes.length - 1], anchor);                      // 536
            anchor.setAttribute('href', href);                                                                         // 537
            if (target) {                                                                                              // 538
                anchor.setAttribute('target', target);                                                                 // 539
            }                                                                                                          // 540
            return anchor;                                                                                             // 541
        },                                                                                                             // 542
                                                                                                                       // 543
        /*                                                                                                             // 544
         * Given the provided match in the format {start: 1, end: 2} where start and end are indices into the          // 545
         * textContent of the provided element argument, modify the DOM inside element to ensure that the text         // 546
         * identified by the provided match can be returned as text nodes that contain exactly that text, without      // 547
         * any additional text at the beginning or end of the returned array of adjacent text nodes.                   // 548
         *                                                                                                             // 549
         * The only DOM manipulation performed by this function is splitting the text nodes, non-text nodes are        // 550
         * not affected in any way.                                                                                    // 551
         */                                                                                                            // 552
        findOrCreateMatchingTextNodes: function (document, element, match) {                                           // 553
            var treeWalker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false),                    // 554
                matchedNodes = [],                                                                                     // 555
                currentTextIndex = 0,                                                                                  // 556
                startReached = false,                                                                                  // 557
                currentNode = null,                                                                                    // 558
                newNode = null;                                                                                        // 559
                                                                                                                       // 560
            while ((currentNode = treeWalker.nextNode()) !== null) {                                                   // 561
                if (!startReached && match.start < (currentTextIndex + currentNode.nodeValue.length)) {                // 562
                    startReached = true;                                                                               // 563
                    newNode = Util.splitStartNodeIfNeeded(currentNode, match.start, currentTextIndex);                 // 564
                }                                                                                                      // 565
                if (startReached) {                                                                                    // 566
                    Util.splitEndNodeIfNeeded(currentNode, newNode, match.end, currentTextIndex);                      // 567
                }                                                                                                      // 568
                if (startReached && currentTextIndex === match.end) {                                                  // 569
                    break; // Found the node(s) corresponding to the link. Break out and move on to the next.          // 570
                } else if (startReached && currentTextIndex > (match.end + 1)) {                                       // 571
                    throw new Error('PerformLinking overshot the target!'); // should never happen...                  // 572
                }                                                                                                      // 573
                                                                                                                       // 574
                if (startReached) {                                                                                    // 575
                    matchedNodes.push(newNode || currentNode);                                                         // 576
                }                                                                                                      // 577
                                                                                                                       // 578
                currentTextIndex += currentNode.nodeValue.length;                                                      // 579
                if (newNode !== null) {                                                                                // 580
                    currentTextIndex += newNode.nodeValue.length;                                                      // 581
                    // Skip the newNode as we'll already have pushed it to the matches                                 // 582
                    treeWalker.nextNode();                                                                             // 583
                }                                                                                                      // 584
                newNode = null;                                                                                        // 585
            }                                                                                                          // 586
            return matchedNodes;                                                                                       // 587
        },                                                                                                             // 588
                                                                                                                       // 589
        /*                                                                                                             // 590
         * Given the provided text node and text coordinates, split the text node if needed to make it align           // 591
         * precisely with the coordinates.                                                                             // 592
         *                                                                                                             // 593
         * This function is intended to be called from Util.findOrCreateMatchingTextNodes.                             // 594
         */                                                                                                            // 595
        splitStartNodeIfNeeded: function (currentNode, matchStartIndex, currentTextIndex) {                            // 596
            if (matchStartIndex !== currentTextIndex) {                                                                // 597
                return currentNode.splitText(matchStartIndex - currentTextIndex);                                      // 598
            }                                                                                                          // 599
            return null;                                                                                               // 600
        },                                                                                                             // 601
                                                                                                                       // 602
        /*                                                                                                             // 603
         * Given the provided text node and text coordinates, split the text node if needed to make it align           // 604
         * precisely with the coordinates. The newNode argument should from the result of Util.splitStartNodeIfNeeded,
         * if that function has been called on the same currentNode.                                                   // 606
         *                                                                                                             // 607
         * This function is intended to be called from Util.findOrCreateMatchingTextNodes.                             // 608
         */                                                                                                            // 609
        splitEndNodeIfNeeded: function (currentNode, newNode, matchEndIndex, currentTextIndex) {                       // 610
            var textIndexOfEndOfFarthestNode,                                                                          // 611
                endSplitPoint;                                                                                         // 612
            textIndexOfEndOfFarthestNode = currentTextIndex + (newNode || currentNode).nodeValue.length +              // 613
                    (newNode ? currentNode.nodeValue.length : 0) -                                                     // 614
                    1;                                                                                                 // 615
            endSplitPoint = (newNode || currentNode).nodeValue.length -                                                // 616
                    (textIndexOfEndOfFarthestNode + 1 - matchEndIndex);                                                // 617
            if (textIndexOfEndOfFarthestNode >= matchEndIndex &&                                                       // 618
                    currentTextIndex !== textIndexOfEndOfFarthestNode &&                                               // 619
                    endSplitPoint !== 0) {                                                                             // 620
                (newNode || currentNode).splitText(endSplitPoint);                                                     // 621
            }                                                                                                          // 622
        },                                                                                                             // 623
                                                                                                                       // 624
        /*                                                                                                             // 625
        * Take an element, and break up all of its text content into unique pieces such that:                          // 626
         * 1) All text content of the elements are in separate blocks. No piece of text content should span            // 627
         *    span multiple blocks. This means no element return by this function should have                          // 628
         *    any blocks as children.                                                                                  // 629
         * 2) The union of the textcontent of all of the elements returned here covers all                             // 630
         *    of the text within the element.                                                                          // 631
         *                                                                                                             // 632
         *                                                                                                             // 633
         * EXAMPLE:                                                                                                    // 634
         * In the event that we have something like:                                                                   // 635
         *                                                                                                             // 636
         * <blockquote>                                                                                                // 637
         *   <p>Some Text</p>                                                                                          // 638
         *   <ol>                                                                                                      // 639
         *     <li>List Item 1</li>                                                                                    // 640
         *     <li>List Item 2</li>                                                                                    // 641
         *   </ol>                                                                                                     // 642
         * </blockquote>                                                                                               // 643
         *                                                                                                             // 644
         * This function would return these elements as an array:                                                      // 645
         *   [ <p>Some Text</p>, <li>List Item 1</li>, <li>List Item 2</li> ]                                          // 646
         *                                                                                                             // 647
         * Since the <blockquote> and <ol> elements contain blocks within them they are not returned.                  // 648
         * Since the <p> and <li>'s don't contain block elements and cover all the text content of the                 // 649
         * <blockquote> container, they are the elements returned.                                                     // 650
         */                                                                                                            // 651
        splitByBlockElements: function (element) {                                                                     // 652
            var toRet = [],                                                                                            // 653
                blockElementQuery = MediumEditor.util.blockContainerElementNames.join(',');                            // 654
                                                                                                                       // 655
            if (element.nodeType === 3 || element.querySelectorAll(blockElementQuery).length === 0) {                  // 656
                return [element];                                                                                      // 657
            }                                                                                                          // 658
                                                                                                                       // 659
            for (var i = 0; i < element.childNodes.length; i++) {                                                      // 660
                var child = element.childNodes[i];                                                                     // 661
                if (child.nodeType === 3) {                                                                            // 662
                    toRet.push(child);                                                                                 // 663
                } else {                                                                                               // 664
                    var blockElements = child.querySelectorAll(blockElementQuery);                                     // 665
                    if (blockElements.length === 0) {                                                                  // 666
                        toRet.push(child);                                                                             // 667
                    } else {                                                                                           // 668
                        toRet = toRet.concat(MediumEditor.util.splitByBlockElements(child));                           // 669
                    }                                                                                                  // 670
                }                                                                                                      // 671
            }                                                                                                          // 672
                                                                                                                       // 673
            return toRet;                                                                                              // 674
        },                                                                                                             // 675
                                                                                                                       // 676
        // Find the next node in the DOM tree that represents any text that is being                                   // 677
        // displayed directly next to the targetNode (passed as an argument)                                           // 678
        // Text that appears directly next to the current node can be:                                                 // 679
        //  - A sibling text node                                                                                      // 680
        //  - A descendant of a sibling element                                                                        // 681
        //  - A sibling text node of an ancestor                                                                       // 682
        //  - A descendant of a sibling element of an ancestor                                                         // 683
        findAdjacentTextNodeWithContent: function findAdjacentTextNodeWithContent(rootNode, targetNode, ownerDocument) {
            var pastTarget = false,                                                                                    // 685
                nextNode,                                                                                              // 686
                nodeIterator = ownerDocument.createNodeIterator(rootNode, NodeFilter.SHOW_TEXT, null, false);          // 687
                                                                                                                       // 688
            // Use a native NodeIterator to iterate over all the text nodes that are descendants                       // 689
            // of the rootNode.  Once past the targetNode, choose the first non-empty text node                        // 690
            nextNode = nodeIterator.nextNode();                                                                        // 691
            while (nextNode) {                                                                                         // 692
                if (nextNode === targetNode) {                                                                         // 693
                    pastTarget = true;                                                                                 // 694
                } else if (pastTarget) {                                                                               // 695
                    if (nextNode.nodeType === 3 && nextNode.nodeValue && nextNode.nodeValue.trim().length > 0) {       // 696
                        break;                                                                                         // 697
                    }                                                                                                  // 698
                }                                                                                                      // 699
                nextNode = nodeIterator.nextNode();                                                                    // 700
            }                                                                                                          // 701
                                                                                                                       // 702
            return nextNode;                                                                                           // 703
        },                                                                                                             // 704
                                                                                                                       // 705
        isDescendant: function isDescendant(parent, child, checkEquality) {                                            // 706
            if (!parent || !child) {                                                                                   // 707
                return false;                                                                                          // 708
            }                                                                                                          // 709
            if (parent === child) {                                                                                    // 710
                return !!checkEquality;                                                                                // 711
            }                                                                                                          // 712
            // If parent is not an element, it can't have any descendants                                              // 713
            if (parent.nodeType !== 1) {                                                                               // 714
                return false;                                                                                          // 715
            }                                                                                                          // 716
            if (nodeContainsWorksWithTextNodes || child.nodeType !== 3) {                                              // 717
                return parent.contains(child);                                                                         // 718
            }                                                                                                          // 719
            var node = child.parentNode;                                                                               // 720
            while (node !== null) {                                                                                    // 721
                if (node === parent) {                                                                                 // 722
                    return true;                                                                                       // 723
                }                                                                                                      // 724
                node = node.parentNode;                                                                                // 725
            }                                                                                                          // 726
            return false;                                                                                              // 727
        },                                                                                                             // 728
                                                                                                                       // 729
        // https://github.com/jashkenas/underscore                                                                     // 730
        isElement: function isElement(obj) {                                                                           // 731
            return !!(obj && obj.nodeType === 1);                                                                      // 732
        },                                                                                                             // 733
                                                                                                                       // 734
        // https://github.com/jashkenas/underscore                                                                     // 735
        throttle: function (func, wait) {                                                                              // 736
            var THROTTLE_INTERVAL = 50,                                                                                // 737
                context,                                                                                               // 738
                args,                                                                                                  // 739
                result,                                                                                                // 740
                timeout = null,                                                                                        // 741
                previous = 0,                                                                                          // 742
                later = function () {                                                                                  // 743
                    previous = Date.now();                                                                             // 744
                    timeout = null;                                                                                    // 745
                    result = func.apply(context, args);                                                                // 746
                    if (!timeout) {                                                                                    // 747
                        context = args = null;                                                                         // 748
                    }                                                                                                  // 749
                };                                                                                                     // 750
                                                                                                                       // 751
            if (!wait && wait !== 0) {                                                                                 // 752
                wait = THROTTLE_INTERVAL;                                                                              // 753
            }                                                                                                          // 754
                                                                                                                       // 755
            return function () {                                                                                       // 756
                var now = Date.now(),                                                                                  // 757
                    remaining = wait - (now - previous);                                                               // 758
                                                                                                                       // 759
                context = this;                                                                                        // 760
                args = arguments;                                                                                      // 761
                if (remaining <= 0 || remaining > wait) {                                                              // 762
                    if (timeout) {                                                                                     // 763
                        clearTimeout(timeout);                                                                         // 764
                        timeout = null;                                                                                // 765
                    }                                                                                                  // 766
                    previous = now;                                                                                    // 767
                    result = func.apply(context, args);                                                                // 768
                    if (!timeout) {                                                                                    // 769
                        context = args = null;                                                                         // 770
                    }                                                                                                  // 771
                } else if (!timeout) {                                                                                 // 772
                    timeout = setTimeout(later, remaining);                                                            // 773
                }                                                                                                      // 774
                return result;                                                                                         // 775
            };                                                                                                         // 776
        },                                                                                                             // 777
                                                                                                                       // 778
        traverseUp: function (current, testElementFunction) {                                                          // 779
            if (!current) {                                                                                            // 780
                return false;                                                                                          // 781
            }                                                                                                          // 782
                                                                                                                       // 783
            do {                                                                                                       // 784
                if (current.nodeType === 1) {                                                                          // 785
                    if (testElementFunction(current)) {                                                                // 786
                        return current;                                                                                // 787
                    }                                                                                                  // 788
                    // do not traverse upwards past the nearest containing editor                                      // 789
                    if (Util.isMediumEditorElement(current)) {                                                         // 790
                        return false;                                                                                  // 791
                    }                                                                                                  // 792
                }                                                                                                      // 793
                                                                                                                       // 794
                current = current.parentNode;                                                                          // 795
            } while (current);                                                                                         // 796
                                                                                                                       // 797
            return false;                                                                                              // 798
        },                                                                                                             // 799
                                                                                                                       // 800
        htmlEntities: function (str) {                                                                                 // 801
            // converts special characters (like <) into their escaped/encoded values (like &lt;).                     // 802
            // This allows you to show to display the string without the browser reading it as HTML.                   // 803
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        },                                                                                                             // 805
                                                                                                                       // 806
        // http://stackoverflow.com/questions/6690752/insert-html-at-caret-in-a-contenteditable-div                    // 807
        insertHTMLCommand: function (doc, html) {                                                                      // 808
            var selection, range, el, fragment, node, lastNode, toReplace;                                             // 809
                                                                                                                       // 810
            if (doc.queryCommandSupported('insertHTML')) {                                                             // 811
                try {                                                                                                  // 812
                    return doc.execCommand('insertHTML', false, html);                                                 // 813
                } catch (ignore) {}                                                                                    // 814
            }                                                                                                          // 815
                                                                                                                       // 816
            selection = doc.getSelection();                                                                            // 817
            if (selection.rangeCount) {                                                                                // 818
                range = selection.getRangeAt(0);                                                                       // 819
                toReplace = range.commonAncestorContainer;                                                             // 820
                                                                                                                       // 821
                // https://github.com/yabwe/medium-editor/issues/748                                                   // 822
                // If the selection is an empty editor element, create a temporary text node inside of the editor      // 823
                // and select it so that we don't delete the editor element                                            // 824
                if (Util.isMediumEditorElement(toReplace) && !toReplace.firstChild) {                                  // 825
                    range.selectNode(toReplace.appendChild(doc.createTextNode('')));                                   // 826
                } else if ((toReplace.nodeType === 3 && range.startOffset === 0 && range.endOffset === toReplace.nodeValue.length) ||
                        (toReplace.nodeType !== 3 && toReplace.innerHTML === range.toString())) {                      // 828
                    // Ensure range covers maximum amount of nodes as possible                                         // 829
                    // By moving up the DOM and selecting ancestors whose only child is the range                      // 830
                    while (!Util.isMediumEditorElement(toReplace) &&                                                   // 831
                            toReplace.parentNode &&                                                                    // 832
                            toReplace.parentNode.childNodes.length === 1 &&                                            // 833
                            !Util.isMediumEditorElement(toReplace.parentNode)) {                                       // 834
                        toReplace = toReplace.parentNode;                                                              // 835
                    }                                                                                                  // 836
                    range.selectNode(toReplace);                                                                       // 837
                }                                                                                                      // 838
                range.deleteContents();                                                                                // 839
                                                                                                                       // 840
                el = doc.createElement('div');                                                                         // 841
                el.innerHTML = html;                                                                                   // 842
                fragment = doc.createDocumentFragment();                                                               // 843
                while (el.firstChild) {                                                                                // 844
                    node = el.firstChild;                                                                              // 845
                    lastNode = fragment.appendChild(node);                                                             // 846
                }                                                                                                      // 847
                range.insertNode(fragment);                                                                            // 848
                                                                                                                       // 849
                // Preserve the selection:                                                                             // 850
                if (lastNode) {                                                                                        // 851
                    range = range.cloneRange();                                                                        // 852
                    range.setStartAfter(lastNode);                                                                     // 853
                    range.collapse(true);                                                                              // 854
                    selection.removeAllRanges();                                                                       // 855
                    selection.addRange(range);                                                                         // 856
                }                                                                                                      // 857
            }                                                                                                          // 858
        },                                                                                                             // 859
                                                                                                                       // 860
        execFormatBlock: function (doc, tagName) {                                                                     // 861
            // Get the top level block element that contains the selection                                             // 862
            var blockContainer = Util.getTopBlockContainer(MediumEditor.selection.getSelectionStart(doc));             // 863
                                                                                                                       // 864
            // Special handling for blockquote                                                                         // 865
            if (tagName === 'blockquote') {                                                                            // 866
                if (blockContainer) {                                                                                  // 867
                    var childNodes = Array.prototype.slice.call(blockContainer.childNodes);                            // 868
                    // Check if the blockquote has a block element as a child (nested blocks)                          // 869
                    if (childNodes.some(function (childNode) {                                                         // 870
                        return Util.isBlockContainer(childNode);                                                       // 871
                    })) {                                                                                              // 872
                        // FF handles blockquote differently on formatBlock                                            // 873
                        // allowing nesting, we need to use outdent                                                    // 874
                        // https://developer.mozilla.org/en-US/docs/Rich-Text_Editing_in_Mozilla                       // 875
                        return doc.execCommand('outdent', false, null);                                                // 876
                    }                                                                                                  // 877
                }                                                                                                      // 878
                                                                                                                       // 879
                // When IE blockquote needs to be called as indent                                                     // 880
                // http://stackoverflow.com/questions/1816223/rich-text-editor-with-blockquote-function/1821777#1821777
                if (Util.isIE) {                                                                                       // 882
                    return doc.execCommand('indent', false, tagName);                                                  // 883
                }                                                                                                      // 884
            }                                                                                                          // 885
                                                                                                                       // 886
            // If the blockContainer is already the element type being passed in                                       // 887
            // treat it as 'undo' formatting and just convert it to a <p>                                              // 888
            if (blockContainer && tagName === blockContainer.nodeName.toLowerCase()) {                                 // 889
                tagName = 'p';                                                                                         // 890
            }                                                                                                          // 891
                                                                                                                       // 892
            // When IE we need to add <> to heading elements                                                           // 893
            // http://stackoverflow.com/questions/10741831/execcommand-formatblock-headings-in-ie                      // 894
            if (Util.isIE) {                                                                                           // 895
                tagName = '<' + tagName + '>';                                                                         // 896
            }                                                                                                          // 897
            return doc.execCommand('formatBlock', false, tagName);                                                     // 898
        },                                                                                                             // 899
                                                                                                                       // 900
        /**                                                                                                            // 901
         * Set target to blank on the given el element                                                                 // 902
         *                                                                                                             // 903
         * TODO: not sure if this should be here                                                                       // 904
         *                                                                                                             // 905
         * When creating a link (using core -> createLink) the selection returned by Firefox will be the parent of the created link
         * instead of the created link itself (as it is for Chrome for example), so we retrieve all "a" children to grab the good one by
         * using `anchorUrl` to ensure that we are adding target="_blank" on the good one.                             // 908
         * This isn't a bulletproof solution anyway ..                                                                 // 909
         */                                                                                                            // 910
        setTargetBlank: function (el, anchorUrl) {                                                                     // 911
            var i, url = anchorUrl || false;                                                                           // 912
            if (el.nodeName.toLowerCase() === 'a') {                                                                   // 913
                el.target = '_blank';                                                                                  // 914
            } else {                                                                                                   // 915
                el = el.getElementsByTagName('a');                                                                     // 916
                                                                                                                       // 917
                for (i = 0; i < el.length; i += 1) {                                                                   // 918
                    if (false === url || url === el[i].attributes.href.value) {                                        // 919
                        el[i].target = '_blank';                                                                       // 920
                    }                                                                                                  // 921
                }                                                                                                      // 922
            }                                                                                                          // 923
        },                                                                                                             // 924
                                                                                                                       // 925
        addClassToAnchors: function (el, buttonClass) {                                                                // 926
            var classes = buttonClass.split(' '),                                                                      // 927
                i,                                                                                                     // 928
                j;                                                                                                     // 929
            if (el.nodeName.toLowerCase() === 'a') {                                                                   // 930
                for (j = 0; j < classes.length; j += 1) {                                                              // 931
                    el.classList.add(classes[j]);                                                                      // 932
                }                                                                                                      // 933
            } else {                                                                                                   // 934
                el = el.getElementsByTagName('a');                                                                     // 935
                for (i = 0; i < el.length; i += 1) {                                                                   // 936
                    for (j = 0; j < classes.length; j += 1) {                                                          // 937
                        el[i].classList.add(classes[j]);                                                               // 938
                    }                                                                                                  // 939
                }                                                                                                      // 940
            }                                                                                                          // 941
        },                                                                                                             // 942
                                                                                                                       // 943
        isListItem: function (node) {                                                                                  // 944
            if (!node) {                                                                                               // 945
                return false;                                                                                          // 946
            }                                                                                                          // 947
            if (node.nodeName.toLowerCase() === 'li') {                                                                // 948
                return true;                                                                                           // 949
            }                                                                                                          // 950
                                                                                                                       // 951
            var parentNode = node.parentNode,                                                                          // 952
                tagName = parentNode.nodeName.toLowerCase();                                                           // 953
            while (tagName === 'li' || (!Util.isBlockContainer(parentNode) && tagName !== 'div')) {                    // 954
                if (tagName === 'li') {                                                                                // 955
                    return true;                                                                                       // 956
                }                                                                                                      // 957
                parentNode = parentNode.parentNode;                                                                    // 958
                if (parentNode) {                                                                                      // 959
                    tagName = parentNode.nodeName.toLowerCase();                                                       // 960
                } else {                                                                                               // 961
                    return false;                                                                                      // 962
                }                                                                                                      // 963
            }                                                                                                          // 964
            return false;                                                                                              // 965
        },                                                                                                             // 966
                                                                                                                       // 967
        cleanListDOM: function (ownerDocument, element) {                                                              // 968
            if (element.nodeName.toLowerCase() !== 'li') {                                                             // 969
                return;                                                                                                // 970
            }                                                                                                          // 971
                                                                                                                       // 972
            var list = element.parentElement;                                                                          // 973
                                                                                                                       // 974
            if (list.parentElement.nodeName.toLowerCase() === 'p') { // yes we need to clean up                        // 975
                Util.unwrap(list.parentElement, ownerDocument);                                                        // 976
                                                                                                                       // 977
                // move cursor at the end of the text inside the list                                                  // 978
                // for some unknown reason, the cursor is moved to end of the "visual" line                            // 979
                MediumEditor.selection.moveCursor(ownerDocument, element.firstChild, element.firstChild.textContent.length);
            }                                                                                                          // 981
        },                                                                                                             // 982
                                                                                                                       // 983
        /* splitDOMTree                                                                                                // 984
         *                                                                                                             // 985
         * Given a root element some descendant element, split the root element                                        // 986
         * into its own element containing the descendant element and all elements                                     // 987
         * on the left or right side of the descendant ('right' is default)                                            // 988
         *                                                                                                             // 989
         * example:                                                                                                    // 990
         *                                                                                                             // 991
         *         <div>                                                                                               // 992
         *      /    |   \
         *  <span> <span> <span>                                                                                       // 994
         *   / \    / \    / \
         *  1   2  3   4  5   6                                                                                        // 996
         *                                                                                                             // 997
         *  If I wanted to split this tree given the <div> as the root and "4" as the leaf                             // 998
         *  the result would be (the prime ' marks indicates nodes that are created as clones):                        // 999
         *                                                                                                             // 1000
         *   SPLITTING OFF 'RIGHT' TREE       SPLITTING OFF 'LEFT' TREE                                                // 1001
         *                                                                                                             // 1002
         *     <div>            <div>'              <div>'      <div>                                                  // 1003
         *      / \              / \                 / \          |                                                    // 1004
         * <span> <span>   <span>' <span>       <span> <span>   <span>                                                 // 1005
         *   / \    |        |      / \           /\     /\       /\
         *  1   2   3        4     5   6         1  2   3  4     5  6                                                  // 1007
         *                                                                                                             // 1008
         *  The above example represents splitting off the 'right' or 'left' part of a tree, where                     // 1009
         *  the <div>' would be returned as an element not appended to the DOM, and the <div>                          // 1010
         *  would remain in place where it was                                                                         // 1011
         *                                                                                                             // 1012
        */                                                                                                             // 1013
        splitOffDOMTree: function (rootNode, leafNode, splitLeft) {                                                    // 1014
            var splitOnNode = leafNode,                                                                                // 1015
                createdNode = null,                                                                                    // 1016
                splitRight = !splitLeft;                                                                               // 1017
                                                                                                                       // 1018
            // loop until we hit the root                                                                              // 1019
            while (splitOnNode !== rootNode) {                                                                         // 1020
                var currParent = splitOnNode.parentNode,                                                               // 1021
                    newParent = currParent.cloneNode(false),                                                           // 1022
                    targetNode = (splitRight ? splitOnNode : currParent.firstChild),                                   // 1023
                    appendLast;                                                                                        // 1024
                                                                                                                       // 1025
                // Create a new parent element which is a clone of the current parent                                  // 1026
                if (createdNode) {                                                                                     // 1027
                    if (splitRight) {                                                                                  // 1028
                        // If we're splitting right, add previous created element before siblings                      // 1029
                        newParent.appendChild(createdNode);                                                            // 1030
                    } else {                                                                                           // 1031
                        // If we're splitting left, add previous created element last                                  // 1032
                        appendLast = createdNode;                                                                      // 1033
                    }                                                                                                  // 1034
                }                                                                                                      // 1035
                createdNode = newParent;                                                                               // 1036
                                                                                                                       // 1037
                while (targetNode) {                                                                                   // 1038
                    var sibling = targetNode.nextSibling;                                                              // 1039
                    // Special handling for the 'splitNode'                                                            // 1040
                    if (targetNode === splitOnNode) {                                                                  // 1041
                        if (!targetNode.hasChildNodes()) {                                                             // 1042
                            targetNode.parentNode.removeChild(targetNode);                                             // 1043
                        } else {                                                                                       // 1044
                            // For the node we're splitting on, if it has children, we need to clone it                // 1045
                            // and not just move it                                                                    // 1046
                            targetNode = targetNode.cloneNode(false);                                                  // 1047
                        }                                                                                              // 1048
                        // If the resulting split node has content, add it                                             // 1049
                        if (targetNode.textContent) {                                                                  // 1050
                            createdNode.appendChild(targetNode);                                                       // 1051
                        }                                                                                              // 1052
                                                                                                                       // 1053
                        targetNode = (splitRight ? sibling : null);                                                    // 1054
                    } else {                                                                                           // 1055
                        // For general case, just remove the element and only                                          // 1056
                        // add it to the split tree if it contains something                                           // 1057
                        targetNode.parentNode.removeChild(targetNode);                                                 // 1058
                        if (targetNode.hasChildNodes() || targetNode.textContent) {                                    // 1059
                            createdNode.appendChild(targetNode);                                                       // 1060
                        }                                                                                              // 1061
                                                                                                                       // 1062
                        targetNode = sibling;                                                                          // 1063
                    }                                                                                                  // 1064
                }                                                                                                      // 1065
                                                                                                                       // 1066
                // If we had an element we wanted to append at the end, do that now                                    // 1067
                if (appendLast) {                                                                                      // 1068
                    createdNode.appendChild(appendLast);                                                               // 1069
                }                                                                                                      // 1070
                                                                                                                       // 1071
                splitOnNode = currParent;                                                                              // 1072
            }                                                                                                          // 1073
                                                                                                                       // 1074
            return createdNode;                                                                                        // 1075
        },                                                                                                             // 1076
                                                                                                                       // 1077
        moveTextRangeIntoElement: function (startNode, endNode, newElement) {                                          // 1078
            if (!startNode || !endNode) {                                                                              // 1079
                return false;                                                                                          // 1080
            }                                                                                                          // 1081
                                                                                                                       // 1082
            var rootNode = Util.findCommonRoot(startNode, endNode);                                                    // 1083
            if (!rootNode) {                                                                                           // 1084
                return false;                                                                                          // 1085
            }                                                                                                          // 1086
                                                                                                                       // 1087
            if (endNode === startNode) {                                                                               // 1088
                var temp = startNode.parentNode,                                                                       // 1089
                    sibling = startNode.nextSibling;                                                                   // 1090
                temp.removeChild(startNode);                                                                           // 1091
                newElement.appendChild(startNode);                                                                     // 1092
                if (sibling) {                                                                                         // 1093
                    temp.insertBefore(newElement, sibling);                                                            // 1094
                } else {                                                                                               // 1095
                    temp.appendChild(newElement);                                                                      // 1096
                }                                                                                                      // 1097
                return newElement.hasChildNodes();                                                                     // 1098
            }                                                                                                          // 1099
                                                                                                                       // 1100
            // create rootChildren array which includes all the children                                               // 1101
            // we care about                                                                                           // 1102
            var rootChildren = [],                                                                                     // 1103
                firstChild,                                                                                            // 1104
                lastChild,                                                                                             // 1105
                nextNode;                                                                                              // 1106
            for (var i = 0; i < rootNode.childNodes.length; i++) {                                                     // 1107
                nextNode = rootNode.childNodes[i];                                                                     // 1108
                if (!firstChild) {                                                                                     // 1109
                    if (Util.isDescendant(nextNode, startNode, true)) {                                                // 1110
                        firstChild = nextNode;                                                                         // 1111
                    }                                                                                                  // 1112
                } else {                                                                                               // 1113
                    if (Util.isDescendant(nextNode, endNode, true)) {                                                  // 1114
                        lastChild = nextNode;                                                                          // 1115
                        break;                                                                                         // 1116
                    } else {                                                                                           // 1117
                        rootChildren.push(nextNode);                                                                   // 1118
                    }                                                                                                  // 1119
                }                                                                                                      // 1120
            }                                                                                                          // 1121
                                                                                                                       // 1122
            var afterLast = lastChild.nextSibling,                                                                     // 1123
                fragment = rootNode.ownerDocument.createDocumentFragment();                                            // 1124
                                                                                                                       // 1125
            // build up fragment on startNode side of tree                                                             // 1126
            if (firstChild === startNode) {                                                                            // 1127
                firstChild.parentNode.removeChild(firstChild);                                                         // 1128
                fragment.appendChild(firstChild);                                                                      // 1129
            } else {                                                                                                   // 1130
                fragment.appendChild(Util.splitOffDOMTree(firstChild, startNode));                                     // 1131
            }                                                                                                          // 1132
                                                                                                                       // 1133
            // add any elements between firstChild & lastChild                                                         // 1134
            rootChildren.forEach(function (element) {                                                                  // 1135
                element.parentNode.removeChild(element);                                                               // 1136
                fragment.appendChild(element);                                                                         // 1137
            });                                                                                                        // 1138
                                                                                                                       // 1139
            // build up fragment on endNode side of the tree                                                           // 1140
            if (lastChild === endNode) {                                                                               // 1141
                lastChild.parentNode.removeChild(lastChild);                                                           // 1142
                fragment.appendChild(lastChild);                                                                       // 1143
            } else {                                                                                                   // 1144
                fragment.appendChild(Util.splitOffDOMTree(lastChild, endNode, true));                                  // 1145
            }                                                                                                          // 1146
                                                                                                                       // 1147
            // Add fragment into passed in element                                                                     // 1148
            newElement.appendChild(fragment);                                                                          // 1149
                                                                                                                       // 1150
            if (lastChild.parentNode === rootNode) {                                                                   // 1151
                // If last child is in the root, insert newElement in front of it                                      // 1152
                rootNode.insertBefore(newElement, lastChild);                                                          // 1153
            } else if (afterLast) {                                                                                    // 1154
                // If last child was removed, but it had a sibling, insert in front of it                              // 1155
                rootNode.insertBefore(newElement, afterLast);                                                          // 1156
            } else {                                                                                                   // 1157
                // lastChild was removed and was the last actual element just append                                   // 1158
                rootNode.appendChild(newElement);                                                                      // 1159
            }                                                                                                          // 1160
                                                                                                                       // 1161
            return newElement.hasChildNodes();                                                                         // 1162
        },                                                                                                             // 1163
                                                                                                                       // 1164
        /* based on http://stackoverflow.com/a/6183069 */                                                              // 1165
        depthOfNode: function (inNode) {                                                                               // 1166
            var theDepth = 0,                                                                                          // 1167
                node = inNode;                                                                                         // 1168
            while (node.parentNode !== null) {                                                                         // 1169
                node = node.parentNode;                                                                                // 1170
                theDepth++;                                                                                            // 1171
            }                                                                                                          // 1172
            return theDepth;                                                                                           // 1173
        },                                                                                                             // 1174
                                                                                                                       // 1175
        findCommonRoot: function (inNode1, inNode2) {                                                                  // 1176
            var depth1 = Util.depthOfNode(inNode1),                                                                    // 1177
                depth2 = Util.depthOfNode(inNode2),                                                                    // 1178
                node1 = inNode1,                                                                                       // 1179
                node2 = inNode2;                                                                                       // 1180
                                                                                                                       // 1181
            while (depth1 !== depth2) {                                                                                // 1182
                if (depth1 > depth2) {                                                                                 // 1183
                    node1 = node1.parentNode;                                                                          // 1184
                    depth1 -= 1;                                                                                       // 1185
                } else {                                                                                               // 1186
                    node2 = node2.parentNode;                                                                          // 1187
                    depth2 -= 1;                                                                                       // 1188
                }                                                                                                      // 1189
            }                                                                                                          // 1190
                                                                                                                       // 1191
            while (node1 !== node2) {                                                                                  // 1192
                node1 = node1.parentNode;                                                                              // 1193
                node2 = node2.parentNode;                                                                              // 1194
            }                                                                                                          // 1195
                                                                                                                       // 1196
            return node1;                                                                                              // 1197
        },                                                                                                             // 1198
        /* END - based on http://stackoverflow.com/a/6183069 */                                                        // 1199
                                                                                                                       // 1200
        isElementAtBeginningOfBlock: function (node) {                                                                 // 1201
            var textVal,                                                                                               // 1202
                sibling;                                                                                               // 1203
            while (!Util.isBlockContainer(node) && !Util.isMediumEditorElement(node)) {                                // 1204
                sibling = node;                                                                                        // 1205
                while (sibling = sibling.previousSibling) {                                                            // 1206
                    textVal = sibling.nodeType === 3 ? sibling.nodeValue : sibling.textContent;                        // 1207
                    if (textVal.length > 0) {                                                                          // 1208
                        return false;                                                                                  // 1209
                    }                                                                                                  // 1210
                }                                                                                                      // 1211
                node = node.parentNode;                                                                                // 1212
            }                                                                                                          // 1213
            return true;                                                                                               // 1214
        },                                                                                                             // 1215
                                                                                                                       // 1216
        isMediumEditorElement: function (element) {                                                                    // 1217
            return element && element.getAttribute && !!element.getAttribute('data-medium-editor-element');            // 1218
        },                                                                                                             // 1219
                                                                                                                       // 1220
        getContainerEditorElement: function (element) {                                                                // 1221
            return Util.traverseUp(element, function (node) {                                                          // 1222
                return Util.isMediumEditorElement(node);                                                               // 1223
            });                                                                                                        // 1224
        },                                                                                                             // 1225
                                                                                                                       // 1226
        isBlockContainer: function (element) {                                                                         // 1227
            return element && element.nodeType !== 3 && Util.blockContainerElementNames.indexOf(element.nodeName.toLowerCase()) !== -1;
        },                                                                                                             // 1229
                                                                                                                       // 1230
        getClosestBlockContainer: function (node) {                                                                    // 1231
            return Util.traverseUp(node, function (node) {                                                             // 1232
                return Util.isBlockContainer(node);                                                                    // 1233
            });                                                                                                        // 1234
        },                                                                                                             // 1235
                                                                                                                       // 1236
        getTopBlockContainer: function (element) {                                                                     // 1237
            var topBlock = element;                                                                                    // 1238
            Util.traverseUp(element, function (el) {                                                                   // 1239
                if (Util.isBlockContainer(el)) {                                                                       // 1240
                    topBlock = el;                                                                                     // 1241
                }                                                                                                      // 1242
                return false;                                                                                          // 1243
            });                                                                                                        // 1244
            return topBlock;                                                                                           // 1245
        },                                                                                                             // 1246
                                                                                                                       // 1247
        getFirstSelectableLeafNode: function (element) {                                                               // 1248
            while (element && element.firstChild) {                                                                    // 1249
                element = element.firstChild;                                                                          // 1250
            }                                                                                                          // 1251
                                                                                                                       // 1252
            // We don't want to set the selection to an element that can't have children, this messes up Gecko.        // 1253
            element = Util.traverseUp(element, function (el) {                                                         // 1254
                return Util.emptyElementNames.indexOf(el.nodeName.toLowerCase()) === -1;                               // 1255
            });                                                                                                        // 1256
            // Selecting at the beginning of a table doesn't work in PhantomJS.                                        // 1257
            if (element.nodeName.toLowerCase() === 'table') {                                                          // 1258
                var firstCell = element.querySelector('th, td');                                                       // 1259
                if (firstCell) {                                                                                       // 1260
                    element = firstCell;                                                                               // 1261
                }                                                                                                      // 1262
            }                                                                                                          // 1263
            return element;                                                                                            // 1264
        },                                                                                                             // 1265
                                                                                                                       // 1266
        getFirstTextNode: function (element) {                                                                         // 1267
            if (element.nodeType === 3) {                                                                              // 1268
                return element;                                                                                        // 1269
            }                                                                                                          // 1270
                                                                                                                       // 1271
            for (var i = 0; i < element.childNodes.length; i++) {                                                      // 1272
                var textNode = Util.getFirstTextNode(element.childNodes[i]);                                           // 1273
                if (textNode !== null) {                                                                               // 1274
                    return textNode;                                                                                   // 1275
                }                                                                                                      // 1276
            }                                                                                                          // 1277
            return null;                                                                                               // 1278
        },                                                                                                             // 1279
                                                                                                                       // 1280
        ensureUrlHasProtocol: function (url) {                                                                         // 1281
            if (url.indexOf('://') === -1) {                                                                           // 1282
                return 'http://' + url;                                                                                // 1283
            }                                                                                                          // 1284
            return url;                                                                                                // 1285
        },                                                                                                             // 1286
                                                                                                                       // 1287
        warn: function () {                                                                                            // 1288
            if (window.console !== undefined && typeof window.console.warn === 'function') {                           // 1289
                window.console.warn.apply(window.console, arguments);                                                  // 1290
            }                                                                                                          // 1291
        },                                                                                                             // 1292
                                                                                                                       // 1293
        deprecated: function (oldName, newName, version) {                                                             // 1294
            // simple deprecation warning mechanism.                                                                   // 1295
            var m = oldName + ' is deprecated, please use ' + newName + ' instead.';                                   // 1296
            if (version) {                                                                                             // 1297
                m += ' Will be removed in ' + version;                                                                 // 1298
            }                                                                                                          // 1299
            Util.warn(m);                                                                                              // 1300
        },                                                                                                             // 1301
                                                                                                                       // 1302
        deprecatedMethod: function (oldName, newName, args, version) {                                                 // 1303
            // run the replacement and warn when someone calls a deprecated method                                     // 1304
            Util.deprecated(oldName, newName, version);                                                                // 1305
            if (typeof this[newName] === 'function') {                                                                 // 1306
                this[newName].apply(this, args);                                                                       // 1307
            }                                                                                                          // 1308
        },                                                                                                             // 1309
                                                                                                                       // 1310
        cleanupAttrs: function (el, attrs) {                                                                           // 1311
            attrs.forEach(function (attr) {                                                                            // 1312
                el.removeAttribute(attr);                                                                              // 1313
            });                                                                                                        // 1314
        },                                                                                                             // 1315
                                                                                                                       // 1316
        cleanupTags: function (el, tags) {                                                                             // 1317
            tags.forEach(function (tag) {                                                                              // 1318
                if (el.nodeName.toLowerCase() === tag) {                                                               // 1319
                    el.parentNode.removeChild(el);                                                                     // 1320
                }                                                                                                      // 1321
            });                                                                                                        // 1322
        },                                                                                                             // 1323
                                                                                                                       // 1324
        // get the closest parent                                                                                      // 1325
        getClosestTag: function (el, tag) {                                                                            // 1326
            return Util.traverseUp(el, function (element) {                                                            // 1327
                return element.nodeName.toLowerCase() === tag.toLowerCase();                                           // 1328
            });                                                                                                        // 1329
        },                                                                                                             // 1330
                                                                                                                       // 1331
        unwrap: function (el, doc) {                                                                                   // 1332
            var fragment = doc.createDocumentFragment(),                                                               // 1333
                nodes = Array.prototype.slice.call(el.childNodes);                                                     // 1334
                                                                                                                       // 1335
            // cast nodeList to array since appending child                                                            // 1336
            // to a different node will alter length of el.childNodes                                                  // 1337
            for (var i = 0; i < nodes.length; i++) {                                                                   // 1338
                fragment.appendChild(nodes[i]);                                                                        // 1339
            }                                                                                                          // 1340
                                                                                                                       // 1341
            if (fragment.childNodes.length) {                                                                          // 1342
                el.parentNode.replaceChild(fragment, el);                                                              // 1343
            } else {                                                                                                   // 1344
                el.parentNode.removeChild(el);                                                                         // 1345
            }                                                                                                          // 1346
        }                                                                                                              // 1347
    };                                                                                                                 // 1348
                                                                                                                       // 1349
    MediumEditor.util = Util;                                                                                          // 1350
}(window));                                                                                                            // 1351
                                                                                                                       // 1352
(function () {                                                                                                         // 1353
    'use strict';                                                                                                      // 1354
                                                                                                                       // 1355
    var Extension = function (options) {                                                                               // 1356
        MediumEditor.util.extend(this, options);                                                                       // 1357
    };                                                                                                                 // 1358
                                                                                                                       // 1359
    Extension.extend = function (protoProps) {                                                                         // 1360
        // magic extender thinger. mostly borrowed from backbone/goog.inherits                                         // 1361
        // place this function on some thing you want extend-able.                                                     // 1362
        //                                                                                                             // 1363
        // example:                                                                                                    // 1364
        //                                                                                                             // 1365
        //      function Thing(args){                                                                                  // 1366
        //          this.options = args;                                                                               // 1367
        //      }                                                                                                      // 1368
        //                                                                                                             // 1369
        //      Thing.prototype = { foo: "bar" };                                                                      // 1370
        //      Thing.extend = extenderify;                                                                            // 1371
        //                                                                                                             // 1372
        //      var ThingTwo = Thing.extend({ foo: "baz" });                                                           // 1373
        //                                                                                                             // 1374
        //      var thingOne = new Thing(); // foo === "bar"                                                           // 1375
        //      var thingTwo = new ThingTwo(); // foo === "baz"                                                        // 1376
        //                                                                                                             // 1377
        //      which seems like some simply shallow copy nonsense                                                     // 1378
        //      at first, but a lot more is going on there.                                                            // 1379
        //                                                                                                             // 1380
        //      passing a `constructor` to the extend props                                                            // 1381
        //      will cause the instance to instantiate through that                                                    // 1382
        //      instead of the parent's constructor.                                                                   // 1383
                                                                                                                       // 1384
        var parent = this,                                                                                             // 1385
            child;                                                                                                     // 1386
                                                                                                                       // 1387
        // The constructor function for the new subclass is either defined by you                                      // 1388
        // (the "constructor" property in your `extend` definition), or defaulted                                      // 1389
        // by us to simply call the parent's constructor.                                                              // 1390
                                                                                                                       // 1391
        if (protoProps && protoProps.hasOwnProperty('constructor')) {                                                  // 1392
            child = protoProps.constructor;                                                                            // 1393
        } else {                                                                                                       // 1394
            child = function () {                                                                                      // 1395
                return parent.apply(this, arguments);                                                                  // 1396
            };                                                                                                         // 1397
        }                                                                                                              // 1398
                                                                                                                       // 1399
        // das statics (.extend comes over, so your subclass can have subclasses too)                                  // 1400
        MediumEditor.util.extend(child, parent);                                                                       // 1401
                                                                                                                       // 1402
        // Set the prototype chain to inherit from `parent`, without calling                                           // 1403
        // `parent`'s constructor function.                                                                            // 1404
        var Surrogate = function () {                                                                                  // 1405
            this.constructor = child;                                                                                  // 1406
        };                                                                                                             // 1407
        Surrogate.prototype = parent.prototype;                                                                        // 1408
        child.prototype = new Surrogate();                                                                             // 1409
                                                                                                                       // 1410
        if (protoProps) {                                                                                              // 1411
            MediumEditor.util.extend(child.prototype, protoProps);                                                     // 1412
        }                                                                                                              // 1413
                                                                                                                       // 1414
        // todo: $super?                                                                                               // 1415
                                                                                                                       // 1416
        return child;                                                                                                  // 1417
    };                                                                                                                 // 1418
                                                                                                                       // 1419
    Extension.prototype = {                                                                                            // 1420
        /* init: [function]                                                                                            // 1421
         *                                                                                                             // 1422
         * Called by MediumEditor during initialization.                                                               // 1423
         * The .base property will already have been set to                                                            // 1424
         * current instance of MediumEditor when this is called.                                                       // 1425
         * All helper methods will exist as well                                                                       // 1426
         */                                                                                                            // 1427
        init: function () {},                                                                                          // 1428
                                                                                                                       // 1429
        /* base: [MediumEditor instance]                                                                               // 1430
         *                                                                                                             // 1431
         * If not overriden, this will be set to the current instance                                                  // 1432
         * of MediumEditor, before the init method is called                                                           // 1433
         */                                                                                                            // 1434
        base: undefined,                                                                                               // 1435
                                                                                                                       // 1436
        /* name: [string]                                                                                              // 1437
         *                                                                                                             // 1438
         * 'name' of the extension, used for retrieving the extension.                                                 // 1439
         * If not set, MediumEditor will set this to be the key                                                        // 1440
         * used when passing the extension into MediumEditor via the                                                   // 1441
         * 'extensions' option                                                                                         // 1442
         */                                                                                                            // 1443
        name: undefined,                                                                                               // 1444
                                                                                                                       // 1445
        /* checkState: [function (node)]                                                                               // 1446
         *                                                                                                             // 1447
         * If implemented, this function will be called one or more times                                              // 1448
         * the state of the editor & toolbar are updated.                                                              // 1449
         * When the state is updated, the editor does the following:                                                   // 1450
         *                                                                                                             // 1451
         * 1) Find the parent node containing the current selection                                                    // 1452
         * 2) Call checkState on the extension, passing the node as an argument                                        // 1453
         * 3) Get the parent node of the previous node                                                                 // 1454
         * 4) Repeat steps #2 and #3 until we move outside the parent contenteditable                                  // 1455
         */                                                                                                            // 1456
        checkState: undefined,                                                                                         // 1457
                                                                                                                       // 1458
        /* destroy: [function ()]                                                                                      // 1459
         *                                                                                                             // 1460
         * This method should remove any created html, custom event handlers                                           // 1461
         * or any other cleanup tasks that should be performed.                                                        // 1462
         * If implemented, this function will be called when MediumEditor's                                            // 1463
         * destroy method has been called.                                                                             // 1464
         */                                                                                                            // 1465
        destroy: undefined,                                                                                            // 1466
                                                                                                                       // 1467
        /* As alternatives to checkState, these functions provide a more structured                                    // 1468
         * path to updating the state of an extension (usually a button) whenever                                      // 1469
         * the state of the editor & toolbar are updated.                                                              // 1470
         */                                                                                                            // 1471
                                                                                                                       // 1472
        /* queryCommandState: [function ()]                                                                            // 1473
         *                                                                                                             // 1474
         * If implemented, this function will be called once on each extension                                         // 1475
         * when the state of the editor/toolbar is being updated.                                                      // 1476
         *                                                                                                             // 1477
         * If this function returns a non-null value, the extension will                                               // 1478
         * be ignored as the code climbs the dom tree.                                                                 // 1479
         *                                                                                                             // 1480
         * If this function returns true, and the setActive() function is defined                                      // 1481
         * setActive() will be called                                                                                  // 1482
         */                                                                                                            // 1483
        queryCommandState: undefined,                                                                                  // 1484
                                                                                                                       // 1485
        /* isActive: [function ()]                                                                                     // 1486
         *                                                                                                             // 1487
         * If implemented, this function will be called when MediumEditor                                              // 1488
         * has determined that this extension is 'active' for the current selection.                                   // 1489
         * This may be called when the editor & toolbar are being updated,                                             // 1490
         * but only if queryCommandState() or isAlreadyApplied() functions                                             // 1491
         * are implemented, and when called, return true.                                                              // 1492
         */                                                                                                            // 1493
        isActive: undefined,                                                                                           // 1494
                                                                                                                       // 1495
        /* isAlreadyApplied: [function (node)]                                                                         // 1496
         *                                                                                                             // 1497
         * If implemented, this function is similar to checkState() in                                                 // 1498
         * that it will be called repeatedly as MediumEditor moves up                                                  // 1499
         * the DOM to update the editor & toolbar after a state change.                                                // 1500
         *                                                                                                             // 1501
         * NOTE: This function will NOT be called if checkState() has                                                  // 1502
         * been implemented. This function will NOT be called if                                                       // 1503
         * queryCommandState() is implemented and returns a non-null                                                   // 1504
         * value when called                                                                                           // 1505
         */                                                                                                            // 1506
        isAlreadyApplied: undefined,                                                                                   // 1507
                                                                                                                       // 1508
        /* setActive: [function ()]                                                                                    // 1509
         *                                                                                                             // 1510
         * If implemented, this function is called when MediumEditor knows                                             // 1511
         * that this extension is currently enabled.  Currently, this                                                  // 1512
         * function is called when updating the editor & toolbar, and                                                  // 1513
         * only if queryCommandState() or isAlreadyApplied(node) return                                                // 1514
         * true when called                                                                                            // 1515
         */                                                                                                            // 1516
        setActive: undefined,                                                                                          // 1517
                                                                                                                       // 1518
        /* setInactive: [function ()]                                                                                  // 1519
         *                                                                                                             // 1520
         * If implemented, this function is called when MediumEditor knows                                             // 1521
         * that this extension is currently disabled.  Curently, this                                                  // 1522
         * is called at the beginning of each state change for                                                         // 1523
         * the editor & toolbar. After calling this, MediumEditor                                                      // 1524
         * will attempt to update the extension, either via checkState()                                               // 1525
         * or the combination of queryCommandState(), isAlreadyApplied(node),                                          // 1526
         * isActive(), and setActive()                                                                                 // 1527
         */                                                                                                            // 1528
        setInactive: undefined,                                                                                        // 1529
                                                                                                                       // 1530
        /************************ Helpers ************************                                                     // 1531
         * The following are helpers that are either set by MediumEditor                                               // 1532
         * during initialization, or are helper methods which either                                                   // 1533
         * route calls to the MediumEditor instance or provide common                                                  // 1534
         * functionality for all extensions                                                                            // 1535
         *********************************************************/                                                    // 1536
                                                                                                                       // 1537
        /* window: [Window]                                                                                            // 1538
         *                                                                                                             // 1539
         * If not overriden, this will be set to the window object                                                     // 1540
         * to be used by MediumEditor and its extensions.  This is                                                     // 1541
         * passed via the 'contentWindow' option to MediumEditor                                                       // 1542
         * and is the global 'window' object by default                                                                // 1543
         */                                                                                                            // 1544
        'window': undefined,                                                                                           // 1545
                                                                                                                       // 1546
        /* document: [Document]                                                                                        // 1547
         *                                                                                                             // 1548
         * If not overriden, this will be set to the document object                                                   // 1549
         * to be used by MediumEditor and its extensions. This is                                                      // 1550
         * passed via the 'ownerDocument' optin to MediumEditor                                                        // 1551
         * and is the global 'document' object by default                                                              // 1552
         */                                                                                                            // 1553
        'document': undefined,                                                                                         // 1554
                                                                                                                       // 1555
        /* getEditorElements: [function ()]                                                                            // 1556
         *                                                                                                             // 1557
         * Helper function which returns an array containing                                                           // 1558
         * all the contenteditable elements for this instance                                                          // 1559
         * of MediumEditor                                                                                             // 1560
         */                                                                                                            // 1561
        getEditorElements: function () {                                                                               // 1562
            return this.base.elements;                                                                                 // 1563
        },                                                                                                             // 1564
                                                                                                                       // 1565
        /* getEditorId: [function ()]                                                                                  // 1566
         *                                                                                                             // 1567
         * Helper function which returns a unique identifier                                                           // 1568
         * for this instance of MediumEditor                                                                           // 1569
         */                                                                                                            // 1570
        getEditorId: function () {                                                                                     // 1571
            return this.base.id;                                                                                       // 1572
        },                                                                                                             // 1573
                                                                                                                       // 1574
        /* getEditorOptions: [function (option)]                                                                       // 1575
         *                                                                                                             // 1576
         * Helper function which returns the value of an option                                                        // 1577
         * used to initialize this instance of MediumEditor                                                            // 1578
         */                                                                                                            // 1579
        getEditorOption: function (option) {                                                                           // 1580
            return this.base.options[option];                                                                          // 1581
        }                                                                                                              // 1582
    };                                                                                                                 // 1583
                                                                                                                       // 1584
    /* List of method names to add to the prototype of Extension                                                       // 1585
     * Each of these methods will be defined as helpers that                                                           // 1586
     * just call directly into the MediumEditor instance.                                                              // 1587
     *                                                                                                                 // 1588
     * example for 'on' method:                                                                                        // 1589
     * Extension.prototype.on = function () {                                                                          // 1590
     *     return this.base.on.apply(this.base, arguments);                                                            // 1591
     * }                                                                                                               // 1592
     */                                                                                                                // 1593
    [                                                                                                                  // 1594
        // general helpers                                                                                             // 1595
        'execAction',                                                                                                  // 1596
                                                                                                                       // 1597
        // event handling                                                                                              // 1598
        'on',                                                                                                          // 1599
        'off',                                                                                                         // 1600
        'subscribe',                                                                                                   // 1601
        'trigger'                                                                                                      // 1602
                                                                                                                       // 1603
    ].forEach(function (helper) {                                                                                      // 1604
        Extension.prototype[helper] = function () {                                                                    // 1605
            return this.base[helper].apply(this.base, arguments);                                                      // 1606
        };                                                                                                             // 1607
    });                                                                                                                // 1608
                                                                                                                       // 1609
    MediumEditor.Extension = Extension;                                                                                // 1610
})();                                                                                                                  // 1611
                                                                                                                       // 1612
(function () {                                                                                                         // 1613
    'use strict';                                                                                                      // 1614
                                                                                                                       // 1615
    function filterOnlyParentElements(node) {                                                                          // 1616
        if (MediumEditor.util.isBlockContainer(node)) {                                                                // 1617
            return NodeFilter.FILTER_ACCEPT;                                                                           // 1618
        } else {                                                                                                       // 1619
            return NodeFilter.FILTER_SKIP;                                                                             // 1620
        }                                                                                                              // 1621
    }                                                                                                                  // 1622
                                                                                                                       // 1623
    var Selection = {                                                                                                  // 1624
        findMatchingSelectionParent: function (testElementFunction, contentWindow) {                                   // 1625
            var selection = contentWindow.getSelection(),                                                              // 1626
                range,                                                                                                 // 1627
                current;                                                                                               // 1628
                                                                                                                       // 1629
            if (selection.rangeCount === 0) {                                                                          // 1630
                return false;                                                                                          // 1631
            }                                                                                                          // 1632
                                                                                                                       // 1633
            range = selection.getRangeAt(0);                                                                           // 1634
            current = range.commonAncestorContainer;                                                                   // 1635
                                                                                                                       // 1636
            return MediumEditor.util.traverseUp(current, testElementFunction);                                         // 1637
        },                                                                                                             // 1638
                                                                                                                       // 1639
        getSelectionElement: function (contentWindow) {                                                                // 1640
            return this.findMatchingSelectionParent(function (el) {                                                    // 1641
                return MediumEditor.util.isMediumEditorElement(el);                                                    // 1642
            }, contentWindow);                                                                                         // 1643
        },                                                                                                             // 1644
                                                                                                                       // 1645
        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down                                                                                                    // 1647
        exportSelection: function (root, doc) {                                                                        // 1648
            if (!root) {                                                                                               // 1649
                return null;                                                                                           // 1650
            }                                                                                                          // 1651
                                                                                                                       // 1652
            var selectionState = null,                                                                                 // 1653
                selection = doc.getSelection();                                                                        // 1654
                                                                                                                       // 1655
            if (selection.rangeCount > 0) {                                                                            // 1656
                var range = selection.getRangeAt(0),                                                                   // 1657
                    preSelectionRange = range.cloneRange(),                                                            // 1658
                    start;                                                                                             // 1659
                                                                                                                       // 1660
                preSelectionRange.selectNodeContents(root);                                                            // 1661
                preSelectionRange.setEnd(range.startContainer, range.startOffset);                                     // 1662
                start = preSelectionRange.toString().length;                                                           // 1663
                                                                                                                       // 1664
                selectionState = {                                                                                     // 1665
                    start: start,                                                                                      // 1666
                    end: start + range.toString().length                                                               // 1667
                };                                                                                                     // 1668
                // If start = 0 there may still be an empty paragraph before it, but we don't care.                    // 1669
                if (start !== 0) {                                                                                     // 1670
                    var emptyBlocksIndex = this.getIndexRelativeToAdjacentEmptyBlocks(doc, root, range.startContainer, range.startOffset);
                    if (emptyBlocksIndex !== -1) {                                                                     // 1672
                        selectionState.emptyBlocksIndex = emptyBlocksIndex;                                            // 1673
                    }                                                                                                  // 1674
                }                                                                                                      // 1675
            }                                                                                                          // 1676
                                                                                                                       // 1677
            return selectionState;                                                                                     // 1678
        },                                                                                                             // 1679
                                                                                                                       // 1680
        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down                                                                                                    // 1682
        //                                                                                                             // 1683
        // {object} selectionState - the selection to import                                                           // 1684
        // {DOMElement} root - the root element the selection is being restored inside of                              // 1685
        // {Document} doc - the document to use for managing selection                                                 // 1686
        // {boolean} [favorLaterSelectionAnchor] - defaults to false. If true, import the cursor immediately           // 1687
        //      subsequent to an anchor tag if it would otherwise be placed right at the trailing edge inside the      // 1688
        //      anchor. This cursor positioning, even though visually equivalent to the user, can affect behavior      // 1689
        //      in MS IE.                                                                                              // 1690
        importSelection: function (selectionState, root, doc, favorLaterSelectionAnchor) {                             // 1691
            if (!selectionState || !root) {                                                                            // 1692
                return;                                                                                                // 1693
            }                                                                                                          // 1694
                                                                                                                       // 1695
            var range = doc.createRange();                                                                             // 1696
            range.setStart(root, 0);                                                                                   // 1697
            range.collapse(true);                                                                                      // 1698
                                                                                                                       // 1699
            var node = root,                                                                                           // 1700
                nodeStack = [],                                                                                        // 1701
                charIndex = 0,                                                                                         // 1702
                foundStart = false,                                                                                    // 1703
                stop = false,                                                                                          // 1704
                nextCharIndex;                                                                                         // 1705
                                                                                                                       // 1706
            while (!stop && node) {                                                                                    // 1707
                if (node.nodeType === 3) {                                                                             // 1708
                    nextCharIndex = charIndex + node.length;                                                           // 1709
                    if (!foundStart && selectionState.start >= charIndex && selectionState.start <= nextCharIndex) {   // 1710
                        range.setStart(node, selectionState.start - charIndex);                                        // 1711
                        foundStart = true;                                                                             // 1712
                    }                                                                                                  // 1713
                    if (foundStart && selectionState.end >= charIndex && selectionState.end <= nextCharIndex) {        // 1714
                        range.setEnd(node, selectionState.end - charIndex);                                            // 1715
                        stop = true;                                                                                   // 1716
                    }                                                                                                  // 1717
                    charIndex = nextCharIndex;                                                                         // 1718
                } else {                                                                                               // 1719
                    var i = node.childNodes.length - 1;                                                                // 1720
                    while (i >= 0) {                                                                                   // 1721
                        nodeStack.push(node.childNodes[i]);                                                            // 1722
                        i -= 1;                                                                                        // 1723
                    }                                                                                                  // 1724
                }                                                                                                      // 1725
                if (!stop) {                                                                                           // 1726
                    node = nodeStack.pop();                                                                            // 1727
                }                                                                                                      // 1728
            }                                                                                                          // 1729
                                                                                                                       // 1730
            if (typeof selectionState.emptyBlocksIndex !== 'undefined') {                                              // 1731
                range = this.importSelectionMoveCursorPastBlocks(doc, root, selectionState.emptyBlocksIndex, range);   // 1732
            }                                                                                                          // 1733
                                                                                                                       // 1734
            // If the selection is right at the ending edge of a link, put it outside the anchor tag instead of inside.
            if (favorLaterSelectionAnchor) {                                                                           // 1736
                range = this.importSelectionMoveCursorPastAnchor(selectionState, range);                               // 1737
            }                                                                                                          // 1738
                                                                                                                       // 1739
            var sel = doc.getSelection();                                                                              // 1740
            sel.removeAllRanges();                                                                                     // 1741
            sel.addRange(range);                                                                                       // 1742
        },                                                                                                             // 1743
                                                                                                                       // 1744
        // Utility method called from importSelection only                                                             // 1745
        importSelectionMoveCursorPastAnchor: function (selectionState, range) {                                        // 1746
            var nodeInsideAnchorTagFunction = function (node) {                                                        // 1747
                return node.nodeName.toLowerCase() === 'a';                                                            // 1748
            };                                                                                                         // 1749
            if (selectionState.start === selectionState.end &&                                                         // 1750
                    range.startContainer.nodeType === 3 &&                                                             // 1751
                    range.startOffset === range.startContainer.nodeValue.length &&                                     // 1752
                    MediumEditor.util.traverseUp(range.startContainer, nodeInsideAnchorTagFunction)) {                 // 1753
                var prevNode = range.startContainer,                                                                   // 1754
                    currentNode = range.startContainer.parentNode;                                                     // 1755
                while (currentNode !== null && currentNode.nodeName.toLowerCase() !== 'a') {                           // 1756
                    if (currentNode.childNodes[currentNode.childNodes.length - 1] !== prevNode) {                      // 1757
                        currentNode = null;                                                                            // 1758
                    } else {                                                                                           // 1759
                        prevNode = currentNode;                                                                        // 1760
                        currentNode = currentNode.parentNode;                                                          // 1761
                    }                                                                                                  // 1762
                }                                                                                                      // 1763
                if (currentNode !== null && currentNode.nodeName.toLowerCase() === 'a') {                              // 1764
                    var currentNodeIndex = null;                                                                       // 1765
                    for (var i = 0; currentNodeIndex === null && i < currentNode.parentNode.childNodes.length; i++) {  // 1766
                        if (currentNode.parentNode.childNodes[i] === currentNode) {                                    // 1767
                            currentNodeIndex = i;                                                                      // 1768
                        }                                                                                              // 1769
                    }                                                                                                  // 1770
                    range.setStart(currentNode.parentNode, currentNodeIndex + 1);                                      // 1771
                    range.collapse(true);                                                                              // 1772
                }                                                                                                      // 1773
            }                                                                                                          // 1774
            return range;                                                                                              // 1775
        },                                                                                                             // 1776
                                                                                                                       // 1777
        // Uses the emptyBlocksIndex calculated by getIndexRelativeToAdjacentEmptyBlocks                               // 1778
        // to move the cursor back to the start of the correct paragraph                                               // 1779
        importSelectionMoveCursorPastBlocks: function (doc, root, index, range) {                                      // 1780
            var treeWalker = doc.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, filterOnlyParentElements, false),     // 1781
                startContainer = range.startContainer,                                                                 // 1782
                startBlock,                                                                                            // 1783
                targetNode,                                                                                            // 1784
                currIndex = 0;                                                                                         // 1785
            index = index || 1; // If index is 0, we still want to move to the next block                              // 1786
                                                                                                                       // 1787
            // Chrome counts newlines and spaces that separate block elements as actual elements.                      // 1788
            // If the selection is inside one of these text nodes, and it has a previous sibling                       // 1789
            // which is a block element, we want the treewalker to start at the previous sibling                       // 1790
            // and NOT at the parent of the textnode                                                                   // 1791
            if (startContainer.nodeType === 3 && MediumEditor.util.isBlockContainer(startContainer.previousSibling)) {
                startBlock = startContainer.previousSibling;                                                           // 1793
            } else {                                                                                                   // 1794
                startBlock = MediumEditor.util.getClosestBlockContainer(startContainer);                               // 1795
            }                                                                                                          // 1796
                                                                                                                       // 1797
            // Skip over empty blocks until we hit the block we want the selection to be in                            // 1798
            while (treeWalker.nextNode()) {                                                                            // 1799
                if (!targetNode) {                                                                                     // 1800
                    // Loop through all blocks until we hit the starting block element                                 // 1801
                    if (startBlock === treeWalker.currentNode) {                                                       // 1802
                        targetNode = treeWalker.currentNode;                                                           // 1803
                    }                                                                                                  // 1804
                } else {                                                                                               // 1805
                    targetNode = treeWalker.currentNode;                                                               // 1806
                    currIndex++;                                                                                       // 1807
                    // We hit the target index, bail                                                                   // 1808
                    if (currIndex === index) {                                                                         // 1809
                        break;                                                                                         // 1810
                    }                                                                                                  // 1811
                    // If we find a non-empty block, ignore the emptyBlocksIndex and just put selection here           // 1812
                    if (targetNode.textContent.length > 0) {                                                           // 1813
                        break;                                                                                         // 1814
                    }                                                                                                  // 1815
                }                                                                                                      // 1816
            }                                                                                                          // 1817
                                                                                                                       // 1818
            // We're selecting a high-level block node, so make sure the cursor gets moved into the deepest            // 1819
            // element at the beginning of the block                                                                   // 1820
            range.setStart(MediumEditor.util.getFirstSelectableLeafNode(targetNode), 0);                               // 1821
                                                                                                                       // 1822
            return range;                                                                                              // 1823
        },                                                                                                             // 1824
                                                                                                                       // 1825
        // Returns -1 unless the cursor is at the beginning of a paragraph/block                                       // 1826
        // If the paragraph/block is preceeded by empty paragraphs/block (with no text)                                // 1827
        // it will return the number of empty paragraphs before the cursor.                                            // 1828
        // Otherwise, it will return 0, which indicates the cursor is at the beginning                                 // 1829
        // of a paragraph/block, and not at the end of the paragraph/block before it                                   // 1830
        getIndexRelativeToAdjacentEmptyBlocks: function (doc, root, cursorContainer, cursorOffset) {                   // 1831
            // If there is text in front of the cursor, that means there isn't only empty blocks before it             // 1832
            if (cursorContainer.textContent.length > 0 && cursorOffset > 0) {                                          // 1833
                return -1;                                                                                             // 1834
            }                                                                                                          // 1835
                                                                                                                       // 1836
            // Check if the block that contains the cursor has any other text in front of the cursor                   // 1837
            var node = cursorContainer;                                                                                // 1838
            if (node.nodeType !== 3) {                                                                                 // 1839
                node = cursorContainer.childNodes[cursorOffset];                                                       // 1840
            }                                                                                                          // 1841
            if (node && !MediumEditor.util.isElementAtBeginningOfBlock(node)) {                                        // 1842
                return -1;                                                                                             // 1843
            }                                                                                                          // 1844
                                                                                                                       // 1845
            // Walk over block elements, counting number of empty blocks between last piece of text                    // 1846
            // and the block the cursor is in                                                                          // 1847
            var closestBlock = MediumEditor.util.getClosestBlockContainer(cursorContainer),                            // 1848
                treeWalker = doc.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, filterOnlyParentElements, false),     // 1849
                emptyBlocksCount = 0;                                                                                  // 1850
            while (treeWalker.nextNode()) {                                                                            // 1851
                var blockIsEmpty = treeWalker.currentNode.textContent === '';                                          // 1852
                if (blockIsEmpty || emptyBlocksCount > 0) {                                                            // 1853
                    emptyBlocksCount += 1;                                                                             // 1854
                }                                                                                                      // 1855
                if (treeWalker.currentNode === closestBlock) {                                                         // 1856
                    return emptyBlocksCount;                                                                           // 1857
                }                                                                                                      // 1858
                if (!blockIsEmpty) {                                                                                   // 1859
                    emptyBlocksCount = 0;                                                                              // 1860
                }                                                                                                      // 1861
            }                                                                                                          // 1862
                                                                                                                       // 1863
            return emptyBlocksCount;                                                                                   // 1864
        },                                                                                                             // 1865
                                                                                                                       // 1866
        selectionInContentEditableFalse: function (contentWindow) {                                                    // 1867
            // determine if the current selection is exclusively inside                                                // 1868
            // a contenteditable="false", though treat the case of an                                                  // 1869
            // explicit contenteditable="true" inside a "false" as false.                                              // 1870
            var sawtrue,                                                                                               // 1871
                sawfalse = this.findMatchingSelectionParent(function (el) {                                            // 1872
                    var ce = el && el.getAttribute('contenteditable');                                                 // 1873
                    if (ce === 'true') {                                                                               // 1874
                        sawtrue = true;                                                                                // 1875
                    }                                                                                                  // 1876
                    return el.nodeName !== '#text' && ce === 'false';                                                  // 1877
                }, contentWindow);                                                                                     // 1878
                                                                                                                       // 1879
            return !sawtrue && sawfalse;                                                                               // 1880
        },                                                                                                             // 1881
                                                                                                                       // 1882
        // http://stackoverflow.com/questions/4176923/html-of-selected-text                                            // 1883
        // by Tim Down                                                                                                 // 1884
        getSelectionHtml: function getSelectionHtml(doc) {                                                             // 1885
            var i,                                                                                                     // 1886
                html = '',                                                                                             // 1887
                sel = doc.getSelection(),                                                                              // 1888
                len,                                                                                                   // 1889
                container;                                                                                             // 1890
            if (sel.rangeCount) {                                                                                      // 1891
                container = doc.createElement('div');                                                                  // 1892
                for (i = 0, len = sel.rangeCount; i < len; i += 1) {                                                   // 1893
                    container.appendChild(sel.getRangeAt(i).cloneContents());                                          // 1894
                }                                                                                                      // 1895
                html = container.innerHTML;                                                                            // 1896
            }                                                                                                          // 1897
            return html;                                                                                               // 1898
        },                                                                                                             // 1899
                                                                                                                       // 1900
        /**                                                                                                            // 1901
         *  Find the caret position within an element irrespective of any inline tags it may contain.                  // 1902
         *                                                                                                             // 1903
         *  @param {DOMElement} An element containing the cursor to find offsets relative to.                          // 1904
         *  @param {Range} A Range representing cursor position. Will window.getSelection if none is passed.           // 1905
         *  @return {Object} 'left' and 'right' attributes contain offsets from begining and end of Element            // 1906
         */                                                                                                            // 1907
        getCaretOffsets: function getCaretOffsets(element, range) {                                                    // 1908
            var preCaretRange, postCaretRange;                                                                         // 1909
                                                                                                                       // 1910
            if (!range) {                                                                                              // 1911
                range = window.getSelection().getRangeAt(0);                                                           // 1912
            }                                                                                                          // 1913
                                                                                                                       // 1914
            preCaretRange = range.cloneRange();                                                                        // 1915
            postCaretRange = range.cloneRange();                                                                       // 1916
                                                                                                                       // 1917
            preCaretRange.selectNodeContents(element);                                                                 // 1918
            preCaretRange.setEnd(range.endContainer, range.endOffset);                                                 // 1919
                                                                                                                       // 1920
            postCaretRange.selectNodeContents(element);                                                                // 1921
            postCaretRange.setStart(range.endContainer, range.endOffset);                                              // 1922
                                                                                                                       // 1923
            return {                                                                                                   // 1924
                left: preCaretRange.toString().length,                                                                 // 1925
                right: postCaretRange.toString().length                                                                // 1926
            };                                                                                                         // 1927
        },                                                                                                             // 1928
                                                                                                                       // 1929
        // http://stackoverflow.com/questions/15867542/range-object-get-selection-parent-node-chrome-vs-firefox        // 1930
        rangeSelectsSingleNode: function (range) {                                                                     // 1931
            var startNode = range.startContainer;                                                                      // 1932
            return startNode === range.endContainer &&                                                                 // 1933
                startNode.hasChildNodes() &&                                                                           // 1934
                range.endOffset === range.startOffset + 1;                                                             // 1935
        },                                                                                                             // 1936
                                                                                                                       // 1937
        getSelectedParentElement: function (range) {                                                                   // 1938
            if (!range) {                                                                                              // 1939
                return null;                                                                                           // 1940
            }                                                                                                          // 1941
                                                                                                                       // 1942
            // Selection encompasses a single element                                                                  // 1943
            if (this.rangeSelectsSingleNode(range) && range.startContainer.childNodes[range.startOffset].nodeType !== 3) {
                return range.startContainer.childNodes[range.startOffset];                                             // 1945
            }                                                                                                          // 1946
                                                                                                                       // 1947
            // Selection range starts inside a text node, so get its parent                                            // 1948
            if (range.startContainer.nodeType === 3) {                                                                 // 1949
                return range.startContainer.parentNode;                                                                // 1950
            }                                                                                                          // 1951
                                                                                                                       // 1952
            // Selection starts inside an element                                                                      // 1953
            return range.startContainer;                                                                               // 1954
        },                                                                                                             // 1955
                                                                                                                       // 1956
        getSelectedElements: function (doc) {                                                                          // 1957
            var selection = doc.getSelection(),                                                                        // 1958
                range,                                                                                                 // 1959
                toRet,                                                                                                 // 1960
                currNode;                                                                                              // 1961
                                                                                                                       // 1962
            if (!selection.rangeCount || selection.isCollapsed || !selection.getRangeAt(0).commonAncestorContainer) {  // 1963
                return [];                                                                                             // 1964
            }                                                                                                          // 1965
                                                                                                                       // 1966
            range = selection.getRangeAt(0);                                                                           // 1967
                                                                                                                       // 1968
            if (range.commonAncestorContainer.nodeType === 3) {                                                        // 1969
                toRet = [];                                                                                            // 1970
                currNode = range.commonAncestorContainer;                                                              // 1971
                while (currNode.parentNode && currNode.parentNode.childNodes.length === 1) {                           // 1972
                    toRet.push(currNode.parentNode);                                                                   // 1973
                    currNode = currNode.parentNode;                                                                    // 1974
                }                                                                                                      // 1975
                                                                                                                       // 1976
                return toRet;                                                                                          // 1977
            }                                                                                                          // 1978
                                                                                                                       // 1979
            return [].filter.call(range.commonAncestorContainer.getElementsByTagName('*'), function (el) {             // 1980
                return (typeof selection.containsNode === 'function') ? selection.containsNode(el, true) : true;       // 1981
            });                                                                                                        // 1982
        },                                                                                                             // 1983
                                                                                                                       // 1984
        selectNode: function (node, doc) {                                                                             // 1985
            var range = doc.createRange(),                                                                             // 1986
                sel = doc.getSelection();                                                                              // 1987
                                                                                                                       // 1988
            range.selectNodeContents(node);                                                                            // 1989
            sel.removeAllRanges();                                                                                     // 1990
            sel.addRange(range);                                                                                       // 1991
        },                                                                                                             // 1992
                                                                                                                       // 1993
        select: function (doc, startNode, startOffset, endNode, endOffset) {                                           // 1994
            doc.getSelection().removeAllRanges();                                                                      // 1995
            var range = doc.createRange();                                                                             // 1996
            range.setStart(startNode, startOffset);                                                                    // 1997
            if (endNode) {                                                                                             // 1998
                range.setEnd(endNode, endOffset);                                                                      // 1999
            } else {                                                                                                   // 2000
                range.collapse(true);                                                                                  // 2001
            }                                                                                                          // 2002
            doc.getSelection().addRange(range);                                                                        // 2003
            return range;                                                                                              // 2004
        },                                                                                                             // 2005
                                                                                                                       // 2006
        /**                                                                                                            // 2007
         * Move cursor to the given node with the given offset.                                                        // 2008
         *                                                                                                             // 2009
         * @param  {DomDocument} doc     Current document                                                              // 2010
         * @param  {DomElement}  node    Element where to jump                                                         // 2011
         * @param  {integer}     offset  Where in the element should we jump, 0 by default                             // 2012
         */                                                                                                            // 2013
        moveCursor: function (doc, node, offset) {                                                                     // 2014
            this.select(doc, node, offset);                                                                            // 2015
        },                                                                                                             // 2016
                                                                                                                       // 2017
        getSelectionRange: function (ownerDocument) {                                                                  // 2018
            var selection = ownerDocument.getSelection();                                                              // 2019
            if (selection.rangeCount === 0) {                                                                          // 2020
                return null;                                                                                           // 2021
            }                                                                                                          // 2022
            return selection.getRangeAt(0);                                                                            // 2023
        },                                                                                                             // 2024
                                                                                                                       // 2025
        // http://stackoverflow.com/questions/1197401/how-can-i-get-the-element-the-caret-is-in-with-javascript-when-using-contentedi
        // by You                                                                                                      // 2027
        getSelectionStart: function (ownerDocument) {                                                                  // 2028
            var node = ownerDocument.getSelection().anchorNode,                                                        // 2029
                startNode = (node && node.nodeType === 3 ? node.parentNode : node);                                    // 2030
                                                                                                                       // 2031
            return startNode;                                                                                          // 2032
        }                                                                                                              // 2033
    };                                                                                                                 // 2034
                                                                                                                       // 2035
    MediumEditor.selection = Selection;                                                                                // 2036
}());                                                                                                                  // 2037
                                                                                                                       // 2038
(function () {                                                                                                         // 2039
    'use strict';                                                                                                      // 2040
                                                                                                                       // 2041
    var Events = function (instance) {                                                                                 // 2042
        this.base = instance;                                                                                          // 2043
        this.options = this.base.options;                                                                              // 2044
        this.events = [];                                                                                              // 2045
        this.disabledEvents = {};                                                                                      // 2046
        this.customEvents = {};                                                                                        // 2047
        this.listeners = {};                                                                                           // 2048
    };                                                                                                                 // 2049
                                                                                                                       // 2050
    Events.prototype = {                                                                                               // 2051
        InputEventOnContenteditableSupported: !MediumEditor.util.isIE,                                                 // 2052
                                                                                                                       // 2053
        // Helpers for event handling                                                                                  // 2054
                                                                                                                       // 2055
        attachDOMEvent: function (target, event, listener, useCapture) {                                               // 2056
            target.addEventListener(event, listener, useCapture);                                                      // 2057
            this.events.push([target, event, listener, useCapture]);                                                   // 2058
        },                                                                                                             // 2059
                                                                                                                       // 2060
        detachDOMEvent: function (target, event, listener, useCapture) {                                               // 2061
            var index = this.indexOfListener(target, event, listener, useCapture),                                     // 2062
                e;                                                                                                     // 2063
            if (index !== -1) {                                                                                        // 2064
                e = this.events.splice(index, 1)[0];                                                                   // 2065
                e[0].removeEventListener(e[1], e[2], e[3]);                                                            // 2066
            }                                                                                                          // 2067
        },                                                                                                             // 2068
                                                                                                                       // 2069
        indexOfListener: function (target, event, listener, useCapture) {                                              // 2070
            var i, n, item;                                                                                            // 2071
            for (i = 0, n = this.events.length; i < n; i = i + 1) {                                                    // 2072
                item = this.events[i];                                                                                 // 2073
                if (item[0] === target && item[1] === event && item[2] === listener && item[3] === useCapture) {       // 2074
                    return i;                                                                                          // 2075
                }                                                                                                      // 2076
            }                                                                                                          // 2077
            return -1;                                                                                                 // 2078
        },                                                                                                             // 2079
                                                                                                                       // 2080
        detachAllDOMEvents: function () {                                                                              // 2081
            var e = this.events.pop();                                                                                 // 2082
            while (e) {                                                                                                // 2083
                e[0].removeEventListener(e[1], e[2], e[3]);                                                            // 2084
                e = this.events.pop();                                                                                 // 2085
            }                                                                                                          // 2086
        },                                                                                                             // 2087
                                                                                                                       // 2088
        enableCustomEvent: function (event) {                                                                          // 2089
            if (this.disabledEvents[event] !== undefined) {                                                            // 2090
                delete this.disabledEvents[event];                                                                     // 2091
            }                                                                                                          // 2092
        },                                                                                                             // 2093
                                                                                                                       // 2094
        disableCustomEvent: function (event) {                                                                         // 2095
            this.disabledEvents[event] = true;                                                                         // 2096
        },                                                                                                             // 2097
                                                                                                                       // 2098
        // custom events                                                                                               // 2099
        attachCustomEvent: function (event, listener) {                                                                // 2100
            this.setupListener(event);                                                                                 // 2101
            if (!this.customEvents[event]) {                                                                           // 2102
                this.customEvents[event] = [];                                                                         // 2103
            }                                                                                                          // 2104
            this.customEvents[event].push(listener);                                                                   // 2105
        },                                                                                                             // 2106
                                                                                                                       // 2107
        detachCustomEvent: function (event, listener) {                                                                // 2108
            var index = this.indexOfCustomListener(event, listener);                                                   // 2109
            if (index !== -1) {                                                                                        // 2110
                this.customEvents[event].splice(index, 1);                                                             // 2111
                // TODO: If array is empty, should detach internal listeners via destroyListener()                     // 2112
            }                                                                                                          // 2113
        },                                                                                                             // 2114
                                                                                                                       // 2115
        indexOfCustomListener: function (event, listener) {                                                            // 2116
            if (!this.customEvents[event] || !this.customEvents[event].length) {                                       // 2117
                return -1;                                                                                             // 2118
            }                                                                                                          // 2119
                                                                                                                       // 2120
            return this.customEvents[event].indexOf(listener);                                                         // 2121
        },                                                                                                             // 2122
                                                                                                                       // 2123
        detachAllCustomEvents: function () {                                                                           // 2124
            this.customEvents = {};                                                                                    // 2125
            // TODO: Should detach internal listeners here via destroyListener()                                       // 2126
        },                                                                                                             // 2127
                                                                                                                       // 2128
        triggerCustomEvent: function (name, data, editable) {                                                          // 2129
            if (this.customEvents[name] && !this.disabledEvents[name]) {                                               // 2130
                this.customEvents[name].forEach(function (listener) {                                                  // 2131
                    listener(data, editable);                                                                          // 2132
                });                                                                                                    // 2133
            }                                                                                                          // 2134
        },                                                                                                             // 2135
                                                                                                                       // 2136
        // Cleaning up                                                                                                 // 2137
                                                                                                                       // 2138
        destroy: function () {                                                                                         // 2139
            this.detachAllDOMEvents();                                                                                 // 2140
            this.detachAllCustomEvents();                                                                              // 2141
            this.detachExecCommand();                                                                                  // 2142
                                                                                                                       // 2143
            if (this.base.elements) {                                                                                  // 2144
                this.base.elements.forEach(function (element) {                                                        // 2145
                    element.removeAttribute('data-medium-focused');                                                    // 2146
                });                                                                                                    // 2147
            }                                                                                                          // 2148
        },                                                                                                             // 2149
                                                                                                                       // 2150
        // Listening to calls to document.execCommand                                                                  // 2151
                                                                                                                       // 2152
        // Attach a listener to be notified when document.execCommand is called                                        // 2153
        attachToExecCommand: function () {                                                                             // 2154
            if (this.execCommandListener) {                                                                            // 2155
                return;                                                                                                // 2156
            }                                                                                                          // 2157
                                                                                                                       // 2158
            // Store an instance of the listener so:                                                                   // 2159
            // 1) We only attach to execCommand once                                                                   // 2160
            // 2) We can remove the listener later                                                                     // 2161
            this.execCommandListener = function (execInfo) {                                                           // 2162
                this.handleDocumentExecCommand(execInfo);                                                              // 2163
            }.bind(this);                                                                                              // 2164
                                                                                                                       // 2165
            // Ensure that execCommand has been wrapped correctly                                                      // 2166
            this.wrapExecCommand();                                                                                    // 2167
                                                                                                                       // 2168
            // Add listener to list of execCommand listeners                                                           // 2169
            this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener);                           // 2170
        },                                                                                                             // 2171
                                                                                                                       // 2172
        // Remove our listener for calls to document.execCommand                                                       // 2173
        detachExecCommand: function () {                                                                               // 2174
            var doc = this.options.ownerDocument;                                                                      // 2175
            if (!this.execCommandListener || !doc.execCommand.listeners) {                                             // 2176
                return;                                                                                                // 2177
            }                                                                                                          // 2178
                                                                                                                       // 2179
            // Find the index of this listener in the array of listeners so it can be removed                          // 2180
            var index = doc.execCommand.listeners.indexOf(this.execCommandListener);                                   // 2181
            if (index !== -1) {                                                                                        // 2182
                doc.execCommand.listeners.splice(index, 1);                                                            // 2183
            }                                                                                                          // 2184
                                                                                                                       // 2185
            // If the list of listeners is now empty, put execCommand back to its original state                       // 2186
            if (!doc.execCommand.listeners.length) {                                                                   // 2187
                this.unwrapExecCommand();                                                                              // 2188
            }                                                                                                          // 2189
        },                                                                                                             // 2190
                                                                                                                       // 2191
        // Wrap document.execCommand in a custom method so we can listen to calls to it                                // 2192
        wrapExecCommand: function () {                                                                                 // 2193
            var doc = this.options.ownerDocument;                                                                      // 2194
                                                                                                                       // 2195
            // Ensure all instance of MediumEditor only wrap execCommand once                                          // 2196
            if (doc.execCommand.listeners) {                                                                           // 2197
                return;                                                                                                // 2198
            }                                                                                                          // 2199
                                                                                                                       // 2200
            // Create a wrapper method for execCommand which will:                                                     // 2201
            // 1) Call document.execCommand with the correct arguments                                                 // 2202
            // 2) Loop through any listeners and notify them that execCommand was called                               // 2203
            //    passing extra info on the call                                                                       // 2204
            // 3) Return the result                                                                                    // 2205
            var wrapper = function (aCommandName, aShowDefaultUI, aValueArgument) {                                    // 2206
                var result = doc.execCommand.orig.apply(this, arguments);                                              // 2207
                                                                                                                       // 2208
                if (!doc.execCommand.listeners) {                                                                      // 2209
                    return result;                                                                                     // 2210
                }                                                                                                      // 2211
                                                                                                                       // 2212
                var args = Array.prototype.slice.call(arguments);                                                      // 2213
                doc.execCommand.listeners.forEach(function (listener) {                                                // 2214
                    listener({                                                                                         // 2215
                        command: aCommandName,                                                                         // 2216
                        value: aValueArgument,                                                                         // 2217
                        args: args,                                                                                    // 2218
                        result: result                                                                                 // 2219
                    });                                                                                                // 2220
                });                                                                                                    // 2221
                                                                                                                       // 2222
                return result;                                                                                         // 2223
            };                                                                                                         // 2224
                                                                                                                       // 2225
            // Store a reference to the original execCommand                                                           // 2226
            wrapper.orig = doc.execCommand;                                                                            // 2227
                                                                                                                       // 2228
            // Attach an array for storing listeners                                                                   // 2229
            wrapper.listeners = [];                                                                                    // 2230
                                                                                                                       // 2231
            // Overwrite execCommand                                                                                   // 2232
            doc.execCommand = wrapper;                                                                                 // 2233
        },                                                                                                             // 2234
                                                                                                                       // 2235
        // Revert document.execCommand back to its original self                                                       // 2236
        unwrapExecCommand: function () {                                                                               // 2237
            var doc = this.options.ownerDocument;                                                                      // 2238
            if (!doc.execCommand.orig) {                                                                               // 2239
                return;                                                                                                // 2240
            }                                                                                                          // 2241
                                                                                                                       // 2242
            // Use the reference to the original execCommand to revert back                                            // 2243
            doc.execCommand = doc.execCommand.orig;                                                                    // 2244
        },                                                                                                             // 2245
                                                                                                                       // 2246
        // Listening to browser events to emit events medium-editor cares about                                        // 2247
        setupListener: function (name) {                                                                               // 2248
            if (this.listeners[name]) {                                                                                // 2249
                return;                                                                                                // 2250
            }                                                                                                          // 2251
                                                                                                                       // 2252
            switch (name) {                                                                                            // 2253
                case 'externalInteraction':                                                                            // 2254
                    // Detecting when user has interacted with elements outside of MediumEditor                        // 2255
                    this.attachDOMEvent(this.options.ownerDocument.body, 'mousedown', this.handleBodyMousedown.bind(this), true);
                    this.attachDOMEvent(this.options.ownerDocument.body, 'click', this.handleBodyClick.bind(this), true);
                    this.attachDOMEvent(this.options.ownerDocument.body, 'focus', this.handleBodyFocus.bind(this), true);
                    break;                                                                                             // 2259
                case 'blur':                                                                                           // 2260
                    // Detecting when focus is lost                                                                    // 2261
                    this.setupListener('externalInteraction');                                                         // 2262
                    break;                                                                                             // 2263
                case 'focus':                                                                                          // 2264
                    // Detecting when focus moves into some part of MediumEditor                                       // 2265
                    this.setupListener('externalInteraction');                                                         // 2266
                    break;                                                                                             // 2267
                case 'editableInput':                                                                                  // 2268
                    // setup cache for knowing when the content has changed                                            // 2269
                    this.contentCache = [];                                                                            // 2270
                    this.base.elements.forEach(function (element) {                                                    // 2271
                        this.contentCache[element.getAttribute('medium-editor-index')] = element.innerHTML;            // 2272
                                                                                                                       // 2273
                        // Attach to the 'oninput' event, handled correctly by most browsers                           // 2274
                        if (this.InputEventOnContenteditableSupported) {                                               // 2275
                            this.attachDOMEvent(element, 'input', this.handleInput.bind(this));                        // 2276
                        }                                                                                              // 2277
                    }.bind(this));                                                                                     // 2278
                                                                                                                       // 2279
                    // For browsers which don't support the input event on contenteditable (IE)                        // 2280
                    // we'll attach to 'selectionchange' on the document and 'keypress' on the editables               // 2281
                    if (!this.InputEventOnContenteditableSupported) {                                                  // 2282
                        this.setupListener('editableKeypress');                                                        // 2283
                        this.keypressUpdateInput = true;                                                               // 2284
                        this.attachDOMEvent(document, 'selectionchange', this.handleDocumentSelectionChange.bind(this));
                        // Listen to calls to execCommand                                                              // 2286
                        this.attachToExecCommand();                                                                    // 2287
                    }                                                                                                  // 2288
                    break;                                                                                             // 2289
                case 'editableClick':                                                                                  // 2290
                    // Detecting click in the contenteditables                                                         // 2291
                    this.attachToEachElement('click', this.handleClick);                                               // 2292
                    break;                                                                                             // 2293
                case 'editableBlur':                                                                                   // 2294
                    // Detecting blur in the contenteditables                                                          // 2295
                    this.attachToEachElement('blur', this.handleBlur);                                                 // 2296
                    break;                                                                                             // 2297
                case 'editableKeypress':                                                                               // 2298
                    // Detecting keypress in the contenteditables                                                      // 2299
                    this.attachToEachElement('keypress', this.handleKeypress);                                         // 2300
                    break;                                                                                             // 2301
                case 'editableKeyup':                                                                                  // 2302
                    // Detecting keyup in the contenteditables                                                         // 2303
                    this.attachToEachElement('keyup', this.handleKeyup);                                               // 2304
                    break;                                                                                             // 2305
                case 'editableKeydown':                                                                                // 2306
                    // Detecting keydown on the contenteditables                                                       // 2307
                    this.attachToEachElement('keydown', this.handleKeydown);                                           // 2308
                    break;                                                                                             // 2309
                case 'editableKeydownEnter':                                                                           // 2310
                    // Detecting keydown for ENTER on the contenteditables                                             // 2311
                    this.setupListener('editableKeydown');                                                             // 2312
                    break;                                                                                             // 2313
                case 'editableKeydownTab':                                                                             // 2314
                    // Detecting keydown for TAB on the contenteditable                                                // 2315
                    this.setupListener('editableKeydown');                                                             // 2316
                    break;                                                                                             // 2317
                case 'editableKeydownDelete':                                                                          // 2318
                    // Detecting keydown for DELETE/BACKSPACE on the contenteditables                                  // 2319
                    this.setupListener('editableKeydown');                                                             // 2320
                    break;                                                                                             // 2321
                case 'editableMouseover':                                                                              // 2322
                    // Detecting mouseover on the contenteditables                                                     // 2323
                    this.attachToEachElement('mouseover', this.handleMouseover);                                       // 2324
                    break;                                                                                             // 2325
                case 'editableDrag':                                                                                   // 2326
                    // Detecting dragover and dragleave on the contenteditables                                        // 2327
                    this.attachToEachElement('dragover', this.handleDragging);                                         // 2328
                    this.attachToEachElement('dragleave', this.handleDragging);                                        // 2329
                    break;                                                                                             // 2330
                case 'editableDrop':                                                                                   // 2331
                    // Detecting drop on the contenteditables                                                          // 2332
                    this.attachToEachElement('drop', this.handleDrop);                                                 // 2333
                    break;                                                                                             // 2334
                case 'editablePaste':                                                                                  // 2335
                    // Detecting paste on the contenteditables                                                         // 2336
                    this.attachToEachElement('paste', this.handlePaste);                                               // 2337
                    break;                                                                                             // 2338
            }                                                                                                          // 2339
            this.listeners[name] = true;                                                                               // 2340
        },                                                                                                             // 2341
                                                                                                                       // 2342
        attachToEachElement: function (name, handler) {                                                                // 2343
            this.base.elements.forEach(function (element) {                                                            // 2344
                this.attachDOMEvent(element, name, handler.bind(this));                                                // 2345
            }, this);                                                                                                  // 2346
        },                                                                                                             // 2347
                                                                                                                       // 2348
        focusElement: function (element) {                                                                             // 2349
            element.focus();                                                                                           // 2350
            this.updateFocus(element, { target: element, type: 'focus' });                                             // 2351
        },                                                                                                             // 2352
                                                                                                                       // 2353
        updateFocus: function (target, eventObj) {                                                                     // 2354
            var toolbar = this.base.getExtensionByName('toolbar'),                                                     // 2355
                toolbarEl = toolbar ? toolbar.getToolbarElement() : null,                                              // 2356
                anchorPreview = this.base.getExtensionByName('anchor-preview'),                                        // 2357
                previewEl = (anchorPreview && anchorPreview.getPreviewElement) ? anchorPreview.getPreviewElement() : null,
                hadFocus = this.base.getFocusedElement(),                                                              // 2359
                toFocus;                                                                                               // 2360
                                                                                                                       // 2361
            // For clicks, we need to know if the mousedown that caused the click happened inside the existing focused element.
            // If so, we don't want to focus another element                                                           // 2363
            if (hadFocus &&                                                                                            // 2364
                    eventObj.type === 'click' &&                                                                       // 2365
                    this.lastMousedownTarget &&                                                                        // 2366
                    (MediumEditor.util.isDescendant(hadFocus, this.lastMousedownTarget, true) ||                       // 2367
                     MediumEditor.util.isDescendant(toolbarEl, this.lastMousedownTarget, true) ||                      // 2368
                     MediumEditor.util.isDescendant(previewEl, this.lastMousedownTarget, true))) {                     // 2369
                toFocus = hadFocus;                                                                                    // 2370
            }                                                                                                          // 2371
                                                                                                                       // 2372
            if (!toFocus) {                                                                                            // 2373
                this.base.elements.some(function (element) {                                                           // 2374
                    // If the target is part of an editor element, this is the element getting focus                   // 2375
                    if (!toFocus && (MediumEditor.util.isDescendant(element, target, true))) {                         // 2376
                        toFocus = element;                                                                             // 2377
                    }                                                                                                  // 2378
                                                                                                                       // 2379
                    // bail if we found an element that's getting focus                                                // 2380
                    return !!toFocus;                                                                                  // 2381
                }, this);                                                                                              // 2382
            }                                                                                                          // 2383
                                                                                                                       // 2384
            // Check if the target is external (not part of the editor, toolbar, or anchorpreview)                     // 2385
            var externalEvent = !MediumEditor.util.isDescendant(hadFocus, target, true) &&                             // 2386
                                !MediumEditor.util.isDescendant(toolbarEl, target, true) &&                            // 2387
                                !MediumEditor.util.isDescendant(previewEl, target, true);                              // 2388
                                                                                                                       // 2389
            if (toFocus !== hadFocus) {                                                                                // 2390
                // If element has focus, and focus is going outside of editor                                          // 2391
                // Don't blur focused element if clicking on editor, toolbar, or anchorpreview                         // 2392
                if (hadFocus && externalEvent) {                                                                       // 2393
                    // Trigger blur on the editable that has lost focus                                                // 2394
                    hadFocus.removeAttribute('data-medium-focused');                                                   // 2395
                    this.triggerCustomEvent('blur', eventObj, hadFocus);                                               // 2396
                }                                                                                                      // 2397
                                                                                                                       // 2398
                // If focus is going into an editor element                                                            // 2399
                if (toFocus) {                                                                                         // 2400
                    // Trigger focus on the editable that now has focus                                                // 2401
                    toFocus.setAttribute('data-medium-focused', true);                                                 // 2402
                    this.triggerCustomEvent('focus', eventObj, toFocus);                                               // 2403
                }                                                                                                      // 2404
            }                                                                                                          // 2405
                                                                                                                       // 2406
            if (externalEvent) {                                                                                       // 2407
                this.triggerCustomEvent('externalInteraction', eventObj);                                              // 2408
            }                                                                                                          // 2409
        },                                                                                                             // 2410
                                                                                                                       // 2411
        updateInput: function (target, eventObj) {                                                                     // 2412
            if (!this.contentCache) {                                                                                  // 2413
                return;                                                                                                // 2414
            }                                                                                                          // 2415
            // An event triggered which signifies that the user may have changed someting                              // 2416
            // Look in our cache of input for the contenteditables to see if something changed                         // 2417
            var index = target.getAttribute('medium-editor-index');                                                    // 2418
            if (target.innerHTML !== this.contentCache[index]) {                                                       // 2419
                // The content has changed since the last time we checked, fire the event                              // 2420
                this.triggerCustomEvent('editableInput', eventObj, target);                                            // 2421
            }                                                                                                          // 2422
            this.contentCache[index] = target.innerHTML;                                                               // 2423
        },                                                                                                             // 2424
                                                                                                                       // 2425
        handleDocumentSelectionChange: function (event) {                                                              // 2426
            // When selectionchange fires, target and current target are set                                           // 2427
            // to document, since this is where the event is handled                                                   // 2428
            // However, currentTarget will have an 'activeElement' property                                            // 2429
            // which will point to whatever element has focus.                                                         // 2430
            if (event.currentTarget && event.currentTarget.activeElement) {                                            // 2431
                var activeElement = event.currentTarget.activeElement,                                                 // 2432
                    currentTarget;                                                                                     // 2433
                // We can look at the 'activeElement' to determine if the selectionchange has                          // 2434
                // happened within a contenteditable owned by this instance of MediumEditor                            // 2435
                this.base.elements.some(function (element) {                                                           // 2436
                    if (MediumEditor.util.isDescendant(element, activeElement, true)) {                                // 2437
                        currentTarget = element;                                                                       // 2438
                        return true;                                                                                   // 2439
                    }                                                                                                  // 2440
                    return false;                                                                                      // 2441
                }, this);                                                                                              // 2442
                                                                                                                       // 2443
                // We know selectionchange fired within one of our contenteditables                                    // 2444
                if (currentTarget) {                                                                                   // 2445
                    this.updateInput(currentTarget, { target: activeElement, currentTarget: currentTarget });          // 2446
                }                                                                                                      // 2447
            }                                                                                                          // 2448
        },                                                                                                             // 2449
                                                                                                                       // 2450
        handleDocumentExecCommand: function () {                                                                       // 2451
            // document.execCommand has been called                                                                    // 2452
            // If one of our contenteditables currently has focus, we should                                           // 2453
            // attempt to trigger the 'editableInput' event                                                            // 2454
            var target = this.base.getFocusedElement();                                                                // 2455
            if (target) {                                                                                              // 2456
                this.updateInput(target, { target: target, currentTarget: target });                                   // 2457
            }                                                                                                          // 2458
        },                                                                                                             // 2459
                                                                                                                       // 2460
        handleBodyClick: function (event) {                                                                            // 2461
            this.updateFocus(event.target, event);                                                                     // 2462
        },                                                                                                             // 2463
                                                                                                                       // 2464
        handleBodyFocus: function (event) {                                                                            // 2465
            this.updateFocus(event.target, event);                                                                     // 2466
        },                                                                                                             // 2467
                                                                                                                       // 2468
        handleBodyMousedown: function (event) {                                                                        // 2469
            this.lastMousedownTarget = event.target;                                                                   // 2470
        },                                                                                                             // 2471
                                                                                                                       // 2472
        handleInput: function (event) {                                                                                // 2473
            this.updateInput(event.currentTarget, event);                                                              // 2474
        },                                                                                                             // 2475
                                                                                                                       // 2476
        handleClick: function (event) {                                                                                // 2477
            this.triggerCustomEvent('editableClick', event, event.currentTarget);                                      // 2478
        },                                                                                                             // 2479
                                                                                                                       // 2480
        handleBlur: function (event) {                                                                                 // 2481
            this.triggerCustomEvent('editableBlur', event, event.currentTarget);                                       // 2482
        },                                                                                                             // 2483
                                                                                                                       // 2484
        handleKeypress: function (event) {                                                                             // 2485
            this.triggerCustomEvent('editableKeypress', event, event.currentTarget);                                   // 2486
                                                                                                                       // 2487
            // If we're doing manual detection of the editableInput event we need                                      // 2488
            // to check for input changes during 'keypress'                                                            // 2489
            if (this.keypressUpdateInput) {                                                                            // 2490
                var eventObj = { target: event.target, currentTarget: event.currentTarget };                           // 2491
                                                                                                                       // 2492
                // In IE, we need to let the rest of the event stack complete before we detect                         // 2493
                // changes to input, so using setTimeout here                                                          // 2494
                setTimeout(function () {                                                                               // 2495
                    this.updateInput(eventObj.currentTarget, eventObj);                                                // 2496
                }.bind(this), 0);                                                                                      // 2497
            }                                                                                                          // 2498
        },                                                                                                             // 2499
                                                                                                                       // 2500
        handleKeyup: function (event) {                                                                                // 2501
            this.triggerCustomEvent('editableKeyup', event, event.currentTarget);                                      // 2502
        },                                                                                                             // 2503
                                                                                                                       // 2504
        handleMouseover: function (event) {                                                                            // 2505
            this.triggerCustomEvent('editableMouseover', event, event.currentTarget);                                  // 2506
        },                                                                                                             // 2507
                                                                                                                       // 2508
        handleDragging: function (event) {                                                                             // 2509
            this.triggerCustomEvent('editableDrag', event, event.currentTarget);                                       // 2510
        },                                                                                                             // 2511
                                                                                                                       // 2512
        handleDrop: function (event) {                                                                                 // 2513
            this.triggerCustomEvent('editableDrop', event, event.currentTarget);                                       // 2514
        },                                                                                                             // 2515
                                                                                                                       // 2516
        handlePaste: function (event) {                                                                                // 2517
            this.triggerCustomEvent('editablePaste', event, event.currentTarget);                                      // 2518
        },                                                                                                             // 2519
                                                                                                                       // 2520
        handleKeydown: function (event) {                                                                              // 2521
            this.triggerCustomEvent('editableKeydown', event, event.currentTarget);                                    // 2522
                                                                                                                       // 2523
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER) || (event.ctrlKey && MediumEditor.util.isKey(event, MediumEditor.util.keyCode.M))) {
                return this.triggerCustomEvent('editableKeydownEnter', event, event.currentTarget);                    // 2525
            }                                                                                                          // 2526
                                                                                                                       // 2527
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.TAB)) {                                       // 2528
                return this.triggerCustomEvent('editableKeydownTab', event, event.currentTarget);                      // 2529
            }                                                                                                          // 2530
                                                                                                                       // 2531
            if (MediumEditor.util.isKey(event, [MediumEditor.util.keyCode.DELETE, MediumEditor.util.keyCode.BACKSPACE])) {
                return this.triggerCustomEvent('editableKeydownDelete', event, event.currentTarget);                   // 2533
            }                                                                                                          // 2534
        }                                                                                                              // 2535
    };                                                                                                                 // 2536
                                                                                                                       // 2537
    MediumEditor.Events = Events;                                                                                      // 2538
}());                                                                                                                  // 2539
                                                                                                                       // 2540
(function () {                                                                                                         // 2541
    'use strict';                                                                                                      // 2542
                                                                                                                       // 2543
    var Button = MediumEditor.Extension.extend({                                                                       // 2544
                                                                                                                       // 2545
        /* Button Options */                                                                                           // 2546
                                                                                                                       // 2547
        /* action: [string]                                                                                            // 2548
         * The action argument to pass to MediumEditor.execAction()                                                    // 2549
         * when the button is clicked                                                                                  // 2550
         */                                                                                                            // 2551
        action: undefined,                                                                                             // 2552
                                                                                                                       // 2553
        /* aria: [string]                                                                                              // 2554
         * The value to add as the aria-label attribute of the button                                                  // 2555
         * element displayed in the toolbar.                                                                           // 2556
         * This is also used as the tooltip for the button                                                             // 2557
         */                                                                                                            // 2558
        aria: undefined,                                                                                               // 2559
                                                                                                                       // 2560
        /* tagNames: [Array]                                                                                           // 2561
         * NOTE: This is not used if useQueryState is set to true.                                                     // 2562
         *                                                                                                             // 2563
         * Array of element tag names that would indicate that this                                                    // 2564
         * button has already been applied. If this action has already                                                 // 2565
         * been applied, the button will be displayed as 'active' in the toolbar                                       // 2566
         *                                                                                                             // 2567
         * Example:                                                                                                    // 2568
         * For 'bold', if the text is ever within a <b> or <strong>                                                    // 2569
         * tag that indicates the text is already bold. So the array                                                   // 2570
         * of tagNames for bold would be: ['b', 'strong']                                                              // 2571
         */                                                                                                            // 2572
        tagNames: undefined,                                                                                           // 2573
                                                                                                                       // 2574
        /* style: [Object]                                                                                             // 2575
         * NOTE: This is not used if useQueryState is set to true.                                                     // 2576
         *                                                                                                             // 2577
         * A pair of css property & value(s) that indicate that this                                                   // 2578
         * button has already been applied. If this action has already                                                 // 2579
         * been applied, the button will be displayed as 'active' in the toolbar                                       // 2580
         * Properties of the object:                                                                                   // 2581
         *   prop [String]: name of the css property                                                                   // 2582
         *   value [String]: value(s) of the css property                                                              // 2583
         *                   multiple values can be separated by a '|'                                                 // 2584
         *                                                                                                             // 2585
         * Example:                                                                                                    // 2586
         * For 'bold', if the text is ever within an element with a 'font-weight'                                      // 2587
         * style property set to '700' or 'bold', that indicates the text                                              // 2588
         * is already bold.  So the style object for bold would be:                                                    // 2589
         * { prop: 'font-weight', value: '700|bold' }                                                                  // 2590
         */                                                                                                            // 2591
        style: undefined,                                                                                              // 2592
                                                                                                                       // 2593
        /* useQueryState: [boolean]                                                                                    // 2594
         * Enables/disables whether this button should use the built-in                                                // 2595
         * document.queryCommandState() method to determine whether                                                    // 2596
         * the action has already been applied.  If the action has already                                             // 2597
         * been applied, the button will be displayed as 'active' in the toolbar                                       // 2598
         *                                                                                                             // 2599
         * Example:                                                                                                    // 2600
         * For 'bold', if this is set to true, the code will call:                                                     // 2601
         * document.queryCommandState('bold') which will return true if the                                            // 2602
         * browser thinks the text is already bold, and false otherwise                                                // 2603
         */                                                                                                            // 2604
        useQueryState: undefined,                                                                                      // 2605
                                                                                                                       // 2606
        /* contentDefault: [string]                                                                                    // 2607
         * Default innerHTML to put inside the button                                                                  // 2608
         */                                                                                                            // 2609
        contentDefault: undefined,                                                                                     // 2610
                                                                                                                       // 2611
        /* contentFA: [string]                                                                                         // 2612
         * The innerHTML to use for the content of the button                                                          // 2613
         * if the `buttonLabels` option for MediumEditor is set to 'fontawesome'                                       // 2614
         */                                                                                                            // 2615
        contentFA: undefined,                                                                                          // 2616
                                                                                                                       // 2617
        /* classList: [Array]                                                                                          // 2618
         * An array of classNames (strings) to be added to the button                                                  // 2619
         */                                                                                                            // 2620
        classList: undefined,                                                                                          // 2621
                                                                                                                       // 2622
        /* attrs: [object]                                                                                             // 2623
         * A set of key-value pairs to add to the button as custom attributes                                          // 2624
         */                                                                                                            // 2625
        attrs: undefined,                                                                                              // 2626
                                                                                                                       // 2627
        // The button constructor can optionally accept the name of a built-in button                                  // 2628
        // (ie 'bold', 'italic', etc.)                                                                                 // 2629
        // When the name of a button is passed, it will initialize itself with the                                     // 2630
        // configuration for that button                                                                               // 2631
        constructor: function (options) {                                                                              // 2632
            if (Button.isBuiltInButton(options)) {                                                                     // 2633
                MediumEditor.Extension.call(this, this.defaults[options]);                                             // 2634
            } else {                                                                                                   // 2635
                MediumEditor.Extension.call(this, options);                                                            // 2636
            }                                                                                                          // 2637
        },                                                                                                             // 2638
                                                                                                                       // 2639
        init: function () {                                                                                            // 2640
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 2641
                                                                                                                       // 2642
            this.button = this.createButton();                                                                         // 2643
            this.on(this.button, 'click', this.handleClick.bind(this));                                                // 2644
        },                                                                                                             // 2645
                                                                                                                       // 2646
        /* getButton: [function ()]                                                                                    // 2647
         *                                                                                                             // 2648
         * If implemented, this function will be called when                                                           // 2649
         * the toolbar is being created.  The DOM Element returned                                                     // 2650
         * by this function will be appended to the toolbar along                                                      // 2651
         * with any other buttons.                                                                                     // 2652
         */                                                                                                            // 2653
        getButton: function () {                                                                                       // 2654
            return this.button;                                                                                        // 2655
        },                                                                                                             // 2656
                                                                                                                       // 2657
        getAction: function () {                                                                                       // 2658
            return (typeof this.action === 'function') ? this.action(this.base.options) : this.action;                 // 2659
        },                                                                                                             // 2660
                                                                                                                       // 2661
        getAria: function () {                                                                                         // 2662
            return (typeof this.aria === 'function') ? this.aria(this.base.options) : this.aria;                       // 2663
        },                                                                                                             // 2664
                                                                                                                       // 2665
        getTagNames: function () {                                                                                     // 2666
            return (typeof this.tagNames === 'function') ? this.tagNames(this.base.options) : this.tagNames;           // 2667
        },                                                                                                             // 2668
                                                                                                                       // 2669
        createButton: function () {                                                                                    // 2670
            var button = this.document.createElement('button'),                                                        // 2671
                content = this.contentDefault,                                                                         // 2672
                ariaLabel = this.getAria(),                                                                            // 2673
                buttonLabels = this.getEditorOption('buttonLabels');                                                   // 2674
            // Add class names                                                                                         // 2675
            button.classList.add('medium-editor-action');                                                              // 2676
            button.classList.add('medium-editor-action-' + this.name);                                                 // 2677
            if (this.classList) {                                                                                      // 2678
                this.classList.forEach(function (className) {                                                          // 2679
                    button.classList.add(className);                                                                   // 2680
                });                                                                                                    // 2681
            }                                                                                                          // 2682
                                                                                                                       // 2683
            // Add attributes                                                                                          // 2684
            button.setAttribute('data-action', this.getAction());                                                      // 2685
            if (ariaLabel) {                                                                                           // 2686
                button.setAttribute('title', ariaLabel);                                                               // 2687
                button.setAttribute('aria-label', ariaLabel);                                                          // 2688
            }                                                                                                          // 2689
            if (this.attrs) {                                                                                          // 2690
                Object.keys(this.attrs).forEach(function (attr) {                                                      // 2691
                    button.setAttribute(attr, this.attrs[attr]);                                                       // 2692
                }, this);                                                                                              // 2693
            }                                                                                                          // 2694
                                                                                                                       // 2695
            if (buttonLabels === 'fontawesome' && this.contentFA) {                                                    // 2696
                content = this.contentFA;                                                                              // 2697
            }                                                                                                          // 2698
            button.innerHTML = content;                                                                                // 2699
            return button;                                                                                             // 2700
        },                                                                                                             // 2701
                                                                                                                       // 2702
        handleClick: function (event) {                                                                                // 2703
            event.preventDefault();                                                                                    // 2704
            event.stopPropagation();                                                                                   // 2705
                                                                                                                       // 2706
            var action = this.getAction();                                                                             // 2707
                                                                                                                       // 2708
            if (action) {                                                                                              // 2709
                this.execAction(action);                                                                               // 2710
            }                                                                                                          // 2711
        },                                                                                                             // 2712
                                                                                                                       // 2713
        isActive: function () {                                                                                        // 2714
            return this.button.classList.contains(this.getEditorOption('activeButtonClass'));                          // 2715
        },                                                                                                             // 2716
                                                                                                                       // 2717
        setInactive: function () {                                                                                     // 2718
            this.button.classList.remove(this.getEditorOption('activeButtonClass'));                                   // 2719
            delete this.knownState;                                                                                    // 2720
        },                                                                                                             // 2721
                                                                                                                       // 2722
        setActive: function () {                                                                                       // 2723
            this.button.classList.add(this.getEditorOption('activeButtonClass'));                                      // 2724
            delete this.knownState;                                                                                    // 2725
        },                                                                                                             // 2726
                                                                                                                       // 2727
        queryCommandState: function () {                                                                               // 2728
            var queryState = null;                                                                                     // 2729
            if (this.useQueryState) {                                                                                  // 2730
                queryState = this.base.queryCommandState(this.getAction());                                            // 2731
            }                                                                                                          // 2732
            return queryState;                                                                                         // 2733
        },                                                                                                             // 2734
                                                                                                                       // 2735
        isAlreadyApplied: function (node) {                                                                            // 2736
            var isMatch = false,                                                                                       // 2737
                tagNames = this.getTagNames(),                                                                         // 2738
                styleVals,                                                                                             // 2739
                computedStyle;                                                                                         // 2740
                                                                                                                       // 2741
            if (this.knownState === false || this.knownState === true) {                                               // 2742
                return this.knownState;                                                                                // 2743
            }                                                                                                          // 2744
                                                                                                                       // 2745
            if (tagNames && tagNames.length > 0) {                                                                     // 2746
                isMatch = tagNames.indexOf(node.nodeName.toLowerCase()) !== -1;                                        // 2747
            }                                                                                                          // 2748
                                                                                                                       // 2749
            if (!isMatch && this.style) {                                                                              // 2750
                styleVals = this.style.value.split('|');                                                               // 2751
                computedStyle = this.window.getComputedStyle(node, null).getPropertyValue(this.style.prop);            // 2752
                styleVals.forEach(function (val) {                                                                     // 2753
                    if (!this.knownState) {                                                                            // 2754
                        isMatch = (computedStyle.indexOf(val) !== -1);                                                 // 2755
                        // text-decoration is not inherited by default                                                 // 2756
                        // so if the computed style for text-decoration doesn't match                                  // 2757
                        // don't write to knownState so we can fallback to other checks                                // 2758
                        if (isMatch || this.style.prop !== 'text-decoration') {                                        // 2759
                            this.knownState = isMatch;                                                                 // 2760
                        }                                                                                              // 2761
                    }                                                                                                  // 2762
                }, this);                                                                                              // 2763
            }                                                                                                          // 2764
                                                                                                                       // 2765
            return isMatch;                                                                                            // 2766
        }                                                                                                              // 2767
    });                                                                                                                // 2768
                                                                                                                       // 2769
    Button.isBuiltInButton = function (name) {                                                                         // 2770
        return (typeof name === 'string') && MediumEditor.extensions.button.prototype.defaults.hasOwnProperty(name);   // 2771
    };                                                                                                                 // 2772
                                                                                                                       // 2773
    MediumEditor.extensions.button = Button;                                                                           // 2774
}());                                                                                                                  // 2775
                                                                                                                       // 2776
(function () {                                                                                                         // 2777
    'use strict';                                                                                                      // 2778
                                                                                                                       // 2779
    /* MediumEditor.extensions.button.defaults: [Object]                                                               // 2780
     * Set of default config options for all of the built-in MediumEditor buttons                                      // 2781
     */                                                                                                                // 2782
    MediumEditor.extensions.button.prototype.defaults = {                                                              // 2783
        'bold': {                                                                                                      // 2784
            name: 'bold',                                                                                              // 2785
            action: 'bold',                                                                                            // 2786
            aria: 'bold',                                                                                              // 2787
            tagNames: ['b', 'strong'],                                                                                 // 2788
            style: {                                                                                                   // 2789
                prop: 'font-weight',                                                                                   // 2790
                value: '700|bold'                                                                                      // 2791
            },                                                                                                         // 2792
            useQueryState: true,                                                                                       // 2793
            contentDefault: '<b>B</b>',                                                                                // 2794
            contentFA: '<i class="fa fa-bold"></i>'                                                                    // 2795
        },                                                                                                             // 2796
        'italic': {                                                                                                    // 2797
            name: 'italic',                                                                                            // 2798
            action: 'italic',                                                                                          // 2799
            aria: 'italic',                                                                                            // 2800
            tagNames: ['i', 'em'],                                                                                     // 2801
            style: {                                                                                                   // 2802
                prop: 'font-style',                                                                                    // 2803
                value: 'italic'                                                                                        // 2804
            },                                                                                                         // 2805
            useQueryState: true,                                                                                       // 2806
            contentDefault: '<b><i>I</i></b>',                                                                         // 2807
            contentFA: '<i class="fa fa-italic"></i>'                                                                  // 2808
        },                                                                                                             // 2809
        'underline': {                                                                                                 // 2810
            name: 'underline',                                                                                         // 2811
            action: 'underline',                                                                                       // 2812
            aria: 'underline',                                                                                         // 2813
            tagNames: ['u'],                                                                                           // 2814
            style: {                                                                                                   // 2815
                prop: 'text-decoration',                                                                               // 2816
                value: 'underline'                                                                                     // 2817
            },                                                                                                         // 2818
            useQueryState: true,                                                                                       // 2819
            contentDefault: '<b><u>U</u></b>',                                                                         // 2820
            contentFA: '<i class="fa fa-underline"></i>'                                                               // 2821
        },                                                                                                             // 2822
        'strikethrough': {                                                                                             // 2823
            name: 'strikethrough',                                                                                     // 2824
            action: 'strikethrough',                                                                                   // 2825
            aria: 'strike through',                                                                                    // 2826
            tagNames: ['strike'],                                                                                      // 2827
            style: {                                                                                                   // 2828
                prop: 'text-decoration',                                                                               // 2829
                value: 'line-through'                                                                                  // 2830
            },                                                                                                         // 2831
            useQueryState: true,                                                                                       // 2832
            contentDefault: '<s>A</s>',                                                                                // 2833
            contentFA: '<i class="fa fa-strikethrough"></i>'                                                           // 2834
        },                                                                                                             // 2835
        'superscript': {                                                                                               // 2836
            name: 'superscript',                                                                                       // 2837
            action: 'superscript',                                                                                     // 2838
            aria: 'superscript',                                                                                       // 2839
            tagNames: ['sup'],                                                                                         // 2840
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for superscript         // 2841
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */   // 2842
            // useQueryState: true                                                                                     // 2843
            contentDefault: '<b>x<sup>1</sup></b>',                                                                    // 2844
            contentFA: '<i class="fa fa-superscript"></i>'                                                             // 2845
        },                                                                                                             // 2846
        'subscript': {                                                                                                 // 2847
            name: 'subscript',                                                                                         // 2848
            action: 'subscript',                                                                                       // 2849
            aria: 'subscript',                                                                                         // 2850
            tagNames: ['sub'],                                                                                         // 2851
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for subscript           // 2852
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */   // 2853
            // useQueryState: true                                                                                     // 2854
            contentDefault: '<b>x<sub>1</sub></b>',                                                                    // 2855
            contentFA: '<i class="fa fa-subscript"></i>'                                                               // 2856
        },                                                                                                             // 2857
        'image': {                                                                                                     // 2858
            name: 'image',                                                                                             // 2859
            action: 'image',                                                                                           // 2860
            aria: 'image',                                                                                             // 2861
            tagNames: ['img'],                                                                                         // 2862
            contentDefault: '<b>image</b>',                                                                            // 2863
            contentFA: '<i class="fa fa-picture-o"></i>'                                                               // 2864
        },                                                                                                             // 2865
        'orderedlist': {                                                                                               // 2866
            name: 'orderedlist',                                                                                       // 2867
            action: 'insertorderedlist',                                                                               // 2868
            aria: 'ordered list',                                                                                      // 2869
            tagNames: ['ol'],                                                                                          // 2870
            useQueryState: true,                                                                                       // 2871
            contentDefault: '<b>1.</b>',                                                                               // 2872
            contentFA: '<i class="fa fa-list-ol"></i>'                                                                 // 2873
        },                                                                                                             // 2874
        'unorderedlist': {                                                                                             // 2875
            name: 'unorderedlist',                                                                                     // 2876
            action: 'insertunorderedlist',                                                                             // 2877
            aria: 'unordered list',                                                                                    // 2878
            tagNames: ['ul'],                                                                                          // 2879
            useQueryState: true,                                                                                       // 2880
            contentDefault: '<b>&bull;</b>',                                                                           // 2881
            contentFA: '<i class="fa fa-list-ul"></i>'                                                                 // 2882
        },                                                                                                             // 2883
        'indent': {                                                                                                    // 2884
            name: 'indent',                                                                                            // 2885
            action: 'indent',                                                                                          // 2886
            aria: 'indent',                                                                                            // 2887
            tagNames: [],                                                                                              // 2888
            contentDefault: '<b>&rarr;</b>',                                                                           // 2889
            contentFA: '<i class="fa fa-indent"></i>'                                                                  // 2890
        },                                                                                                             // 2891
        'outdent': {                                                                                                   // 2892
            name: 'outdent',                                                                                           // 2893
            action: 'outdent',                                                                                         // 2894
            aria: 'outdent',                                                                                           // 2895
            tagNames: [],                                                                                              // 2896
            contentDefault: '<b>&larr;</b>',                                                                           // 2897
            contentFA: '<i class="fa fa-outdent"></i>'                                                                 // 2898
        },                                                                                                             // 2899
        'justifyCenter': {                                                                                             // 2900
            name: 'justifyCenter',                                                                                     // 2901
            action: 'justifyCenter',                                                                                   // 2902
            aria: 'center justify',                                                                                    // 2903
            tagNames: [],                                                                                              // 2904
            style: {                                                                                                   // 2905
                prop: 'text-align',                                                                                    // 2906
                value: 'center'                                                                                        // 2907
            },                                                                                                         // 2908
            contentDefault: '<b>C</b>',                                                                                // 2909
            contentFA: '<i class="fa fa-align-center"></i>'                                                            // 2910
        },                                                                                                             // 2911
        'justifyFull': {                                                                                               // 2912
            name: 'justifyFull',                                                                                       // 2913
            action: 'justifyFull',                                                                                     // 2914
            aria: 'full justify',                                                                                      // 2915
            tagNames: [],                                                                                              // 2916
            style: {                                                                                                   // 2917
                prop: 'text-align',                                                                                    // 2918
                value: 'justify'                                                                                       // 2919
            },                                                                                                         // 2920
            contentDefault: '<b>J</b>',                                                                                // 2921
            contentFA: '<i class="fa fa-align-justify"></i>'                                                           // 2922
        },                                                                                                             // 2923
        'justifyLeft': {                                                                                               // 2924
            name: 'justifyLeft',                                                                                       // 2925
            action: 'justifyLeft',                                                                                     // 2926
            aria: 'left justify',                                                                                      // 2927
            tagNames: [],                                                                                              // 2928
            style: {                                                                                                   // 2929
                prop: 'text-align',                                                                                    // 2930
                value: 'left'                                                                                          // 2931
            },                                                                                                         // 2932
            contentDefault: '<b>L</b>',                                                                                // 2933
            contentFA: '<i class="fa fa-align-left"></i>'                                                              // 2934
        },                                                                                                             // 2935
        'justifyRight': {                                                                                              // 2936
            name: 'justifyRight',                                                                                      // 2937
            action: 'justifyRight',                                                                                    // 2938
            aria: 'right justify',                                                                                     // 2939
            tagNames: [],                                                                                              // 2940
            style: {                                                                                                   // 2941
                prop: 'text-align',                                                                                    // 2942
                value: 'right'                                                                                         // 2943
            },                                                                                                         // 2944
            contentDefault: '<b>R</b>',                                                                                // 2945
            contentFA: '<i class="fa fa-align-right"></i>'                                                             // 2946
        },                                                                                                             // 2947
        // Known inline elements that are not removed, or not removed consistantly across browsers:                    // 2948
        // <span>, <label>, <br>                                                                                       // 2949
        'removeFormat': {                                                                                              // 2950
            name: 'removeFormat',                                                                                      // 2951
            aria: 'remove formatting',                                                                                 // 2952
            action: 'removeFormat',                                                                                    // 2953
            contentDefault: '<b>X</b>',                                                                                // 2954
            contentFA: '<i class="fa fa-eraser"></i>'                                                                  // 2955
        },                                                                                                             // 2956
                                                                                                                       // 2957
        /***** Buttons for appending block elements (append-<element> action) *****/                                   // 2958
                                                                                                                       // 2959
        'quote': {                                                                                                     // 2960
            name: 'quote',                                                                                             // 2961
            action: 'append-blockquote',                                                                               // 2962
            aria: 'blockquote',                                                                                        // 2963
            tagNames: ['blockquote'],                                                                                  // 2964
            contentDefault: '<b>&ldquo;</b>',                                                                          // 2965
            contentFA: '<i class="fa fa-quote-right"></i>'                                                             // 2966
        },                                                                                                             // 2967
        'pre': {                                                                                                       // 2968
            name: 'pre',                                                                                               // 2969
            action: 'append-pre',                                                                                      // 2970
            aria: 'preformatted text',                                                                                 // 2971
            tagNames: ['pre'],                                                                                         // 2972
            contentDefault: '<b>0101</b>',                                                                             // 2973
            contentFA: '<i class="fa fa-code fa-lg"></i>'                                                              // 2974
        },                                                                                                             // 2975
        'h1': {                                                                                                        // 2976
            name: 'h1',                                                                                                // 2977
            action: 'append-h1',                                                                                       // 2978
            aria: 'header type one',                                                                                   // 2979
            tagNames: ['h1'],                                                                                          // 2980
            contentDefault: '<b>H1</b>',                                                                               // 2981
            contentFA: '<i class="fa fa-header"><sup>1</sup>'                                                          // 2982
        },                                                                                                             // 2983
        'h2': {                                                                                                        // 2984
            name: 'h2',                                                                                                // 2985
            action: 'append-h2',                                                                                       // 2986
            aria: 'header type two',                                                                                   // 2987
            tagNames: ['h2'],                                                                                          // 2988
            contentDefault: '<b>H2</b>',                                                                               // 2989
            contentFA: '<i class="fa fa-header"><sup>2</sup>'                                                          // 2990
        },                                                                                                             // 2991
        'h3': {                                                                                                        // 2992
            name: 'h3',                                                                                                // 2993
            action: 'append-h3',                                                                                       // 2994
            aria: 'header type three',                                                                                 // 2995
            tagNames: ['h3'],                                                                                          // 2996
            contentDefault: '<b>H3</b>',                                                                               // 2997
            contentFA: '<i class="fa fa-header"><sup>3</sup>'                                                          // 2998
        },                                                                                                             // 2999
        'h4': {                                                                                                        // 3000
            name: 'h4',                                                                                                // 3001
            action: 'append-h4',                                                                                       // 3002
            aria: 'header type four',                                                                                  // 3003
            tagNames: ['h4'],                                                                                          // 3004
            contentDefault: '<b>H4</b>',                                                                               // 3005
            contentFA: '<i class="fa fa-header"><sup>4</sup>'                                                          // 3006
        },                                                                                                             // 3007
        'h5': {                                                                                                        // 3008
            name: 'h5',                                                                                                // 3009
            action: 'append-h5',                                                                                       // 3010
            aria: 'header type five',                                                                                  // 3011
            tagNames: ['h5'],                                                                                          // 3012
            contentDefault: '<b>H5</b>',                                                                               // 3013
            contentFA: '<i class="fa fa-header"><sup>5</sup>'                                                          // 3014
        },                                                                                                             // 3015
        'h6': {                                                                                                        // 3016
            name: 'h6',                                                                                                // 3017
            action: 'append-h6',                                                                                       // 3018
            aria: 'header type six',                                                                                   // 3019
            tagNames: ['h6'],                                                                                          // 3020
            contentDefault: '<b>H6</b>',                                                                               // 3021
            contentFA: '<i class="fa fa-header"><sup>6</sup>'                                                          // 3022
        }                                                                                                              // 3023
    };                                                                                                                 // 3024
                                                                                                                       // 3025
})();                                                                                                                  // 3026
(function () {                                                                                                         // 3027
    'use strict';                                                                                                      // 3028
                                                                                                                       // 3029
    /* Base functionality for an extension which will display                                                          // 3030
     * a 'form' inside the toolbar                                                                                     // 3031
     */                                                                                                                // 3032
    var FormExtension = MediumEditor.extensions.button.extend({                                                        // 3033
                                                                                                                       // 3034
        init: function () {                                                                                            // 3035
            MediumEditor.extensions.button.prototype.init.apply(this, arguments);                                      // 3036
        },                                                                                                             // 3037
                                                                                                                       // 3038
        // default labels for the form buttons                                                                         // 3039
        formSaveLabel: '&#10003;',                                                                                     // 3040
        formCloseLabel: '&times;',                                                                                     // 3041
                                                                                                                       // 3042
        /* hasForm: [boolean]                                                                                          // 3043
         *                                                                                                             // 3044
         * Setting this to true will cause getForm() to be called                                                      // 3045
         * when the toolbar is created, so the form can be appended                                                    // 3046
         * inside the toolbar container                                                                                // 3047
         */                                                                                                            // 3048
        hasForm: true,                                                                                                 // 3049
                                                                                                                       // 3050
        /* getForm: [function ()]                                                                                      // 3051
         *                                                                                                             // 3052
         * When hasForm is true, this function must be implemented                                                     // 3053
         * and return a DOM Element which will be appended to                                                          // 3054
         * the toolbar container. The form should start hidden, and                                                    // 3055
         * the extension can choose when to hide/show it                                                               // 3056
         */                                                                                                            // 3057
        getForm: function () {},                                                                                       // 3058
                                                                                                                       // 3059
        /* isDisplayed: [function ()]                                                                                  // 3060
         *                                                                                                             // 3061
         * This function should return true/false reflecting                                                           // 3062
         * whether the form is currently displayed                                                                     // 3063
         */                                                                                                            // 3064
        isDisplayed: function () {},                                                                                   // 3065
                                                                                                                       // 3066
        /* hideForm: [function ()]                                                                                     // 3067
         *                                                                                                             // 3068
         * This function should hide the form element inside                                                           // 3069
         * the toolbar container                                                                                       // 3070
         */                                                                                                            // 3071
        hideForm: function () {},                                                                                      // 3072
                                                                                                                       // 3073
        /************************ Helpers ************************                                                     // 3074
         * The following are helpers that are either set by MediumEditor                                               // 3075
         * during initialization, or are helper methods which either                                                   // 3076
         * route calls to the MediumEditor instance or provide common                                                  // 3077
         * functionality for all form extensions                                                                       // 3078
         *********************************************************/                                                    // 3079
                                                                                                                       // 3080
        /* showToolbarDefaultActions: [function ()]                                                                    // 3081
         *                                                                                                             // 3082
         * Helper method which will turn back the toolbar after canceling                                              // 3083
         * the customized form                                                                                         // 3084
         */                                                                                                            // 3085
        showToolbarDefaultActions: function () {                                                                       // 3086
            var toolbar = this.base.getExtensionByName('toolbar');                                                     // 3087
            if (toolbar) {                                                                                             // 3088
                toolbar.showToolbarDefaultActions();                                                                   // 3089
            }                                                                                                          // 3090
        },                                                                                                             // 3091
                                                                                                                       // 3092
        /* hideToolbarDefaultActions: [function ()]                                                                    // 3093
         *                                                                                                             // 3094
         * Helper function which will hide the default contents of the                                                 // 3095
         * toolbar, but leave the toolbar container in the same state                                                  // 3096
         * to allow a form to display its custom contents inside the toolbar                                           // 3097
         */                                                                                                            // 3098
        hideToolbarDefaultActions: function () {                                                                       // 3099
            var toolbar = this.base.getExtensionByName('toolbar');                                                     // 3100
            if (toolbar) {                                                                                             // 3101
                toolbar.hideToolbarDefaultActions();                                                                   // 3102
            }                                                                                                          // 3103
        },                                                                                                             // 3104
                                                                                                                       // 3105
        /* setToolbarPosition: [function ()]                                                                           // 3106
         *                                                                                                             // 3107
         * Helper function which will update the size and position                                                     // 3108
         * of the toolbar based on the toolbar content and the current                                                 // 3109
         * position of the user's selection                                                                            // 3110
         */                                                                                                            // 3111
        setToolbarPosition: function () {                                                                              // 3112
            var toolbar = this.base.getExtensionByName('toolbar');                                                     // 3113
            if (toolbar) {                                                                                             // 3114
                toolbar.setToolbarPosition();                                                                          // 3115
            }                                                                                                          // 3116
        }                                                                                                              // 3117
    });                                                                                                                // 3118
                                                                                                                       // 3119
    MediumEditor.extensions.form = FormExtension;                                                                      // 3120
})();                                                                                                                  // 3121
(function () {                                                                                                         // 3122
    'use strict';                                                                                                      // 3123
                                                                                                                       // 3124
    var AnchorForm = MediumEditor.extensions.form.extend({                                                             // 3125
        /* Anchor Form Options */                                                                                      // 3126
                                                                                                                       // 3127
        /* customClassOption: [string]  (previously options.anchorButton + options.anchorButtonClass)                  // 3128
         * Custom class name the user can optionally have added to their created links (ie 'button').                  // 3129
         * If passed as a non-empty string, a checkbox will be displayed allowing the user to choose                   // 3130
         * whether to have the class added to the created link or not.                                                 // 3131
         */                                                                                                            // 3132
        customClassOption: null,                                                                                       // 3133
                                                                                                                       // 3134
        /* customClassOptionText: [string]                                                                             // 3135
         * text to be shown in the checkbox when the __customClassOption__ is being used.                              // 3136
         */                                                                                                            // 3137
        customClassOptionText: 'Button',                                                                               // 3138
                                                                                                                       // 3139
        /* linkValidation: [boolean]  (previously options.checkLinkFormat)                                             // 3140
         * enables/disables check for common URL protocols on anchor links.                                            // 3141
         */                                                                                                            // 3142
        linkValidation: false,                                                                                         // 3143
                                                                                                                       // 3144
        /* placeholderText: [string]  (previously options.anchorInputPlaceholder)                                      // 3145
         * text to be shown as placeholder of the anchor input.                                                        // 3146
         */                                                                                                            // 3147
        placeholderText: 'Paste or type a link',                                                                       // 3148
                                                                                                                       // 3149
        /* targetCheckbox: [boolean]  (previously options.anchorTarget)                                                // 3150
         * enables/disables displaying a "Open in new window" checkbox, which when checked                             // 3151
         * changes the `target` attribute of the created link.                                                         // 3152
         */                                                                                                            // 3153
        targetCheckbox: false,                                                                                         // 3154
                                                                                                                       // 3155
        /* targetCheckboxText: [string]  (previously options.anchorInputCheckboxLabel)                                 // 3156
         * text to be shown in the checkbox enabled via the __targetCheckbox__ option.                                 // 3157
         */                                                                                                            // 3158
        targetCheckboxText: 'Open in new window',                                                                      // 3159
                                                                                                                       // 3160
        // Options for the Button base class                                                                           // 3161
        name: 'anchor',                                                                                                // 3162
        action: 'createLink',                                                                                          // 3163
        aria: 'link',                                                                                                  // 3164
        tagNames: ['a'],                                                                                               // 3165
        contentDefault: '<b>#</b>',                                                                                    // 3166
        contentFA: '<i class="fa fa-link"></i>',                                                                       // 3167
                                                                                                                       // 3168
        init: function () {                                                                                            // 3169
            MediumEditor.extensions.form.prototype.init.apply(this, arguments);                                        // 3170
                                                                                                                       // 3171
            this.subscribe('editableKeydown', this.handleKeydown.bind(this));                                          // 3172
        },                                                                                                             // 3173
                                                                                                                       // 3174
        // Called when the button the toolbar is clicked                                                               // 3175
        // Overrides ButtonExtension.handleClick                                                                       // 3176
        handleClick: function (event) {                                                                                // 3177
            event.preventDefault();                                                                                    // 3178
            event.stopPropagation();                                                                                   // 3179
                                                                                                                       // 3180
            var range = MediumEditor.selection.getSelectionRange(this.document);                                       // 3181
                                                                                                                       // 3182
            if (range.startContainer.nodeName.toLowerCase() === 'a' ||                                                 // 3183
                range.endContainer.nodeName.toLowerCase() === 'a' ||                                                   // 3184
                MediumEditor.util.getClosestTag(MediumEditor.selection.getSelectedParentElement(range), 'a')) {        // 3185
                return this.execAction('unlink');                                                                      // 3186
            }                                                                                                          // 3187
                                                                                                                       // 3188
            if (!this.isDisplayed()) {                                                                                 // 3189
                this.showForm();                                                                                       // 3190
            }                                                                                                          // 3191
                                                                                                                       // 3192
            return false;                                                                                              // 3193
        },                                                                                                             // 3194
                                                                                                                       // 3195
        // Called when user hits the defined shortcut (CTRL / COMMAND + K)                                             // 3196
        handleKeydown: function (event) {                                                                              // 3197
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.K) && MediumEditor.util.isMetaCtrlKey(event) && !event.shiftKey) {
                this.handleClick(event);                                                                               // 3199
            }                                                                                                          // 3200
        },                                                                                                             // 3201
                                                                                                                       // 3202
        // Called by medium-editor to append form to the toolbar                                                       // 3203
        getForm: function () {                                                                                         // 3204
            if (!this.form) {                                                                                          // 3205
                this.form = this.createForm();                                                                         // 3206
            }                                                                                                          // 3207
            return this.form;                                                                                          // 3208
        },                                                                                                             // 3209
                                                                                                                       // 3210
        getTemplate: function () {                                                                                     // 3211
            var template = [                                                                                           // 3212
                '<input type="text" class="medium-editor-toolbar-input" placeholder="', this.placeholderText, '">'     // 3213
            ];                                                                                                         // 3214
                                                                                                                       // 3215
            template.push(                                                                                             // 3216
                '<a href="#" class="medium-editor-toolbar-save">',                                                     // 3217
                this.getEditorOption('buttonLabels') === 'fontawesome' ? '<i class="fa fa-check"></i>' : this.formSaveLabel,
                '</a>'                                                                                                 // 3219
            );                                                                                                         // 3220
                                                                                                                       // 3221
            template.push('<a href="#" class="medium-editor-toolbar-close">',                                          // 3222
                this.getEditorOption('buttonLabels') === 'fontawesome' ? '<i class="fa fa-times"></i>' : this.formCloseLabel,
                '</a>');                                                                                               // 3224
                                                                                                                       // 3225
            // both of these options are slightly moot with the ability to                                             // 3226
            // override the various form buildup/serialize functions.                                                  // 3227
                                                                                                                       // 3228
            if (this.targetCheckbox) {                                                                                 // 3229
                // fixme: ideally, this targetCheckboxText would be a formLabel too,                                   // 3230
                // figure out how to deprecate? also consider `fa-` icon default implcations.                          // 3231
                template.push(                                                                                         // 3232
                    '<div class="medium-editor-toolbar-form-row">',                                                    // 3233
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-target">',                             // 3234
                    '<label>',                                                                                         // 3235
                    this.targetCheckboxText,                                                                           // 3236
                    '</label>',                                                                                        // 3237
                    '</div>'                                                                                           // 3238
                );                                                                                                     // 3239
            }                                                                                                          // 3240
                                                                                                                       // 3241
            if (this.customClassOption) {                                                                              // 3242
                // fixme: expose this `Button` text as a formLabel property, too                                       // 3243
                // and provide similar access to a `fa-` icon default.                                                 // 3244
                template.push(                                                                                         // 3245
                    '<div class="medium-editor-toolbar-form-row">',                                                    // 3246
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-button">',                             // 3247
                    '<label>',                                                                                         // 3248
                    this.customClassOptionText,                                                                        // 3249
                    '</label>',                                                                                        // 3250
                    '</div>'                                                                                           // 3251
                );                                                                                                     // 3252
            }                                                                                                          // 3253
                                                                                                                       // 3254
            return template.join('');                                                                                  // 3255
                                                                                                                       // 3256
        },                                                                                                             // 3257
                                                                                                                       // 3258
        // Used by medium-editor when the default toolbar is to be displayed                                           // 3259
        isDisplayed: function () {                                                                                     // 3260
            return this.getForm().style.display === 'block';                                                           // 3261
        },                                                                                                             // 3262
                                                                                                                       // 3263
        hideForm: function () {                                                                                        // 3264
            this.getForm().style.display = 'none';                                                                     // 3265
            this.getInput().value = '';                                                                                // 3266
        },                                                                                                             // 3267
                                                                                                                       // 3268
        showForm: function (opts) {                                                                                    // 3269
            var input = this.getInput(),                                                                               // 3270
                targetCheckbox = this.getAnchorTargetCheckbox(),                                                       // 3271
                buttonCheckbox = this.getAnchorButtonCheckbox();                                                       // 3272
                                                                                                                       // 3273
            opts = opts || { url: '' };                                                                                // 3274
            // TODO: This is for backwards compatability                                                               // 3275
            // We don't need to support the 'string' argument in 6.0.0                                                 // 3276
            if (typeof opts === 'string') {                                                                            // 3277
                opts = {                                                                                               // 3278
                    url: opts                                                                                          // 3279
                };                                                                                                     // 3280
            }                                                                                                          // 3281
                                                                                                                       // 3282
            this.base.saveSelection();                                                                                 // 3283
            this.hideToolbarDefaultActions();                                                                          // 3284
            this.getForm().style.display = 'block';                                                                    // 3285
            this.setToolbarPosition();                                                                                 // 3286
                                                                                                                       // 3287
            input.value = opts.url;                                                                                    // 3288
            input.focus();                                                                                             // 3289
                                                                                                                       // 3290
            // If we have a target checkbox, we want it to be checked/unchecked                                        // 3291
            // based on whether the existing link has target=_blank                                                    // 3292
            if (targetCheckbox) {                                                                                      // 3293
                targetCheckbox.checked = opts.target === '_blank';                                                     // 3294
            }                                                                                                          // 3295
                                                                                                                       // 3296
            // If we have a custom class checkbox, we want it to be checked/unchecked                                  // 3297
            // based on whether an existing link already has the class                                                 // 3298
            if (buttonCheckbox) {                                                                                      // 3299
                var classList = opts.buttonClass ? opts.buttonClass.split(' ') : [];                                   // 3300
                buttonCheckbox.checked = (classList.indexOf(this.customClassOption) !== -1);                           // 3301
            }                                                                                                          // 3302
        },                                                                                                             // 3303
                                                                                                                       // 3304
        // Called by core when tearing down medium-editor (destroy)                                                    // 3305
        destroy: function () {                                                                                         // 3306
            if (!this.form) {                                                                                          // 3307
                return false;                                                                                          // 3308
            }                                                                                                          // 3309
                                                                                                                       // 3310
            if (this.form.parentNode) {                                                                                // 3311
                this.form.parentNode.removeChild(this.form);                                                           // 3312
            }                                                                                                          // 3313
                                                                                                                       // 3314
            delete this.form;                                                                                          // 3315
        },                                                                                                             // 3316
                                                                                                                       // 3317
        // core methods                                                                                                // 3318
                                                                                                                       // 3319
        getFormOpts: function () {                                                                                     // 3320
            // no notion of private functions? wanted `_getFormOpts`                                                   // 3321
            var targetCheckbox = this.getAnchorTargetCheckbox(),                                                       // 3322
                buttonCheckbox = this.getAnchorButtonCheckbox(),                                                       // 3323
                opts = {                                                                                               // 3324
                    url: this.getInput().value                                                                         // 3325
                };                                                                                                     // 3326
                                                                                                                       // 3327
            if (this.linkValidation) {                                                                                 // 3328
                opts.url = this.checkLinkFormat(opts.url);                                                             // 3329
            }                                                                                                          // 3330
                                                                                                                       // 3331
            opts.target = '_self';                                                                                     // 3332
            if (targetCheckbox && targetCheckbox.checked) {                                                            // 3333
                opts.target = '_blank';                                                                                // 3334
            }                                                                                                          // 3335
                                                                                                                       // 3336
            if (buttonCheckbox && buttonCheckbox.checked) {                                                            // 3337
                opts.buttonClass = this.customClassOption;                                                             // 3338
            }                                                                                                          // 3339
                                                                                                                       // 3340
            return opts;                                                                                               // 3341
        },                                                                                                             // 3342
                                                                                                                       // 3343
        doFormSave: function () {                                                                                      // 3344
            var opts = this.getFormOpts();                                                                             // 3345
            this.completeFormSave(opts);                                                                               // 3346
        },                                                                                                             // 3347
                                                                                                                       // 3348
        completeFormSave: function (opts) {                                                                            // 3349
            this.base.restoreSelection();                                                                              // 3350
            this.execAction(this.action, opts);                                                                        // 3351
            this.base.checkSelection();                                                                                // 3352
        },                                                                                                             // 3353
                                                                                                                       // 3354
        checkLinkFormat: function (value) {                                                                            // 3355
            var re = /^(https?|ftps?|rtmpt?):\/\/|mailto:/;                                                            // 3356
            return (re.test(value) ? '' : 'http://') + value;                                                          // 3357
        },                                                                                                             // 3358
                                                                                                                       // 3359
        doFormCancel: function () {                                                                                    // 3360
            this.base.restoreSelection();                                                                              // 3361
            this.base.checkSelection();                                                                                // 3362
        },                                                                                                             // 3363
                                                                                                                       // 3364
        // form creation and event handling                                                                            // 3365
        attachFormEvents: function (form) {                                                                            // 3366
            var close = form.querySelector('.medium-editor-toolbar-close'),                                            // 3367
                save = form.querySelector('.medium-editor-toolbar-save'),                                              // 3368
                input = form.querySelector('.medium-editor-toolbar-input');                                            // 3369
                                                                                                                       // 3370
            // Handle clicks on the form itself                                                                        // 3371
            this.on(form, 'click', this.handleFormClick.bind(this));                                                   // 3372
                                                                                                                       // 3373
            // Handle typing in the textbox                                                                            // 3374
            this.on(input, 'keyup', this.handleTextboxKeyup.bind(this));                                               // 3375
                                                                                                                       // 3376
            // Handle close button clicks                                                                              // 3377
            this.on(close, 'click', this.handleCloseClick.bind(this));                                                 // 3378
                                                                                                                       // 3379
            // Handle save button clicks (capture)                                                                     // 3380
            this.on(save, 'click', this.handleSaveClick.bind(this), true);                                             // 3381
                                                                                                                       // 3382
        },                                                                                                             // 3383
                                                                                                                       // 3384
        createForm: function () {                                                                                      // 3385
            var doc = this.document,                                                                                   // 3386
                form = doc.createElement('div');                                                                       // 3387
                                                                                                                       // 3388
            // Anchor Form (div)                                                                                       // 3389
            form.className = 'medium-editor-toolbar-form';                                                             // 3390
            form.id = 'medium-editor-toolbar-form-anchor-' + this.getEditorId();                                       // 3391
            form.innerHTML = this.getTemplate();                                                                       // 3392
            this.attachFormEvents(form);                                                                               // 3393
                                                                                                                       // 3394
            return form;                                                                                               // 3395
        },                                                                                                             // 3396
                                                                                                                       // 3397
        getInput: function () {                                                                                        // 3398
            return this.getForm().querySelector('input.medium-editor-toolbar-input');                                  // 3399
        },                                                                                                             // 3400
                                                                                                                       // 3401
        getAnchorTargetCheckbox: function () {                                                                         // 3402
            return this.getForm().querySelector('.medium-editor-toolbar-anchor-target');                               // 3403
        },                                                                                                             // 3404
                                                                                                                       // 3405
        getAnchorButtonCheckbox: function () {                                                                         // 3406
            return this.getForm().querySelector('.medium-editor-toolbar-anchor-button');                               // 3407
        },                                                                                                             // 3408
                                                                                                                       // 3409
        handleTextboxKeyup: function (event) {                                                                         // 3410
            // For ENTER -> create the anchor                                                                          // 3411
            if (event.keyCode === MediumEditor.util.keyCode.ENTER) {                                                   // 3412
                event.preventDefault();                                                                                // 3413
                this.doFormSave();                                                                                     // 3414
                return;                                                                                                // 3415
            }                                                                                                          // 3416
                                                                                                                       // 3417
            // For ESCAPE -> close the form                                                                            // 3418
            if (event.keyCode === MediumEditor.util.keyCode.ESCAPE) {                                                  // 3419
                event.preventDefault();                                                                                // 3420
                this.doFormCancel();                                                                                   // 3421
            }                                                                                                          // 3422
        },                                                                                                             // 3423
                                                                                                                       // 3424
        handleFormClick: function (event) {                                                                            // 3425
            // make sure not to hide form when clicking inside the form                                                // 3426
            event.stopPropagation();                                                                                   // 3427
        },                                                                                                             // 3428
                                                                                                                       // 3429
        handleSaveClick: function (event) {                                                                            // 3430
            // Clicking Save -> create the anchor                                                                      // 3431
            event.preventDefault();                                                                                    // 3432
            this.doFormSave();                                                                                         // 3433
        },                                                                                                             // 3434
                                                                                                                       // 3435
        handleCloseClick: function (event) {                                                                           // 3436
            // Click Close -> close the form                                                                           // 3437
            event.preventDefault();                                                                                    // 3438
            this.doFormCancel();                                                                                       // 3439
        }                                                                                                              // 3440
    });                                                                                                                // 3441
                                                                                                                       // 3442
    MediumEditor.extensions.anchor = AnchorForm;                                                                       // 3443
}());                                                                                                                  // 3444
(function () {                                                                                                         // 3445
    'use strict';                                                                                                      // 3446
                                                                                                                       // 3447
    var AnchorPreview = MediumEditor.Extension.extend({                                                                // 3448
        name: 'anchor-preview',                                                                                        // 3449
                                                                                                                       // 3450
        // Anchor Preview Options                                                                                      // 3451
                                                                                                                       // 3452
        /* hideDelay: [number]  (previously options.anchorPreviewHideDelay)                                            // 3453
         * time in milliseconds to show the anchor tag preview after the mouse has left the anchor tag.                // 3454
         */                                                                                                            // 3455
        hideDelay: 500,                                                                                                // 3456
                                                                                                                       // 3457
        /* previewValueSelector: [string]                                                                              // 3458
         * the default selector to locate where to put the activeAnchor value in the preview                           // 3459
         */                                                                                                            // 3460
        previewValueSelector: 'a',                                                                                     // 3461
                                                                                                                       // 3462
        init: function () {                                                                                            // 3463
            this.anchorPreview = this.createPreview();                                                                 // 3464
                                                                                                                       // 3465
            this.getEditorOption('elementsContainer').appendChild(this.anchorPreview);                                 // 3466
                                                                                                                       // 3467
            this.attachToEditables();                                                                                  // 3468
        },                                                                                                             // 3469
                                                                                                                       // 3470
        getPreviewElement: function () {                                                                               // 3471
            return this.anchorPreview;                                                                                 // 3472
        },                                                                                                             // 3473
                                                                                                                       // 3474
        createPreview: function () {                                                                                   // 3475
            var el = this.document.createElement('div');                                                               // 3476
                                                                                                                       // 3477
            el.id = 'medium-editor-anchor-preview-' + this.getEditorId();                                              // 3478
            el.className = 'medium-editor-anchor-preview';                                                             // 3479
            el.innerHTML = this.getTemplate();                                                                         // 3480
                                                                                                                       // 3481
            this.on(el, 'click', this.handleClick.bind(this));                                                         // 3482
                                                                                                                       // 3483
            return el;                                                                                                 // 3484
        },                                                                                                             // 3485
                                                                                                                       // 3486
        getTemplate: function () {                                                                                     // 3487
            return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">' +    // 3488
                '    <a class="medium-editor-toolbar-anchor-preview-inner"></a>' +                                     // 3489
                '</div>';                                                                                              // 3490
        },                                                                                                             // 3491
                                                                                                                       // 3492
        destroy: function () {                                                                                         // 3493
            if (this.anchorPreview) {                                                                                  // 3494
                if (this.anchorPreview.parentNode) {                                                                   // 3495
                    this.anchorPreview.parentNode.removeChild(this.anchorPreview);                                     // 3496
                }                                                                                                      // 3497
                delete this.anchorPreview;                                                                             // 3498
            }                                                                                                          // 3499
        },                                                                                                             // 3500
                                                                                                                       // 3501
        hidePreview: function () {                                                                                     // 3502
            this.anchorPreview.classList.remove('medium-editor-anchor-preview-active');                                // 3503
            this.activeAnchor = null;                                                                                  // 3504
        },                                                                                                             // 3505
                                                                                                                       // 3506
        showPreview: function (anchorEl) {                                                                             // 3507
            if (this.anchorPreview.classList.contains('medium-editor-anchor-preview-active') ||                        // 3508
                    anchorEl.getAttribute('data-disable-preview')) {                                                   // 3509
                return true;                                                                                           // 3510
            }                                                                                                          // 3511
                                                                                                                       // 3512
            if (this.previewValueSelector) {                                                                           // 3513
                this.anchorPreview.querySelector(this.previewValueSelector).textContent = anchorEl.attributes.href.value;
                this.anchorPreview.querySelector(this.previewValueSelector).href = anchorEl.attributes.href.value;     // 3515
            }                                                                                                          // 3516
                                                                                                                       // 3517
            this.anchorPreview.classList.add('medium-toolbar-arrow-over');                                             // 3518
            this.anchorPreview.classList.remove('medium-toolbar-arrow-under');                                         // 3519
                                                                                                                       // 3520
            if (!this.anchorPreview.classList.contains('medium-editor-anchor-preview-active')) {                       // 3521
                this.anchorPreview.classList.add('medium-editor-anchor-preview-active');                               // 3522
            }                                                                                                          // 3523
                                                                                                                       // 3524
            this.activeAnchor = anchorEl;                                                                              // 3525
                                                                                                                       // 3526
            this.positionPreview();                                                                                    // 3527
            this.attachPreviewHandlers();                                                                              // 3528
                                                                                                                       // 3529
            return this;                                                                                               // 3530
        },                                                                                                             // 3531
                                                                                                                       // 3532
        positionPreview: function (activeAnchor) {                                                                     // 3533
            activeAnchor = activeAnchor || this.activeAnchor;                                                          // 3534
            var buttonHeight = this.anchorPreview.offsetHeight,                                                        // 3535
                boundary = activeAnchor.getBoundingClientRect(),                                                       // 3536
                middleBoundary = (boundary.left + boundary.right) / 2,                                                 // 3537
                diffLeft = this.diffLeft,                                                                              // 3538
                diffTop = this.diffTop,                                                                                // 3539
                halfOffsetWidth,                                                                                       // 3540
                defaultLeft;                                                                                           // 3541
                                                                                                                       // 3542
            halfOffsetWidth = this.anchorPreview.offsetWidth / 2;                                                      // 3543
            var toolbarExtension = this.base.getExtensionByName('toolbar');                                            // 3544
            if (toolbarExtension) {                                                                                    // 3545
                diffLeft = toolbarExtension.diffLeft;                                                                  // 3546
                diffTop = toolbarExtension.diffTop;                                                                    // 3547
            }                                                                                                          // 3548
            defaultLeft = diffLeft - halfOffsetWidth;                                                                  // 3549
                                                                                                                       // 3550
            this.anchorPreview.style.top = Math.round(buttonHeight + boundary.bottom - diffTop + this.window.pageYOffset - this.anchorPreview.offsetHeight) + 'px';
            if (middleBoundary < halfOffsetWidth) {                                                                    // 3552
                this.anchorPreview.style.left = defaultLeft + halfOffsetWidth + 'px';                                  // 3553
            } else if ((this.window.innerWidth - middleBoundary) < halfOffsetWidth) {                                  // 3554
                this.anchorPreview.style.left = this.window.innerWidth + defaultLeft - halfOffsetWidth + 'px';         // 3555
            } else {                                                                                                   // 3556
                this.anchorPreview.style.left = defaultLeft + middleBoundary + 'px';                                   // 3557
            }                                                                                                          // 3558
        },                                                                                                             // 3559
                                                                                                                       // 3560
        attachToEditables: function () {                                                                               // 3561
            this.subscribe('editableMouseover', this.handleEditableMouseover.bind(this));                              // 3562
        },                                                                                                             // 3563
                                                                                                                       // 3564
        handleClick: function (event) {                                                                                // 3565
            var anchorExtension = this.base.getExtensionByName('anchor'),                                              // 3566
                activeAnchor = this.activeAnchor;                                                                      // 3567
                                                                                                                       // 3568
            if (anchorExtension && activeAnchor) {                                                                     // 3569
                event.preventDefault();                                                                                // 3570
                                                                                                                       // 3571
                this.base.selectElement(this.activeAnchor);                                                            // 3572
                                                                                                                       // 3573
                // Using setTimeout + delay because:                                                                   // 3574
                // We may actually be displaying the anchor form, which should be controlled by delay                  // 3575
                this.base.delay(function () {                                                                          // 3576
                    if (activeAnchor) {                                                                                // 3577
                        var opts = {                                                                                   // 3578
                            url: activeAnchor.attributes.href.value,                                                   // 3579
                            target: activeAnchor.getAttribute('target'),                                               // 3580
                            buttonClass: activeAnchor.getAttribute('class')                                            // 3581
                        };                                                                                             // 3582
                        anchorExtension.showForm(opts);                                                                // 3583
                        activeAnchor = null;                                                                           // 3584
                    }                                                                                                  // 3585
                }.bind(this));                                                                                         // 3586
            }                                                                                                          // 3587
                                                                                                                       // 3588
            this.hidePreview();                                                                                        // 3589
        },                                                                                                             // 3590
                                                                                                                       // 3591
        handleAnchorMouseout: function () {                                                                            // 3592
            this.anchorToPreview = null;                                                                               // 3593
            this.off(this.activeAnchor, 'mouseout', this.instanceHandleAnchorMouseout);                                // 3594
            this.instanceHandleAnchorMouseout = null;                                                                  // 3595
        },                                                                                                             // 3596
                                                                                                                       // 3597
        handleEditableMouseover: function (event) {                                                                    // 3598
            var target = MediumEditor.util.getClosestTag(event.target, 'a');                                           // 3599
                                                                                                                       // 3600
            if (false === target) {                                                                                    // 3601
                return;                                                                                                // 3602
            }                                                                                                          // 3603
                                                                                                                       // 3604
            // Detect empty href attributes                                                                            // 3605
            // The browser will make href="" or href="#top"                                                            // 3606
            // into absolute urls when accessed as event.target.href, so check the html                                // 3607
            if (!/href=["']\S+["']/.test(target.outerHTML) || /href=["']#\S+["']/.test(target.outerHTML)) {            // 3608
                return true;                                                                                           // 3609
            }                                                                                                          // 3610
                                                                                                                       // 3611
            // only show when toolbar is not present                                                                   // 3612
            var toolbar = this.base.getExtensionByName('toolbar');                                                     // 3613
            if (toolbar && toolbar.isDisplayed && toolbar.isDisplayed()) {                                             // 3614
                return true;                                                                                           // 3615
            }                                                                                                          // 3616
                                                                                                                       // 3617
            // detach handler for other anchor in case we hovered multiple anchors quickly                             // 3618
            if (this.activeAnchor && this.activeAnchor !== target) {                                                   // 3619
                this.detachPreviewHandlers();                                                                          // 3620
            }                                                                                                          // 3621
                                                                                                                       // 3622
            this.anchorToPreview = target;                                                                             // 3623
                                                                                                                       // 3624
            this.instanceHandleAnchorMouseout = this.handleAnchorMouseout.bind(this);                                  // 3625
            this.on(this.anchorToPreview, 'mouseout', this.instanceHandleAnchorMouseout);                              // 3626
            // Using setTimeout + delay because:                                                                       // 3627
            // - We're going to show the anchor preview according to the configured delay                              // 3628
            //   if the mouse has not left the anchor tag in that time                                                 // 3629
            this.base.delay(function () {                                                                              // 3630
                if (this.anchorToPreview) {                                                                            // 3631
                    this.showPreview(this.anchorToPreview);                                                            // 3632
                }                                                                                                      // 3633
            }.bind(this));                                                                                             // 3634
        },                                                                                                             // 3635
                                                                                                                       // 3636
        handlePreviewMouseover: function () {                                                                          // 3637
            this.lastOver = (new Date()).getTime();                                                                    // 3638
            this.hovering = true;                                                                                      // 3639
        },                                                                                                             // 3640
                                                                                                                       // 3641
        handlePreviewMouseout: function (event) {                                                                      // 3642
            if (!event.relatedTarget || !/anchor-preview/.test(event.relatedTarget.className)) {                       // 3643
                this.hovering = false;                                                                                 // 3644
            }                                                                                                          // 3645
        },                                                                                                             // 3646
                                                                                                                       // 3647
        updatePreview: function () {                                                                                   // 3648
            if (this.hovering) {                                                                                       // 3649
                return true;                                                                                           // 3650
            }                                                                                                          // 3651
            var durr = (new Date()).getTime() - this.lastOver;                                                         // 3652
            if (durr > this.hideDelay) {                                                                               // 3653
                // hide the preview 1/2 second after mouse leaves the link                                             // 3654
                this.detachPreviewHandlers();                                                                          // 3655
            }                                                                                                          // 3656
        },                                                                                                             // 3657
                                                                                                                       // 3658
        detachPreviewHandlers: function () {                                                                           // 3659
            // cleanup                                                                                                 // 3660
            clearInterval(this.intervalTimer);                                                                         // 3661
            if (this.instanceHandlePreviewMouseover) {                                                                 // 3662
                this.off(this.anchorPreview, 'mouseover', this.instanceHandlePreviewMouseover);                        // 3663
                this.off(this.anchorPreview, 'mouseout', this.instanceHandlePreviewMouseout);                          // 3664
                if (this.activeAnchor) {                                                                               // 3665
                    this.off(this.activeAnchor, 'mouseover', this.instanceHandlePreviewMouseover);                     // 3666
                    this.off(this.activeAnchor, 'mouseout', this.instanceHandlePreviewMouseout);                       // 3667
                }                                                                                                      // 3668
            }                                                                                                          // 3669
                                                                                                                       // 3670
            this.hidePreview();                                                                                        // 3671
                                                                                                                       // 3672
            this.hovering = this.instanceHandlePreviewMouseover = this.instanceHandlePreviewMouseout = null;           // 3673
        },                                                                                                             // 3674
                                                                                                                       // 3675
        // TODO: break up method and extract out handlers                                                              // 3676
        attachPreviewHandlers: function () {                                                                           // 3677
            this.lastOver = (new Date()).getTime();                                                                    // 3678
            this.hovering = true;                                                                                      // 3679
                                                                                                                       // 3680
            this.instanceHandlePreviewMouseover = this.handlePreviewMouseover.bind(this);                              // 3681
            this.instanceHandlePreviewMouseout = this.handlePreviewMouseout.bind(this);                                // 3682
                                                                                                                       // 3683
            this.intervalTimer = setInterval(this.updatePreview.bind(this), 200);                                      // 3684
                                                                                                                       // 3685
            this.on(this.anchorPreview, 'mouseover', this.instanceHandlePreviewMouseover);                             // 3686
            this.on(this.anchorPreview, 'mouseout', this.instanceHandlePreviewMouseout);                               // 3687
            this.on(this.activeAnchor, 'mouseover', this.instanceHandlePreviewMouseover);                              // 3688
            this.on(this.activeAnchor, 'mouseout', this.instanceHandlePreviewMouseout);                                // 3689
        }                                                                                                              // 3690
    });                                                                                                                // 3691
                                                                                                                       // 3692
    MediumEditor.extensions.anchorPreview = AnchorPreview;                                                             // 3693
}());                                                                                                                  // 3694
                                                                                                                       // 3695
(function () {                                                                                                         // 3696
    'use strict';                                                                                                      // 3697
                                                                                                                       // 3698
    var WHITESPACE_CHARS,                                                                                              // 3699
        KNOWN_TLDS_FRAGMENT,                                                                                           // 3700
        LINK_REGEXP_TEXT,                                                                                              // 3701
        KNOWN_TLDS_REGEXP;                                                                                             // 3702
                                                                                                                       // 3703
    WHITESPACE_CHARS = [' ', '\t', '\n', '\r', '\u00A0', '\u2000', '\u2001', '\u2002', '\u2003',                       // 3704
                                    '\u2028', '\u2029'];                                                               // 3705
    KNOWN_TLDS_FRAGMENT = 'com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|' +
        'xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|' +
        'bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|' +
        'fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|' +
        'is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|' +
        'mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|' +
        'pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|' +
        'tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw';          // 3713
                                                                                                                       // 3714
    LINK_REGEXP_TEXT =                                                                                                 // 3715
        '(' +                                                                                                          // 3716
        // Version of Gruber URL Regexp optimized for JS: http://stackoverflow.com/a/17733640                          // 3717
        '((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.](' + KNOWN_TLDS_FRAGMENT + ')\\\/)\\S+(?:[^\\s`!\\[\\]{};:\'\".,?\u00AB\u00BB\u201C\u201D\u2018\u2019]))' +
        // Addition to above Regexp to support bare domains/one level subdomains with common non-i18n TLDs and without www prefix:
        ')|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.(' + KNOWN_TLDS_FRAGMENT + '))';                                          // 3720
                                                                                                                       // 3721
    KNOWN_TLDS_REGEXP = new RegExp('^(' + KNOWN_TLDS_FRAGMENT + ')$', 'i');                                            // 3722
                                                                                                                       // 3723
    function nodeIsNotInsideAnchorTag(node) {                                                                          // 3724
        return !MediumEditor.util.getClosestTag(node, 'a');                                                            // 3725
    }                                                                                                                  // 3726
                                                                                                                       // 3727
    var AutoLink = MediumEditor.Extension.extend({                                                                     // 3728
        init: function () {                                                                                            // 3729
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 3730
                                                                                                                       // 3731
            this.disableEventHandling = false;                                                                         // 3732
            this.subscribe('editableKeypress', this.onKeypress.bind(this));                                            // 3733
            this.subscribe('editableBlur', this.onBlur.bind(this));                                                    // 3734
            // MS IE has it's own auto-URL detect feature but ours is better in some ways. Be consistent.              // 3735
            this.document.execCommand('AutoUrlDetect', false, false);                                                  // 3736
        },                                                                                                             // 3737
                                                                                                                       // 3738
        destroy: function () {                                                                                         // 3739
            // Turn AutoUrlDetect back on                                                                              // 3740
            if (this.document.queryCommandSupported('AutoUrlDetect')) {                                                // 3741
                this.document.execCommand('AutoUrlDetect', false, true);                                               // 3742
            }                                                                                                          // 3743
        },                                                                                                             // 3744
                                                                                                                       // 3745
        onBlur: function (blurEvent, editable) {                                                                       // 3746
            this.performLinking(editable);                                                                             // 3747
        },                                                                                                             // 3748
                                                                                                                       // 3749
        onKeypress: function (keyPressEvent) {                                                                         // 3750
            if (this.disableEventHandling) {                                                                           // 3751
                return;                                                                                                // 3752
            }                                                                                                          // 3753
                                                                                                                       // 3754
            if (MediumEditor.util.isKey(keyPressEvent, [MediumEditor.util.keyCode.SPACE, MediumEditor.util.keyCode.ENTER])) {
                clearTimeout(this.performLinkingTimeout);                                                              // 3756
                // Saving/restoring the selection in the middle of a keypress doesn't work well...                     // 3757
                this.performLinkingTimeout = setTimeout(function () {                                                  // 3758
                    try {                                                                                              // 3759
                        var sel = this.base.exportSelection();                                                         // 3760
                        if (this.performLinking(keyPressEvent.target)) {                                               // 3761
                            // pass true for favorLaterSelectionAnchor - this is needed for links at the end of a      // 3762
                            // paragraph in MS IE, or MS IE causes the link to be deleted right after adding it.       // 3763
                            this.base.importSelection(sel, true);                                                      // 3764
                        }                                                                                              // 3765
                    } catch (e) {                                                                                      // 3766
                        if (window.console) {                                                                          // 3767
                            window.console.error('Failed to perform linking', e);                                      // 3768
                        }                                                                                              // 3769
                        this.disableEventHandling = true;                                                              // 3770
                    }                                                                                                  // 3771
                }.bind(this), 0);                                                                                      // 3772
            }                                                                                                          // 3773
        },                                                                                                             // 3774
                                                                                                                       // 3775
        performLinking: function (contenteditable) {                                                                   // 3776
            // Perform linking on a paragraph level basis as otherwise the detection can wrongly find the end          // 3777
            // of one paragraph and the beginning of another paragraph to constitute a link, such as a paragraph ending
            // "link." and the next paragraph beginning with "my" is interpreted into "link.my" and the code tries to create
            // a link across blockElements - which doesn't work and is terrible.                                       // 3780
            // (Medium deletes the spaces/returns between P tags so the textContent ends up without paragraph spacing)
            var blockElements = MediumEditor.util.splitByBlockElements(contenteditable),                               // 3782
                documentModified = false;                                                                              // 3783
            if (blockElements.length === 0) {                                                                          // 3784
                blockElements = [contenteditable];                                                                     // 3785
            }                                                                                                          // 3786
            for (var i = 0; i < blockElements.length; i++) {                                                           // 3787
                documentModified = this.removeObsoleteAutoLinkSpans(blockElements[i]) || documentModified;             // 3788
                documentModified = this.performLinkingWithinElement(blockElements[i]) || documentModified;             // 3789
            }                                                                                                          // 3790
            return documentModified;                                                                                   // 3791
        },                                                                                                             // 3792
                                                                                                                       // 3793
        removeObsoleteAutoLinkSpans: function (element) {                                                              // 3794
            if (!element || element.nodeType === 3) {                                                                  // 3795
                return false;                                                                                          // 3796
            }                                                                                                          // 3797
                                                                                                                       // 3798
            var spans = element.querySelectorAll('span[data-auto-link="true"]'),                                       // 3799
                documentModified = false;                                                                              // 3800
                                                                                                                       // 3801
            for (var i = 0; i < spans.length; i++) {                                                                   // 3802
                var textContent = spans[i].textContent;                                                                // 3803
                if (textContent.indexOf('://') === -1) {                                                               // 3804
                    textContent = MediumEditor.util.ensureUrlHasProtocol(textContent);                                 // 3805
                }                                                                                                      // 3806
                if (spans[i].getAttribute('data-href') !== textContent && nodeIsNotInsideAnchorTag(spans[i])) {        // 3807
                    documentModified = true;                                                                           // 3808
                    var trimmedTextContent = textContent.replace(/\s+$/, '');                                          // 3809
                    if (spans[i].getAttribute('data-href') === trimmedTextContent) {                                   // 3810
                        var charactersTrimmed = textContent.length - trimmedTextContent.length,                        // 3811
                            subtree = MediumEditor.util.splitOffDOMTree(spans[i], this.splitTextBeforeEnd(spans[i], charactersTrimmed));
                        spans[i].parentNode.insertBefore(subtree, spans[i].nextSibling);                               // 3813
                    } else {                                                                                           // 3814
                        // Some editing has happened to the span, so just remove it entirely. The user can put it back
                        // around just the href content if they need to prevent it from linking                        // 3816
                        MediumEditor.util.unwrap(spans[i], this.document);                                             // 3817
                    }                                                                                                  // 3818
                }                                                                                                      // 3819
            }                                                                                                          // 3820
            return documentModified;                                                                                   // 3821
        },                                                                                                             // 3822
                                                                                                                       // 3823
        splitTextBeforeEnd: function (element, characterCount) {                                                       // 3824
            var treeWalker = this.document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false),               // 3825
                lastChildNotExhausted = true;                                                                          // 3826
                                                                                                                       // 3827
            // Start the tree walker at the last descendant of the span                                                // 3828
            while (lastChildNotExhausted) {                                                                            // 3829
                lastChildNotExhausted = treeWalker.lastChild() !== null;                                               // 3830
            }                                                                                                          // 3831
                                                                                                                       // 3832
            var currentNode,                                                                                           // 3833
                currentNodeValue,                                                                                      // 3834
                previousNode;                                                                                          // 3835
            while (characterCount > 0 && previousNode !== null) {                                                      // 3836
                currentNode = treeWalker.currentNode;                                                                  // 3837
                currentNodeValue = currentNode.nodeValue;                                                              // 3838
                if (currentNodeValue.length > characterCount) {                                                        // 3839
                    previousNode = currentNode.splitText(currentNodeValue.length - characterCount);                    // 3840
                    characterCount = 0;                                                                                // 3841
                } else {                                                                                               // 3842
                    previousNode = treeWalker.previousNode();                                                          // 3843
                    characterCount -= currentNodeValue.length;                                                         // 3844
                }                                                                                                      // 3845
            }                                                                                                          // 3846
            return previousNode;                                                                                       // 3847
        },                                                                                                             // 3848
                                                                                                                       // 3849
        performLinkingWithinElement: function (element) {                                                              // 3850
            var matches = this.findLinkableText(element),                                                              // 3851
                linkCreated = false;                                                                                   // 3852
                                                                                                                       // 3853
            for (var matchIndex = 0; matchIndex < matches.length; matchIndex++) {                                      // 3854
                var matchingTextNodes = MediumEditor.util.findOrCreateMatchingTextNodes(this.document, element,        // 3855
                        matches[matchIndex]);                                                                          // 3856
                if (this.shouldNotLink(matchingTextNodes)) {                                                           // 3857
                    continue;                                                                                          // 3858
                }                                                                                                      // 3859
                this.createAutoLink(matchingTextNodes, matches[matchIndex].href);                                      // 3860
            }                                                                                                          // 3861
            return linkCreated;                                                                                        // 3862
        },                                                                                                             // 3863
                                                                                                                       // 3864
        shouldNotLink: function (textNodes) {                                                                          // 3865
            var shouldNotLink = false;                                                                                 // 3866
            for (var i = 0; i < textNodes.length && shouldNotLink === false; i++) {                                    // 3867
                // Do not link if the text node is either inside an anchor or inside span[data-auto-link]              // 3868
                shouldNotLink = !!MediumEditor.util.traverseUp(textNodes[i], function (node) {                         // 3869
                    return node.nodeName.toLowerCase() === 'a' ||                                                      // 3870
                        (node.getAttribute && node.getAttribute('data-auto-link') === 'true');                         // 3871
                });                                                                                                    // 3872
            }                                                                                                          // 3873
            return shouldNotLink;                                                                                      // 3874
        },                                                                                                             // 3875
                                                                                                                       // 3876
        findLinkableText: function (contenteditable) {                                                                 // 3877
            var linkRegExp = new RegExp(LINK_REGEXP_TEXT, 'gi'),                                                       // 3878
                textContent = contenteditable.textContent,                                                             // 3879
                match = null,                                                                                          // 3880
                matches = [];                                                                                          // 3881
                                                                                                                       // 3882
            while ((match = linkRegExp.exec(textContent)) !== null) {                                                  // 3883
                var matchOk = true,                                                                                    // 3884
                    matchEnd = match.index + match[0].length;                                                          // 3885
                // If the regexp detected something as a link that has text immediately preceding/following it, bail out.
                matchOk = (match.index === 0 || WHITESPACE_CHARS.indexOf(textContent[match.index - 1]) !== -1) &&      // 3887
                    (matchEnd === textContent.length || WHITESPACE_CHARS.indexOf(textContent[matchEnd]) !== -1);       // 3888
                // If the regexp detected a bare domain that doesn't use one of our expected TLDs, bail out.           // 3889
                matchOk = matchOk && (match[0].indexOf('/') !== -1 ||                                                  // 3890
                    KNOWN_TLDS_REGEXP.test(match[0].split('.').pop().split('?').shift()));                             // 3891
                                                                                                                       // 3892
                if (matchOk) {                                                                                         // 3893
                    matches.push({                                                                                     // 3894
                        href: match[0],                                                                                // 3895
                        start: match.index,                                                                            // 3896
                        end: matchEnd                                                                                  // 3897
                    });                                                                                                // 3898
                }                                                                                                      // 3899
            }                                                                                                          // 3900
            return matches;                                                                                            // 3901
        },                                                                                                             // 3902
                                                                                                                       // 3903
        createAutoLink: function (textNodes, href) {                                                                   // 3904
            href = MediumEditor.util.ensureUrlHasProtocol(href);                                                       // 3905
            var anchor = MediumEditor.util.createLink(this.document, textNodes, href, this.getEditorOption('targetBlank') ? '_blank' : null),
                span = this.document.createElement('span');                                                            // 3907
            span.setAttribute('data-auto-link', 'true');                                                               // 3908
            span.setAttribute('data-href', href);                                                                      // 3909
            anchor.insertBefore(span, anchor.firstChild);                                                              // 3910
            while (anchor.childNodes.length > 1) {                                                                     // 3911
                span.appendChild(anchor.childNodes[1]);                                                                // 3912
            }                                                                                                          // 3913
        }                                                                                                              // 3914
                                                                                                                       // 3915
    });                                                                                                                // 3916
                                                                                                                       // 3917
    MediumEditor.extensions.autoLink = AutoLink;                                                                       // 3918
}());                                                                                                                  // 3919
(function () {                                                                                                         // 3920
    'use strict';                                                                                                      // 3921
                                                                                                                       // 3922
    var CLASS_DRAG_OVER = 'medium-editor-dragover';                                                                    // 3923
                                                                                                                       // 3924
    function clearClassNames(element) {                                                                                // 3925
        var editable = MediumEditor.util.getContainerEditorElement(element),                                           // 3926
            existing = Array.prototype.slice.call(editable.parentElement.querySelectorAll('.' + CLASS_DRAG_OVER));     // 3927
                                                                                                                       // 3928
        existing.forEach(function (el) {                                                                               // 3929
            el.classList.remove(CLASS_DRAG_OVER);                                                                      // 3930
        });                                                                                                            // 3931
    }                                                                                                                  // 3932
                                                                                                                       // 3933
    var FileDragging = MediumEditor.Extension.extend({                                                                 // 3934
        name: 'fileDragging',                                                                                          // 3935
                                                                                                                       // 3936
        allowedTypes: ['image'],                                                                                       // 3937
                                                                                                                       // 3938
        init: function () {                                                                                            // 3939
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 3940
                                                                                                                       // 3941
            this.subscribe('editableDrag', this.handleDrag.bind(this));                                                // 3942
            this.subscribe('editableDrop', this.handleDrop.bind(this));                                                // 3943
        },                                                                                                             // 3944
                                                                                                                       // 3945
        handleDrag: function (event) {                                                                                 // 3946
            event.preventDefault();                                                                                    // 3947
            event.dataTransfer.dropEffect = 'copy';                                                                    // 3948
                                                                                                                       // 3949
            var target = event.target.classList ? event.target : event.target.parentElement;                           // 3950
                                                                                                                       // 3951
            // Ensure the class gets removed from anything that had it before                                          // 3952
            clearClassNames(target);                                                                                   // 3953
                                                                                                                       // 3954
            if (event.type === 'dragover') {                                                                           // 3955
                target.classList.add(CLASS_DRAG_OVER);                                                                 // 3956
            }                                                                                                          // 3957
        },                                                                                                             // 3958
                                                                                                                       // 3959
        handleDrop: function (event) {                                                                                 // 3960
            // Prevent file from opening in the current window                                                         // 3961
            event.preventDefault();                                                                                    // 3962
            event.stopPropagation();                                                                                   // 3963
                                                                                                                       // 3964
            // IE9 does not support the File API, so prevent file from opening in the window                           // 3965
            // but also don't try to actually get the file                                                             // 3966
            if (event.dataTransfer.files) {                                                                            // 3967
                Array.prototype.slice.call(event.dataTransfer.files).forEach(function (file) {                         // 3968
                    if (this.isAllowedFile(file)) {                                                                    // 3969
                        if (file.type.match('image')) {                                                                // 3970
                            this.insertImageFile(file);                                                                // 3971
                        }                                                                                              // 3972
                    }                                                                                                  // 3973
                }, this);                                                                                              // 3974
            }                                                                                                          // 3975
                                                                                                                       // 3976
            // Make sure we remove our class from everything                                                           // 3977
            clearClassNames(event.target);                                                                             // 3978
        },                                                                                                             // 3979
                                                                                                                       // 3980
        isAllowedFile: function (file) {                                                                               // 3981
            return this.allowedTypes.some(function (fileType) {                                                        // 3982
                return !!file.type.match(fileType);                                                                    // 3983
            });                                                                                                        // 3984
        },                                                                                                             // 3985
                                                                                                                       // 3986
        insertImageFile: function (file) {                                                                             // 3987
            var fileReader = new FileReader();                                                                         // 3988
            fileReader.readAsDataURL(file);                                                                            // 3989
                                                                                                                       // 3990
            var id = 'medium-img-' + (+new Date());                                                                    // 3991
            MediumEditor.util.insertHTMLCommand(this.document, '<img class="medium-editor-image-loading" id="' + id + '" />');
                                                                                                                       // 3993
            fileReader.onload = function () {                                                                          // 3994
                var img = this.document.getElementById(id);                                                            // 3995
                if (img) {                                                                                             // 3996
                    img.removeAttribute('id');                                                                         // 3997
                    img.removeAttribute('class');                                                                      // 3998
                    img.src = fileReader.result;                                                                       // 3999
                }                                                                                                      // 4000
            }.bind(this);                                                                                              // 4001
        }                                                                                                              // 4002
    });                                                                                                                // 4003
                                                                                                                       // 4004
    MediumEditor.extensions.fileDragging = FileDragging;                                                               // 4005
}());                                                                                                                  // 4006
                                                                                                                       // 4007
(function () {                                                                                                         // 4008
    'use strict';                                                                                                      // 4009
                                                                                                                       // 4010
    var KeyboardCommands = MediumEditor.Extension.extend({                                                             // 4011
        name: 'keyboard-commands',                                                                                     // 4012
                                                                                                                       // 4013
        /* KeyboardCommands Options */                                                                                 // 4014
                                                                                                                       // 4015
        /* commands: [Array]                                                                                           // 4016
         * Array of objects describing each command and the combination of keys that will trigger it                   // 4017
         * Required for each object:                                                                                   // 4018
         *   command [String] (argument passed to editor.execAction())                                                 // 4019
         *   key [String] (keyboard character that triggers this command)                                              // 4020
         *   meta [boolean] (whether the ctrl/meta key has to be active or inactive)                                   // 4021
         *   shift [boolean] (whether the shift key has to be active or inactive)                                      // 4022
         *   alt [boolean] (whether the alt key has to be active or inactive)                                          // 4023
         */                                                                                                            // 4024
        commands: [                                                                                                    // 4025
            {                                                                                                          // 4026
                command: 'bold',                                                                                       // 4027
                key: 'B',                                                                                              // 4028
                meta: true,                                                                                            // 4029
                shift: false,                                                                                          // 4030
                alt: false                                                                                             // 4031
            },                                                                                                         // 4032
            {                                                                                                          // 4033
                command: 'italic',                                                                                     // 4034
                key: 'I',                                                                                              // 4035
                meta: true,                                                                                            // 4036
                shift: false,                                                                                          // 4037
                alt: false                                                                                             // 4038
            },                                                                                                         // 4039
            {                                                                                                          // 4040
                command: 'underline',                                                                                  // 4041
                key: 'U',                                                                                              // 4042
                meta: true,                                                                                            // 4043
                shift: false,                                                                                          // 4044
                alt: false                                                                                             // 4045
            }                                                                                                          // 4046
        ],                                                                                                             // 4047
                                                                                                                       // 4048
        init: function () {                                                                                            // 4049
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 4050
                                                                                                                       // 4051
            this.subscribe('editableKeydown', this.handleKeydown.bind(this));                                          // 4052
            this.keys = {};                                                                                            // 4053
            this.commands.forEach(function (command) {                                                                 // 4054
                var keyCode = command.key.charCodeAt(0);                                                               // 4055
                if (!this.keys[keyCode]) {                                                                             // 4056
                    this.keys[keyCode] = [];                                                                           // 4057
                }                                                                                                      // 4058
                this.keys[keyCode].push(command);                                                                      // 4059
            }, this);                                                                                                  // 4060
        },                                                                                                             // 4061
                                                                                                                       // 4062
        handleKeydown: function (event) {                                                                              // 4063
            var keyCode = MediumEditor.util.getKeyCode(event);                                                         // 4064
            if (!this.keys[keyCode]) {                                                                                 // 4065
                return;                                                                                                // 4066
            }                                                                                                          // 4067
                                                                                                                       // 4068
            var isMeta = MediumEditor.util.isMetaCtrlKey(event),                                                       // 4069
                isShift = !!event.shiftKey,                                                                            // 4070
                isAlt = !!event.altKey;                                                                                // 4071
                                                                                                                       // 4072
            this.keys[keyCode].forEach(function (data) {                                                               // 4073
                if (data.meta === isMeta &&                                                                            // 4074
                    data.shift === isShift &&                                                                          // 4075
                    (data.alt === isAlt ||                                                                             // 4076
                     undefined === data.alt)) { // TODO deprecated: remove check for undefined === data.alt when jumping to 6.0.0
                    event.preventDefault();                                                                            // 4078
                    event.stopPropagation();                                                                           // 4079
                                                                                                                       // 4080
                    // command can be false so the shortcut is just disabled                                           // 4081
                    if (false !== data.command) {                                                                      // 4082
                        this.execAction(data.command);                                                                 // 4083
                    }                                                                                                  // 4084
                }                                                                                                      // 4085
            }, this);                                                                                                  // 4086
        }                                                                                                              // 4087
    });                                                                                                                // 4088
                                                                                                                       // 4089
    MediumEditor.extensions.keyboardCommands = KeyboardCommands;                                                       // 4090
}());                                                                                                                  // 4091
                                                                                                                       // 4092
(function () {                                                                                                         // 4093
    'use strict';                                                                                                      // 4094
                                                                                                                       // 4095
    var FontSizeForm = MediumEditor.extensions.form.extend({                                                           // 4096
                                                                                                                       // 4097
        name: 'fontsize',                                                                                              // 4098
        action: 'fontSize',                                                                                            // 4099
        aria: 'increase/decrease font size',                                                                           // 4100
        contentDefault: '&#xB1;', // ±                                                                                 // 4101
        contentFA: '<i class="fa fa-text-height"></i>',                                                                // 4102
                                                                                                                       // 4103
        init: function () {                                                                                            // 4104
            MediumEditor.extensions.form.prototype.init.apply(this, arguments);                                        // 4105
        },                                                                                                             // 4106
                                                                                                                       // 4107
        // Called when the button the toolbar is clicked                                                               // 4108
        // Overrides ButtonExtension.handleClick                                                                       // 4109
        handleClick: function (event) {                                                                                // 4110
            event.preventDefault();                                                                                    // 4111
            event.stopPropagation();                                                                                   // 4112
                                                                                                                       // 4113
            if (!this.isDisplayed()) {                                                                                 // 4114
                // Get fontsize of current selection (convert to string since IE returns this as number)               // 4115
                var fontSize = this.document.queryCommandValue('fontSize') + '';                                       // 4116
                this.showForm(fontSize);                                                                               // 4117
            }                                                                                                          // 4118
                                                                                                                       // 4119
            return false;                                                                                              // 4120
        },                                                                                                             // 4121
                                                                                                                       // 4122
        // Called by medium-editor to append form to the toolbar                                                       // 4123
        getForm: function () {                                                                                         // 4124
            if (!this.form) {                                                                                          // 4125
                this.form = this.createForm();                                                                         // 4126
            }                                                                                                          // 4127
            return this.form;                                                                                          // 4128
        },                                                                                                             // 4129
                                                                                                                       // 4130
        // Used by medium-editor when the default toolbar is to be displayed                                           // 4131
        isDisplayed: function () {                                                                                     // 4132
            return this.getForm().style.display === 'block';                                                           // 4133
        },                                                                                                             // 4134
                                                                                                                       // 4135
        hideForm: function () {                                                                                        // 4136
            this.getForm().style.display = 'none';                                                                     // 4137
            this.getInput().value = '';                                                                                // 4138
        },                                                                                                             // 4139
                                                                                                                       // 4140
        showForm: function (fontSize) {                                                                                // 4141
            var input = this.getInput();                                                                               // 4142
                                                                                                                       // 4143
            this.base.saveSelection();                                                                                 // 4144
            this.hideToolbarDefaultActions();                                                                          // 4145
            this.getForm().style.display = 'block';                                                                    // 4146
            this.setToolbarPosition();                                                                                 // 4147
                                                                                                                       // 4148
            input.value = fontSize || '';                                                                              // 4149
            input.focus();                                                                                             // 4150
        },                                                                                                             // 4151
                                                                                                                       // 4152
        // Called by core when tearing down medium-editor (destroy)                                                    // 4153
        destroy: function () {                                                                                         // 4154
            if (!this.form) {                                                                                          // 4155
                return false;                                                                                          // 4156
            }                                                                                                          // 4157
                                                                                                                       // 4158
            if (this.form.parentNode) {                                                                                // 4159
                this.form.parentNode.removeChild(this.form);                                                           // 4160
            }                                                                                                          // 4161
                                                                                                                       // 4162
            delete this.form;                                                                                          // 4163
        },                                                                                                             // 4164
                                                                                                                       // 4165
        // core methods                                                                                                // 4166
                                                                                                                       // 4167
        doFormSave: function () {                                                                                      // 4168
            this.base.restoreSelection();                                                                              // 4169
            this.base.checkSelection();                                                                                // 4170
        },                                                                                                             // 4171
                                                                                                                       // 4172
        doFormCancel: function () {                                                                                    // 4173
            this.base.restoreSelection();                                                                              // 4174
            this.clearFontSize();                                                                                      // 4175
            this.base.checkSelection();                                                                                // 4176
        },                                                                                                             // 4177
                                                                                                                       // 4178
        // form creation and event handling                                                                            // 4179
        createForm: function () {                                                                                      // 4180
            var doc = this.document,                                                                                   // 4181
                form = doc.createElement('div'),                                                                       // 4182
                input = doc.createElement('input'),                                                                    // 4183
                close = doc.createElement('a'),                                                                        // 4184
                save = doc.createElement('a');                                                                         // 4185
                                                                                                                       // 4186
            // Font Size Form (div)                                                                                    // 4187
            form.className = 'medium-editor-toolbar-form';                                                             // 4188
            form.id = 'medium-editor-toolbar-form-fontsize-' + this.getEditorId();                                     // 4189
                                                                                                                       // 4190
            // Handle clicks on the form itself                                                                        // 4191
            this.on(form, 'click', this.handleFormClick.bind(this));                                                   // 4192
                                                                                                                       // 4193
            // Add font size slider                                                                                    // 4194
            input.setAttribute('type', 'range');                                                                       // 4195
            input.setAttribute('min', '1');                                                                            // 4196
            input.setAttribute('max', '7');                                                                            // 4197
            input.className = 'medium-editor-toolbar-input';                                                           // 4198
            form.appendChild(input);                                                                                   // 4199
                                                                                                                       // 4200
            // Handle typing in the textbox                                                                            // 4201
            this.on(input, 'change', this.handleSliderChange.bind(this));                                              // 4202
                                                                                                                       // 4203
            // Add save buton                                                                                          // 4204
            save.setAttribute('href', '#');                                                                            // 4205
            save.className = 'medium-editor-toobar-save';                                                              // 4206
            save.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?                                  // 4207
                             '<i class="fa fa-check"></i>' :                                                           // 4208
                             '&#10003;';                                                                               // 4209
            form.appendChild(save);                                                                                    // 4210
                                                                                                                       // 4211
            // Handle save button clicks (capture)                                                                     // 4212
            this.on(save, 'click', this.handleSaveClick.bind(this), true);                                             // 4213
                                                                                                                       // 4214
            // Add close button                                                                                        // 4215
            close.setAttribute('href', '#');                                                                           // 4216
            close.className = 'medium-editor-toobar-close';                                                            // 4217
            close.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?                                 // 4218
                              '<i class="fa fa-times"></i>' :                                                          // 4219
                              '&times;';                                                                               // 4220
            form.appendChild(close);                                                                                   // 4221
                                                                                                                       // 4222
            // Handle close button clicks                                                                              // 4223
            this.on(close, 'click', this.handleCloseClick.bind(this));                                                 // 4224
                                                                                                                       // 4225
            return form;                                                                                               // 4226
        },                                                                                                             // 4227
                                                                                                                       // 4228
        getInput: function () {                                                                                        // 4229
            return this.getForm().querySelector('input.medium-editor-toolbar-input');                                  // 4230
        },                                                                                                             // 4231
                                                                                                                       // 4232
        clearFontSize: function () {                                                                                   // 4233
            MediumEditor.selection.getSelectedElements(this.document).forEach(function (el) {                          // 4234
                if (el.nodeName.toLowerCase() === 'font' && el.hasAttribute('size')) {                                 // 4235
                    el.removeAttribute('size');                                                                        // 4236
                }                                                                                                      // 4237
            });                                                                                                        // 4238
        },                                                                                                             // 4239
                                                                                                                       // 4240
        handleSliderChange: function () {                                                                              // 4241
            var size = this.getInput().value;                                                                          // 4242
            if (size === '4') {                                                                                        // 4243
                this.clearFontSize();                                                                                  // 4244
            } else {                                                                                                   // 4245
                this.execAction('fontSize', { size: size });                                                           // 4246
            }                                                                                                          // 4247
        },                                                                                                             // 4248
                                                                                                                       // 4249
        handleFormClick: function (event) {                                                                            // 4250
            // make sure not to hide form when clicking inside the form                                                // 4251
            event.stopPropagation();                                                                                   // 4252
        },                                                                                                             // 4253
                                                                                                                       // 4254
        handleSaveClick: function (event) {                                                                            // 4255
            // Clicking Save -> create the font size                                                                   // 4256
            event.preventDefault();                                                                                    // 4257
            this.doFormSave();                                                                                         // 4258
        },                                                                                                             // 4259
                                                                                                                       // 4260
        handleCloseClick: function (event) {                                                                           // 4261
            // Click Close -> close the form                                                                           // 4262
            event.preventDefault();                                                                                    // 4263
            this.doFormCancel();                                                                                       // 4264
        }                                                                                                              // 4265
    });                                                                                                                // 4266
                                                                                                                       // 4267
    MediumEditor.extensions.fontSize = FontSizeForm;                                                                   // 4268
}());                                                                                                                  // 4269
(function () {                                                                                                         // 4270
    'use strict';                                                                                                      // 4271
    /*jslint regexp: true*/                                                                                            // 4272
    /*                                                                                                                 // 4273
        jslint does not allow character negation, because the negation                                                 // 4274
        will not match any unicode characters. In the regexes in this                                                  // 4275
        block, negation is used specifically to match the end of an html                                               // 4276
        tag, and in fact unicode characters *should* be allowed.                                                       // 4277
    */                                                                                                                 // 4278
    function createReplacements() {                                                                                    // 4279
        return [                                                                                                       // 4280
            // replace two bogus tags that begin pastes from google docs                                               // 4281
            [new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), ''],                                                      // 4282
            [new RegExp(/<\/b>(<br[^>]*>)?$/gi), ''],                                                                  // 4283
                                                                                                                       // 4284
             // un-html spaces and newlines inserted by OS X                                                           // 4285
            [new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g), ' '],                                     // 4286
            [new RegExp(/<br class="Apple-interchange-newline">/g), '<br>'],                                           // 4287
                                                                                                                       // 4288
            // replace google docs italics+bold with a span to be replaced once the html is inserted                   // 4289
            [new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi), '<span class="replace-with italic bold">'],
                                                                                                                       // 4291
            // replace google docs italics with a span to be replaced once the html is inserted                        // 4292
            [new RegExp(/<span[^>]*font-style:italic[^>]*>/gi), '<span class="replace-with italic">'],                 // 4293
                                                                                                                       // 4294
            //[replace google docs bolds with a span to be replaced once the html is inserted                          // 4295
            [new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi), '<span class="replace-with bold">'],                    // 4296
                                                                                                                       // 4297
             // replace manually entered b/i/a tags with real ones                                                     // 4298
            [new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi), '<$1$2>'],                                                          // 4299
                                                                                                                       // 4300
             // replace manually a tags with real ones, converting smart-quotes from google docs                       // 4301
            [new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi), '<a href="$1">'],
                                                                                                                       // 4303
            // Newlines between paragraphs in html have no syntactic value,                                            // 4304
            // but then have a tendency to accidentally become additional paragraphs down the line                     // 4305
            [new RegExp(/<\/p>\n+/gi), '</p>'],                                                                        // 4306
            [new RegExp(/\n+<p/gi), '<p'],                                                                             // 4307
                                                                                                                       // 4308
            // Microsoft Word makes these odd tags, like <o:p></o:p>                                                   // 4309
            [new RegExp(/<\/?o:[a-z]*>/gi), ''],                                                                       // 4310
                                                                                                                       // 4311
            // cleanup comments added by Chrome when pasting html                                                      // 4312
            ['<!--EndFragment-->', ''],                                                                                // 4313
            ['<!--StartFragment-->', '']                                                                               // 4314
        ];                                                                                                             // 4315
    }                                                                                                                  // 4316
    /*jslint regexp: false*/                                                                                           // 4317
                                                                                                                       // 4318
    var PasteHandler = MediumEditor.Extension.extend({                                                                 // 4319
        /* Paste Options */                                                                                            // 4320
                                                                                                                       // 4321
        /* forcePlainText: [boolean]                                                                                   // 4322
         * Forces pasting as plain text.                                                                               // 4323
         */                                                                                                            // 4324
        forcePlainText: true,                                                                                          // 4325
                                                                                                                       // 4326
        /* cleanPastedHTML: [boolean]                                                                                  // 4327
         * cleans pasted content from different sources, like google docs etc.                                         // 4328
         */                                                                                                            // 4329
        cleanPastedHTML: false,                                                                                        // 4330
                                                                                                                       // 4331
        /* cleanReplacements: [Array]                                                                                  // 4332
         * custom pairs (2 element arrays) of RegExp and replacement text to use during paste when                     // 4333
         * __forcePlainText__ or __cleanPastedHTML__ are `true` OR when calling `cleanPaste(text)` helper method.      // 4334
         */                                                                                                            // 4335
        cleanReplacements: [],                                                                                         // 4336
                                                                                                                       // 4337
        /* cleanAttrs:: [Array]                                                                                        // 4338
         * list of element attributes to remove during paste when __cleanPastedHTML__ is `true` or when                // 4339
         * calling `cleanPaste(text)` or `pasteHTML(html, options)` helper methods.                                    // 4340
         */                                                                                                            // 4341
        cleanAttrs: ['class', 'style', 'dir'],                                                                         // 4342
                                                                                                                       // 4343
        /* cleanTags: [Array]                                                                                          // 4344
         * list of element tag names to remove during paste when __cleanPastedHTML__ is `true` or when                 // 4345
         * calling `cleanPaste(text)` or `pasteHTML(html, options)` helper methods.                                    // 4346
         */                                                                                                            // 4347
        cleanTags: ['meta'],                                                                                           // 4348
                                                                                                                       // 4349
        init: function () {                                                                                            // 4350
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 4351
                                                                                                                       // 4352
            if (this.forcePlainText || this.cleanPastedHTML) {                                                         // 4353
                this.subscribe('editablePaste', this.handlePaste.bind(this));                                          // 4354
            }                                                                                                          // 4355
        },                                                                                                             // 4356
                                                                                                                       // 4357
        handlePaste: function (event, element) {                                                                       // 4358
            var paragraphs,                                                                                            // 4359
                html = '',                                                                                             // 4360
                p,                                                                                                     // 4361
                dataFormatHTML = 'text/html',                                                                          // 4362
                dataFormatPlain = 'text/plain',                                                                        // 4363
                pastedHTML,                                                                                            // 4364
                pastedPlain;                                                                                           // 4365
                                                                                                                       // 4366
            if (this.window.clipboardData && event.clipboardData === undefined) {                                      // 4367
                event.clipboardData = this.window.clipboardData;                                                       // 4368
                // If window.clipboardData exists, but event.clipboardData doesn't exist,                              // 4369
                // we're probably in IE. IE only has two possibilities for clipboard                                   // 4370
                // data format: 'Text' and 'URL'.                                                                      // 4371
                //                                                                                                     // 4372
                // Of the two, we want 'Text':                                                                         // 4373
                dataFormatHTML = 'Text';                                                                               // 4374
                dataFormatPlain = 'Text';                                                                              // 4375
            }                                                                                                          // 4376
                                                                                                                       // 4377
            if (event.clipboardData &&                                                                                 // 4378
                    event.clipboardData.getData &&                                                                     // 4379
                    !event.defaultPrevented) {                                                                         // 4380
                event.preventDefault();                                                                                // 4381
                                                                                                                       // 4382
                pastedHTML = event.clipboardData.getData(dataFormatHTML);                                              // 4383
                pastedPlain = event.clipboardData.getData(dataFormatPlain);                                            // 4384
                                                                                                                       // 4385
                if (this.cleanPastedHTML && pastedHTML) {                                                              // 4386
                    return this.cleanPaste(pastedHTML);                                                                // 4387
                }                                                                                                      // 4388
                                                                                                                       // 4389
                if (!(this.getEditorOption('disableReturn') || element.getAttribute('data-disable-return'))) {         // 4390
                    paragraphs = pastedPlain.split(/[\r\n]+/g);                                                        // 4391
                    // If there are no \r\n in data, don't wrap in <p>                                                 // 4392
                    if (paragraphs.length > 1) {                                                                       // 4393
                        for (p = 0; p < paragraphs.length; p += 1) {                                                   // 4394
                            if (paragraphs[p] !== '') {                                                                // 4395
                                html += '<p>' + MediumEditor.util.htmlEntities(paragraphs[p]) + '</p>';                // 4396
                            }                                                                                          // 4397
                        }                                                                                              // 4398
                    } else {                                                                                           // 4399
                        html = MediumEditor.util.htmlEntities(paragraphs[0]);                                          // 4400
                    }                                                                                                  // 4401
                } else {                                                                                               // 4402
                    html = MediumEditor.util.htmlEntities(pastedPlain);                                                // 4403
                }                                                                                                      // 4404
                MediumEditor.util.insertHTMLCommand(this.document, html);                                              // 4405
            }                                                                                                          // 4406
        },                                                                                                             // 4407
                                                                                                                       // 4408
        cleanPaste: function (text) {                                                                                  // 4409
            var i, elList, tmp, workEl,                                                                                // 4410
                multiline = /<p|<br|<div/.test(text),                                                                  // 4411
                replacements = createReplacements().concat(this.cleanReplacements || []);                              // 4412
                                                                                                                       // 4413
            for (i = 0; i < replacements.length; i += 1) {                                                             // 4414
                text = text.replace(replacements[i][0], replacements[i][1]);                                           // 4415
            }                                                                                                          // 4416
                                                                                                                       // 4417
            if (!multiline) {                                                                                          // 4418
                return this.pasteHTML(text);                                                                           // 4419
            }                                                                                                          // 4420
                                                                                                                       // 4421
            // create a temporary div to cleanup block elements                                                        // 4422
            tmp = this.document.createElement('div');                                                                  // 4423
                                                                                                                       // 4424
            // double br's aren't converted to p tags, but we want paragraphs.                                         // 4425
            tmp.innerHTML = '<p>' + text.split('<br><br>').join('</p><p>') + '</p>';                                   // 4426
                                                                                                                       // 4427
            // block element cleanup                                                                                   // 4428
            elList = tmp.querySelectorAll('a,p,div,br');                                                               // 4429
            for (i = 0; i < elList.length; i += 1) {                                                                   // 4430
                workEl = elList[i];                                                                                    // 4431
                                                                                                                       // 4432
                // Microsoft Word replaces some spaces with newlines.                                                  // 4433
                // While newlines between block elements are meaningless, newlines within                              // 4434
                // elements are sometimes actually spaces.                                                             // 4435
                workEl.innerHTML = workEl.innerHTML.replace(/\n/gi, ' ');                                              // 4436
                                                                                                                       // 4437
                switch (workEl.nodeName.toLowerCase()) {                                                               // 4438
                    case 'p':                                                                                          // 4439
                    case 'div':                                                                                        // 4440
                        this.filterCommonBlocks(workEl);                                                               // 4441
                        break;                                                                                         // 4442
                    case 'br':                                                                                         // 4443
                        this.filterLineBreak(workEl);                                                                  // 4444
                        break;                                                                                         // 4445
                }                                                                                                      // 4446
            }                                                                                                          // 4447
                                                                                                                       // 4448
            this.pasteHTML(tmp.innerHTML);                                                                             // 4449
        },                                                                                                             // 4450
                                                                                                                       // 4451
        pasteHTML: function (html, options) {                                                                          // 4452
            options = MediumEditor.util.defaults({}, options, {                                                        // 4453
                cleanAttrs: this.cleanAttrs,                                                                           // 4454
                cleanTags: this.cleanTags                                                                              // 4455
            });                                                                                                        // 4456
                                                                                                                       // 4457
            var elList, workEl, i, fragmentBody, pasteBlock = this.document.createDocumentFragment();                  // 4458
                                                                                                                       // 4459
            pasteBlock.appendChild(this.document.createElement('body'));                                               // 4460
                                                                                                                       // 4461
            fragmentBody = pasteBlock.querySelector('body');                                                           // 4462
            fragmentBody.innerHTML = html;                                                                             // 4463
                                                                                                                       // 4464
            this.cleanupSpans(fragmentBody);                                                                           // 4465
                                                                                                                       // 4466
            elList = fragmentBody.querySelectorAll('*');                                                               // 4467
            for (i = 0; i < elList.length; i += 1) {                                                                   // 4468
                workEl = elList[i];                                                                                    // 4469
                                                                                                                       // 4470
                if ('a' === workEl.nodeName.toLowerCase() && this.getEditorOption('targetBlank')) {                    // 4471
                    MediumEditor.util.setTargetBlank(workEl);                                                          // 4472
                }                                                                                                      // 4473
                                                                                                                       // 4474
                MediumEditor.util.cleanupAttrs(workEl, options.cleanAttrs);                                            // 4475
                MediumEditor.util.cleanupTags(workEl, options.cleanTags);                                              // 4476
            }                                                                                                          // 4477
                                                                                                                       // 4478
            MediumEditor.util.insertHTMLCommand(this.document, fragmentBody.innerHTML.replace(/&nbsp;/g, ' '));        // 4479
        },                                                                                                             // 4480
                                                                                                                       // 4481
        isCommonBlock: function (el) {                                                                                 // 4482
            return (el && (el.nodeName.toLowerCase() === 'p' || el.nodeName.toLowerCase() === 'div'));                 // 4483
        },                                                                                                             // 4484
                                                                                                                       // 4485
        filterCommonBlocks: function (el) {                                                                            // 4486
            if (/^\s*$/.test(el.textContent) && el.parentNode) {                                                       // 4487
                el.parentNode.removeChild(el);                                                                         // 4488
            }                                                                                                          // 4489
        },                                                                                                             // 4490
                                                                                                                       // 4491
        filterLineBreak: function (el) {                                                                               // 4492
            if (this.isCommonBlock(el.previousElementSibling)) {                                                       // 4493
                // remove stray br's following common block elements                                                   // 4494
                this.removeWithParent(el);                                                                             // 4495
            } else if (this.isCommonBlock(el.parentNode) && (el.parentNode.firstChild === el || el.parentNode.lastChild === el)) {
                // remove br's just inside open or close tags of a div/p                                               // 4497
                this.removeWithParent(el);                                                                             // 4498
            } else if (el.parentNode && el.parentNode.childElementCount === 1 && el.parentNode.textContent === '') {   // 4499
                // and br's that are the only child of elements other than div/p                                       // 4500
                this.removeWithParent(el);                                                                             // 4501
            }                                                                                                          // 4502
        },                                                                                                             // 4503
                                                                                                                       // 4504
        // remove an element, including its parent, if it is the only element within its parent                        // 4505
        removeWithParent: function (el) {                                                                              // 4506
            if (el && el.parentNode) {                                                                                 // 4507
                if (el.parentNode.parentNode && el.parentNode.childElementCount === 1) {                               // 4508
                    el.parentNode.parentNode.removeChild(el.parentNode);                                               // 4509
                } else {                                                                                               // 4510
                    el.parentNode.removeChild(el);                                                                     // 4511
                }                                                                                                      // 4512
            }                                                                                                          // 4513
        },                                                                                                             // 4514
                                                                                                                       // 4515
        cleanupSpans: function (containerEl) {                                                                         // 4516
            var i,                                                                                                     // 4517
                el,                                                                                                    // 4518
                newEl,                                                                                                 // 4519
                spans = containerEl.querySelectorAll('.replace-with'),                                                 // 4520
                isCEF = function (el) {                                                                                // 4521
                    return (el && el.nodeName !== '#text' && el.getAttribute('contenteditable') === 'false');          // 4522
                };                                                                                                     // 4523
                                                                                                                       // 4524
            for (i = 0; i < spans.length; i += 1) {                                                                    // 4525
                el = spans[i];                                                                                         // 4526
                newEl = this.document.createElement(el.classList.contains('bold') ? 'b' : 'i');                        // 4527
                                                                                                                       // 4528
                if (el.classList.contains('bold') && el.classList.contains('italic')) {                                // 4529
                    // add an i tag as well if this has both italics and bold                                          // 4530
                    newEl.innerHTML = '<i>' + el.innerHTML + '</i>';                                                   // 4531
                } else {                                                                                               // 4532
                    newEl.innerHTML = el.innerHTML;                                                                    // 4533
                }                                                                                                      // 4534
                el.parentNode.replaceChild(newEl, el);                                                                 // 4535
            }                                                                                                          // 4536
                                                                                                                       // 4537
            spans = containerEl.querySelectorAll('span');                                                              // 4538
            for (i = 0; i < spans.length; i += 1) {                                                                    // 4539
                el = spans[i];                                                                                         // 4540
                                                                                                                       // 4541
                // bail if span is in contenteditable = false                                                          // 4542
                if (MediumEditor.util.traverseUp(el, isCEF)) {                                                         // 4543
                    return false;                                                                                      // 4544
                }                                                                                                      // 4545
                                                                                                                       // 4546
                // remove empty spans, replace others with their contents                                              // 4547
                MediumEditor.util.unwrap(el, this.document);                                                           // 4548
            }                                                                                                          // 4549
        }                                                                                                              // 4550
    });                                                                                                                // 4551
                                                                                                                       // 4552
    MediumEditor.extensions.paste = PasteHandler;                                                                      // 4553
}());                                                                                                                  // 4554
                                                                                                                       // 4555
(function () {                                                                                                         // 4556
    'use strict';                                                                                                      // 4557
                                                                                                                       // 4558
    var Placeholder = MediumEditor.Extension.extend({                                                                  // 4559
        name: 'placeholder',                                                                                           // 4560
                                                                                                                       // 4561
        /* Placeholder Options */                                                                                      // 4562
                                                                                                                       // 4563
        /* text: [string]                                                                                              // 4564
         * Text to display in the placeholder                                                                          // 4565
         */                                                                                                            // 4566
        text: 'Type your text',                                                                                        // 4567
                                                                                                                       // 4568
        /* hideOnClick: [boolean]                                                                                      // 4569
         * Should we hide the placeholder on click (true) or when user starts typing (false)                           // 4570
         */                                                                                                            // 4571
        hideOnClick: true,                                                                                             // 4572
                                                                                                                       // 4573
        init: function () {                                                                                            // 4574
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 4575
                                                                                                                       // 4576
            this.initPlaceholders();                                                                                   // 4577
            this.attachEventHandlers();                                                                                // 4578
        },                                                                                                             // 4579
                                                                                                                       // 4580
        initPlaceholders: function () {                                                                                // 4581
            this.getEditorElements().forEach(function (el) {                                                           // 4582
                if (!el.getAttribute('data-placeholder')) {                                                            // 4583
                    el.setAttribute('data-placeholder', this.text);                                                    // 4584
                }                                                                                                      // 4585
                this.updatePlaceholder(el);                                                                            // 4586
            }, this);                                                                                                  // 4587
        },                                                                                                             // 4588
                                                                                                                       // 4589
        destroy: function () {                                                                                         // 4590
            this.getEditorElements().forEach(function (el) {                                                           // 4591
                if (el.getAttribute('data-placeholder') === this.text) {                                               // 4592
                    el.removeAttribute('data-placeholder');                                                            // 4593
                }                                                                                                      // 4594
            }, this);                                                                                                  // 4595
        },                                                                                                             // 4596
                                                                                                                       // 4597
        showPlaceholder: function (el) {                                                                               // 4598
            if (el) {                                                                                                  // 4599
                el.classList.add('medium-editor-placeholder');                                                         // 4600
            }                                                                                                          // 4601
        },                                                                                                             // 4602
                                                                                                                       // 4603
        hidePlaceholder: function (el) {                                                                               // 4604
            if (el) {                                                                                                  // 4605
                el.classList.remove('medium-editor-placeholder');                                                      // 4606
            }                                                                                                          // 4607
        },                                                                                                             // 4608
                                                                                                                       // 4609
        updatePlaceholder: function (el, dontShow) {                                                                   // 4610
            // If the element has content, hide the placeholder                                                        // 4611
            if (el.querySelector('img, blockquote, ul, ol') || (el.textContent.replace(/^\s+|\s+$/g, '') !== '')) {    // 4612
                return this.hidePlaceholder(el);                                                                       // 4613
            }                                                                                                          // 4614
                                                                                                                       // 4615
            if (!dontShow) {                                                                                           // 4616
                this.showPlaceholder(el);                                                                              // 4617
            }                                                                                                          // 4618
        },                                                                                                             // 4619
                                                                                                                       // 4620
        attachEventHandlers: function () {                                                                             // 4621
            if (this.hideOnClick) {                                                                                    // 4622
                // For the 'hideOnClick' option, the placeholder should always be hidden on focus                      // 4623
                this.subscribe('focus', this.handleFocus.bind(this));                                                  // 4624
            }                                                                                                          // 4625
                                                                                                                       // 4626
            // If the editor has content, it should always hide the placeholder                                        // 4627
            this.subscribe('editableInput', this.handleInput.bind(this));                                              // 4628
                                                                                                                       // 4629
            // When the editor loses focus, check if the placeholder should be visible                                 // 4630
            this.subscribe('blur', this.handleBlur.bind(this));                                                        // 4631
        },                                                                                                             // 4632
                                                                                                                       // 4633
        handleInput: function (event, element) {                                                                       // 4634
            // If the placeholder should be hidden on focus and the                                                    // 4635
            // element has focus, don't show the placeholder                                                           // 4636
            var dontShow = this.hideOnClick && (element === this.base.getFocusedElement());                            // 4637
                                                                                                                       // 4638
            // Editor's content has changed, check if the placeholder should be hidden                                 // 4639
            this.updatePlaceholder(element, dontShow);                                                                 // 4640
        },                                                                                                             // 4641
                                                                                                                       // 4642
        handleFocus: function (event, element) {                                                                       // 4643
            // Editor has focus, hide the placeholder                                                                  // 4644
            this.hidePlaceholder(element);                                                                             // 4645
        },                                                                                                             // 4646
                                                                                                                       // 4647
        handleBlur: function (event, element) {                                                                        // 4648
            // Editor has lost focus, check if the placeholder should be shown                                         // 4649
            this.updatePlaceholder(element);                                                                           // 4650
        }                                                                                                              // 4651
    });                                                                                                                // 4652
                                                                                                                       // 4653
    MediumEditor.extensions.placeholder = Placeholder;                                                                 // 4654
}());                                                                                                                  // 4655
                                                                                                                       // 4656
(function () {                                                                                                         // 4657
    'use strict';                                                                                                      // 4658
                                                                                                                       // 4659
    var Toolbar = MediumEditor.Extension.extend({                                                                      // 4660
        name: 'toolbar',                                                                                               // 4661
                                                                                                                       // 4662
        /* Toolbar Options */                                                                                          // 4663
                                                                                                                       // 4664
        /* align: ['left'|'center'|'right']                                                                            // 4665
         * When the __static__ option is true, this aligns the static toolbar                                          // 4666
         * relative to the medium-editor element.                                                                      // 4667
         */                                                                                                            // 4668
        align: 'center',                                                                                               // 4669
                                                                                                                       // 4670
        /* allowMultiParagraphSelection: [boolean]                                                                     // 4671
         * enables/disables whether the toolbar should be displayed when                                               // 4672
         * selecting multiple paragraphs/block elements                                                                // 4673
         */                                                                                                            // 4674
        allowMultiParagraphSelection: true,                                                                            // 4675
                                                                                                                       // 4676
        /* buttons: [Array]                                                                                            // 4677
         * the names of the set of buttons to display on the toolbar.                                                  // 4678
         */                                                                                                            // 4679
        buttons: ['bold', 'italic', 'underline', 'anchor', 'h2', 'h3', 'quote'],                                       // 4680
                                                                                                                       // 4681
        /* diffLeft: [Number]                                                                                          // 4682
         * value in pixels to be added to the X axis positioning of the toolbar.                                       // 4683
         */                                                                                                            // 4684
        diffLeft: 0,                                                                                                   // 4685
                                                                                                                       // 4686
        /* diffTop: [Number]                                                                                           // 4687
         * value in pixels to be added to the Y axis positioning of the toolbar.                                       // 4688
         */                                                                                                            // 4689
        diffTop: -10,                                                                                                  // 4690
                                                                                                                       // 4691
        /* firstButtonClass: [string]                                                                                  // 4692
         * CSS class added to the first button in the toolbar.                                                         // 4693
         */                                                                                                            // 4694
        firstButtonClass: 'medium-editor-button-first',                                                                // 4695
                                                                                                                       // 4696
        /* lastButtonClass: [string]                                                                                   // 4697
         * CSS class added to the last button in the toolbar.                                                          // 4698
         */                                                                                                            // 4699
        lastButtonClass: 'medium-editor-button-last',                                                                  // 4700
                                                                                                                       // 4701
        /* standardizeSelectionStart: [boolean]                                                                        // 4702
         * enables/disables standardizing how the beginning of a range is decided                                      // 4703
         * between browsers whenever the selected text is analyzed for updating toolbar buttons status.                // 4704
         */                                                                                                            // 4705
        standardizeSelectionStart: false,                                                                              // 4706
                                                                                                                       // 4707
        /* static: [boolean]                                                                                           // 4708
         * enable/disable the toolbar always displaying in the same location                                           // 4709
         * relative to the medium-editor element.                                                                      // 4710
         */                                                                                                            // 4711
        static: false,                                                                                                 // 4712
                                                                                                                       // 4713
        /* sticky: [boolean]                                                                                           // 4714
         * When the __static__ option is true, this enables/disables the toolbar                                       // 4715
         * "sticking" to the viewport and staying visible on the screen while                                          // 4716
         * the page scrolls.                                                                                           // 4717
         */                                                                                                            // 4718
        sticky: false,                                                                                                 // 4719
                                                                                                                       // 4720
        /* updateOnEmptySelection: [boolean]                                                                           // 4721
         * When the __static__ option is true, this enables/disables updating                                          // 4722
         * the state of the toolbar buttons even when the selection is collapsed                                       // 4723
         * (there is no selection, just a cursor).                                                                     // 4724
         */                                                                                                            // 4725
        updateOnEmptySelection: false,                                                                                 // 4726
                                                                                                                       // 4727
        /* relativeContainer: [node]                                                                                   // 4728
         * appending the toolbar to a given node instead of body                                                       // 4729
         */                                                                                                            // 4730
        relativeContainer: null,                                                                                       // 4731
                                                                                                                       // 4732
        init: function () {                                                                                            // 4733
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 4734
                                                                                                                       // 4735
            this.initThrottledMethods();                                                                               // 4736
                                                                                                                       // 4737
            if (!this.relativeContainer) {                                                                             // 4738
                this.getEditorOption('elementsContainer').appendChild(this.getToolbarElement());                       // 4739
            } else {                                                                                                   // 4740
                this.relativeContainer.appendChild(this.getToolbarElement());                                          // 4741
            }                                                                                                          // 4742
        },                                                                                                             // 4743
                                                                                                                       // 4744
        // Helper method to execute method for every extension, but ignoring the toolbar extension                     // 4745
        forEachExtension: function (iterator, context) {                                                               // 4746
            return this.base.extensions.forEach(function (command) {                                                   // 4747
                if (command === this) {                                                                                // 4748
                    return;                                                                                            // 4749
                }                                                                                                      // 4750
                return iterator.apply(context || this, arguments);                                                     // 4751
            }, this);                                                                                                  // 4752
        },                                                                                                             // 4753
                                                                                                                       // 4754
        // Toolbar creation/deletion                                                                                   // 4755
                                                                                                                       // 4756
        createToolbar: function () {                                                                                   // 4757
            var toolbar = this.document.createElement('div');                                                          // 4758
                                                                                                                       // 4759
            toolbar.id = 'medium-editor-toolbar-' + this.getEditorId();                                                // 4760
            toolbar.className = 'medium-editor-toolbar';                                                               // 4761
                                                                                                                       // 4762
            if (this.static) {                                                                                         // 4763
                toolbar.className += ' static-toolbar';                                                                // 4764
            } else if (this.relativeContainer) {                                                                       // 4765
                toolbar.className += ' medium-editor-relative-toolbar';                                                // 4766
            } else {                                                                                                   // 4767
                toolbar.className += ' medium-editor-stalker-toolbar';                                                 // 4768
            }                                                                                                          // 4769
                                                                                                                       // 4770
            toolbar.appendChild(this.createToolbarButtons());                                                          // 4771
                                                                                                                       // 4772
            // Add any forms that extensions may have                                                                  // 4773
            this.forEachExtension(function (extension) {                                                               // 4774
                if (extension.hasForm) {                                                                               // 4775
                    toolbar.appendChild(extension.getForm());                                                          // 4776
                }                                                                                                      // 4777
            });                                                                                                        // 4778
                                                                                                                       // 4779
            this.attachEventHandlers();                                                                                // 4780
                                                                                                                       // 4781
            return toolbar;                                                                                            // 4782
        },                                                                                                             // 4783
                                                                                                                       // 4784
        createToolbarButtons: function () {                                                                            // 4785
            var ul = this.document.createElement('ul'),                                                                // 4786
                li,                                                                                                    // 4787
                btn,                                                                                                   // 4788
                buttons,                                                                                               // 4789
                extension,                                                                                             // 4790
                buttonName,                                                                                            // 4791
                buttonOpts;                                                                                            // 4792
                                                                                                                       // 4793
            ul.id = 'medium-editor-toolbar-actions' + this.getEditorId();                                              // 4794
            ul.className = 'medium-editor-toolbar-actions';                                                            // 4795
            ul.style.display = 'block';                                                                                // 4796
                                                                                                                       // 4797
            this.buttons.forEach(function (button) {                                                                   // 4798
                if (typeof button === 'string') {                                                                      // 4799
                    buttonName = button;                                                                               // 4800
                    buttonOpts = null;                                                                                 // 4801
                } else {                                                                                               // 4802
                    buttonName = button.name;                                                                          // 4803
                    buttonOpts = button;                                                                               // 4804
                }                                                                                                      // 4805
                                                                                                                       // 4806
                // If the button already exists as an extension, it'll be returned                                     // 4807
                // othwerise it'll create the default built-in button                                                  // 4808
                extension = this.base.addBuiltInExtension(buttonName, buttonOpts);                                     // 4809
                                                                                                                       // 4810
                if (extension && typeof extension.getButton === 'function') {                                          // 4811
                    btn = extension.getButton(this.base);                                                              // 4812
                    li = this.document.createElement('li');                                                            // 4813
                    if (MediumEditor.util.isElement(btn)) {                                                            // 4814
                        li.appendChild(btn);                                                                           // 4815
                    } else {                                                                                           // 4816
                        li.innerHTML = btn;                                                                            // 4817
                    }                                                                                                  // 4818
                    ul.appendChild(li);                                                                                // 4819
                }                                                                                                      // 4820
            }, this);                                                                                                  // 4821
                                                                                                                       // 4822
            buttons = ul.querySelectorAll('button');                                                                   // 4823
            if (buttons.length > 0) {                                                                                  // 4824
                buttons[0].classList.add(this.firstButtonClass);                                                       // 4825
                buttons[buttons.length - 1].classList.add(this.lastButtonClass);                                       // 4826
            }                                                                                                          // 4827
                                                                                                                       // 4828
            return ul;                                                                                                 // 4829
        },                                                                                                             // 4830
                                                                                                                       // 4831
        destroy: function () {                                                                                         // 4832
            if (this.toolbar) {                                                                                        // 4833
                if (this.toolbar.parentNode) {                                                                         // 4834
                    this.toolbar.parentNode.removeChild(this.toolbar);                                                 // 4835
                }                                                                                                      // 4836
                delete this.toolbar;                                                                                   // 4837
            }                                                                                                          // 4838
        },                                                                                                             // 4839
                                                                                                                       // 4840
        // Toolbar accessors                                                                                           // 4841
                                                                                                                       // 4842
        getToolbarElement: function () {                                                                               // 4843
            if (!this.toolbar) {                                                                                       // 4844
                this.toolbar = this.createToolbar();                                                                   // 4845
            }                                                                                                          // 4846
                                                                                                                       // 4847
            return this.toolbar;                                                                                       // 4848
        },                                                                                                             // 4849
                                                                                                                       // 4850
        getToolbarActionsElement: function () {                                                                        // 4851
            return this.getToolbarElement().querySelector('.medium-editor-toolbar-actions');                           // 4852
        },                                                                                                             // 4853
                                                                                                                       // 4854
        // Toolbar event handlers                                                                                      // 4855
                                                                                                                       // 4856
        initThrottledMethods: function () {                                                                            // 4857
            // throttledPositionToolbar is throttled because:                                                          // 4858
            // - It will be called when the browser is resizing, which can fire many times very quickly                // 4859
            // - For some event (like resize) a slight lag in UI responsiveness is OK and provides performance benefits
            this.throttledPositionToolbar = MediumEditor.util.throttle(function () {                                   // 4861
                if (this.base.isActive) {                                                                              // 4862
                    this.positionToolbarIfShown();                                                                     // 4863
                }                                                                                                      // 4864
            }.bind(this));                                                                                             // 4865
        },                                                                                                             // 4866
                                                                                                                       // 4867
        attachEventHandlers: function () {                                                                             // 4868
            // MediumEditor custom events for when user beings and ends interaction with a contenteditable and its elements
            this.subscribe('blur', this.handleBlur.bind(this));                                                        // 4870
            this.subscribe('focus', this.handleFocus.bind(this));                                                      // 4871
                                                                                                                       // 4872
            // Updating the state of the toolbar as things change                                                      // 4873
            this.subscribe('editableClick', this.handleEditableClick.bind(this));                                      // 4874
            this.subscribe('editableKeyup', this.handleEditableKeyup.bind(this));                                      // 4875
                                                                                                                       // 4876
            // Handle mouseup on document for updating the selection in the toolbar                                    // 4877
            this.on(this.document.documentElement, 'mouseup', this.handleDocumentMouseup.bind(this));                  // 4878
                                                                                                                       // 4879
            // Add a scroll event for sticky toolbar                                                                   // 4880
            if (this.static && this.sticky) {                                                                          // 4881
                // On scroll (capture), re-position the toolbar                                                        // 4882
                this.on(this.window, 'scroll', this.handleWindowScroll.bind(this), true);                              // 4883
            }                                                                                                          // 4884
                                                                                                                       // 4885
            // On resize, re-position the toolbar                                                                      // 4886
            this.on(this.window, 'resize', this.handleWindowResize.bind(this));                                        // 4887
        },                                                                                                             // 4888
                                                                                                                       // 4889
        handleWindowScroll: function () {                                                                              // 4890
            this.positionToolbarIfShown();                                                                             // 4891
        },                                                                                                             // 4892
                                                                                                                       // 4893
        handleWindowResize: function () {                                                                              // 4894
            this.throttledPositionToolbar();                                                                           // 4895
        },                                                                                                             // 4896
                                                                                                                       // 4897
        handleDocumentMouseup: function (event) {                                                                      // 4898
            // Do not trigger checkState when mouseup fires over the toolbar                                           // 4899
            if (event &&                                                                                               // 4900
                    event.target &&                                                                                    // 4901
                    MediumEditor.util.isDescendant(this.getToolbarElement(), event.target)) {                          // 4902
                return false;                                                                                          // 4903
            }                                                                                                          // 4904
            this.checkState();                                                                                         // 4905
        },                                                                                                             // 4906
                                                                                                                       // 4907
        handleEditableClick: function () {                                                                             // 4908
            // Delay the call to checkState to handle bug where selection is empty                                     // 4909
            // immediately after clicking inside a pre-existing selection                                              // 4910
            setTimeout(function () {                                                                                   // 4911
                this.checkState();                                                                                     // 4912
            }.bind(this), 0);                                                                                          // 4913
        },                                                                                                             // 4914
                                                                                                                       // 4915
        handleEditableKeyup: function () {                                                                             // 4916
            this.checkState();                                                                                         // 4917
        },                                                                                                             // 4918
                                                                                                                       // 4919
        handleBlur: function () {                                                                                      // 4920
            // Kill any previously delayed calls to hide the toolbar                                                   // 4921
            clearTimeout(this.hideTimeout);                                                                            // 4922
                                                                                                                       // 4923
            // Blur may fire even if we have a selection, so we want to prevent any delayed showToolbar                // 4924
            // calls from happening in this specific case                                                              // 4925
            clearTimeout(this.delayShowTimeout);                                                                       // 4926
                                                                                                                       // 4927
            // Delay the call to hideToolbar to handle bug with multiple editors on the page at once                   // 4928
            this.hideTimeout = setTimeout(function () {                                                                // 4929
                this.hideToolbar();                                                                                    // 4930
            }.bind(this), 1);                                                                                          // 4931
        },                                                                                                             // 4932
                                                                                                                       // 4933
        handleFocus: function () {                                                                                     // 4934
            this.checkState();                                                                                         // 4935
        },                                                                                                             // 4936
                                                                                                                       // 4937
        // Hiding/showing toolbar                                                                                      // 4938
                                                                                                                       // 4939
        isDisplayed: function () {                                                                                     // 4940
            return this.getToolbarElement().classList.contains('medium-editor-toolbar-active');                        // 4941
        },                                                                                                             // 4942
                                                                                                                       // 4943
        showToolbar: function () {                                                                                     // 4944
            clearTimeout(this.hideTimeout);                                                                            // 4945
            if (!this.isDisplayed()) {                                                                                 // 4946
                this.getToolbarElement().classList.add('medium-editor-toolbar-active');                                // 4947
                this.trigger('showToolbar', {}, this.base.getFocusedElement());                                        // 4948
            }                                                                                                          // 4949
        },                                                                                                             // 4950
                                                                                                                       // 4951
        hideToolbar: function () {                                                                                     // 4952
            if (this.isDisplayed()) {                                                                                  // 4953
                this.getToolbarElement().classList.remove('medium-editor-toolbar-active');                             // 4954
                this.trigger('hideToolbar', {}, this.base.getFocusedElement());                                        // 4955
            }                                                                                                          // 4956
        },                                                                                                             // 4957
                                                                                                                       // 4958
        isToolbarDefaultActionsDisplayed: function () {                                                                // 4959
            return this.getToolbarActionsElement().style.display === 'block';                                          // 4960
        },                                                                                                             // 4961
                                                                                                                       // 4962
        hideToolbarDefaultActions: function () {                                                                       // 4963
            if (this.isToolbarDefaultActionsDisplayed()) {                                                             // 4964
                this.getToolbarActionsElement().style.display = 'none';                                                // 4965
            }                                                                                                          // 4966
        },                                                                                                             // 4967
                                                                                                                       // 4968
        showToolbarDefaultActions: function () {                                                                       // 4969
            this.hideExtensionForms();                                                                                 // 4970
                                                                                                                       // 4971
            if (!this.isToolbarDefaultActionsDisplayed()) {                                                            // 4972
                this.getToolbarActionsElement().style.display = 'block';                                               // 4973
            }                                                                                                          // 4974
                                                                                                                       // 4975
            // Using setTimeout + options.delay because:                                                               // 4976
            // We will actually be displaying the toolbar, which should be controlled by options.delay                 // 4977
            this.delayShowTimeout = this.base.delay(function () {                                                      // 4978
                this.showToolbar();                                                                                    // 4979
            }.bind(this));                                                                                             // 4980
        },                                                                                                             // 4981
                                                                                                                       // 4982
        hideExtensionForms: function () {                                                                              // 4983
            // Hide all extension forms                                                                                // 4984
            this.forEachExtension(function (extension) {                                                               // 4985
                if (extension.hasForm && extension.isDisplayed()) {                                                    // 4986
                    extension.hideForm();                                                                              // 4987
                }                                                                                                      // 4988
            });                                                                                                        // 4989
        },                                                                                                             // 4990
                                                                                                                       // 4991
        // Responding to changes in user selection                                                                     // 4992
                                                                                                                       // 4993
        // Checks for existance of multiple block elements in the current selection                                    // 4994
        multipleBlockElementsSelected: function () {                                                                   // 4995
            var regexEmptyHTMLTags = /<[^\/>][^>]*><\/[^>]+>/gim, // http://stackoverflow.com/questions/3129738/remove-empty-tags-using-regex
                regexBlockElements = new RegExp('<(' + MediumEditor.util.blockContainerElementNames.join('|') + ')[^>]*>', 'g'),
                selectionHTML = MediumEditor.selection.getSelectionHtml(this.document).replace(regexEmptyHTMLTags, ''), // Filter out empty blocks from selection
                hasMultiParagraphs = selectionHTML.match(regexBlockElements); // Find how many block elements are within the html
                                                                                                                       // 5000
            return !!hasMultiParagraphs && hasMultiParagraphs.length > 1;                                              // 5001
        },                                                                                                             // 5002
                                                                                                                       // 5003
        modifySelection: function () {                                                                                 // 5004
            var selection = this.window.getSelection(),                                                                // 5005
                selectionRange = selection.getRangeAt(0);                                                              // 5006
                                                                                                                       // 5007
            /*                                                                                                         // 5008
            * In firefox, there are cases (ie doubleclick of a word) where the selectionRange start                    // 5009
            * will be at the very end of an element.  In other browsers, the selectionRange start                      // 5010
            * would instead be at the very beginning of an element that actually has content.                          // 5011
            * example:                                                                                                 // 5012
            *   <span>foo</span><span>bar</span>                                                                       // 5013
            *                                                                                                          // 5014
            * If the text 'bar' is selected, most browsers will have the selectionRange start at the beginning         // 5015
            * of the 'bar' span.  However, there are cases where firefox will have the selectionRange start            // 5016
            * at the end of the 'foo' span.  The contenteditable behavior will be ok, but if there are any             // 5017
            * properties on the 'bar' span, they won't be reflected accurately in the toolbar                          // 5018
            * (ie 'Bold' button wouldn't be active)                                                                    // 5019
            *                                                                                                          // 5020
            * So, for cases where the selectionRange start is at the end of an element/node, find the next             // 5021
            * adjacent text node that actually has content in it, and move the selectionRange start there.             // 5022
            */                                                                                                         // 5023
            if (this.standardizeSelectionStart &&                                                                      // 5024
                    selectionRange.startContainer.nodeValue &&                                                         // 5025
                    (selectionRange.startOffset === selectionRange.startContainer.nodeValue.length)) {                 // 5026
                var adjacentNode = MediumEditor.util.findAdjacentTextNodeWithContent(MediumEditor.selection.getSelectionElement(this.window), selectionRange.startContainer, this.document);
                if (adjacentNode) {                                                                                    // 5028
                    var offset = 0;                                                                                    // 5029
                    while (adjacentNode.nodeValue.substr(offset, 1).trim().length === 0) {                             // 5030
                        offset = offset + 1;                                                                           // 5031
                    }                                                                                                  // 5032
                    selectionRange = MediumEditor.selection.select(this.document, adjacentNode, offset,                // 5033
                        selectionRange.endContainer, selectionRange.endOffset);                                        // 5034
                }                                                                                                      // 5035
            }                                                                                                          // 5036
        },                                                                                                             // 5037
                                                                                                                       // 5038
        checkState: function () {                                                                                      // 5039
            if (this.base.preventSelectionUpdates) {                                                                   // 5040
                return;                                                                                                // 5041
            }                                                                                                          // 5042
                                                                                                                       // 5043
            // If no editable has focus OR selection is inside contenteditable = false                                 // 5044
            // hide toolbar                                                                                            // 5045
            if (!this.base.getFocusedElement() ||                                                                      // 5046
                    MediumEditor.selection.selectionInContentEditableFalse(this.window)) {                             // 5047
                return this.hideToolbar();                                                                             // 5048
            }                                                                                                          // 5049
                                                                                                                       // 5050
            // If there's no selection element, selection element doesn't belong to this editor                        // 5051
            // or toolbar is disabled for this selection element                                                       // 5052
            // hide toolbar                                                                                            // 5053
            var selectionElement = MediumEditor.selection.getSelectionElement(this.window);                            // 5054
            if (!selectionElement ||                                                                                   // 5055
                    this.getEditorElements().indexOf(selectionElement) === -1 ||                                       // 5056
                    selectionElement.getAttribute('data-disable-toolbar')) {                                           // 5057
                return this.hideToolbar();                                                                             // 5058
            }                                                                                                          // 5059
                                                                                                                       // 5060
            // Now we know there's a focused editable with a selection                                                 // 5061
                                                                                                                       // 5062
            // If the updateOnEmptySelection option is true, show the toolbar                                          // 5063
            if (this.updateOnEmptySelection && this.static) {                                                          // 5064
                return this.showAndUpdateToolbar();                                                                    // 5065
            }                                                                                                          // 5066
                                                                                                                       // 5067
            // If we don't have a 'valid' selection -> hide toolbar                                                    // 5068
            if (this.window.getSelection().toString().trim() === '' ||                                                 // 5069
                (this.allowMultiParagraphSelection === false && this.multipleBlockElementsSelected())) {               // 5070
                return this.hideToolbar();                                                                             // 5071
            }                                                                                                          // 5072
                                                                                                                       // 5073
            this.showAndUpdateToolbar();                                                                               // 5074
        },                                                                                                             // 5075
                                                                                                                       // 5076
        // Updating the toolbar                                                                                        // 5077
                                                                                                                       // 5078
        showAndUpdateToolbar: function () {                                                                            // 5079
            this.modifySelection();                                                                                    // 5080
            this.setToolbarButtonStates();                                                                             // 5081
            this.trigger('positionToolbar', {}, this.base.getFocusedElement());                                        // 5082
            this.showToolbarDefaultActions();                                                                          // 5083
            this.setToolbarPosition();                                                                                 // 5084
        },                                                                                                             // 5085
                                                                                                                       // 5086
        setToolbarButtonStates: function () {                                                                          // 5087
            this.forEachExtension(function (extension) {                                                               // 5088
                if (typeof extension.isActive === 'function' &&                                                        // 5089
                    typeof extension.setInactive === 'function') {                                                     // 5090
                    extension.setInactive();                                                                           // 5091
                }                                                                                                      // 5092
            });                                                                                                        // 5093
                                                                                                                       // 5094
            this.checkActiveButtons();                                                                                 // 5095
        },                                                                                                             // 5096
                                                                                                                       // 5097
        checkActiveButtons: function () {                                                                              // 5098
            var manualStateChecks = [],                                                                                // 5099
                queryState = null,                                                                                     // 5100
                selectionRange = MediumEditor.selection.getSelectionRange(this.document),                              // 5101
                parentNode,                                                                                            // 5102
                updateExtensionState = function (extension) {                                                          // 5103
                    if (typeof extension.checkState === 'function') {                                                  // 5104
                        extension.checkState(parentNode);                                                              // 5105
                    } else if (typeof extension.isActive === 'function' &&                                             // 5106
                               typeof extension.isAlreadyApplied === 'function' &&                                     // 5107
                               typeof extension.setActive === 'function') {                                            // 5108
                        if (!extension.isActive() && extension.isAlreadyApplied(parentNode)) {                         // 5109
                            extension.setActive();                                                                     // 5110
                        }                                                                                              // 5111
                    }                                                                                                  // 5112
                };                                                                                                     // 5113
                                                                                                                       // 5114
            if (!selectionRange) {                                                                                     // 5115
                return;                                                                                                // 5116
            }                                                                                                          // 5117
                                                                                                                       // 5118
            // Loop through all extensions                                                                             // 5119
            this.forEachExtension(function (extension) {                                                               // 5120
                // For those extensions where we can use document.queryCommandState(), do so                           // 5121
                if (typeof extension.queryCommandState === 'function') {                                               // 5122
                    queryState = extension.queryCommandState();                                                        // 5123
                    // If queryCommandState returns a valid value, we can trust the browser                            // 5124
                    // and don't need to do our manual checks                                                          // 5125
                    if (queryState !== null) {                                                                         // 5126
                        if (queryState && typeof extension.setActive === 'function') {                                 // 5127
                            extension.setActive();                                                                     // 5128
                        }                                                                                              // 5129
                        return;                                                                                        // 5130
                    }                                                                                                  // 5131
                }                                                                                                      // 5132
                // We can't use queryCommandState for this extension, so add to manualStateChecks                      // 5133
                manualStateChecks.push(extension);                                                                     // 5134
            });                                                                                                        // 5135
                                                                                                                       // 5136
            parentNode = MediumEditor.selection.getSelectedParentElement(selectionRange);                              // 5137
                                                                                                                       // 5138
            // Make sure the selection parent isn't outside of the contenteditable                                     // 5139
            if (!this.getEditorElements().some(function (element) {                                                    // 5140
                    return MediumEditor.util.isDescendant(element, parentNode, true);                                  // 5141
                })) {                                                                                                  // 5142
                return;                                                                                                // 5143
            }                                                                                                          // 5144
                                                                                                                       // 5145
            // Climb up the DOM and do manual checks for whether a certain extension is currently enabled for this node
            while (parentNode) {                                                                                       // 5147
                manualStateChecks.forEach(updateExtensionState);                                                       // 5148
                                                                                                                       // 5149
                // we can abort the search upwards if we leave the contentEditable element                             // 5150
                if (MediumEditor.util.isMediumEditorElement(parentNode)) {                                             // 5151
                    break;                                                                                             // 5152
                }                                                                                                      // 5153
                parentNode = parentNode.parentNode;                                                                    // 5154
            }                                                                                                          // 5155
        },                                                                                                             // 5156
                                                                                                                       // 5157
        // Positioning toolbar                                                                                         // 5158
                                                                                                                       // 5159
        positionToolbarIfShown: function () {                                                                          // 5160
            if (this.isDisplayed()) {                                                                                  // 5161
                this.setToolbarPosition();                                                                             // 5162
            }                                                                                                          // 5163
        },                                                                                                             // 5164
                                                                                                                       // 5165
        setToolbarPosition: function () {                                                                              // 5166
            var container = this.base.getFocusedElement(),                                                             // 5167
                selection = this.window.getSelection(),                                                                // 5168
                anchorPreview;                                                                                         // 5169
                                                                                                                       // 5170
            // If there isn't a valid selection, bail                                                                  // 5171
            if (!container) {                                                                                          // 5172
                return this;                                                                                           // 5173
            }                                                                                                          // 5174
                                                                                                                       // 5175
            if (this.static && !this.relativeContainer) {                                                              // 5176
                this.showToolbar();                                                                                    // 5177
                this.positionStaticToolbar(container);                                                                 // 5178
            } else if (!selection.isCollapsed) {                                                                       // 5179
                this.showToolbar();                                                                                    // 5180
                                                                                                                       // 5181
                // we don't need any absolute positioning if relativeContainer is set                                  // 5182
                if (!this.relativeContainer) {                                                                         // 5183
                    this.positionToolbar(selection);                                                                   // 5184
                }                                                                                                      // 5185
            }                                                                                                          // 5186
                                                                                                                       // 5187
            anchorPreview = this.base.getExtensionByName('anchor-preview');                                            // 5188
                                                                                                                       // 5189
            if (anchorPreview && typeof anchorPreview.hidePreview === 'function') {                                    // 5190
                anchorPreview.hidePreview();                                                                           // 5191
            }                                                                                                          // 5192
        },                                                                                                             // 5193
                                                                                                                       // 5194
        positionStaticToolbar: function (container) {                                                                  // 5195
            // position the toolbar at left 0, so we can get the real width of the toolbar                             // 5196
            this.getToolbarElement().style.left = '0';                                                                 // 5197
                                                                                                                       // 5198
            // document.documentElement for IE 9                                                                       // 5199
            var scrollTop = (this.document.documentElement && this.document.documentElement.scrollTop) || this.document.body.scrollTop,
                windowWidth = this.window.innerWidth,                                                                  // 5201
                toolbarElement = this.getToolbarElement(),                                                             // 5202
                containerRect = container.getBoundingClientRect(),                                                     // 5203
                containerTop = containerRect.top + scrollTop,                                                          // 5204
                containerCenter = (containerRect.left + (containerRect.width / 2)),                                    // 5205
                toolbarHeight = toolbarElement.offsetHeight,                                                           // 5206
                toolbarWidth = toolbarElement.offsetWidth,                                                             // 5207
                halfOffsetWidth = toolbarWidth / 2,                                                                    // 5208
                targetLeft;                                                                                            // 5209
                                                                                                                       // 5210
            if (this.sticky) {                                                                                         // 5211
                // If it's beyond the height of the editor, position it at the bottom of the editor                    // 5212
                if (scrollTop > (containerTop + container.offsetHeight - toolbarHeight)) {                             // 5213
                    toolbarElement.style.top = (containerTop + container.offsetHeight - toolbarHeight) + 'px';         // 5214
                    toolbarElement.classList.remove('medium-editor-sticky-toolbar');                                   // 5215
                                                                                                                       // 5216
                // Stick the toolbar to the top of the window                                                          // 5217
                } else if (scrollTop > (containerTop - toolbarHeight)) {                                               // 5218
                    toolbarElement.classList.add('medium-editor-sticky-toolbar');                                      // 5219
                    toolbarElement.style.top = '0px';                                                                  // 5220
                                                                                                                       // 5221
                // Normal static toolbar position                                                                      // 5222
                } else {                                                                                               // 5223
                    toolbarElement.classList.remove('medium-editor-sticky-toolbar');                                   // 5224
                    toolbarElement.style.top = containerTop - toolbarHeight + 'px';                                    // 5225
                }                                                                                                      // 5226
            } else {                                                                                                   // 5227
                toolbarElement.style.top = containerTop - toolbarHeight + 'px';                                        // 5228
            }                                                                                                          // 5229
                                                                                                                       // 5230
            switch (this.align) {                                                                                      // 5231
                case 'left':                                                                                           // 5232
                    targetLeft = containerRect.left;                                                                   // 5233
                    break;                                                                                             // 5234
                                                                                                                       // 5235
                case 'right':                                                                                          // 5236
                    targetLeft = containerRect.right - toolbarWidth;                                                   // 5237
                    break;                                                                                             // 5238
                                                                                                                       // 5239
                case 'center':                                                                                         // 5240
                    targetLeft = containerCenter - halfOffsetWidth;                                                    // 5241
                    break;                                                                                             // 5242
            }                                                                                                          // 5243
                                                                                                                       // 5244
            if (targetLeft < 0) {                                                                                      // 5245
                targetLeft = 0;                                                                                        // 5246
            } else if ((targetLeft + toolbarWidth) > windowWidth) {                                                    // 5247
                targetLeft = (windowWidth - Math.ceil(toolbarWidth) - 1);                                              // 5248
            }                                                                                                          // 5249
                                                                                                                       // 5250
            toolbarElement.style.left = targetLeft + 'px';                                                             // 5251
        },                                                                                                             // 5252
                                                                                                                       // 5253
        positionToolbar: function (selection) {                                                                        // 5254
            // position the toolbar at left 0, so we can get the real width of the toolbar                             // 5255
            this.getToolbarElement().style.left = '0';                                                                 // 5256
                                                                                                                       // 5257
            var windowWidth = this.window.innerWidth,                                                                  // 5258
                range = selection.getRangeAt(0),                                                                       // 5259
                boundary = range.getBoundingClientRect(),                                                              // 5260
                middleBoundary = (boundary.left + boundary.right) / 2,                                                 // 5261
                toolbarElement = this.getToolbarElement(),                                                             // 5262
                toolbarHeight = toolbarElement.offsetHeight,                                                           // 5263
                toolbarWidth = toolbarElement.offsetWidth,                                                             // 5264
                halfOffsetWidth = toolbarWidth / 2,                                                                    // 5265
                buttonHeight = 50,                                                                                     // 5266
                defaultLeft = this.diffLeft - halfOffsetWidth;                                                         // 5267
                                                                                                                       // 5268
            if (boundary.top < buttonHeight) {                                                                         // 5269
                toolbarElement.classList.add('medium-toolbar-arrow-over');                                             // 5270
                toolbarElement.classList.remove('medium-toolbar-arrow-under');                                         // 5271
                toolbarElement.style.top = buttonHeight + boundary.bottom - this.diffTop + this.window.pageYOffset - toolbarHeight + 'px';
            } else {                                                                                                   // 5273
                toolbarElement.classList.add('medium-toolbar-arrow-under');                                            // 5274
                toolbarElement.classList.remove('medium-toolbar-arrow-over');                                          // 5275
                toolbarElement.style.top = boundary.top + this.diffTop + this.window.pageYOffset - toolbarHeight + 'px';
            }                                                                                                          // 5277
                                                                                                                       // 5278
            if (middleBoundary < halfOffsetWidth) {                                                                    // 5279
                toolbarElement.style.left = defaultLeft + halfOffsetWidth + 'px';                                      // 5280
            } else if ((windowWidth - middleBoundary) < halfOffsetWidth) {                                             // 5281
                toolbarElement.style.left = windowWidth + defaultLeft - halfOffsetWidth + 'px';                        // 5282
            } else {                                                                                                   // 5283
                toolbarElement.style.left = defaultLeft + middleBoundary + 'px';                                       // 5284
            }                                                                                                          // 5285
        }                                                                                                              // 5286
    });                                                                                                                // 5287
                                                                                                                       // 5288
    MediumEditor.extensions.toolbar = Toolbar;                                                                         // 5289
}());                                                                                                                  // 5290
                                                                                                                       // 5291
(function () {                                                                                                         // 5292
    'use strict';                                                                                                      // 5293
                                                                                                                       // 5294
    var ImageDragging = MediumEditor.Extension.extend({                                                                // 5295
        init: function () {                                                                                            // 5296
            MediumEditor.Extension.prototype.init.apply(this, arguments);                                              // 5297
                                                                                                                       // 5298
            this.subscribe('editableDrag', this.handleDrag.bind(this));                                                // 5299
            this.subscribe('editableDrop', this.handleDrop.bind(this));                                                // 5300
        },                                                                                                             // 5301
                                                                                                                       // 5302
        handleDrag: function (event) {                                                                                 // 5303
            var className = 'medium-editor-dragover';                                                                  // 5304
            event.preventDefault();                                                                                    // 5305
            event.dataTransfer.dropEffect = 'copy';                                                                    // 5306
                                                                                                                       // 5307
            if (event.type === 'dragover') {                                                                           // 5308
                event.target.classList.add(className);                                                                 // 5309
            } else if (event.type === 'dragleave') {                                                                   // 5310
                event.target.classList.remove(className);                                                              // 5311
            }                                                                                                          // 5312
        },                                                                                                             // 5313
                                                                                                                       // 5314
        handleDrop: function (event) {                                                                                 // 5315
            var className = 'medium-editor-dragover',                                                                  // 5316
                files;                                                                                                 // 5317
            event.preventDefault();                                                                                    // 5318
            event.stopPropagation();                                                                                   // 5319
                                                                                                                       // 5320
            // IE9 does not support the File API, so prevent file from opening in a new window                         // 5321
            // but also don't try to actually get the file                                                             // 5322
            if (event.dataTransfer.files) {                                                                            // 5323
                files = Array.prototype.slice.call(event.dataTransfer.files, 0);                                       // 5324
                files.some(function (file) {                                                                           // 5325
                    if (file.type.match('image')) {                                                                    // 5326
                        var fileReader, id;                                                                            // 5327
                        fileReader = new FileReader();                                                                 // 5328
                        fileReader.readAsDataURL(file);                                                                // 5329
                                                                                                                       // 5330
                        id = 'medium-img-' + (+new Date());                                                            // 5331
                        MediumEditor.util.insertHTMLCommand(this.document, '<img class="medium-editor-image-loading" id="' + id + '" />');
                                                                                                                       // 5333
                        fileReader.onload = function () {                                                              // 5334
                            var img = this.document.getElementById(id);                                                // 5335
                            if (img) {                                                                                 // 5336
                                img.removeAttribute('id');                                                             // 5337
                                img.removeAttribute('class');                                                          // 5338
                                img.src = fileReader.result;                                                           // 5339
                            }                                                                                          // 5340
                        }.bind(this);                                                                                  // 5341
                    }                                                                                                  // 5342
                }.bind(this));                                                                                         // 5343
            }                                                                                                          // 5344
            event.target.classList.remove(className);                                                                  // 5345
        }                                                                                                              // 5346
    });                                                                                                                // 5347
                                                                                                                       // 5348
    MediumEditor.extensions.imageDragging = ImageDragging;                                                             // 5349
}());                                                                                                                  // 5350
                                                                                                                       // 5351
(function () {                                                                                                         // 5352
    'use strict';                                                                                                      // 5353
                                                                                                                       // 5354
    // Event handlers that shouldn't be exposed externally                                                             // 5355
                                                                                                                       // 5356
    function handleDisabledEnterKeydown(event, element) {                                                              // 5357
        if (this.options.disableReturn || element.getAttribute('data-disable-return')) {                               // 5358
            event.preventDefault();                                                                                    // 5359
        } else if (this.options.disableDoubleReturn || element.getAttribute('data-disable-double-return')) {           // 5360
            var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument);                           // 5361
                                                                                                                       // 5362
            // if current text selection is empty OR previous sibling text is empty                                    // 5363
            if ((node && node.textContent.trim() === '') ||                                                            // 5364
                (node.previousElementSibling && node.previousElementSibling.textContent.trim() === '')) {              // 5365
                event.preventDefault();                                                                                // 5366
            }                                                                                                          // 5367
        }                                                                                                              // 5368
    }                                                                                                                  // 5369
                                                                                                                       // 5370
    function handleTabKeydown(event) {                                                                                 // 5371
        // Override tab only for pre nodes                                                                             // 5372
        var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),                               // 5373
            tag = node && node.nodeName.toLowerCase();                                                                 // 5374
                                                                                                                       // 5375
        if (tag === 'pre') {                                                                                           // 5376
            event.preventDefault();                                                                                    // 5377
            MediumEditor.util.insertHTMLCommand(this.options.ownerDocument, '    ');                                   // 5378
        }                                                                                                              // 5379
                                                                                                                       // 5380
        // Tab to indent list structures!                                                                              // 5381
        if (MediumEditor.util.isListItem(node)) {                                                                      // 5382
            event.preventDefault();                                                                                    // 5383
                                                                                                                       // 5384
            // If Shift is down, outdent, otherwise indent                                                             // 5385
            if (event.shiftKey) {                                                                                      // 5386
                this.options.ownerDocument.execCommand('outdent', false, null);                                        // 5387
            } else {                                                                                                   // 5388
                this.options.ownerDocument.execCommand('indent', false, null);                                         // 5389
            }                                                                                                          // 5390
        }                                                                                                              // 5391
    }                                                                                                                  // 5392
                                                                                                                       // 5393
    function handleBlockDeleteKeydowns(event) {                                                                        // 5394
        var p, node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),                            // 5395
            tagName = node.nodeName.toLowerCase(),                                                                     // 5396
            isEmpty = /^(\s+|<br\/?>)?$/i,                                                                             // 5397
            isHeader = /h\d/i;                                                                                         // 5398
                                                                                                                       // 5399
        if (MediumEditor.util.isKey(event, [MediumEditor.util.keyCode.BACKSPACE, MediumEditor.util.keyCode.ENTER]) &&  // 5400
                // has a preceeding sibling                                                                            // 5401
                node.previousElementSibling &&                                                                         // 5402
                // in a header                                                                                         // 5403
                isHeader.test(tagName) &&                                                                              // 5404
                // at the very end of the block                                                                        // 5405
                MediumEditor.selection.getCaretOffsets(node).left === 0) {                                             // 5406
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.BACKSPACE) && isEmpty.test(node.previousElementSibling.innerHTML)) {
                // backspacing the begining of a header into an empty previous element will                            // 5408
                // change the tagName of the current node to prevent one                                               // 5409
                // instead delete previous node and cancel the event.                                                  // 5410
                node.previousElementSibling.parentNode.removeChild(node.previousElementSibling);                       // 5411
                event.preventDefault();                                                                                // 5412
            } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER)) {                              // 5413
                // hitting return in the begining of a header will create empty header elements before the current one
                // instead, make "<p><br></p>" element, which are what happens if you hit return in an empty paragraph
                p = this.options.ownerDocument.createElement('p');                                                     // 5416
                p.innerHTML = '<br>';                                                                                  // 5417
                node.previousElementSibling.parentNode.insertBefore(p, node);                                          // 5418
                event.preventDefault();                                                                                // 5419
            }                                                                                                          // 5420
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.DELETE) &&                                 // 5421
                    // between two sibling elements                                                                    // 5422
                    node.nextElementSibling &&                                                                         // 5423
                    node.previousElementSibling &&                                                                     // 5424
                    // not in a header                                                                                 // 5425
                    !isHeader.test(tagName) &&                                                                         // 5426
                    // in an empty tag                                                                                 // 5427
                    isEmpty.test(node.innerHTML) &&                                                                    // 5428
                    // when the next tag *is* a header                                                                 // 5429
                    isHeader.test(node.nextElementSibling.nodeName.toLowerCase())) {                                   // 5430
            // hitting delete in an empty element preceding a header, ex:                                              // 5431
            //  <p>[CURSOR]</p><h1>Header</h1>                                                                         // 5432
            // Will cause the h1 to become a paragraph.                                                                // 5433
            // Instead, delete the paragraph node and move the cursor to the begining of the h1                        // 5434
                                                                                                                       // 5435
            // remove node and move cursor to start of header                                                          // 5436
            MediumEditor.selection.moveCursor(this.options.ownerDocument, node.nextElementSibling);                    // 5437
                                                                                                                       // 5438
            node.previousElementSibling.parentNode.removeChild(node);                                                  // 5439
                                                                                                                       // 5440
            event.preventDefault();                                                                                    // 5441
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.BACKSPACE) &&                              // 5442
                tagName === 'li' &&                                                                                    // 5443
                // hitting backspace inside an empty li                                                                // 5444
                isEmpty.test(node.innerHTML) &&                                                                        // 5445
                // is first element (no preceeding siblings)                                                           // 5446
                !node.previousElementSibling &&                                                                        // 5447
                // parent also does not have a sibling                                                                 // 5448
                !node.parentElement.previousElementSibling &&                                                          // 5449
                // is not the only li in a list                                                                        // 5450
                node.nextElementSibling &&                                                                             // 5451
                node.nextElementSibling.nodeName.toLowerCase() === 'li') {                                             // 5452
            // backspacing in an empty first list element in the first list (with more elements) ex:                   // 5453
            //  <ul><li>[CURSOR]</li><li>List Item 2</li></ul>                                                         // 5454
            // will remove the first <li> but add some extra element before (varies based on browser)                  // 5455
            // Instead, this will:                                                                                     // 5456
            // 1) remove the list element                                                                              // 5457
            // 2) create a paragraph before the list                                                                   // 5458
            // 3) move the cursor into the paragraph                                                                   // 5459
                                                                                                                       // 5460
            // create a paragraph before the list                                                                      // 5461
            p = this.options.ownerDocument.createElement('p');                                                         // 5462
            p.innerHTML = '<br>';                                                                                      // 5463
            node.parentElement.parentElement.insertBefore(p, node.parentElement);                                      // 5464
                                                                                                                       // 5465
            // move the cursor into the new paragraph                                                                  // 5466
            MediumEditor.selection.moveCursor(this.options.ownerDocument, p);                                          // 5467
                                                                                                                       // 5468
            // remove the list element                                                                                 // 5469
            node.parentElement.removeChild(node);                                                                      // 5470
                                                                                                                       // 5471
            event.preventDefault();                                                                                    // 5472
        }                                                                                                              // 5473
    }                                                                                                                  // 5474
                                                                                                                       // 5475
    function handleKeyup(event) {                                                                                      // 5476
        var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),                               // 5477
            tagName;                                                                                                   // 5478
                                                                                                                       // 5479
        if (!node) {                                                                                                   // 5480
            return;                                                                                                    // 5481
        }                                                                                                              // 5482
                                                                                                                       // 5483
        if (MediumEditor.util.isMediumEditorElement(node) && node.children.length === 0) {                             // 5484
            this.options.ownerDocument.execCommand('formatBlock', false, 'p');                                         // 5485
        }                                                                                                              // 5486
                                                                                                                       // 5487
        if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER) && !MediumEditor.util.isListItem(node)) {  // 5488
            tagName = node.nodeName.toLowerCase();                                                                     // 5489
            // For anchor tags, unlink                                                                                 // 5490
            if (tagName === 'a') {                                                                                     // 5491
                this.options.ownerDocument.execCommand('unlink', false, null);                                         // 5492
            } else if (!event.shiftKey && !event.ctrlKey) {                                                            // 5493
                // only format block if this is not a header tag                                                       // 5494
                if (!/h\d/.test(tagName)) {                                                                            // 5495
                    this.options.ownerDocument.execCommand('formatBlock', false, 'p');                                 // 5496
                }                                                                                                      // 5497
            }                                                                                                          // 5498
        }                                                                                                              // 5499
    }                                                                                                                  // 5500
                                                                                                                       // 5501
    // Internal helper methods which shouldn't be exposed externally                                                   // 5502
                                                                                                                       // 5503
    function addToEditors(win) {                                                                                       // 5504
        if (!win._mediumEditors) {                                                                                     // 5505
            // To avoid breaking users who are assuming that the unique id on                                          // 5506
            // medium-editor elements will start at 1, inserting a 'null' in the                                       // 5507
            // array so the unique-id can always map to the index of the editor instance                               // 5508
            win._mediumEditors = [null];                                                                               // 5509
        }                                                                                                              // 5510
                                                                                                                       // 5511
        // If this already has a unique id, re-use it                                                                  // 5512
        if (!this.id) {                                                                                                // 5513
            this.id = win._mediumEditors.length;                                                                       // 5514
        }                                                                                                              // 5515
                                                                                                                       // 5516
        win._mediumEditors[this.id] = this;                                                                            // 5517
    }                                                                                                                  // 5518
                                                                                                                       // 5519
    function removeFromEditors(win) {                                                                                  // 5520
        if (!win._mediumEditors || !win._mediumEditors[this.id]) {                                                     // 5521
            return;                                                                                                    // 5522
        }                                                                                                              // 5523
                                                                                                                       // 5524
        /* Setting the instance to null in the array instead of deleting it allows:                                    // 5525
         * 1) Each instance to preserve its own unique-id, even after being destroyed                                  // 5526
         *    and initialized again                                                                                    // 5527
         * 2) The unique-id to always correspond to an index in the array of medium-editor                             // 5528
         *    instances. Thus, we will be able to look at a contenteditable, and determine                             // 5529
         *    which instance it belongs to, by indexing into the global array.                                         // 5530
         */                                                                                                            // 5531
        win._mediumEditors[this.id] = null;                                                                            // 5532
    }                                                                                                                  // 5533
                                                                                                                       // 5534
    function createElementsArray(selector) {                                                                           // 5535
        if (!selector) {                                                                                               // 5536
            selector = [];                                                                                             // 5537
        }                                                                                                              // 5538
        // If string, use as query selector                                                                            // 5539
        if (typeof selector === 'string') {                                                                            // 5540
            selector = this.options.ownerDocument.querySelectorAll(selector);                                          // 5541
        }                                                                                                              // 5542
        // If element, put into array                                                                                  // 5543
        if (MediumEditor.util.isElement(selector)) {                                                                   // 5544
            selector = [selector];                                                                                     // 5545
        }                                                                                                              // 5546
        // Convert NodeList (or other array like object) into an array                                                 // 5547
        var elements = Array.prototype.slice.apply(selector);                                                          // 5548
                                                                                                                       // 5549
        // Loop through elements and convert textarea's into divs                                                      // 5550
        this.elements = [];                                                                                            // 5551
        elements.forEach(function (element, index) {                                                                   // 5552
            if (element.nodeName.toLowerCase() === 'textarea') {                                                       // 5553
                this.elements.push(createContentEditable.call(this, element, index));                                  // 5554
            } else {                                                                                                   // 5555
                this.elements.push(element);                                                                           // 5556
            }                                                                                                          // 5557
        }, this);                                                                                                      // 5558
    }                                                                                                                  // 5559
                                                                                                                       // 5560
    function setExtensionDefaults(extension, defaults) {                                                               // 5561
        Object.keys(defaults).forEach(function (prop) {                                                                // 5562
            if (extension[prop] === undefined) {                                                                       // 5563
                extension[prop] = defaults[prop];                                                                      // 5564
            }                                                                                                          // 5565
        });                                                                                                            // 5566
        return extension;                                                                                              // 5567
    }                                                                                                                  // 5568
                                                                                                                       // 5569
    function initExtension(extension, name, instance) {                                                                // 5570
        var extensionDefaults = {                                                                                      // 5571
            'window': instance.options.contentWindow,                                                                  // 5572
            'document': instance.options.ownerDocument,                                                                // 5573
            'base': instance                                                                                           // 5574
        };                                                                                                             // 5575
                                                                                                                       // 5576
        // Add default options into the extension                                                                      // 5577
        extension = setExtensionDefaults(extension, extensionDefaults);                                                // 5578
                                                                                                                       // 5579
        // Call init on the extension                                                                                  // 5580
        if (typeof extension.init === 'function') {                                                                    // 5581
            extension.init();                                                                                          // 5582
        }                                                                                                              // 5583
                                                                                                                       // 5584
        // Set extension name (if not already set)                                                                     // 5585
        if (!extension.name) {                                                                                         // 5586
            extension.name = name;                                                                                     // 5587
        }                                                                                                              // 5588
        return extension;                                                                                              // 5589
    }                                                                                                                  // 5590
                                                                                                                       // 5591
    function isToolbarEnabled() {                                                                                      // 5592
        // If any of the elements don't have the toolbar disabled                                                      // 5593
        // We need a toolbar                                                                                           // 5594
        if (this.elements.every(function (element) {                                                                   // 5595
                return !!element.getAttribute('data-disable-toolbar');                                                 // 5596
            })) {                                                                                                      // 5597
            return false;                                                                                              // 5598
        }                                                                                                              // 5599
                                                                                                                       // 5600
        return this.options.toolbar !== false;                                                                         // 5601
    }                                                                                                                  // 5602
                                                                                                                       // 5603
    function isAnchorPreviewEnabled() {                                                                                // 5604
        // If toolbar is disabled, don't add                                                                           // 5605
        if (!isToolbarEnabled.call(this)) {                                                                            // 5606
            return false;                                                                                              // 5607
        }                                                                                                              // 5608
                                                                                                                       // 5609
        return this.options.anchorPreview !== false;                                                                   // 5610
    }                                                                                                                  // 5611
                                                                                                                       // 5612
    function isPlaceholderEnabled() {                                                                                  // 5613
        return this.options.placeholder !== false;                                                                     // 5614
    }                                                                                                                  // 5615
                                                                                                                       // 5616
    function isAutoLinkEnabled() {                                                                                     // 5617
        return this.options.autoLink !== false;                                                                        // 5618
    }                                                                                                                  // 5619
                                                                                                                       // 5620
    function isImageDraggingEnabled() {                                                                                // 5621
        return this.options.imageDragging !== false;                                                                   // 5622
    }                                                                                                                  // 5623
                                                                                                                       // 5624
    function isKeyboardCommandsEnabled() {                                                                             // 5625
        return this.options.keyboardCommands !== false;                                                                // 5626
    }                                                                                                                  // 5627
                                                                                                                       // 5628
    function shouldUseFileDraggingExtension() {                                                                        // 5629
        // Since the file-dragging extension replaces the image-dragging extension,                                    // 5630
        // we need to check if the user passed an overrided image-dragging extension.                                  // 5631
        // If they have, to avoid breaking users, we won't use file-dragging extension.                                // 5632
        return !this.options.extensions['imageDragging'];                                                              // 5633
    }                                                                                                                  // 5634
                                                                                                                       // 5635
    function createContentEditable(textarea, id) {                                                                     // 5636
        var div = this.options.ownerDocument.createElement('div'),                                                     // 5637
            now = Date.now(),                                                                                          // 5638
            uniqueId = 'medium-editor-' + now + '-' + id,                                                              // 5639
            atts = textarea.attributes;                                                                                // 5640
                                                                                                                       // 5641
        // Some browsers can move pretty fast, since we're using a timestamp                                           // 5642
        // to make a unique-id, ensure that the id is actually unique on the page                                      // 5643
        while (this.options.ownerDocument.getElementById(uniqueId)) {                                                  // 5644
            now++;                                                                                                     // 5645
            uniqueId = 'medium-editor-' + now + '-' + id;                                                              // 5646
        }                                                                                                              // 5647
                                                                                                                       // 5648
        div.className = textarea.className;                                                                            // 5649
        div.id = uniqueId;                                                                                             // 5650
        div.innerHTML = textarea.value;                                                                                // 5651
                                                                                                                       // 5652
        textarea.setAttribute('medium-editor-textarea-id', uniqueId);                                                  // 5653
                                                                                                                       // 5654
        // re-create all attributes from the textearea to the new created div                                          // 5655
        for (var i = 0, n = atts.length; i < n; i++) {                                                                 // 5656
            // do not re-create existing attributes                                                                    // 5657
            if (!div.hasAttribute(atts[i].nodeName)) {                                                                 // 5658
                div.setAttribute(atts[i].nodeName, atts[i].nodeValue);                                                 // 5659
            }                                                                                                          // 5660
        }                                                                                                              // 5661
                                                                                                                       // 5662
        textarea.classList.add('medium-editor-hidden');                                                                // 5663
        textarea.parentNode.insertBefore(                                                                              // 5664
            div,                                                                                                       // 5665
            textarea                                                                                                   // 5666
        );                                                                                                             // 5667
                                                                                                                       // 5668
        return div;                                                                                                    // 5669
    }                                                                                                                  // 5670
                                                                                                                       // 5671
    function initElements() {                                                                                          // 5672
        this.elements.forEach(function (element, index) {                                                              // 5673
            if (!this.options.disableEditing && !element.getAttribute('data-disable-editing')) {                       // 5674
                element.setAttribute('contentEditable', true);                                                         // 5675
                element.setAttribute('spellcheck', this.options.spellcheck);                                           // 5676
            }                                                                                                          // 5677
            element.setAttribute('data-medium-editor-element', true);                                                  // 5678
            element.setAttribute('role', 'textbox');                                                                   // 5679
            element.setAttribute('aria-multiline', true);                                                              // 5680
            element.setAttribute('medium-editor-index', index);                                                        // 5681
                                                                                                                       // 5682
            if (element.hasAttribute('medium-editor-textarea-id')) {                                                   // 5683
                this.on(element, 'input', function (event) {                                                           // 5684
                    var target = event.target,                                                                         // 5685
                        textarea = target.parentNode.querySelector('textarea[medium-editor-textarea-id="' + target.getAttribute('medium-editor-textarea-id') + '"]');
                    if (textarea) {                                                                                    // 5687
                        textarea.value = this.serialize()[target.id].value;                                            // 5688
                    }                                                                                                  // 5689
                }.bind(this));                                                                                         // 5690
            }                                                                                                          // 5691
        }, this);                                                                                                      // 5692
    }                                                                                                                  // 5693
                                                                                                                       // 5694
    function attachHandlers() {                                                                                        // 5695
        var i;                                                                                                         // 5696
                                                                                                                       // 5697
        // attach to tabs                                                                                              // 5698
        this.subscribe('editableKeydownTab', handleTabKeydown.bind(this));                                             // 5699
                                                                                                                       // 5700
        // Bind keys which can create or destroy a block element: backspace, delete, return                            // 5701
        this.subscribe('editableKeydownDelete', handleBlockDeleteKeydowns.bind(this));                                 // 5702
        this.subscribe('editableKeydownEnter', handleBlockDeleteKeydowns.bind(this));                                  // 5703
                                                                                                                       // 5704
        // disabling return or double return                                                                           // 5705
        if (this.options.disableReturn || this.options.disableDoubleReturn) {                                          // 5706
            this.subscribe('editableKeydownEnter', handleDisabledEnterKeydown.bind(this));                             // 5707
        } else {                                                                                                       // 5708
            for (i = 0; i < this.elements.length; i += 1) {                                                            // 5709
                if (this.elements[i].getAttribute('data-disable-return') || this.elements[i].getAttribute('data-disable-double-return')) {
                    this.subscribe('editableKeydownEnter', handleDisabledEnterKeydown.bind(this));                     // 5711
                    break;                                                                                             // 5712
                }                                                                                                      // 5713
            }                                                                                                          // 5714
        }                                                                                                              // 5715
                                                                                                                       // 5716
        // if we're not disabling return, add a handler to help handle cleanup                                         // 5717
        // for certain cases when enter is pressed                                                                     // 5718
        if (!this.options.disableReturn) {                                                                             // 5719
            this.elements.forEach(function (element) {                                                                 // 5720
                if (!element.getAttribute('data-disable-return')) {                                                    // 5721
                    this.on(element, 'keyup', handleKeyup.bind(this));                                                 // 5722
                }                                                                                                      // 5723
            }, this);                                                                                                  // 5724
        }                                                                                                              // 5725
    }                                                                                                                  // 5726
                                                                                                                       // 5727
    function initExtensions() {                                                                                        // 5728
                                                                                                                       // 5729
        this.extensions = [];                                                                                          // 5730
                                                                                                                       // 5731
        // Passed in extensions                                                                                        // 5732
        Object.keys(this.options.extensions).forEach(function (name) {                                                 // 5733
            // Always save the toolbar extension for last                                                              // 5734
            if (name !== 'toolbar' && this.options.extensions[name]) {                                                 // 5735
                this.extensions.push(initExtension(this.options.extensions[name], name, this));                        // 5736
            }                                                                                                          // 5737
        }, this);                                                                                                      // 5738
                                                                                                                       // 5739
        // 4 Cases for imageDragging + fileDragging extensons:                                                         // 5740
        //                                                                                                             // 5741
        // 1. ImageDragging ON + No Custom Image Dragging Extension:                                                   // 5742
        //    * Use fileDragging extension (default options)                                                           // 5743
        // 2. ImageDragging OFF + No Custom Image Dragging Extension:                                                  // 5744
        //    * Use fileDragging extension w/ images turned off                                                        // 5745
        // 3. ImageDragging ON + Custom Image Dragging Extension:                                                      // 5746
        //    * Don't use fileDragging (could interfere with custom image dragging extension)                          // 5747
        // 4. ImageDragging OFF + Custom Image Dragging:                                                               // 5748
        //    * Don't use fileDragging (could interfere with custom image dragging extension)                          // 5749
        if (shouldUseFileDraggingExtension.call(this)) {                                                               // 5750
            var opts = this.options.fileDragging;                                                                      // 5751
            if (!opts) {                                                                                               // 5752
                opts = {};                                                                                             // 5753
                                                                                                                       // 5754
                // Image is in the 'allowedTypes' list by default.                                                     // 5755
                // If imageDragging is off override the 'allowedTypes' list with an empty one                          // 5756
                if (!isImageDraggingEnabled.call(this)) {                                                              // 5757
                    opts.allowedTypes = [];                                                                            // 5758
                }                                                                                                      // 5759
            }                                                                                                          // 5760
            this.addBuiltInExtension('fileDragging', opts);                                                            // 5761
        }                                                                                                              // 5762
                                                                                                                       // 5763
        // Built-in extensions                                                                                         // 5764
        var builtIns = {                                                                                               // 5765
            paste: true,                                                                                               // 5766
            'anchor-preview': isAnchorPreviewEnabled.call(this),                                                       // 5767
            autoLink: isAutoLinkEnabled.call(this),                                                                    // 5768
            keyboardCommands: isKeyboardCommandsEnabled.call(this),                                                    // 5769
            placeholder: isPlaceholderEnabled.call(this)                                                               // 5770
        };                                                                                                             // 5771
        Object.keys(builtIns).forEach(function (name) {                                                                // 5772
            if (builtIns[name]) {                                                                                      // 5773
                this.addBuiltInExtension(name);                                                                        // 5774
            }                                                                                                          // 5775
        }, this);                                                                                                      // 5776
                                                                                                                       // 5777
        // Users can pass in a custom toolbar extension                                                                // 5778
        // so check for that first and if it's not present                                                             // 5779
        // just create the default toolbar                                                                             // 5780
        var toolbarExtension = this.options.extensions['toolbar'];                                                     // 5781
        if (!toolbarExtension && isToolbarEnabled.call(this)) {                                                        // 5782
            // Backwards compatability                                                                                 // 5783
            var toolbarOptions = MediumEditor.util.extend({}, this.options.toolbar, {                                  // 5784
                allowMultiParagraphSelection: this.options.allowMultiParagraphSelection // deprecated                  // 5785
            });                                                                                                        // 5786
            toolbarExtension = new MediumEditor.extensions.toolbar(toolbarOptions);                                    // 5787
        }                                                                                                              // 5788
                                                                                                                       // 5789
        // If the toolbar is not disabled, so we actually have an extension                                            // 5790
        // initialize it and add it to the extensions array                                                            // 5791
        if (toolbarExtension) {                                                                                        // 5792
            this.extensions.push(initExtension(toolbarExtension, 'toolbar', this));                                    // 5793
        }                                                                                                              // 5794
    }                                                                                                                  // 5795
                                                                                                                       // 5796
    function mergeOptions(defaults, options) {                                                                         // 5797
        var deprecatedProperties = [                                                                                   // 5798
            ['allowMultiParagraphSelection', 'toolbar.allowMultiParagraphSelection']                                   // 5799
        ];                                                                                                             // 5800
        // warn about using deprecated properties                                                                      // 5801
        if (options) {                                                                                                 // 5802
            deprecatedProperties.forEach(function (pair) {                                                             // 5803
                if (options.hasOwnProperty(pair[0]) && options[pair[0]] !== undefined) {                               // 5804
                    MediumEditor.util.deprecated(pair[0], pair[1], 'v6.0.0');                                          // 5805
                }                                                                                                      // 5806
            });                                                                                                        // 5807
        }                                                                                                              // 5808
                                                                                                                       // 5809
        return MediumEditor.util.defaults({}, options, defaults);                                                      // 5810
    }                                                                                                                  // 5811
                                                                                                                       // 5812
    function execActionInternal(action, opts) {                                                                        // 5813
        /*jslint regexp: true*/                                                                                        // 5814
        var appendAction = /^append-(.+)$/gi,                                                                          // 5815
            justifyAction = /justify([A-Za-z]*)$/g, /* Detecting if is justifyCenter|Right|Left */                     // 5816
            match;                                                                                                     // 5817
        /*jslint regexp: false*/                                                                                       // 5818
                                                                                                                       // 5819
        // Actions starting with 'append-' should attempt to format a block of text ('formatBlock') using a specific   // 5820
        // type of block element (ie append-blockquote, append-h1, append-pre, etc.)                                   // 5821
        match = appendAction.exec(action);                                                                             // 5822
        if (match) {                                                                                                   // 5823
            return MediumEditor.util.execFormatBlock(this.options.ownerDocument, match[1]);                            // 5824
        }                                                                                                              // 5825
                                                                                                                       // 5826
        if (action === 'fontSize') {                                                                                   // 5827
            return this.options.ownerDocument.execCommand('fontSize', false, opts.size);                               // 5828
        }                                                                                                              // 5829
                                                                                                                       // 5830
        if (action === 'createLink') {                                                                                 // 5831
            return this.createLink(opts);                                                                              // 5832
        }                                                                                                              // 5833
                                                                                                                       // 5834
        if (action === 'image') {                                                                                      // 5835
            return this.options.ownerDocument.execCommand('insertImage', false, this.options.contentWindow.getSelection());
        }                                                                                                              // 5837
                                                                                                                       // 5838
        /* Issue: https://github.com/yabwe/medium-editor/issues/595                                                    // 5839
         * If the action is to justify the text */                                                                     // 5840
        if (justifyAction.exec(action)) {                                                                              // 5841
            var result = this.options.ownerDocument.execCommand(action, false, null),                                  // 5842
                parentNode = MediumEditor.selection.getSelectedParentElement(MediumEditor.selection.getSelectionRange(this.options.ownerDocument));
            if (parentNode) {                                                                                          // 5844
                cleanupJustifyDivFragments.call(this, MediumEditor.util.getTopBlockContainer(parentNode));             // 5845
            }                                                                                                          // 5846
                                                                                                                       // 5847
            return result;                                                                                             // 5848
        }                                                                                                              // 5849
                                                                                                                       // 5850
        return this.options.ownerDocument.execCommand(action, false, null);                                            // 5851
    }                                                                                                                  // 5852
                                                                                                                       // 5853
    /* If we've just justified text within a container block                                                           // 5854
     * Chrome may have removed <br> elements and instead wrapped lines in <div> elements                               // 5855
     * with a text-align property.  If so, we want to fix this                                                         // 5856
     */                                                                                                                // 5857
    function cleanupJustifyDivFragments(blockContainer) {                                                              // 5858
        if (!blockContainer) {                                                                                         // 5859
            return;                                                                                                    // 5860
        }                                                                                                              // 5861
                                                                                                                       // 5862
        var textAlign,                                                                                                 // 5863
            childDivs = Array.prototype.slice.call(blockContainer.childNodes).filter(function (element) {              // 5864
                var isDiv = element.nodeName.toLowerCase() === 'div';                                                  // 5865
                if (isDiv && !textAlign) {                                                                             // 5866
                    textAlign = element.style.textAlign;                                                               // 5867
                }                                                                                                      // 5868
                return isDiv;                                                                                          // 5869
            });                                                                                                        // 5870
                                                                                                                       // 5871
        /* If we found child <div> elements with text-align style attributes                                           // 5872
         * we should fix this by:                                                                                      // 5873
         *                                                                                                             // 5874
         * 1) Unwrapping each <div> which has a text-align style                                                       // 5875
         * 2) Insert a <br> element after each set of 'unwrapped' div children                                         // 5876
         * 3) Set the text-align style of the parent block element                                                     // 5877
         */                                                                                                            // 5878
        if (childDivs.length) {                                                                                        // 5879
            // Since we're mucking with the HTML, preserve selection                                                   // 5880
            this.saveSelection();                                                                                      // 5881
            childDivs.forEach(function (div) {                                                                         // 5882
                if (div.style.textAlign === textAlign) {                                                               // 5883
                    var lastChild = div.lastChild;                                                                     // 5884
                    if (lastChild) {                                                                                   // 5885
                        // Instead of a div, extract the child elements and add a <br>                                 // 5886
                        MediumEditor.util.unwrap(div, this.options.ownerDocument);                                     // 5887
                        var br = this.options.ownerDocument.createElement('BR');                                       // 5888
                        lastChild.parentNode.insertBefore(br, lastChild.nextSibling);                                  // 5889
                    }                                                                                                  // 5890
                }                                                                                                      // 5891
            }, this);                                                                                                  // 5892
            blockContainer.style.textAlign = textAlign;                                                                // 5893
            // We're done, so restore selection                                                                        // 5894
            this.restoreSelection();                                                                                   // 5895
        }                                                                                                              // 5896
    }                                                                                                                  // 5897
                                                                                                                       // 5898
    MediumEditor.prototype = {                                                                                         // 5899
        // NOT DOCUMENTED - exposed for backwards compatability                                                        // 5900
        init: function (elements, options) {                                                                           // 5901
            this.options = mergeOptions.call(this, this.defaults, options);                                            // 5902
            this.origElements = elements;                                                                              // 5903
                                                                                                                       // 5904
            if (!this.options.elementsContainer) {                                                                     // 5905
                this.options.elementsContainer = this.options.ownerDocument.body;                                      // 5906
            }                                                                                                          // 5907
                                                                                                                       // 5908
            return this.setup();                                                                                       // 5909
        },                                                                                                             // 5910
                                                                                                                       // 5911
        setup: function () {                                                                                           // 5912
            if (this.isActive) {                                                                                       // 5913
                return;                                                                                                // 5914
            }                                                                                                          // 5915
                                                                                                                       // 5916
            createElementsArray.call(this, this.origElements);                                                         // 5917
                                                                                                                       // 5918
            if (this.elements.length === 0) {                                                                          // 5919
                return;                                                                                                // 5920
            }                                                                                                          // 5921
                                                                                                                       // 5922
            this.isActive = true;                                                                                      // 5923
            addToEditors.call(this, this.options.contentWindow);                                                       // 5924
                                                                                                                       // 5925
            this.events = new MediumEditor.Events(this);                                                               // 5926
                                                                                                                       // 5927
            // Call initialization helpers                                                                             // 5928
            initElements.call(this);                                                                                   // 5929
            initExtensions.call(this);                                                                                 // 5930
            attachHandlers.call(this);                                                                                 // 5931
        },                                                                                                             // 5932
                                                                                                                       // 5933
        destroy: function () {                                                                                         // 5934
            if (!this.isActive) {                                                                                      // 5935
                return;                                                                                                // 5936
            }                                                                                                          // 5937
                                                                                                                       // 5938
            this.isActive = false;                                                                                     // 5939
                                                                                                                       // 5940
            this.extensions.forEach(function (extension) {                                                             // 5941
                if (typeof extension.destroy === 'function') {                                                         // 5942
                    extension.destroy();                                                                               // 5943
                }                                                                                                      // 5944
            }, this);                                                                                                  // 5945
                                                                                                                       // 5946
            this.events.destroy();                                                                                     // 5947
                                                                                                                       // 5948
            this.elements.forEach(function (element) {                                                                 // 5949
                // Reset elements content, fix for issue where after editor destroyed the red underlines on spelling errors are left
                if (this.options.spellcheck) {                                                                         // 5951
                    element.innerHTML = element.innerHTML;                                                             // 5952
                }                                                                                                      // 5953
                                                                                                                       // 5954
                // cleanup extra added attributes                                                                      // 5955
                element.removeAttribute('contentEditable');                                                            // 5956
                element.removeAttribute('spellcheck');                                                                 // 5957
                element.removeAttribute('data-medium-editor-element');                                                 // 5958
                element.removeAttribute('role');                                                                       // 5959
                element.removeAttribute('aria-multiline');                                                             // 5960
                element.removeAttribute('medium-editor-index');                                                        // 5961
                                                                                                                       // 5962
                // Remove any elements created for textareas                                                           // 5963
                if (element.hasAttribute('medium-editor-textarea-id')) {                                               // 5964
                    var textarea = element.parentNode.querySelector('textarea[medium-editor-textarea-id="' + element.getAttribute('medium-editor-textarea-id') + '"]');
                    if (textarea) {                                                                                    // 5966
                        // Un-hide the textarea                                                                        // 5967
                        textarea.classList.remove('medium-editor-hidden');                                             // 5968
                    }                                                                                                  // 5969
                    if (element.parentNode) {                                                                          // 5970
                        element.parentNode.removeChild(element);                                                       // 5971
                    }                                                                                                  // 5972
                }                                                                                                      // 5973
            }, this);                                                                                                  // 5974
            this.elements = [];                                                                                        // 5975
                                                                                                                       // 5976
            removeFromEditors.call(this, this.options.contentWindow);                                                  // 5977
        },                                                                                                             // 5978
                                                                                                                       // 5979
        on: function (target, event, listener, useCapture) {                                                           // 5980
            this.events.attachDOMEvent(target, event, listener, useCapture);                                           // 5981
        },                                                                                                             // 5982
                                                                                                                       // 5983
        off: function (target, event, listener, useCapture) {                                                          // 5984
            this.events.detachDOMEvent(target, event, listener, useCapture);                                           // 5985
        },                                                                                                             // 5986
                                                                                                                       // 5987
        subscribe: function (event, listener) {                                                                        // 5988
            this.events.attachCustomEvent(event, listener);                                                            // 5989
        },                                                                                                             // 5990
                                                                                                                       // 5991
        unsubscribe: function (event, listener) {                                                                      // 5992
            this.events.detachCustomEvent(event, listener);                                                            // 5993
        },                                                                                                             // 5994
                                                                                                                       // 5995
        trigger: function (name, data, editable) {                                                                     // 5996
            this.events.triggerCustomEvent(name, data, editable);                                                      // 5997
        },                                                                                                             // 5998
                                                                                                                       // 5999
        delay: function (fn) {                                                                                         // 6000
            var self = this;                                                                                           // 6001
            return setTimeout(function () {                                                                            // 6002
                if (self.isActive) {                                                                                   // 6003
                    fn();                                                                                              // 6004
                }                                                                                                      // 6005
            }, this.options.delay);                                                                                    // 6006
        },                                                                                                             // 6007
                                                                                                                       // 6008
        serialize: function () {                                                                                       // 6009
            var i,                                                                                                     // 6010
                elementid,                                                                                             // 6011
                content = {};                                                                                          // 6012
            for (i = 0; i < this.elements.length; i += 1) {                                                            // 6013
                elementid = (this.elements[i].id !== '') ? this.elements[i].id : 'element-' + i;                       // 6014
                content[elementid] = {                                                                                 // 6015
                    value: this.elements[i].innerHTML.trim()                                                           // 6016
                };                                                                                                     // 6017
            }                                                                                                          // 6018
            return content;                                                                                            // 6019
        },                                                                                                             // 6020
                                                                                                                       // 6021
        getExtensionByName: function (name) {                                                                          // 6022
            var extension;                                                                                             // 6023
            if (this.extensions && this.extensions.length) {                                                           // 6024
                this.extensions.some(function (ext) {                                                                  // 6025
                    if (ext.name === name) {                                                                           // 6026
                        extension = ext;                                                                               // 6027
                        return true;                                                                                   // 6028
                    }                                                                                                  // 6029
                    return false;                                                                                      // 6030
                });                                                                                                    // 6031
            }                                                                                                          // 6032
            return extension;                                                                                          // 6033
        },                                                                                                             // 6034
                                                                                                                       // 6035
        /**                                                                                                            // 6036
         * NOT DOCUMENTED - exposed as a helper for other extensions to use                                            // 6037
         */                                                                                                            // 6038
        addBuiltInExtension: function (name, opts) {                                                                   // 6039
            var extension = this.getExtensionByName(name),                                                             // 6040
                merged;                                                                                                // 6041
            if (extension) {                                                                                           // 6042
                return extension;                                                                                      // 6043
            }                                                                                                          // 6044
                                                                                                                       // 6045
            switch (name) {                                                                                            // 6046
                case 'anchor':                                                                                         // 6047
                    merged = MediumEditor.util.extend({}, this.options.anchor, opts);                                  // 6048
                    extension = new MediumEditor.extensions.anchor(merged);                                            // 6049
                    break;                                                                                             // 6050
                case 'anchor-preview':                                                                                 // 6051
                    extension = new MediumEditor.extensions.anchorPreview(this.options.anchorPreview);                 // 6052
                    break;                                                                                             // 6053
                case 'autoLink':                                                                                       // 6054
                    extension = new MediumEditor.extensions.autoLink();                                                // 6055
                    break;                                                                                             // 6056
                case 'fileDragging':                                                                                   // 6057
                    extension = new MediumEditor.extensions.fileDragging(opts);                                        // 6058
                    break;                                                                                             // 6059
                case 'fontsize':                                                                                       // 6060
                    extension = new MediumEditor.extensions.fontSize(opts);                                            // 6061
                    break;                                                                                             // 6062
                case 'keyboardCommands':                                                                               // 6063
                    extension = new MediumEditor.extensions.keyboardCommands(this.options.keyboardCommands);           // 6064
                    break;                                                                                             // 6065
                case 'paste':                                                                                          // 6066
                    extension = new MediumEditor.extensions.paste(this.options.paste);                                 // 6067
                    break;                                                                                             // 6068
                case 'placeholder':                                                                                    // 6069
                    extension = new MediumEditor.extensions.placeholder(this.options.placeholder);                     // 6070
                    break;                                                                                             // 6071
                default:                                                                                               // 6072
                    // All of the built-in buttons for MediumEditor are extensions                                     // 6073
                    // so check to see if the extension we're creating is a built-in button                            // 6074
                    if (MediumEditor.extensions.button.isBuiltInButton(name)) {                                        // 6075
                        if (opts) {                                                                                    // 6076
                            merged = MediumEditor.util.defaults({}, opts, MediumEditor.extensions.button.prototype.defaults[name]);
                            extension = new MediumEditor.extensions.button(merged);                                    // 6078
                        } else {                                                                                       // 6079
                            extension = new MediumEditor.extensions.button(name);                                      // 6080
                        }                                                                                              // 6081
                    }                                                                                                  // 6082
            }                                                                                                          // 6083
                                                                                                                       // 6084
            if (extension) {                                                                                           // 6085
                this.extensions.push(initExtension(extension, name, this));                                            // 6086
            }                                                                                                          // 6087
                                                                                                                       // 6088
            return extension;                                                                                          // 6089
        },                                                                                                             // 6090
                                                                                                                       // 6091
        stopSelectionUpdates: function () {                                                                            // 6092
            this.preventSelectionUpdates = true;                                                                       // 6093
        },                                                                                                             // 6094
                                                                                                                       // 6095
        startSelectionUpdates: function () {                                                                           // 6096
            this.preventSelectionUpdates = false;                                                                      // 6097
        },                                                                                                             // 6098
                                                                                                                       // 6099
        checkSelection: function () {                                                                                  // 6100
            var toolbar = this.getExtensionByName('toolbar');                                                          // 6101
            if (toolbar) {                                                                                             // 6102
                toolbar.checkState();                                                                                  // 6103
            }                                                                                                          // 6104
            return this;                                                                                               // 6105
        },                                                                                                             // 6106
                                                                                                                       // 6107
        // Wrapper around document.queryCommandState for checking whether an action has already                        // 6108
        // been applied to the current selection                                                                       // 6109
        queryCommandState: function (action) {                                                                         // 6110
            var fullAction = /^full-(.+)$/gi,                                                                          // 6111
                match,                                                                                                 // 6112
                queryState = null;                                                                                     // 6113
                                                                                                                       // 6114
            // Actions starting with 'full-' need to be modified since this is a medium-editor concept                 // 6115
            match = fullAction.exec(action);                                                                           // 6116
            if (match) {                                                                                               // 6117
                action = match[1];                                                                                     // 6118
            }                                                                                                          // 6119
                                                                                                                       // 6120
            try {                                                                                                      // 6121
                queryState = this.options.ownerDocument.queryCommandState(action);                                     // 6122
            } catch (exc) {                                                                                            // 6123
                queryState = null;                                                                                     // 6124
            }                                                                                                          // 6125
                                                                                                                       // 6126
            return queryState;                                                                                         // 6127
        },                                                                                                             // 6128
                                                                                                                       // 6129
        execAction: function (action, opts) {                                                                          // 6130
            /*jslint regexp: true*/                                                                                    // 6131
            var fullAction = /^full-(.+)$/gi,                                                                          // 6132
                match,                                                                                                 // 6133
                result;                                                                                                // 6134
            /*jslint regexp: false*/                                                                                   // 6135
                                                                                                                       // 6136
            // Actions starting with 'full-' should be applied to to the entire contents of the editable element       // 6137
            // (ie full-bold, full-append-pre, etc.)                                                                   // 6138
            match = fullAction.exec(action);                                                                           // 6139
            if (match) {                                                                                               // 6140
                // Store the current selection to be restored after applying the action                                // 6141
                this.saveSelection();                                                                                  // 6142
                // Select all of the contents before calling the action                                                // 6143
                this.selectAllContents();                                                                              // 6144
                result = execActionInternal.call(this, match[1], opts);                                                // 6145
                // Restore the previous selection                                                                      // 6146
                this.restoreSelection();                                                                               // 6147
            } else {                                                                                                   // 6148
                result = execActionInternal.call(this, action, opts);                                                  // 6149
            }                                                                                                          // 6150
                                                                                                                       // 6151
            // do some DOM clean-up for known browser issues after the action                                          // 6152
            if (action === 'insertunorderedlist' || action === 'insertorderedlist') {                                  // 6153
                MediumEditor.util.cleanListDOM(this.options.ownerDocument, this.getSelectedParentElement());           // 6154
            }                                                                                                          // 6155
                                                                                                                       // 6156
            this.checkSelection();                                                                                     // 6157
            return result;                                                                                             // 6158
        },                                                                                                             // 6159
                                                                                                                       // 6160
        getSelectedParentElement: function (range) {                                                                   // 6161
            if (range === undefined) {                                                                                 // 6162
                range = this.options.contentWindow.getSelection().getRangeAt(0);                                       // 6163
            }                                                                                                          // 6164
            return MediumEditor.selection.getSelectedParentElement(range);                                             // 6165
        },                                                                                                             // 6166
                                                                                                                       // 6167
        selectAllContents: function () {                                                                               // 6168
            var currNode = MediumEditor.selection.getSelectionElement(this.options.contentWindow);                     // 6169
                                                                                                                       // 6170
            if (currNode) {                                                                                            // 6171
                // Move to the lowest descendant node that still selects all of the contents                           // 6172
                while (currNode.children.length === 1) {                                                               // 6173
                    currNode = currNode.children[0];                                                                   // 6174
                }                                                                                                      // 6175
                                                                                                                       // 6176
                this.selectElement(currNode);                                                                          // 6177
            }                                                                                                          // 6178
        },                                                                                                             // 6179
                                                                                                                       // 6180
        selectElement: function (element) {                                                                            // 6181
            MediumEditor.selection.selectNode(element, this.options.ownerDocument);                                    // 6182
                                                                                                                       // 6183
            var selElement = MediumEditor.selection.getSelectionElement(this.options.contentWindow);                   // 6184
            if (selElement) {                                                                                          // 6185
                this.events.focusElement(selElement);                                                                  // 6186
            }                                                                                                          // 6187
        },                                                                                                             // 6188
                                                                                                                       // 6189
        getFocusedElement: function () {                                                                               // 6190
            var focused;                                                                                               // 6191
            this.elements.some(function (element) {                                                                    // 6192
                // Find the element that has focus                                                                     // 6193
                if (!focused && element.getAttribute('data-medium-focused')) {                                         // 6194
                    focused = element;                                                                                 // 6195
                }                                                                                                      // 6196
                                                                                                                       // 6197
                // bail if we found the element that had focus                                                         // 6198
                return !!focused;                                                                                      // 6199
            }, this);                                                                                                  // 6200
                                                                                                                       // 6201
            return focused;                                                                                            // 6202
        },                                                                                                             // 6203
                                                                                                                       // 6204
        // Export the state of the selection in respect to one of this                                                 // 6205
        // instance of MediumEditor's elements                                                                         // 6206
        exportSelection: function () {                                                                                 // 6207
            var selectionElement = MediumEditor.selection.getSelectionElement(this.options.contentWindow),             // 6208
                editableElementIndex = this.elements.indexOf(selectionElement),                                        // 6209
                selectionState = null;                                                                                 // 6210
                                                                                                                       // 6211
            if (editableElementIndex >= 0) {                                                                           // 6212
                selectionState = MediumEditor.selection.exportSelection(selectionElement, this.options.ownerDocument);
            }                                                                                                          // 6214
                                                                                                                       // 6215
            if (selectionState !== null && editableElementIndex !== 0) {                                               // 6216
                selectionState.editableElementIndex = editableElementIndex;                                            // 6217
            }                                                                                                          // 6218
                                                                                                                       // 6219
            return selectionState;                                                                                     // 6220
        },                                                                                                             // 6221
                                                                                                                       // 6222
        saveSelection: function () {                                                                                   // 6223
            this.selectionState = this.exportSelection();                                                              // 6224
        },                                                                                                             // 6225
                                                                                                                       // 6226
        // Restore a selection based on a selectionState returned by a call                                            // 6227
        // to MediumEditor.exportSelection                                                                             // 6228
        importSelection: function (selectionState, favorLaterSelectionAnchor) {                                        // 6229
            if (!selectionState) {                                                                                     // 6230
                return;                                                                                                // 6231
            }                                                                                                          // 6232
                                                                                                                       // 6233
            var editableElement = this.elements[selectionState.editableElementIndex || 0];                             // 6234
            MediumEditor.selection.importSelection(selectionState, editableElement, this.options.ownerDocument, favorLaterSelectionAnchor);
        },                                                                                                             // 6236
                                                                                                                       // 6237
        restoreSelection: function () {                                                                                // 6238
            this.importSelection(this.selectionState);                                                                 // 6239
        },                                                                                                             // 6240
                                                                                                                       // 6241
        createLink: function (opts) {                                                                                  // 6242
            var currentEditor = MediumEditor.selection.getSelectionElement(this.options.contentWindow),                // 6243
                customEvent = {};                                                                                      // 6244
                                                                                                                       // 6245
            // Make sure the selection is within an element this editor is tracking                                    // 6246
            if (this.elements.indexOf(currentEditor) === -1) {                                                         // 6247
                return;                                                                                                // 6248
            }                                                                                                          // 6249
                                                                                                                       // 6250
            try {                                                                                                      // 6251
                this.events.disableCustomEvent('editableInput');                                                       // 6252
                if (opts.url && opts.url.trim().length > 0) {                                                          // 6253
                    var currentSelection = this.options.contentWindow.getSelection();                                  // 6254
                    if (currentSelection) {                                                                            // 6255
                        var currRange = currentSelection.getRangeAt(0),                                                // 6256
                            commonAncestorContainer = currRange.commonAncestorContainer,                               // 6257
                            exportedSelection,                                                                         // 6258
                            startContainerParentElement,                                                               // 6259
                            endContainerParentElement,                                                                 // 6260
                            textNodes;                                                                                 // 6261
                                                                                                                       // 6262
                        // If the selection is contained within a single text node                                     // 6263
                        // and the selection starts at the beginning of the text node,                                 // 6264
                        // MSIE still says the startContainer is the parent of the text node.                          // 6265
                        // If the selection is contained within a single text node, we                                 // 6266
                        // want to just use the default browser 'createLink', so we need                               // 6267
                        // to account for this case and adjust the commonAncestorContainer accordingly                 // 6268
                        if (currRange.endContainer.nodeType === 3 &&                                                   // 6269
                            currRange.startContainer.nodeType !== 3 &&                                                 // 6270
                            currRange.startOffset === 0 &&                                                             // 6271
                            currRange.startContainer.firstChild === currRange.endContainer) {                          // 6272
                            commonAncestorContainer = currRange.endContainer;                                          // 6273
                        }                                                                                              // 6274
                                                                                                                       // 6275
                        startContainerParentElement = MediumEditor.util.getClosestBlockContainer(currRange.startContainer);
                        endContainerParentElement = MediumEditor.util.getClosestBlockContainer(currRange.endContainer);
                                                                                                                       // 6278
                        // If the selection is not contained within a single text node                                 // 6279
                        // but the selection is contained within the same block element                                // 6280
                        // we want to make sure we create a single link, and not multiple links                        // 6281
                        // which can happen with the built in browser functionality                                    // 6282
                        if (commonAncestorContainer.nodeType !== 3 && startContainerParentElement === endContainerParentElement) {
                            var parentElement = (startContainerParentElement || currentEditor),                        // 6284
                                fragment = this.options.ownerDocument.createDocumentFragment();                        // 6285
                                                                                                                       // 6286
                            // since we are going to create a link from an extracted text,                             // 6287
                            // be sure that if we are updating a link, we won't let an empty link behind (see #754)    // 6288
                            // (Workaroung for Chrome)                                                                 // 6289
                            this.execAction('unlink');                                                                 // 6290
                                                                                                                       // 6291
                            exportedSelection = this.exportSelection();                                                // 6292
                            fragment.appendChild(parentElement.cloneNode(true));                                       // 6293
                                                                                                                       // 6294
                            if (currentEditor === parentElement) {                                                     // 6295
                                // We have to avoid the editor itself being wiped out when it's the only block element,
                                // as our reference inside this.elements gets detached from the page when insertHTML runs.
                                // If we just use [parentElement, 0] and [parentElement, parentElement.childNodes.length]
                                // as the range boundaries, this happens whenever parentElement === currentEditor.     // 6299
                                // The tradeoff to this workaround is that a orphaned tag can sometimes be left behind at
                                // the end of the editor's content.                                                    // 6301
                                // In Gecko:                                                                           // 6302
                                // as an empty <strong></strong> if parentElement.lastChild is a <strong> tag.         // 6303
                                // In WebKit:                                                                          // 6304
                                // an invented <br /> tag at the end in the same situation                             // 6305
                                MediumEditor.selection.select(                                                         // 6306
                                    this.options.ownerDocument,                                                        // 6307
                                    parentElement.firstChild,                                                          // 6308
                                    0,                                                                                 // 6309
                                    parentElement.lastChild,                                                           // 6310
                                    parentElement.lastChild.nodeType === 3 ?                                           // 6311
                                    parentElement.lastChild.nodeValue.length : parentElement.lastChild.childNodes.length
                                );                                                                                     // 6313
                            } else {                                                                                   // 6314
                                MediumEditor.selection.select(                                                         // 6315
                                    this.options.ownerDocument,                                                        // 6316
                                    parentElement,                                                                     // 6317
                                    0,                                                                                 // 6318
                                    parentElement,                                                                     // 6319
                                    parentElement.childNodes.length                                                    // 6320
                                );                                                                                     // 6321
                            }                                                                                          // 6322
                                                                                                                       // 6323
                            var modifiedExportedSelection = this.exportSelection();                                    // 6324
                                                                                                                       // 6325
                            textNodes = MediumEditor.util.findOrCreateMatchingTextNodes(                               // 6326
                                this.options.ownerDocument,                                                            // 6327
                                fragment,                                                                              // 6328
                                {                                                                                      // 6329
                                    start: exportedSelection.start - modifiedExportedSelection.start,                  // 6330
                                    end: exportedSelection.end - modifiedExportedSelection.start,                      // 6331
                                    editableElementIndex: exportedSelection.editableElementIndex                       // 6332
                                }                                                                                      // 6333
                            );                                                                                         // 6334
                                                                                                                       // 6335
                            // Creates the link in the document fragment                                               // 6336
                            MediumEditor.util.createLink(this.options.ownerDocument, textNodes, opts.url.trim());      // 6337
                                                                                                                       // 6338
                            // Chrome trims the leading whitespaces when inserting HTML, which messes up restoring the selection.
                            var leadingWhitespacesCount = (fragment.firstChild.innerHTML.match(/^\s+/) || [''])[0].length;
                                                                                                                       // 6341
                            // Now move the created link back into the original document in a way to preserve undo/redo history
                            MediumEditor.util.insertHTMLCommand(this.options.ownerDocument, fragment.firstChild.innerHTML.replace(/^\s+/, ''));
                            exportedSelection.start -= leadingWhitespacesCount;                                        // 6344
                            exportedSelection.end -= leadingWhitespacesCount;                                          // 6345
                                                                                                                       // 6346
                            this.importSelection(exportedSelection);                                                   // 6347
                        } else {                                                                                       // 6348
                            this.options.ownerDocument.execCommand('createLink', false, opts.url);                     // 6349
                        }                                                                                              // 6350
                                                                                                                       // 6351
                        if (this.options.targetBlank || opts.target === '_blank') {                                    // 6352
                            MediumEditor.util.setTargetBlank(MediumEditor.selection.getSelectionStart(this.options.ownerDocument), opts.url);
                        }                                                                                              // 6354
                                                                                                                       // 6355
                        if (opts.buttonClass) {                                                                        // 6356
                            MediumEditor.util.addClassToAnchors(MediumEditor.selection.getSelectionStart(this.options.ownerDocument), opts.buttonClass);
                        }                                                                                              // 6358
                    }                                                                                                  // 6359
                }                                                                                                      // 6360
                // Fire input event for backwards compatibility if anyone was listening directly to the DOM input event
                if (this.options.targetBlank || opts.target === '_blank' || opts.buttonClass) {                        // 6362
                    customEvent = this.options.ownerDocument.createEvent('HTMLEvents');                                // 6363
                    customEvent.initEvent('input', true, true, this.options.contentWindow);                            // 6364
                    for (var i = 0; i < this.elements.length; i += 1) {                                                // 6365
                        this.elements[i].dispatchEvent(customEvent);                                                   // 6366
                    }                                                                                                  // 6367
                }                                                                                                      // 6368
            } finally {                                                                                                // 6369
                this.events.enableCustomEvent('editableInput');                                                        // 6370
            }                                                                                                          // 6371
            // Fire our custom editableInput event                                                                     // 6372
            this.events.triggerCustomEvent('editableInput', customEvent, currentEditor);                               // 6373
        },                                                                                                             // 6374
                                                                                                                       // 6375
        cleanPaste: function (text) {                                                                                  // 6376
            this.getExtensionByName('paste').cleanPaste(text);                                                         // 6377
        },                                                                                                             // 6378
                                                                                                                       // 6379
        pasteHTML: function (html, options) {                                                                          // 6380
            this.getExtensionByName('paste').pasteHTML(html, options);                                                 // 6381
        },                                                                                                             // 6382
                                                                                                                       // 6383
        setContent: function (html, index) {                                                                           // 6384
            index = index || 0;                                                                                        // 6385
                                                                                                                       // 6386
            if (this.elements[index]) {                                                                                // 6387
                var target = this.elements[index];                                                                     // 6388
                target.innerHTML = html;                                                                               // 6389
                this.events.updateInput(target, { target: target, currentTarget: target });                            // 6390
            }                                                                                                          // 6391
        }                                                                                                              // 6392
    };                                                                                                                 // 6393
}());                                                                                                                  // 6394
                                                                                                                       // 6395
(function () {                                                                                                         // 6396
    // summary: The default options hash used by the Editor                                                            // 6397
                                                                                                                       // 6398
    MediumEditor.prototype.defaults = {                                                                                // 6399
        activeButtonClass: 'medium-editor-button-active',                                                              // 6400
        buttonLabels: false,                                                                                           // 6401
        delay: 0,                                                                                                      // 6402
        disableReturn: false,                                                                                          // 6403
        disableDoubleReturn: false,                                                                                    // 6404
        disableEditing: false,                                                                                         // 6405
        autoLink: false,                                                                                               // 6406
        elementsContainer: false,                                                                                      // 6407
        contentWindow: window,                                                                                         // 6408
        ownerDocument: document,                                                                                       // 6409
        targetBlank: false,                                                                                            // 6410
        extensions: {},                                                                                                // 6411
        spellcheck: true                                                                                               // 6412
    };                                                                                                                 // 6413
})();                                                                                                                  // 6414
                                                                                                                       // 6415
MediumEditor.parseVersionString = function (release) {                                                                 // 6416
    var split = release.split('-'),                                                                                    // 6417
        version = split[0].split('.'),                                                                                 // 6418
        preRelease = (split.length > 1) ? split[1] : '';                                                               // 6419
    return {                                                                                                           // 6420
        major: parseInt(version[0], 10),                                                                               // 6421
        minor: parseInt(version[1], 10),                                                                               // 6422
        revision: parseInt(version[2], 10),                                                                            // 6423
        preRelease: preRelease,                                                                                        // 6424
        toString: function () {                                                                                        // 6425
            return [version[0], version[1], version[2]].join('.') + (preRelease ? '-' + preRelease : '');              // 6426
        }                                                                                                              // 6427
    };                                                                                                                 // 6428
};                                                                                                                     // 6429
                                                                                                                       // 6430
MediumEditor.version = MediumEditor.parseVersionString.call(this, ({                                                   // 6431
    // grunt-bump looks for this:                                                                                      // 6432
    'version': '5.8.2'                                                                                                 // 6433
}).version);                                                                                                           // 6434
                                                                                                                       // 6435
    return MediumEditor;                                                                                               // 6436
}()));                                                                                                                 // 6437
                                                                                                                       // 6438
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/handlebars/handlebars.runtime.js                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
                                                                                                                       // 2
 handlebars v3.0.3                                                                                                     // 3
                                                                                                                       // 4
Copyright (C) 2011-2014 by Yehuda Katz                                                                                 // 5
                                                                                                                       // 6
Permission is hereby granted, free of charge, to any person obtaining a copy                                           // 7
of this software and associated documentation files (the "Software"), to deal                                          // 8
in the Software without restriction, including without limitation the rights                                           // 9
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell                                              // 10
copies of the Software, and to permit persons to whom the Software is                                                  // 11
furnished to do so, subject to the following conditions:                                                               // 12
                                                                                                                       // 13
The above copyright notice and this permission notice shall be included in                                             // 14
all copies or substantial portions of the Software.                                                                    // 15
                                                                                                                       // 16
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR                                             // 17
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,                                               // 18
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE                                            // 19
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER                                                 // 20
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,                                          // 21
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN                                              // 22
THE SOFTWARE.                                                                                                          // 23
                                                                                                                       // 24
@license                                                                                                               // 25
*/                                                                                                                     // 26
(function webpackUniversalModuleDefinition(root, factory) {                                                            // 27
	if(typeof exports === 'object' && typeof module === 'object')                                                         // 28
		module.exports = factory();                                                                                          // 29
	else if(typeof define === 'function' && define.amd)                                                                   // 30
		define(factory);                                                                                                     // 31
	else if(typeof exports === 'object')                                                                                  // 32
		exports["Handlebars"] = factory();                                                                                   // 33
	else                                                                                                                  // 34
		root["Handlebars"] = factory();                                                                                      // 35
})(this, function() {                                                                                                  // 36
return /******/ (function(modules) { // webpackBootstrap                                                               // 37
/******/ 	// The module cache                                                                                          // 38
/******/ 	var installedModules = {};                                                                                   // 39
                                                                                                                       // 40
/******/ 	// The require function                                                                                      // 41
/******/ 	function __webpack_require__(moduleId) {                                                                     // 42
                                                                                                                       // 43
/******/ 		// Check if module is in cache                                                                              // 44
/******/ 		if(installedModules[moduleId])                                                                              // 45
/******/ 			return installedModules[moduleId].exports;                                                                 // 46
                                                                                                                       // 47
/******/ 		// Create a new module (and put it into the cache)                                                          // 48
/******/ 		var module = installedModules[moduleId] = {                                                                 // 49
/******/ 			exports: {},                                                                                               // 50
/******/ 			id: moduleId,                                                                                              // 51
/******/ 			loaded: false                                                                                              // 52
/******/ 		};                                                                                                          // 53
                                                                                                                       // 54
/******/ 		// Execute the module function                                                                              // 55
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);                        // 56
                                                                                                                       // 57
/******/ 		// Flag the module as loaded                                                                                // 58
/******/ 		module.loaded = true;                                                                                       // 59
                                                                                                                       // 60
/******/ 		// Return the exports of the module                                                                         // 61
/******/ 		return module.exports;                                                                                      // 62
/******/ 	}                                                                                                            // 63
                                                                                                                       // 64
                                                                                                                       // 65
/******/ 	// expose the modules object (__webpack_modules__)                                                           // 66
/******/ 	__webpack_require__.m = modules;                                                                             // 67
                                                                                                                       // 68
/******/ 	// expose the module cache                                                                                   // 69
/******/ 	__webpack_require__.c = installedModules;                                                                    // 70
                                                                                                                       // 71
/******/ 	// __webpack_public_path__                                                                                   // 72
/******/ 	__webpack_require__.p = "";                                                                                  // 73
                                                                                                                       // 74
/******/ 	// Load entry module and return exports                                                                      // 75
/******/ 	return __webpack_require__(0);                                                                               // 76
/******/ })                                                                                                            // 77
/************************************************************************/                                             // 78
/******/ ([                                                                                                            // 79
/* 0 */                                                                                                                // 80
/***/ function(module, exports, __webpack_require__) {                                                                 // 81
                                                                                                                       // 82
	'use strict';                                                                                                         // 83
                                                                                                                       // 84
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 85
                                                                                                                       // 86
	exports.__esModule = true;                                                                                            // 87
                                                                                                                       // 88
	var _import = __webpack_require__(1);                                                                                 // 89
                                                                                                                       // 90
	var base = _interopRequireWildcard(_import);                                                                          // 91
                                                                                                                       // 92
	// Each of these augment the Handlebars object. No need to setup here.                                                // 93
	// (This is done to easily share code between commonjs and browse envs)                                               // 94
                                                                                                                       // 95
	var _SafeString = __webpack_require__(2);                                                                             // 96
                                                                                                                       // 97
	var _SafeString2 = _interopRequireWildcard(_SafeString);                                                              // 98
                                                                                                                       // 99
	var _Exception = __webpack_require__(3);                                                                              // 100
                                                                                                                       // 101
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 102
                                                                                                                       // 103
	var _import2 = __webpack_require__(4);                                                                                // 104
                                                                                                                       // 105
	var Utils = _interopRequireWildcard(_import2);                                                                        // 106
                                                                                                                       // 107
	var _import3 = __webpack_require__(5);                                                                                // 108
                                                                                                                       // 109
	var runtime = _interopRequireWildcard(_import3);                                                                      // 110
                                                                                                                       // 111
	var _noConflict = __webpack_require__(6);                                                                             // 112
                                                                                                                       // 113
	var _noConflict2 = _interopRequireWildcard(_noConflict);                                                              // 114
                                                                                                                       // 115
	// For compatibility and usage outside of module systems, make the Handlebars object a namespace                      // 116
	function create() {                                                                                                   // 117
	  var hb = new base.HandlebarsEnvironment();                                                                          // 118
                                                                                                                       // 119
	  Utils.extend(hb, base);                                                                                             // 120
	  hb.SafeString = _SafeString2['default'];                                                                            // 121
	  hb.Exception = _Exception2['default'];                                                                              // 122
	  hb.Utils = Utils;                                                                                                   // 123
	  hb.escapeExpression = Utils.escapeExpression;                                                                       // 124
                                                                                                                       // 125
	  hb.VM = runtime;                                                                                                    // 126
	  hb.template = function (spec) {                                                                                     // 127
	    return runtime.template(spec, hb);                                                                                // 128
	  };                                                                                                                  // 129
                                                                                                                       // 130
	  return hb;                                                                                                          // 131
	}                                                                                                                     // 132
                                                                                                                       // 133
	var inst = create();                                                                                                  // 134
	inst.create = create;                                                                                                 // 135
                                                                                                                       // 136
	_noConflict2['default'](inst);                                                                                        // 137
                                                                                                                       // 138
	inst['default'] = inst;                                                                                               // 139
                                                                                                                       // 140
	exports['default'] = inst;                                                                                            // 141
	module.exports = exports['default'];                                                                                  // 142
                                                                                                                       // 143
/***/ },                                                                                                               // 144
/* 1 */                                                                                                                // 145
/***/ function(module, exports, __webpack_require__) {                                                                 // 146
                                                                                                                       // 147
	'use strict';                                                                                                         // 148
                                                                                                                       // 149
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 150
                                                                                                                       // 151
	exports.__esModule = true;                                                                                            // 152
	exports.HandlebarsEnvironment = HandlebarsEnvironment;                                                                // 153
	exports.createFrame = createFrame;                                                                                    // 154
                                                                                                                       // 155
	var _import = __webpack_require__(4);                                                                                 // 156
                                                                                                                       // 157
	var Utils = _interopRequireWildcard(_import);                                                                         // 158
                                                                                                                       // 159
	var _Exception = __webpack_require__(3);                                                                              // 160
                                                                                                                       // 161
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 162
                                                                                                                       // 163
	var VERSION = '3.0.1';                                                                                                // 164
	exports.VERSION = VERSION;                                                                                            // 165
	var COMPILER_REVISION = 6;                                                                                            // 166
                                                                                                                       // 167
	exports.COMPILER_REVISION = COMPILER_REVISION;                                                                        // 168
	var REVISION_CHANGES = {                                                                                              // 169
	  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it                                                // 170
	  2: '== 1.0.0-rc.3',                                                                                                 // 171
	  3: '== 1.0.0-rc.4',                                                                                                 // 172
	  4: '== 1.x.x',                                                                                                      // 173
	  5: '== 2.0.0-alpha.x',                                                                                              // 174
	  6: '>= 2.0.0-beta.1'                                                                                                // 175
	};                                                                                                                    // 176
                                                                                                                       // 177
	exports.REVISION_CHANGES = REVISION_CHANGES;                                                                          // 178
	var isArray = Utils.isArray,                                                                                          // 179
	    isFunction = Utils.isFunction,                                                                                    // 180
	    toString = Utils.toString,                                                                                        // 181
	    objectType = '[object Object]';                                                                                   // 182
                                                                                                                       // 183
	function HandlebarsEnvironment(helpers, partials) {                                                                   // 184
	  this.helpers = helpers || {};                                                                                       // 185
	  this.partials = partials || {};                                                                                     // 186
                                                                                                                       // 187
	  registerDefaultHelpers(this);                                                                                       // 188
	}                                                                                                                     // 189
                                                                                                                       // 190
	HandlebarsEnvironment.prototype = {                                                                                   // 191
	  constructor: HandlebarsEnvironment,                                                                                 // 192
                                                                                                                       // 193
	  logger: logger,                                                                                                     // 194
	  log: log,                                                                                                           // 195
                                                                                                                       // 196
	  registerHelper: function registerHelper(name, fn) {                                                                 // 197
	    if (toString.call(name) === objectType) {                                                                         // 198
	      if (fn) {                                                                                                       // 199
	        throw new _Exception2['default']('Arg not supported with multiple helpers');                                  // 200
	      }                                                                                                               // 201
	      Utils.extend(this.helpers, name);                                                                               // 202
	    } else {                                                                                                          // 203
	      this.helpers[name] = fn;                                                                                        // 204
	    }                                                                                                                 // 205
	  },                                                                                                                  // 206
	  unregisterHelper: function unregisterHelper(name) {                                                                 // 207
	    delete this.helpers[name];                                                                                        // 208
	  },                                                                                                                  // 209
                                                                                                                       // 210
	  registerPartial: function registerPartial(name, partial) {                                                          // 211
	    if (toString.call(name) === objectType) {                                                                         // 212
	      Utils.extend(this.partials, name);                                                                              // 213
	    } else {                                                                                                          // 214
	      if (typeof partial === 'undefined') {                                                                           // 215
	        throw new _Exception2['default']('Attempting to register a partial as undefined');                            // 216
	      }                                                                                                               // 217
	      this.partials[name] = partial;                                                                                  // 218
	    }                                                                                                                 // 219
	  },                                                                                                                  // 220
	  unregisterPartial: function unregisterPartial(name) {                                                               // 221
	    delete this.partials[name];                                                                                       // 222
	  }                                                                                                                   // 223
	};                                                                                                                    // 224
                                                                                                                       // 225
	function registerDefaultHelpers(instance) {                                                                           // 226
	  instance.registerHelper('helperMissing', function () {                                                              // 227
	    if (arguments.length === 1) {                                                                                     // 228
	      // A missing field in a {{foo}} constuct.                                                                       // 229
	      return undefined;                                                                                               // 230
	    } else {                                                                                                          // 231
	      // Someone is actually trying to call something, blow up.                                                       // 232
	      throw new _Exception2['default']('Missing helper: "' + arguments[arguments.length - 1].name + '"');             // 233
	    }                                                                                                                 // 234
	  });                                                                                                                 // 235
                                                                                                                       // 236
	  instance.registerHelper('blockHelperMissing', function (context, options) {                                         // 237
	    var inverse = options.inverse,                                                                                    // 238
	        fn = options.fn;                                                                                              // 239
                                                                                                                       // 240
	    if (context === true) {                                                                                           // 241
	      return fn(this);                                                                                                // 242
	    } else if (context === false || context == null) {                                                                // 243
	      return inverse(this);                                                                                           // 244
	    } else if (isArray(context)) {                                                                                    // 245
	      if (context.length > 0) {                                                                                       // 246
	        if (options.ids) {                                                                                            // 247
	          options.ids = [options.name];                                                                               // 248
	        }                                                                                                             // 249
                                                                                                                       // 250
	        return instance.helpers.each(context, options);                                                               // 251
	      } else {                                                                                                        // 252
	        return inverse(this);                                                                                         // 253
	      }                                                                                                               // 254
	    } else {                                                                                                          // 255
	      if (options.data && options.ids) {                                                                              // 256
	        var data = createFrame(options.data);                                                                         // 257
	        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);                           // 258
	        options = { data: data };                                                                                     // 259
	      }                                                                                                               // 260
                                                                                                                       // 261
	      return fn(context, options);                                                                                    // 262
	    }                                                                                                                 // 263
	  });                                                                                                                 // 264
                                                                                                                       // 265
	  instance.registerHelper('each', function (context, options) {                                                       // 266
	    if (!options) {                                                                                                   // 267
	      throw new _Exception2['default']('Must pass iterator to #each');                                                // 268
	    }                                                                                                                 // 269
                                                                                                                       // 270
	    var fn = options.fn,                                                                                              // 271
	        inverse = options.inverse,                                                                                    // 272
	        i = 0,                                                                                                        // 273
	        ret = '',                                                                                                     // 274
	        data = undefined,                                                                                             // 275
	        contextPath = undefined;                                                                                      // 276
                                                                                                                       // 277
	    if (options.data && options.ids) {                                                                                // 278
	      contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';                          // 279
	    }                                                                                                                 // 280
                                                                                                                       // 281
	    if (isFunction(context)) {                                                                                        // 282
	      context = context.call(this);                                                                                   // 283
	    }                                                                                                                 // 284
                                                                                                                       // 285
	    if (options.data) {                                                                                               // 286
	      data = createFrame(options.data);                                                                               // 287
	    }                                                                                                                 // 288
                                                                                                                       // 289
	    function execIteration(field, index, last) {                                                                      // 290
	      if (data) {                                                                                                     // 291
	        data.key = field;                                                                                             // 292
	        data.index = index;                                                                                           // 293
	        data.first = index === 0;                                                                                     // 294
	        data.last = !!last;                                                                                           // 295
                                                                                                                       // 296
	        if (contextPath) {                                                                                            // 297
	          data.contextPath = contextPath + field;                                                                     // 298
	        }                                                                                                             // 299
	      }                                                                                                               // 300
                                                                                                                       // 301
	      ret = ret + fn(context[field], {                                                                                // 302
	        data: data,                                                                                                   // 303
	        blockParams: Utils.blockParams([context[field], field], [contextPath + field, null])                          // 304
	      });                                                                                                             // 305
	    }                                                                                                                 // 306
                                                                                                                       // 307
	    if (context && typeof context === 'object') {                                                                     // 308
	      if (isArray(context)) {                                                                                         // 309
	        for (var j = context.length; i < j; i++) {                                                                    // 310
	          execIteration(i, i, i === context.length - 1);                                                              // 311
	        }                                                                                                             // 312
	      } else {                                                                                                        // 313
	        var priorKey = undefined;                                                                                     // 314
                                                                                                                       // 315
	        for (var key in context) {                                                                                    // 316
	          if (context.hasOwnProperty(key)) {                                                                          // 317
	            // We're running the iterations one step out of sync so we can detect                                     // 318
	            // the last iteration without have to scan the object twice and create                                    // 319
	            // an itermediate keys array.                                                                             // 320
	            if (priorKey) {                                                                                           // 321
	              execIteration(priorKey, i - 1);                                                                         // 322
	            }                                                                                                         // 323
	            priorKey = key;                                                                                           // 324
	            i++;                                                                                                      // 325
	          }                                                                                                           // 326
	        }                                                                                                             // 327
	        if (priorKey) {                                                                                               // 328
	          execIteration(priorKey, i - 1, true);                                                                       // 329
	        }                                                                                                             // 330
	      }                                                                                                               // 331
	    }                                                                                                                 // 332
                                                                                                                       // 333
	    if (i === 0) {                                                                                                    // 334
	      ret = inverse(this);                                                                                            // 335
	    }                                                                                                                 // 336
                                                                                                                       // 337
	    return ret;                                                                                                       // 338
	  });                                                                                                                 // 339
                                                                                                                       // 340
	  instance.registerHelper('if', function (conditional, options) {                                                     // 341
	    if (isFunction(conditional)) {                                                                                    // 342
	      conditional = conditional.call(this);                                                                           // 343
	    }                                                                                                                 // 344
                                                                                                                       // 345
	    // Default behavior is to render the positive path if the value is truthy and not empty.                          // 346
	    // The `includeZero` option may be set to treat the condtional as purely not empty based on the                   // 347
	    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.             // 348
	    if (!options.hash.includeZero && !conditional || Utils.isEmpty(conditional)) {                                    // 349
	      return options.inverse(this);                                                                                   // 350
	    } else {                                                                                                          // 351
	      return options.fn(this);                                                                                        // 352
	    }                                                                                                                 // 353
	  });                                                                                                                 // 354
                                                                                                                       // 355
	  instance.registerHelper('unless', function (conditional, options) {                                                 // 356
	    return instance.helpers['if'].call(this, conditional, { fn: options.inverse, inverse: options.fn, hash: options.hash });
	  });                                                                                                                 // 358
                                                                                                                       // 359
	  instance.registerHelper('with', function (context, options) {                                                       // 360
	    if (isFunction(context)) {                                                                                        // 361
	      context = context.call(this);                                                                                   // 362
	    }                                                                                                                 // 363
                                                                                                                       // 364
	    var fn = options.fn;                                                                                              // 365
                                                                                                                       // 366
	    if (!Utils.isEmpty(context)) {                                                                                    // 367
	      if (options.data && options.ids) {                                                                              // 368
	        var data = createFrame(options.data);                                                                         // 369
	        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);                         // 370
	        options = { data: data };                                                                                     // 371
	      }                                                                                                               // 372
                                                                                                                       // 373
	      return fn(context, options);                                                                                    // 374
	    } else {                                                                                                          // 375
	      return options.inverse(this);                                                                                   // 376
	    }                                                                                                                 // 377
	  });                                                                                                                 // 378
                                                                                                                       // 379
	  instance.registerHelper('log', function (message, options) {                                                        // 380
	    var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;                    // 381
	    instance.log(level, message);                                                                                     // 382
	  });                                                                                                                 // 383
                                                                                                                       // 384
	  instance.registerHelper('lookup', function (obj, field) {                                                           // 385
	    return obj && obj[field];                                                                                         // 386
	  });                                                                                                                 // 387
	}                                                                                                                     // 388
                                                                                                                       // 389
	var logger = {                                                                                                        // 390
	  methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },                                                        // 391
                                                                                                                       // 392
	  // State enum                                                                                                       // 393
	  DEBUG: 0,                                                                                                           // 394
	  INFO: 1,                                                                                                            // 395
	  WARN: 2,                                                                                                            // 396
	  ERROR: 3,                                                                                                           // 397
	  level: 1,                                                                                                           // 398
                                                                                                                       // 399
	  // Can be overridden in the host environment                                                                        // 400
	  log: function log(level, message) {                                                                                 // 401
	    if (typeof console !== 'undefined' && logger.level <= level) {                                                    // 402
	      var method = logger.methodMap[level];                                                                           // 403
	      (console[method] || console.log).call(console, message); // eslint-disable-line no-console                      // 404
	    }                                                                                                                 // 405
	  }                                                                                                                   // 406
	};                                                                                                                    // 407
                                                                                                                       // 408
	exports.logger = logger;                                                                                              // 409
	var log = logger.log;                                                                                                 // 410
                                                                                                                       // 411
	exports.log = log;                                                                                                    // 412
                                                                                                                       // 413
	function createFrame(object) {                                                                                        // 414
	  var frame = Utils.extend({}, object);                                                                               // 415
	  frame._parent = object;                                                                                             // 416
	  return frame;                                                                                                       // 417
	}                                                                                                                     // 418
                                                                                                                       // 419
	/* [args, ]options */                                                                                                 // 420
                                                                                                                       // 421
/***/ },                                                                                                               // 422
/* 2 */                                                                                                                // 423
/***/ function(module, exports, __webpack_require__) {                                                                 // 424
                                                                                                                       // 425
	'use strict';                                                                                                         // 426
                                                                                                                       // 427
	exports.__esModule = true;                                                                                            // 428
	// Build out our basic SafeString type                                                                                // 429
	function SafeString(string) {                                                                                         // 430
	  this.string = string;                                                                                               // 431
	}                                                                                                                     // 432
                                                                                                                       // 433
	SafeString.prototype.toString = SafeString.prototype.toHTML = function () {                                           // 434
	  return '' + this.string;                                                                                            // 435
	};                                                                                                                    // 436
                                                                                                                       // 437
	exports['default'] = SafeString;                                                                                      // 438
	module.exports = exports['default'];                                                                                  // 439
                                                                                                                       // 440
/***/ },                                                                                                               // 441
/* 3 */                                                                                                                // 442
/***/ function(module, exports, __webpack_require__) {                                                                 // 443
                                                                                                                       // 444
	'use strict';                                                                                                         // 445
                                                                                                                       // 446
	exports.__esModule = true;                                                                                            // 447
                                                                                                                       // 448
	var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];                     // 449
                                                                                                                       // 450
	function Exception(message, node) {                                                                                   // 451
	  var loc = node && node.loc,                                                                                         // 452
	      line = undefined,                                                                                               // 453
	      column = undefined;                                                                                             // 454
	  if (loc) {                                                                                                          // 455
	    line = loc.start.line;                                                                                            // 456
	    column = loc.start.column;                                                                                        // 457
                                                                                                                       // 458
	    message += ' - ' + line + ':' + column;                                                                           // 459
	  }                                                                                                                   // 460
                                                                                                                       // 461
	  var tmp = Error.prototype.constructor.call(this, message);                                                          // 462
                                                                                                                       // 463
	  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.                 // 464
	  for (var idx = 0; idx < errorProps.length; idx++) {                                                                 // 465
	    this[errorProps[idx]] = tmp[errorProps[idx]];                                                                     // 466
	  }                                                                                                                   // 467
                                                                                                                       // 468
	  if (Error.captureStackTrace) {                                                                                      // 469
	    Error.captureStackTrace(this, Exception);                                                                         // 470
	  }                                                                                                                   // 471
                                                                                                                       // 472
	  if (loc) {                                                                                                          // 473
	    this.lineNumber = line;                                                                                           // 474
	    this.column = column;                                                                                             // 475
	  }                                                                                                                   // 476
	}                                                                                                                     // 477
                                                                                                                       // 478
	Exception.prototype = new Error();                                                                                    // 479
                                                                                                                       // 480
	exports['default'] = Exception;                                                                                       // 481
	module.exports = exports['default'];                                                                                  // 482
                                                                                                                       // 483
/***/ },                                                                                                               // 484
/* 4 */                                                                                                                // 485
/***/ function(module, exports, __webpack_require__) {                                                                 // 486
                                                                                                                       // 487
	'use strict';                                                                                                         // 488
                                                                                                                       // 489
	exports.__esModule = true;                                                                                            // 490
	exports.extend = extend;                                                                                              // 491
                                                                                                                       // 492
	// Older IE versions do not directly support indexOf so we must implement our own, sadly.                             // 493
	exports.indexOf = indexOf;                                                                                            // 494
	exports.escapeExpression = escapeExpression;                                                                          // 495
	exports.isEmpty = isEmpty;                                                                                            // 496
	exports.blockParams = blockParams;                                                                                    // 497
	exports.appendContextPath = appendContextPath;                                                                        // 498
	var escape = {                                                                                                        // 499
	  '&': '&amp;',                                                                                                       // 500
	  '<': '&lt;',                                                                                                        // 501
	  '>': '&gt;',                                                                                                        // 502
	  '"': '&quot;',                                                                                                      // 503
	  '\'': '&#x27;',                                                                                                     // 504
	  '`': '&#x60;'                                                                                                       // 505
	};                                                                                                                    // 506
                                                                                                                       // 507
	var badChars = /[&<>"'`]/g,                                                                                           // 508
	    possible = /[&<>"'`]/;                                                                                            // 509
                                                                                                                       // 510
	function escapeChar(chr) {                                                                                            // 511
	  return escape[chr];                                                                                                 // 512
	}                                                                                                                     // 513
                                                                                                                       // 514
	function extend(obj /* , ...source */) {                                                                              // 515
	  for (var i = 1; i < arguments.length; i++) {                                                                        // 516
	    for (var key in arguments[i]) {                                                                                   // 517
	      if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {                                                  // 518
	        obj[key] = arguments[i][key];                                                                                 // 519
	      }                                                                                                               // 520
	    }                                                                                                                 // 521
	  }                                                                                                                   // 522
                                                                                                                       // 523
	  return obj;                                                                                                         // 524
	}                                                                                                                     // 525
                                                                                                                       // 526
	var toString = Object.prototype.toString;                                                                             // 527
                                                                                                                       // 528
	exports.toString = toString;                                                                                          // 529
	// Sourced from lodash                                                                                                // 530
	// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt                                                         // 531
	/*eslint-disable func-style, no-var */                                                                                // 532
	var isFunction = function isFunction(value) {                                                                         // 533
	  return typeof value === 'function';                                                                                 // 534
	};                                                                                                                    // 535
	// fallback for older versions of Chrome and Safari                                                                   // 536
	/* istanbul ignore next */                                                                                            // 537
	if (isFunction(/x/)) {                                                                                                // 538
	  exports.isFunction = isFunction = function (value) {                                                                // 539
	    return typeof value === 'function' && toString.call(value) === '[object Function]';                               // 540
	  };                                                                                                                  // 541
	}                                                                                                                     // 542
	var isFunction;                                                                                                       // 543
	exports.isFunction = isFunction;                                                                                      // 544
	/*eslint-enable func-style, no-var */                                                                                 // 545
                                                                                                                       // 546
	/* istanbul ignore next */                                                                                            // 547
	var isArray = Array.isArray || function (value) {                                                                     // 548
	  return value && typeof value === 'object' ? toString.call(value) === '[object Array]' : false;                      // 549
	};exports.isArray = isArray;                                                                                          // 550
                                                                                                                       // 551
	function indexOf(array, value) {                                                                                      // 552
	  for (var i = 0, len = array.length; i < len; i++) {                                                                 // 553
	    if (array[i] === value) {                                                                                         // 554
	      return i;                                                                                                       // 555
	    }                                                                                                                 // 556
	  }                                                                                                                   // 557
	  return -1;                                                                                                          // 558
	}                                                                                                                     // 559
                                                                                                                       // 560
	function escapeExpression(string) {                                                                                   // 561
	  if (typeof string !== 'string') {                                                                                   // 562
	    // don't escape SafeStrings, since they're already safe                                                           // 563
	    if (string && string.toHTML) {                                                                                    // 564
	      return string.toHTML();                                                                                         // 565
	    } else if (string == null) {                                                                                      // 566
	      return '';                                                                                                      // 567
	    } else if (!string) {                                                                                             // 568
	      return string + '';                                                                                             // 569
	    }                                                                                                                 // 570
                                                                                                                       // 571
	    // Force a string conversion as this will be done by the append regardless and                                    // 572
	    // the regex test will do this transparently behind the scenes, causing issues if                                 // 573
	    // an object's to string has escaped characters in it.                                                            // 574
	    string = '' + string;                                                                                             // 575
	  }                                                                                                                   // 576
                                                                                                                       // 577
	  if (!possible.test(string)) {                                                                                       // 578
	    return string;                                                                                                    // 579
	  }                                                                                                                   // 580
	  return string.replace(badChars, escapeChar);                                                                        // 581
	}                                                                                                                     // 582
                                                                                                                       // 583
	function isEmpty(value) {                                                                                             // 584
	  if (!value && value !== 0) {                                                                                        // 585
	    return true;                                                                                                      // 586
	  } else if (isArray(value) && value.length === 0) {                                                                  // 587
	    return true;                                                                                                      // 588
	  } else {                                                                                                            // 589
	    return false;                                                                                                     // 590
	  }                                                                                                                   // 591
	}                                                                                                                     // 592
                                                                                                                       // 593
	function blockParams(params, ids) {                                                                                   // 594
	  params.path = ids;                                                                                                  // 595
	  return params;                                                                                                      // 596
	}                                                                                                                     // 597
                                                                                                                       // 598
	function appendContextPath(contextPath, id) {                                                                         // 599
	  return (contextPath ? contextPath + '.' : '') + id;                                                                 // 600
	}                                                                                                                     // 601
                                                                                                                       // 602
/***/ },                                                                                                               // 603
/* 5 */                                                                                                                // 604
/***/ function(module, exports, __webpack_require__) {                                                                 // 605
                                                                                                                       // 606
	'use strict';                                                                                                         // 607
                                                                                                                       // 608
	var _interopRequireWildcard = __webpack_require__(7)['default'];                                                      // 609
                                                                                                                       // 610
	exports.__esModule = true;                                                                                            // 611
	exports.checkRevision = checkRevision;                                                                                // 612
                                                                                                                       // 613
	// TODO: Remove this line and break up compilePartial                                                                 // 614
                                                                                                                       // 615
	exports.template = template;                                                                                          // 616
	exports.wrapProgram = wrapProgram;                                                                                    // 617
	exports.resolvePartial = resolvePartial;                                                                              // 618
	exports.invokePartial = invokePartial;                                                                                // 619
	exports.noop = noop;                                                                                                  // 620
                                                                                                                       // 621
	var _import = __webpack_require__(4);                                                                                 // 622
                                                                                                                       // 623
	var Utils = _interopRequireWildcard(_import);                                                                         // 624
                                                                                                                       // 625
	var _Exception = __webpack_require__(3);                                                                              // 626
                                                                                                                       // 627
	var _Exception2 = _interopRequireWildcard(_Exception);                                                                // 628
                                                                                                                       // 629
	var _COMPILER_REVISION$REVISION_CHANGES$createFrame = __webpack_require__(1);                                         // 630
                                                                                                                       // 631
	function checkRevision(compilerInfo) {                                                                                // 632
	  var compilerRevision = compilerInfo && compilerInfo[0] || 1,                                                        // 633
	      currentRevision = _COMPILER_REVISION$REVISION_CHANGES$createFrame.COMPILER_REVISION;                            // 634
                                                                                                                       // 635
	  if (compilerRevision !== currentRevision) {                                                                         // 636
	    if (compilerRevision < currentRevision) {                                                                         // 637
	      var runtimeVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[currentRevision],        // 638
	          compilerVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[compilerRevision];      // 639
	      throw new _Exception2['default']('Template was precompiled with an older version of Handlebars than the current runtime. ' + 'Please update your precompiler to a newer version (' + runtimeVersions + ') or downgrade your runtime to an older version (' + compilerVersions + ').');
	    } else {                                                                                                          // 641
	      // Use the embedded version info since the runtime doesn't know about this revision yet                         // 642
	      throw new _Exception2['default']('Template was precompiled with a newer version of Handlebars than the current runtime. ' + 'Please update your runtime to a newer version (' + compilerInfo[1] + ').');
	    }                                                                                                                 // 644
	  }                                                                                                                   // 645
	}                                                                                                                     // 646
                                                                                                                       // 647
	function template(templateSpec, env) {                                                                                // 648
	  /* istanbul ignore next */                                                                                          // 649
	  if (!env) {                                                                                                         // 650
	    throw new _Exception2['default']('No environment passed to template');                                            // 651
	  }                                                                                                                   // 652
	  if (!templateSpec || !templateSpec.main) {                                                                          // 653
	    throw new _Exception2['default']('Unknown template object: ' + typeof templateSpec);                              // 654
	  }                                                                                                                   // 655
                                                                                                                       // 656
	  // Note: Using env.VM references rather than local var references throughout this section to allow                  // 657
	  // for external users to override these as psuedo-supported APIs.                                                   // 658
	  env.VM.checkRevision(templateSpec.compiler);                                                                        // 659
                                                                                                                       // 660
	  function invokePartialWrapper(partial, context, options) {                                                          // 661
	    if (options.hash) {                                                                                               // 662
	      context = Utils.extend({}, context, options.hash);                                                              // 663
	    }                                                                                                                 // 664
                                                                                                                       // 665
	    partial = env.VM.resolvePartial.call(this, partial, context, options);                                            // 666
	    var result = env.VM.invokePartial.call(this, partial, context, options);                                          // 667
                                                                                                                       // 668
	    if (result == null && env.compile) {                                                                              // 669
	      options.partials[options.name] = env.compile(partial, templateSpec.compilerOptions, env);                       // 670
	      result = options.partials[options.name](context, options);                                                      // 671
	    }                                                                                                                 // 672
	    if (result != null) {                                                                                             // 673
	      if (options.indent) {                                                                                           // 674
	        var lines = result.split('\n');                                                                               // 675
	        for (var i = 0, l = lines.length; i < l; i++) {                                                               // 676
	          if (!lines[i] && i + 1 === l) {                                                                             // 677
	            break;                                                                                                    // 678
	          }                                                                                                           // 679
                                                                                                                       // 680
	          lines[i] = options.indent + lines[i];                                                                       // 681
	        }                                                                                                             // 682
	        result = lines.join('\n');                                                                                    // 683
	      }                                                                                                               // 684
	      return result;                                                                                                  // 685
	    } else {                                                                                                          // 686
	      throw new _Exception2['default']('The partial ' + options.name + ' could not be compiled when running in runtime-only mode');
	    }                                                                                                                 // 688
	  }                                                                                                                   // 689
                                                                                                                       // 690
	  // Just add water                                                                                                   // 691
	  var container = {                                                                                                   // 692
	    strict: function strict(obj, name) {                                                                              // 693
	      if (!(name in obj)) {                                                                                           // 694
	        throw new _Exception2['default']('"' + name + '" not defined in ' + obj);                                     // 695
	      }                                                                                                               // 696
	      return obj[name];                                                                                               // 697
	    },                                                                                                                // 698
	    lookup: function lookup(depths, name) {                                                                           // 699
	      var len = depths.length;                                                                                        // 700
	      for (var i = 0; i < len; i++) {                                                                                 // 701
	        if (depths[i] && depths[i][name] != null) {                                                                   // 702
	          return depths[i][name];                                                                                     // 703
	        }                                                                                                             // 704
	      }                                                                                                               // 705
	    },                                                                                                                // 706
	    lambda: function lambda(current, context) {                                                                       // 707
	      return typeof current === 'function' ? current.call(context) : current;                                         // 708
	    },                                                                                                                // 709
                                                                                                                       // 710
	    escapeExpression: Utils.escapeExpression,                                                                         // 711
	    invokePartial: invokePartialWrapper,                                                                              // 712
                                                                                                                       // 713
	    fn: function fn(i) {                                                                                              // 714
	      return templateSpec[i];                                                                                         // 715
	    },                                                                                                                // 716
                                                                                                                       // 717
	    programs: [],                                                                                                     // 718
	    program: function program(i, data, declaredBlockParams, blockParams, depths) {                                    // 719
	      var programWrapper = this.programs[i],                                                                          // 720
	          fn = this.fn(i);                                                                                            // 721
	      if (data || depths || blockParams || declaredBlockParams) {                                                     // 722
	        programWrapper = wrapProgram(this, i, fn, data, declaredBlockParams, blockParams, depths);                    // 723
	      } else if (!programWrapper) {                                                                                   // 724
	        programWrapper = this.programs[i] = wrapProgram(this, i, fn);                                                 // 725
	      }                                                                                                               // 726
	      return programWrapper;                                                                                          // 727
	    },                                                                                                                // 728
                                                                                                                       // 729
	    data: function data(value, depth) {                                                                               // 730
	      while (value && depth--) {                                                                                      // 731
	        value = value._parent;                                                                                        // 732
	      }                                                                                                               // 733
	      return value;                                                                                                   // 734
	    },                                                                                                                // 735
	    merge: function merge(param, common) {                                                                            // 736
	      var obj = param || common;                                                                                      // 737
                                                                                                                       // 738
	      if (param && common && param !== common) {                                                                      // 739
	        obj = Utils.extend({}, common, param);                                                                        // 740
	      }                                                                                                               // 741
                                                                                                                       // 742
	      return obj;                                                                                                     // 743
	    },                                                                                                                // 744
                                                                                                                       // 745
	    noop: env.VM.noop,                                                                                                // 746
	    compilerInfo: templateSpec.compiler                                                                               // 747
	  };                                                                                                                  // 748
                                                                                                                       // 749
	  function ret(context) {                                                                                             // 750
	    var options = arguments[1] === undefined ? {} : arguments[1];                                                     // 751
                                                                                                                       // 752
	    var data = options.data;                                                                                          // 753
                                                                                                                       // 754
	    ret._setup(options);                                                                                              // 755
	    if (!options.partial && templateSpec.useData) {                                                                   // 756
	      data = initData(context, data);                                                                                 // 757
	    }                                                                                                                 // 758
	    var depths = undefined,                                                                                           // 759
	        blockParams = templateSpec.useBlockParams ? [] : undefined;                                                   // 760
	    if (templateSpec.useDepths) {                                                                                     // 761
	      depths = options.depths ? [context].concat(options.depths) : [context];                                         // 762
	    }                                                                                                                 // 763
                                                                                                                       // 764
	    return templateSpec.main.call(container, context, container.helpers, container.partials, data, blockParams, depths);
	  }                                                                                                                   // 766
	  ret.isTop = true;                                                                                                   // 767
                                                                                                                       // 768
	  ret._setup = function (options) {                                                                                   // 769
	    if (!options.partial) {                                                                                           // 770
	      container.helpers = container.merge(options.helpers, env.helpers);                                              // 771
                                                                                                                       // 772
	      if (templateSpec.usePartial) {                                                                                  // 773
	        container.partials = container.merge(options.partials, env.partials);                                         // 774
	      }                                                                                                               // 775
	    } else {                                                                                                          // 776
	      container.helpers = options.helpers;                                                                            // 777
	      container.partials = options.partials;                                                                          // 778
	    }                                                                                                                 // 779
	  };                                                                                                                  // 780
                                                                                                                       // 781
	  ret._child = function (i, data, blockParams, depths) {                                                              // 782
	    if (templateSpec.useBlockParams && !blockParams) {                                                                // 783
	      throw new _Exception2['default']('must pass block params');                                                     // 784
	    }                                                                                                                 // 785
	    if (templateSpec.useDepths && !depths) {                                                                          // 786
	      throw new _Exception2['default']('must pass parent depths');                                                    // 787
	    }                                                                                                                 // 788
                                                                                                                       // 789
	    return wrapProgram(container, i, templateSpec[i], data, 0, blockParams, depths);                                  // 790
	  };                                                                                                                  // 791
	  return ret;                                                                                                         // 792
	}                                                                                                                     // 793
                                                                                                                       // 794
	function wrapProgram(container, i, fn, data, declaredBlockParams, blockParams, depths) {                              // 795
	  function prog(context) {                                                                                            // 796
	    var options = arguments[1] === undefined ? {} : arguments[1];                                                     // 797
                                                                                                                       // 798
	    return fn.call(container, context, container.helpers, container.partials, options.data || data, blockParams && [options.blockParams].concat(blockParams), depths && [context].concat(depths));
	  }                                                                                                                   // 800
	  prog.program = i;                                                                                                   // 801
	  prog.depth = depths ? depths.length : 0;                                                                            // 802
	  prog.blockParams = declaredBlockParams || 0;                                                                        // 803
	  return prog;                                                                                                        // 804
	}                                                                                                                     // 805
                                                                                                                       // 806
	function resolvePartial(partial, context, options) {                                                                  // 807
	  if (!partial) {                                                                                                     // 808
	    partial = options.partials[options.name];                                                                         // 809
	  } else if (!partial.call && !options.name) {                                                                        // 810
	    // This is a dynamic partial that returned a string                                                               // 811
	    options.name = partial;                                                                                           // 812
	    partial = options.partials[partial];                                                                              // 813
	  }                                                                                                                   // 814
	  return partial;                                                                                                     // 815
	}                                                                                                                     // 816
                                                                                                                       // 817
	function invokePartial(partial, context, options) {                                                                   // 818
	  options.partial = true;                                                                                             // 819
                                                                                                                       // 820
	  if (partial === undefined) {                                                                                        // 821
	    throw new _Exception2['default']('The partial ' + options.name + ' could not be found');                          // 822
	  } else if (partial instanceof Function) {                                                                           // 823
	    return partial(context, options);                                                                                 // 824
	  }                                                                                                                   // 825
	}                                                                                                                     // 826
                                                                                                                       // 827
	function noop() {                                                                                                     // 828
	  return '';                                                                                                          // 829
	}                                                                                                                     // 830
                                                                                                                       // 831
	function initData(context, data) {                                                                                    // 832
	  if (!data || !('root' in data)) {                                                                                   // 833
	    data = data ? _COMPILER_REVISION$REVISION_CHANGES$createFrame.createFrame(data) : {};                             // 834
	    data.root = context;                                                                                              // 835
	  }                                                                                                                   // 836
	  return data;                                                                                                        // 837
	}                                                                                                                     // 838
                                                                                                                       // 839
/***/ },                                                                                                               // 840
/* 6 */                                                                                                                // 841
/***/ function(module, exports, __webpack_require__) {                                                                 // 842
                                                                                                                       // 843
	/* WEBPACK VAR INJECTION */(function(global) {'use strict';                                                           // 844
                                                                                                                       // 845
	exports.__esModule = true;                                                                                            // 846
	/*global window */                                                                                                    // 847
                                                                                                                       // 848
	exports['default'] = function (Handlebars) {                                                                          // 849
	  /* istanbul ignore next */                                                                                          // 850
	  var root = typeof global !== 'undefined' ? global : window,                                                         // 851
	      $Handlebars = root.Handlebars;                                                                                  // 852
	  /* istanbul ignore next */                                                                                          // 853
	  Handlebars.noConflict = function () {                                                                               // 854
	    if (root.Handlebars === Handlebars) {                                                                             // 855
	      root.Handlebars = $Handlebars;                                                                                  // 856
	    }                                                                                                                 // 857
	  };                                                                                                                  // 858
	};                                                                                                                    // 859
                                                                                                                       // 860
	module.exports = exports['default'];                                                                                  // 861
	/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))                                          // 862
                                                                                                                       // 863
/***/ },                                                                                                               // 864
/* 7 */                                                                                                                // 865
/***/ function(module, exports, __webpack_require__) {                                                                 // 866
                                                                                                                       // 867
	"use strict";                                                                                                         // 868
                                                                                                                       // 869
	exports["default"] = function (obj) {                                                                                 // 870
	  return obj && obj.__esModule ? obj : {                                                                              // 871
	    "default": obj                                                                                                    // 872
	  };                                                                                                                  // 873
	};                                                                                                                    // 874
                                                                                                                       // 875
	exports.__esModule = true;                                                                                            // 876
                                                                                                                       // 877
/***/ }                                                                                                                // 878
/******/ ])                                                                                                            // 879
});                                                                                                                    // 880
;                                                                                                                      // 881
                                                                                                                       // 882
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/handlebars.noconflict.js                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// medium-editor-insert-plugin needs its own Handlebars, not Meteor's                                                  // 1
// Handlebars. Fortunately, the local one is still available before Meteor's                                           // 2
// takes over.                                                                                                         // 3
Handlebars = window.Handlebars;                                                                                        // 4
                                                                                                                       // 5
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/jquery-sortable/source/js/jquery-sortable.js                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/* ===================================================                                                                 // 1
 *  jquery-sortable.js v0.9.12                                                                                         // 2
 *  http://johnny.github.com/jquery-sortable/                                                                          // 3
 * ===================================================                                                                 // 4
 *  Copyright (c) 2012 Jonas von Andrian                                                                               // 5
 *  All rights reserved.                                                                                               // 6
 *                                                                                                                     // 7
 *  Redistribution and use in source and binary forms, with or without                                                 // 8
 *  modification, are permitted provided that the following conditions are met:                                        // 9
 *  * Redistributions of source code must retain the above copyright                                                   // 10
 *    notice, this list of conditions and the following disclaimer.                                                    // 11
 *  * Redistributions in binary form must reproduce the above copyright                                                // 12
 *    notice, this list of conditions and the following disclaimer in the                                              // 13
 *    documentation and/or other materials provided with the distribution.                                             // 14
 *  * The name of the author may not be used to endorse or promote products                                            // 15
 *    derived from this software without specific prior written permission.                                            // 16
 *                                                                                                                     // 17
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND                                    // 18
 *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                      // 19
 *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE                                             // 20
 *  DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY                                                 // 21
 *  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES                                         // 22
 *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;                                       // 23
 *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND                                        // 24
 *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT                                         // 25
 *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS                                      // 26
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                       // 27
 * ========================================================== */                                                       // 28
                                                                                                                       // 29
!function ( $, window, pluginName, undefined){                                                                         // 30
  var eventNames,                                                                                                      // 31
  containerDefaults = {                                                                                                // 32
    // If true, items can be dragged from this container                                                               // 33
    drag: true,                                                                                                        // 34
    // If true, items can be droped onto this container                                                                // 35
    drop: true,                                                                                                        // 36
    // Exclude items from being draggable, if the                                                                      // 37
    // selector matches the item                                                                                       // 38
    exclude: "",                                                                                                       // 39
    // If true, search for nested containers within an item                                                            // 40
    nested: true,                                                                                                      // 41
    // If true, the items are assumed to be arranged vertically                                                        // 42
    vertical: true                                                                                                     // 43
  }, // end container defaults                                                                                         // 44
  groupDefaults = {                                                                                                    // 45
    // This is executed after the placeholder has been moved.                                                          // 46
    // $closestItemOrContainer contains the closest item, the placeholder                                              // 47
    // has been put at or the closest empty Container, the placeholder has                                             // 48
    // been appended to.                                                                                               // 49
    afterMove: function ($placeholder, container, $closestItemOrContainer) {                                           // 50
    },                                                                                                                 // 51
    // The exact css path between the container and its items, e.g. "> tbody"                                          // 52
    containerPath: "",                                                                                                 // 53
    // The css selector of the containers                                                                              // 54
    containerSelector: "ol, ul",                                                                                       // 55
    // Distance the mouse has to travel to start dragging                                                              // 56
    distance: 0,                                                                                                       // 57
    // Time in milliseconds after mousedown until dragging should start.                                               // 58
    // This option can be used to prevent unwanted drags when clicking on an element.                                  // 59
    delay: 0,                                                                                                          // 60
    // The css selector of the drag handle                                                                             // 61
    handle: "",                                                                                                        // 62
    // The exact css path between the item and its subcontainers                                                       // 63
    itemPath: "",                                                                                                      // 64
    // The css selector of the items                                                                                   // 65
    itemSelector: "li",                                                                                                // 66
    // Check if the dragged item may be inside the container.                                                          // 67
    // Use with care, since the search for a valid container entails a depth first search                              // 68
    // and may be quite expensive.                                                                                     // 69
    isValidTarget: function ($item, container) {                                                                       // 70
      return true                                                                                                      // 71
    },                                                                                                                 // 72
    // Executed before onDrop if placeholder is detached.                                                              // 73
    // This happens if pullPlaceholder is set to false and the drop occurs outside a container.                        // 74
    onCancel: function ($item, container, _super, event) {                                                             // 75
    },                                                                                                                 // 76
    // Executed at the beginning of a mouse move event.                                                                // 77
    // The Placeholder has not been moved yet.                                                                         // 78
    onDrag: function ($item, position, _super, event) {                                                                // 79
      $item.css(position)                                                                                              // 80
    },                                                                                                                 // 81
    // Called after the drag has been started,                                                                         // 82
    // that is the mouse button is beeing held down and                                                                // 83
    // the mouse is moving.                                                                                            // 84
    // The container is the closest initialized container.                                                             // 85
    // Therefore it might not be the container, that actually contains the item.                                       // 86
    onDragStart: function ($item, container, _super, event) {                                                          // 87
      $item.css({                                                                                                      // 88
        height: $item.height(),                                                                                        // 89
        width: $item.width()                                                                                           // 90
      })                                                                                                               // 91
      $item.addClass("dragged")                                                                                        // 92
      $("body").addClass("dragging")                                                                                   // 93
    },                                                                                                                 // 94
    // Called when the mouse button is beeing released                                                                 // 95
    onDrop: function ($item, container, _super, event) {                                                               // 96
      $item.removeClass("dragged").removeAttr("style")                                                                 // 97
      $("body").removeClass("dragging")                                                                                // 98
    },                                                                                                                 // 99
    // Called on mousedown. If falsy value is returned, the dragging will not start.                                   // 100
    // If clicked on input element, ignore                                                                             // 101
    onMousedown: function ($item, _super, event) {                                                                     // 102
      if (!event.target.nodeName.match(/^(input|select)$/i)) {                                                         // 103
        event.preventDefault()                                                                                         // 104
        return true                                                                                                    // 105
      }                                                                                                                // 106
    },                                                                                                                 // 107
    // Template for the placeholder. Can be any valid jQuery input                                                     // 108
    // e.g. a string, a DOM element.                                                                                   // 109
    // The placeholder must have the class "placeholder"                                                               // 110
    placeholder: '<li class="placeholder"/>',                                                                          // 111
    // If true, the position of the placeholder is calculated on every mousemove.                                      // 112
    // If false, it is only calculated when the mouse is above a container.                                            // 113
    pullPlaceholder: true,                                                                                             // 114
    // Specifies serialization of the container group.                                                                 // 115
    // The pair $parent/$children is either container/items or item/subcontainers.                                     // 116
    serialize: function ($parent, $children, parentIsContainer) {                                                      // 117
      var result = $.extend({}, $parent.data())                                                                        // 118
                                                                                                                       // 119
      if(parentIsContainer)                                                                                            // 120
        return [$children]                                                                                             // 121
      else if ($children[0]){                                                                                          // 122
        result.children = $children                                                                                    // 123
      }                                                                                                                // 124
                                                                                                                       // 125
      delete result.subContainers                                                                                      // 126
      delete result.sortable                                                                                           // 127
                                                                                                                       // 128
      return result                                                                                                    // 129
    },                                                                                                                 // 130
    // Set tolerance while dragging. Positive values decrease sensitivity,                                             // 131
    // negative values increase it.                                                                                    // 132
    tolerance: 0                                                                                                       // 133
  }, // end group defaults                                                                                             // 134
  containerGroups = {},                                                                                                // 135
  groupCounter = 0,                                                                                                    // 136
  emptyBox = {                                                                                                         // 137
    left: 0,                                                                                                           // 138
    top: 0,                                                                                                            // 139
    bottom: 0,                                                                                                         // 140
    right:0                                                                                                            // 141
  },                                                                                                                   // 142
  eventNames = {                                                                                                       // 143
    start: "touchstart.sortable mousedown.sortable",                                                                   // 144
    drop: "touchend.sortable touchcancel.sortable mouseup.sortable",                                                   // 145
    drag: "touchmove.sortable mousemove.sortable",                                                                     // 146
    scroll: "scroll.sortable"                                                                                          // 147
  },                                                                                                                   // 148
  subContainerKey = "subContainers"                                                                                    // 149
                                                                                                                       // 150
  /*                                                                                                                   // 151
   * a is Array [left, right, top, bottom]                                                                             // 152
   * b is array [left, top]                                                                                            // 153
   */                                                                                                                  // 154
  function d(a,b) {                                                                                                    // 155
    var x = Math.max(0, a[0] - b[0], b[0] - a[1]),                                                                     // 156
    y = Math.max(0, a[2] - b[1], b[1] - a[3])                                                                          // 157
    return x+y;                                                                                                        // 158
  }                                                                                                                    // 159
                                                                                                                       // 160
  function setDimensions(array, dimensions, tolerance, useOffset) {                                                    // 161
    var i = array.length,                                                                                              // 162
    offsetMethod = useOffset ? "offset" : "position"                                                                   // 163
    tolerance = tolerance || 0                                                                                         // 164
                                                                                                                       // 165
    while(i--){                                                                                                        // 166
      var el = array[i].el ? array[i].el : $(array[i]),                                                                // 167
      // use fitting method                                                                                            // 168
      pos = el[offsetMethod]()                                                                                         // 169
      pos.left += parseInt(el.css('margin-left'), 10)                                                                  // 170
      pos.top += parseInt(el.css('margin-top'),10)                                                                     // 171
      dimensions[i] = [                                                                                                // 172
        pos.left - tolerance,                                                                                          // 173
        pos.left + el.outerWidth() + tolerance,                                                                        // 174
        pos.top - tolerance,                                                                                           // 175
        pos.top + el.outerHeight() + tolerance                                                                         // 176
      ]                                                                                                                // 177
    }                                                                                                                  // 178
  }                                                                                                                    // 179
                                                                                                                       // 180
  function getRelativePosition(pointer, element) {                                                                     // 181
    var offset = element.offset()                                                                                      // 182
    return {                                                                                                           // 183
      left: pointer.left - offset.left,                                                                                // 184
      top: pointer.top - offset.top                                                                                    // 185
    }                                                                                                                  // 186
  }                                                                                                                    // 187
                                                                                                                       // 188
  function sortByDistanceDesc(dimensions, pointer, lastPointer) {                                                      // 189
    pointer = [pointer.left, pointer.top]                                                                              // 190
    lastPointer = lastPointer && [lastPointer.left, lastPointer.top]                                                   // 191
                                                                                                                       // 192
    var dim,                                                                                                           // 193
    i = dimensions.length,                                                                                             // 194
    distances = []                                                                                                     // 195
                                                                                                                       // 196
    while(i--){                                                                                                        // 197
      dim = dimensions[i]                                                                                              // 198
      distances[i] = [i,d(dim,pointer), lastPointer && d(dim, lastPointer)]                                            // 199
    }                                                                                                                  // 200
    distances = distances.sort(function  (a,b) {                                                                       // 201
      return b[1] - a[1] || b[2] - a[2] || b[0] - a[0]                                                                 // 202
    })                                                                                                                 // 203
                                                                                                                       // 204
    // last entry is the closest                                                                                       // 205
    return distances                                                                                                   // 206
  }                                                                                                                    // 207
                                                                                                                       // 208
  function ContainerGroup(options) {                                                                                   // 209
    this.options = $.extend({}, groupDefaults, options)                                                                // 210
    this.containers = []                                                                                               // 211
                                                                                                                       // 212
    if(!this.options.rootGroup){                                                                                       // 213
      this.scrollProxy = $.proxy(this.scroll, this)                                                                    // 214
      this.dragProxy = $.proxy(this.drag, this)                                                                        // 215
      this.dropProxy = $.proxy(this.drop, this)                                                                        // 216
      this.placeholder = $(this.options.placeholder)                                                                   // 217
                                                                                                                       // 218
      if(!options.isValidTarget)                                                                                       // 219
        this.options.isValidTarget = undefined                                                                         // 220
    }                                                                                                                  // 221
  }                                                                                                                    // 222
                                                                                                                       // 223
  ContainerGroup.get = function  (options) {                                                                           // 224
    if(!containerGroups[options.group]) {                                                                              // 225
      if(options.group === undefined)                                                                                  // 226
        options.group = groupCounter ++                                                                                // 227
                                                                                                                       // 228
      containerGroups[options.group] = new ContainerGroup(options)                                                     // 229
    }                                                                                                                  // 230
                                                                                                                       // 231
    return containerGroups[options.group]                                                                              // 232
  }                                                                                                                    // 233
                                                                                                                       // 234
  ContainerGroup.prototype = {                                                                                         // 235
    dragInit: function  (e, itemContainer) {                                                                           // 236
      this.$document = $(itemContainer.el[0].ownerDocument)                                                            // 237
                                                                                                                       // 238
      // get item to drag                                                                                              // 239
      this.item = $(e.target).closest(this.options.itemSelector)                                                       // 240
      this.itemContainer = itemContainer                                                                               // 241
                                                                                                                       // 242
      if(this.item.is(this.options.exclude) ||                                                                         // 243
         !this.options.onMousedown(this.item, groupDefaults.onMousedown, e)){                                          // 244
        return                                                                                                         // 245
      }                                                                                                                // 246
                                                                                                                       // 247
      this.setPointer(e)                                                                                               // 248
      this.toggleListeners('on')                                                                                       // 249
                                                                                                                       // 250
      this.setupDelayTimer()                                                                                           // 251
      this.dragInitDone = true                                                                                         // 252
    },                                                                                                                 // 253
    drag: function  (e) {                                                                                              // 254
      if(!this.dragging){                                                                                              // 255
        if(!this.distanceMet(e) || !this.delayMet)                                                                     // 256
          return                                                                                                       // 257
                                                                                                                       // 258
        this.options.onDragStart(this.item, this.itemContainer, groupDefaults.onDragStart, e)                          // 259
        this.item.before(this.placeholder)                                                                             // 260
        this.dragging = true                                                                                           // 261
      }                                                                                                                // 262
                                                                                                                       // 263
      this.setPointer(e)                                                                                               // 264
      // place item under the cursor                                                                                   // 265
      this.options.onDrag(this.item,                                                                                   // 266
                          getRelativePosition(this.pointer, this.item.offsetParent()),                                 // 267
                          groupDefaults.onDrag,                                                                        // 268
                          e)                                                                                           // 269
                                                                                                                       // 270
      var x = e.pageX || e.originalEvent.pageX,                                                                        // 271
      y = e.pageY || e.originalEvent.pageY,                                                                            // 272
      box = this.sameResultBox,                                                                                        // 273
      t = this.options.tolerance                                                                                       // 274
                                                                                                                       // 275
      if(!box || box.top - t > y || box.bottom + t < y || box.left - t > x || box.right + t < x)                       // 276
        if(!this.searchValidTarget())                                                                                  // 277
          this.placeholder.detach()                                                                                    // 278
    },                                                                                                                 // 279
    drop: function  (e) {                                                                                              // 280
      this.toggleListeners('off')                                                                                      // 281
                                                                                                                       // 282
      this.dragInitDone = false                                                                                        // 283
                                                                                                                       // 284
      if(this.dragging){                                                                                               // 285
        // processing Drop, check if placeholder is detached                                                           // 286
        if(this.placeholder.closest("html")[0])                                                                        // 287
          this.placeholder.before(this.item).detach()                                                                  // 288
        else                                                                                                           // 289
          this.options.onCancel(this.item, this.itemContainer, groupDefaults.onCancel, e)                              // 290
                                                                                                                       // 291
        this.options.onDrop(this.item, this.getContainer(this.item), groupDefaults.onDrop, e)                          // 292
                                                                                                                       // 293
        // cleanup                                                                                                     // 294
        this.clearDimensions()                                                                                         // 295
        this.clearOffsetParent()                                                                                       // 296
        this.lastAppendedItem = this.sameResultBox = undefined                                                         // 297
        this.dragging = false                                                                                          // 298
      }                                                                                                                // 299
    },                                                                                                                 // 300
    searchValidTarget: function  (pointer, lastPointer) {                                                              // 301
      if(!pointer){                                                                                                    // 302
        pointer = this.relativePointer || this.pointer                                                                 // 303
        lastPointer = this.lastRelativePointer || this.lastPointer                                                     // 304
      }                                                                                                                // 305
                                                                                                                       // 306
      var distances = sortByDistanceDesc(this.getContainerDimensions(),                                                // 307
                                         pointer,                                                                      // 308
                                         lastPointer),                                                                 // 309
      i = distances.length                                                                                             // 310
                                                                                                                       // 311
      while(i--){                                                                                                      // 312
        var index = distances[i][0],                                                                                   // 313
        distance = distances[i][1]                                                                                     // 314
                                                                                                                       // 315
        if(!distance || this.options.pullPlaceholder){                                                                 // 316
          var container = this.containers[index]                                                                       // 317
          if(!container.disabled){                                                                                     // 318
            if(!this.$getOffsetParent()){                                                                              // 319
              var offsetParent = container.getItemOffsetParent()                                                       // 320
              pointer = getRelativePosition(pointer, offsetParent)                                                     // 321
              lastPointer = getRelativePosition(lastPointer, offsetParent)                                             // 322
            }                                                                                                          // 323
            if(container.searchValidTarget(pointer, lastPointer))                                                      // 324
              return true                                                                                              // 325
          }                                                                                                            // 326
        }                                                                                                              // 327
      }                                                                                                                // 328
      if(this.sameResultBox)                                                                                           // 329
        this.sameResultBox = undefined                                                                                 // 330
    },                                                                                                                 // 331
    movePlaceholder: function  (container, item, method, sameResultBox) {                                              // 332
      var lastAppendedItem = this.lastAppendedItem                                                                     // 333
      if(!sameResultBox && lastAppendedItem && lastAppendedItem[0] === item[0])                                        // 334
        return;                                                                                                        // 335
                                                                                                                       // 336
      item[method](this.placeholder)                                                                                   // 337
      this.lastAppendedItem = item                                                                                     // 338
      this.sameResultBox = sameResultBox                                                                               // 339
      this.options.afterMove(this.placeholder, container, item)                                                        // 340
    },                                                                                                                 // 341
    getContainerDimensions: function  () {                                                                             // 342
      if(!this.containerDimensions)                                                                                    // 343
        setDimensions(this.containers, this.containerDimensions = [], this.options.tolerance, !this.$getOffsetParent())
      return this.containerDimensions                                                                                  // 345
    },                                                                                                                 // 346
    getContainer: function  (element) {                                                                                // 347
      return element.closest(this.options.containerSelector).data(pluginName)                                          // 348
    },                                                                                                                 // 349
    $getOffsetParent: function  () {                                                                                   // 350
      if(this.offsetParent === undefined){                                                                             // 351
        var i = this.containers.length - 1,                                                                            // 352
        offsetParent = this.containers[i].getItemOffsetParent()                                                        // 353
                                                                                                                       // 354
        if(!this.options.rootGroup){                                                                                   // 355
          while(i--){                                                                                                  // 356
            if(offsetParent[0] != this.containers[i].getItemOffsetParent()[0]){                                        // 357
              // If every container has the same offset parent,                                                        // 358
              // use position() which is relative to this parent,                                                      // 359
              // otherwise use offset()                                                                                // 360
              // compare #setDimensions                                                                                // 361
              offsetParent = false                                                                                     // 362
              break;                                                                                                   // 363
            }                                                                                                          // 364
          }                                                                                                            // 365
        }                                                                                                              // 366
                                                                                                                       // 367
        this.offsetParent = offsetParent                                                                               // 368
      }                                                                                                                // 369
      return this.offsetParent                                                                                         // 370
    },                                                                                                                 // 371
    setPointer: function (e) {                                                                                         // 372
      var pointer = this.getPointer(e)                                                                                 // 373
                                                                                                                       // 374
      if(this.$getOffsetParent()){                                                                                     // 375
        var relativePointer = getRelativePosition(pointer, this.$getOffsetParent())                                    // 376
        this.lastRelativePointer = this.relativePointer                                                                // 377
        this.relativePointer = relativePointer                                                                         // 378
      }                                                                                                                // 379
                                                                                                                       // 380
      this.lastPointer = this.pointer                                                                                  // 381
      this.pointer = pointer                                                                                           // 382
    },                                                                                                                 // 383
    distanceMet: function (e) {                                                                                        // 384
      var currentPointer = this.getPointer(e)                                                                          // 385
      return (Math.max(                                                                                                // 386
        Math.abs(this.pointer.left - currentPointer.left),                                                             // 387
        Math.abs(this.pointer.top - currentPointer.top)                                                                // 388
      ) >= this.options.distance)                                                                                      // 389
    },                                                                                                                 // 390
    getPointer: function(e) {                                                                                          // 391
      return {                                                                                                         // 392
        left: e.pageX || e.originalEvent.pageX,                                                                        // 393
        top: e.pageY || e.originalEvent.pageY                                                                          // 394
      }                                                                                                                // 395
    },                                                                                                                 // 396
    setupDelayTimer: function () {                                                                                     // 397
      var that = this                                                                                                  // 398
      this.delayMet = !this.options.delay                                                                              // 399
                                                                                                                       // 400
      // init delay timer if needed                                                                                    // 401
      if (!this.delayMet) {                                                                                            // 402
        clearTimeout(this._mouseDelayTimer);                                                                           // 403
        this._mouseDelayTimer = setTimeout(function() {                                                                // 404
          that.delayMet = true                                                                                         // 405
        }, this.options.delay)                                                                                         // 406
      }                                                                                                                // 407
    },                                                                                                                 // 408
    scroll: function  (e) {                                                                                            // 409
      this.clearDimensions()                                                                                           // 410
      this.clearOffsetParent() // TODO is this needed?                                                                 // 411
    },                                                                                                                 // 412
    toggleListeners: function (method) {                                                                               // 413
      var that = this,                                                                                                 // 414
      events = ['drag','drop','scroll']                                                                                // 415
                                                                                                                       // 416
      $.each(events,function  (i,event) {                                                                              // 417
        that.$document[method](eventNames[event], that[event + 'Proxy'])                                               // 418
      })                                                                                                               // 419
    },                                                                                                                 // 420
    clearOffsetParent: function () {                                                                                   // 421
      this.offsetParent = undefined                                                                                    // 422
    },                                                                                                                 // 423
    // Recursively clear container and item dimensions                                                                 // 424
    clearDimensions: function  () {                                                                                    // 425
      this.traverse(function(object){                                                                                  // 426
        object._clearDimensions()                                                                                      // 427
      })                                                                                                               // 428
    },                                                                                                                 // 429
    traverse: function(callback) {                                                                                     // 430
      callback(this)                                                                                                   // 431
      var i = this.containers.length                                                                                   // 432
      while(i--){                                                                                                      // 433
        this.containers[i].traverse(callback)                                                                          // 434
      }                                                                                                                // 435
    },                                                                                                                 // 436
    _clearDimensions: function(){                                                                                      // 437
      this.containerDimensions = undefined                                                                             // 438
    },                                                                                                                 // 439
    _destroy: function () {                                                                                            // 440
      containerGroups[this.options.group] = undefined                                                                  // 441
    }                                                                                                                  // 442
  }                                                                                                                    // 443
                                                                                                                       // 444
  function Container(element, options) {                                                                               // 445
    this.el = element                                                                                                  // 446
    this.options = $.extend( {}, containerDefaults, options)                                                           // 447
                                                                                                                       // 448
    this.group = ContainerGroup.get(this.options)                                                                      // 449
    this.rootGroup = this.options.rootGroup || this.group                                                              // 450
    this.handle = this.rootGroup.options.handle || this.rootGroup.options.itemSelector                                 // 451
                                                                                                                       // 452
    var itemPath = this.rootGroup.options.itemPath                                                                     // 453
    this.target = itemPath ? this.el.find(itemPath) : this.el                                                          // 454
                                                                                                                       // 455
    this.target.on(eventNames.start, this.handle, $.proxy(this.dragInit, this))                                        // 456
                                                                                                                       // 457
    if(this.options.drop)                                                                                              // 458
      this.group.containers.push(this)                                                                                 // 459
  }                                                                                                                    // 460
                                                                                                                       // 461
  Container.prototype = {                                                                                              // 462
    dragInit: function  (e) {                                                                                          // 463
      var rootGroup = this.rootGroup                                                                                   // 464
                                                                                                                       // 465
      if( !this.disabled &&                                                                                            // 466
          !rootGroup.dragInitDone &&                                                                                   // 467
          this.options.drag &&                                                                                         // 468
          this.isValidDrag(e)) {                                                                                       // 469
        rootGroup.dragInit(e, this)                                                                                    // 470
      }                                                                                                                // 471
    },                                                                                                                 // 472
    isValidDrag: function(e) {                                                                                         // 473
      return e.which == 1 ||                                                                                           // 474
        e.type == "touchstart" && e.originalEvent.touches.length == 1                                                  // 475
    },                                                                                                                 // 476
    searchValidTarget: function  (pointer, lastPointer) {                                                              // 477
      var distances = sortByDistanceDesc(this.getItemDimensions(),                                                     // 478
                                         pointer,                                                                      // 479
                                         lastPointer),                                                                 // 480
      i = distances.length,                                                                                            // 481
      rootGroup = this.rootGroup,                                                                                      // 482
      validTarget = !rootGroup.options.isValidTarget ||                                                                // 483
        rootGroup.options.isValidTarget(rootGroup.item, this)                                                          // 484
                                                                                                                       // 485
      if(!i && validTarget){                                                                                           // 486
        rootGroup.movePlaceholder(this, this.target, "append")                                                         // 487
        return true                                                                                                    // 488
      } else                                                                                                           // 489
        while(i--){                                                                                                    // 490
          var index = distances[i][0],                                                                                 // 491
          distance = distances[i][1]                                                                                   // 492
          if(!distance && this.hasChildGroup(index)){                                                                  // 493
            var found = this.getContainerGroup(index).searchValidTarget(pointer, lastPointer)                          // 494
            if(found)                                                                                                  // 495
              return true                                                                                              // 496
          }                                                                                                            // 497
          else if(validTarget){                                                                                        // 498
            this.movePlaceholder(index, pointer)                                                                       // 499
            return true                                                                                                // 500
          }                                                                                                            // 501
        }                                                                                                              // 502
    },                                                                                                                 // 503
    movePlaceholder: function  (index, pointer) {                                                                      // 504
      var item = $(this.items[index]),                                                                                 // 505
      dim = this.itemDimensions[index],                                                                                // 506
      method = "after",                                                                                                // 507
      width = item.outerWidth(),                                                                                       // 508
      height = item.outerHeight(),                                                                                     // 509
      offset = item.offset(),                                                                                          // 510
      sameResultBox = {                                                                                                // 511
        left: offset.left,                                                                                             // 512
        right: offset.left + width,                                                                                    // 513
        top: offset.top,                                                                                               // 514
        bottom: offset.top + height                                                                                    // 515
      }                                                                                                                // 516
      if(this.options.vertical){                                                                                       // 517
        var yCenter = (dim[2] + dim[3]) / 2,                                                                           // 518
        inUpperHalf = pointer.top <= yCenter                                                                           // 519
        if(inUpperHalf){                                                                                               // 520
          method = "before"                                                                                            // 521
          sameResultBox.bottom -= height / 2                                                                           // 522
        } else                                                                                                         // 523
          sameResultBox.top += height / 2                                                                              // 524
      } else {                                                                                                         // 525
        var xCenter = (dim[0] + dim[1]) / 2,                                                                           // 526
        inLeftHalf = pointer.left <= xCenter                                                                           // 527
        if(inLeftHalf){                                                                                                // 528
          method = "before"                                                                                            // 529
          sameResultBox.right -= width / 2                                                                             // 530
        } else                                                                                                         // 531
          sameResultBox.left += width / 2                                                                              // 532
      }                                                                                                                // 533
      if(this.hasChildGroup(index))                                                                                    // 534
        sameResultBox = emptyBox                                                                                       // 535
      this.rootGroup.movePlaceholder(this, item, method, sameResultBox)                                                // 536
    },                                                                                                                 // 537
    getItemDimensions: function  () {                                                                                  // 538
      if(!this.itemDimensions){                                                                                        // 539
        this.items = this.$getChildren(this.el, "item").filter(":not(.placeholder, .dragged)").get()                   // 540
        setDimensions(this.items, this.itemDimensions = [], this.options.tolerance)                                    // 541
      }                                                                                                                // 542
      return this.itemDimensions                                                                                       // 543
    },                                                                                                                 // 544
    getItemOffsetParent: function  () {                                                                                // 545
      var offsetParent,                                                                                                // 546
      el = this.el                                                                                                     // 547
      // Since el might be empty we have to check el itself and                                                        // 548
      // can not do something like el.children().first().offsetParent()                                                // 549
      if(el.css("position") === "relative" || el.css("position") === "absolute"  || el.css("position") === "fixed")    // 550
        offsetParent = el                                                                                              // 551
      else                                                                                                             // 552
        offsetParent = el.offsetParent()                                                                               // 553
      return offsetParent                                                                                              // 554
    },                                                                                                                 // 555
    hasChildGroup: function (index) {                                                                                  // 556
      return this.options.nested && this.getContainerGroup(index)                                                      // 557
    },                                                                                                                 // 558
    getContainerGroup: function  (index) {                                                                             // 559
      var childGroup = $.data(this.items[index], subContainerKey)                                                      // 560
      if( childGroup === undefined){                                                                                   // 561
        var childContainers = this.$getChildren(this.items[index], "container")                                        // 562
        childGroup = false                                                                                             // 563
                                                                                                                       // 564
        if(childContainers[0]){                                                                                        // 565
          var options = $.extend({}, this.options, {                                                                   // 566
            rootGroup: this.rootGroup,                                                                                 // 567
            group: groupCounter ++                                                                                     // 568
          })                                                                                                           // 569
          childGroup = childContainers[pluginName](options).data(pluginName).group                                     // 570
        }                                                                                                              // 571
        $.data(this.items[index], subContainerKey, childGroup)                                                         // 572
      }                                                                                                                // 573
      return childGroup                                                                                                // 574
    },                                                                                                                 // 575
    $getChildren: function (parent, type) {                                                                            // 576
      var options = this.rootGroup.options,                                                                            // 577
      path = options[type + "Path"],                                                                                   // 578
      selector = options[type + "Selector"]                                                                            // 579
                                                                                                                       // 580
      parent = $(parent)                                                                                               // 581
      if(path)                                                                                                         // 582
        parent = parent.find(path)                                                                                     // 583
                                                                                                                       // 584
      return parent.children(selector)                                                                                 // 585
    },                                                                                                                 // 586
    _serialize: function (parent, isContainer) {                                                                       // 587
      var that = this,                                                                                                 // 588
      childType = isContainer ? "item" : "container",                                                                  // 589
                                                                                                                       // 590
      children = this.$getChildren(parent, childType).not(this.options.exclude).map(function () {                      // 591
        return that._serialize($(this), !isContainer)                                                                  // 592
      }).get()                                                                                                         // 593
                                                                                                                       // 594
      return this.rootGroup.options.serialize(parent, children, isContainer)                                           // 595
    },                                                                                                                 // 596
    traverse: function(callback) {                                                                                     // 597
      $.each(this.items || [], function(item){                                                                         // 598
        var group = $.data(this, subContainerKey)                                                                      // 599
        if(group)                                                                                                      // 600
          group.traverse(callback)                                                                                     // 601
      });                                                                                                              // 602
                                                                                                                       // 603
      callback(this)                                                                                                   // 604
    },                                                                                                                 // 605
    _clearDimensions: function  () {                                                                                   // 606
      this.itemDimensions = undefined                                                                                  // 607
    },                                                                                                                 // 608
    _destroy: function() {                                                                                             // 609
      var that = this;                                                                                                 // 610
                                                                                                                       // 611
      this.target.off(eventNames.start, this.handle);                                                                  // 612
      this.el.removeData(pluginName)                                                                                   // 613
                                                                                                                       // 614
      if(this.options.drop)                                                                                            // 615
        this.group.containers = $.grep(this.group.containers, function(val){                                           // 616
          return val != that                                                                                           // 617
        })                                                                                                             // 618
                                                                                                                       // 619
      $.each(this.items || [], function(){                                                                             // 620
        $.removeData(this, subContainerKey)                                                                            // 621
      })                                                                                                               // 622
    }                                                                                                                  // 623
  }                                                                                                                    // 624
                                                                                                                       // 625
  var API = {                                                                                                          // 626
    enable: function() {                                                                                               // 627
      this.traverse(function(object){                                                                                  // 628
        object.disabled = false                                                                                        // 629
      })                                                                                                               // 630
    },                                                                                                                 // 631
    disable: function (){                                                                                              // 632
      this.traverse(function(object){                                                                                  // 633
        object.disabled = true                                                                                         // 634
      })                                                                                                               // 635
    },                                                                                                                 // 636
    serialize: function () {                                                                                           // 637
      return this._serialize(this.el, true)                                                                            // 638
    },                                                                                                                 // 639
    refresh: function() {                                                                                              // 640
      this.traverse(function(object){                                                                                  // 641
        object._clearDimensions()                                                                                      // 642
      })                                                                                                               // 643
    },                                                                                                                 // 644
    destroy: function () {                                                                                             // 645
      this.traverse(function(object){                                                                                  // 646
        object._destroy();                                                                                             // 647
      })                                                                                                               // 648
    }                                                                                                                  // 649
  }                                                                                                                    // 650
                                                                                                                       // 651
  $.extend(Container.prototype, API)                                                                                   // 652
                                                                                                                       // 653
  /**                                                                                                                  // 654
   * jQuery API                                                                                                        // 655
   *                                                                                                                   // 656
   * Parameters are                                                                                                    // 657
   *   either options on init                                                                                          // 658
   *   or a method name followed by arguments to pass to the method                                                    // 659
   */                                                                                                                  // 660
  $.fn[pluginName] = function(methodOrOptions) {                                                                       // 661
    var args = Array.prototype.slice.call(arguments, 1)                                                                // 662
                                                                                                                       // 663
    return this.map(function(){                                                                                        // 664
      var $t = $(this),                                                                                                // 665
      object = $t.data(pluginName)                                                                                     // 666
                                                                                                                       // 667
      if(object && API[methodOrOptions])                                                                               // 668
        return API[methodOrOptions].apply(object, args) || this                                                        // 669
      else if(!object && (methodOrOptions === undefined ||                                                             // 670
                          typeof methodOrOptions === "object"))                                                        // 671
        $t.data(pluginName, new Container($t, methodOrOptions))                                                        // 672
                                                                                                                       // 673
      return this                                                                                                      // 674
    });                                                                                                                // 675
  };                                                                                                                   // 676
                                                                                                                       // 677
}(jQuery, window, 'sortable');                                                                                         // 678
                                                                                                                       // 679
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/blueimp-file-upload/js/vendor/jquery.ui.widget.js           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*! jQuery UI - v1.11.1+CommonJS - 2014-09-17                                                                          // 1
* http://jqueryui.com                                                                                                  // 2
* Includes: widget.js                                                                                                  // 3
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */                                             // 4
                                                                                                                       // 5
(function( factory ) {                                                                                                 // 6
	if ( typeof define === "function" && define.amd ) {                                                                   // 7
                                                                                                                       // 8
		// AMD. Register as an anonymous module.                                                                             // 9
		define([ "jquery" ], factory );                                                                                      // 10
                                                                                                                       // 11
	} else if (typeof exports === "object") {                                                                             // 12
		// Node/CommonJS:                                                                                                    // 13
		factory(require("jquery"));                                                                                          // 14
                                                                                                                       // 15
	} else {                                                                                                              // 16
                                                                                                                       // 17
		// Browser globals                                                                                                   // 18
		factory( jQuery );                                                                                                   // 19
	}                                                                                                                     // 20
}(function( $ ) {                                                                                                      // 21
/*!                                                                                                                    // 22
 * jQuery UI Widget 1.11.1                                                                                             // 23
 * http://jqueryui.com                                                                                                 // 24
 *                                                                                                                     // 25
 * Copyright 2014 jQuery Foundation and other contributors                                                             // 26
 * Released under the MIT license.                                                                                     // 27
 * http://jquery.org/license                                                                                           // 28
 *                                                                                                                     // 29
 * http://api.jqueryui.com/jQuery.widget/                                                                              // 30
 */                                                                                                                    // 31
                                                                                                                       // 32
                                                                                                                       // 33
var widget_uuid = 0,                                                                                                   // 34
	widget_slice = Array.prototype.slice;                                                                                 // 35
                                                                                                                       // 36
$.cleanData = (function( orig ) {                                                                                      // 37
	return function( elems ) {                                                                                            // 38
		var events, elem, i;                                                                                                 // 39
		for ( i = 0; (elem = elems[i]) != null; i++ ) {                                                                      // 40
			try {                                                                                                               // 41
                                                                                                                       // 42
				// Only trigger remove when necessary to save time                                                                 // 43
				events = $._data( elem, "events" );                                                                                // 44
				if ( events && events.remove ) {                                                                                   // 45
					$( elem ).triggerHandler( "remove" );                                                                             // 46
				}                                                                                                                  // 47
                                                                                                                       // 48
			// http://bugs.jquery.com/ticket/8235                                                                               // 49
			} catch( e ) {}                                                                                                     // 50
		}                                                                                                                    // 51
		orig( elems );                                                                                                       // 52
	};                                                                                                                    // 53
})( $.cleanData );                                                                                                     // 54
                                                                                                                       // 55
$.widget = function( name, base, prototype ) {                                                                         // 56
	var fullName, existingConstructor, constructor, basePrototype,                                                        // 57
		// proxiedPrototype allows the provided prototype to remain unmodified                                               // 58
		// so that it can be used as a mixin for multiple widgets (#8876)                                                    // 59
		proxiedPrototype = {},                                                                                               // 60
		namespace = name.split( "." )[ 0 ];                                                                                  // 61
                                                                                                                       // 62
	name = name.split( "." )[ 1 ];                                                                                        // 63
	fullName = namespace + "-" + name;                                                                                    // 64
                                                                                                                       // 65
	if ( !prototype ) {                                                                                                   // 66
		prototype = base;                                                                                                    // 67
		base = $.Widget;                                                                                                     // 68
	}                                                                                                                     // 69
                                                                                                                       // 70
	// create selector for plugin                                                                                         // 71
	$.expr[ ":" ][ fullName.toLowerCase() ] = function( elem ) {                                                          // 72
		return !!$.data( elem, fullName );                                                                                   // 73
	};                                                                                                                    // 74
                                                                                                                       // 75
	$[ namespace ] = $[ namespace ] || {};                                                                                // 76
	existingConstructor = $[ namespace ][ name ];                                                                         // 77
	constructor = $[ namespace ][ name ] = function( options, element ) {                                                 // 78
		// allow instantiation without "new" keyword                                                                         // 79
		if ( !this._createWidget ) {                                                                                         // 80
			return new constructor( options, element );                                                                         // 81
		}                                                                                                                    // 82
                                                                                                                       // 83
		// allow instantiation without initializing for simple inheritance                                                   // 84
		// must use "new" keyword (the code above always passes args)                                                        // 85
		if ( arguments.length ) {                                                                                            // 86
			this._createWidget( options, element );                                                                             // 87
		}                                                                                                                    // 88
	};                                                                                                                    // 89
	// extend with the existing constructor to carry over any static properties                                           // 90
	$.extend( constructor, existingConstructor, {                                                                         // 91
		version: prototype.version,                                                                                          // 92
		// copy the object used to create the prototype in case we need to                                                   // 93
		// redefine the widget later                                                                                         // 94
		_proto: $.extend( {}, prototype ),                                                                                   // 95
		// track widgets that inherit from this widget in case this widget is                                                // 96
		// redefined after a widget inherits from it                                                                         // 97
		_childConstructors: []                                                                                               // 98
	});                                                                                                                   // 99
                                                                                                                       // 100
	basePrototype = new base();                                                                                           // 101
	// we need to make the options hash a property directly on the new instance                                           // 102
	// otherwise we'll modify the options hash on the prototype that we're                                                // 103
	// inheriting from                                                                                                    // 104
	basePrototype.options = $.widget.extend( {}, basePrototype.options );                                                 // 105
	$.each( prototype, function( prop, value ) {                                                                          // 106
		if ( !$.isFunction( value ) ) {                                                                                      // 107
			proxiedPrototype[ prop ] = value;                                                                                   // 108
			return;                                                                                                             // 109
		}                                                                                                                    // 110
		proxiedPrototype[ prop ] = (function() {                                                                             // 111
			var _super = function() {                                                                                           // 112
					return base.prototype[ prop ].apply( this, arguments );                                                           // 113
				},                                                                                                                 // 114
				_superApply = function( args ) {                                                                                   // 115
					return base.prototype[ prop ].apply( this, args );                                                                // 116
				};                                                                                                                 // 117
			return function() {                                                                                                 // 118
				var __super = this._super,                                                                                         // 119
					__superApply = this._superApply,                                                                                  // 120
					returnValue;                                                                                                      // 121
                                                                                                                       // 122
				this._super = _super;                                                                                              // 123
				this._superApply = _superApply;                                                                                    // 124
                                                                                                                       // 125
				returnValue = value.apply( this, arguments );                                                                      // 126
                                                                                                                       // 127
				this._super = __super;                                                                                             // 128
				this._superApply = __superApply;                                                                                   // 129
                                                                                                                       // 130
				return returnValue;                                                                                                // 131
			};                                                                                                                  // 132
		})();                                                                                                                // 133
	});                                                                                                                   // 134
	constructor.prototype = $.widget.extend( basePrototype, {                                                             // 135
		// TODO: remove support for widgetEventPrefix                                                                        // 136
		// always use the name + a colon as the prefix, e.g., draggable:start                                                // 137
		// don't prefix for widgets that aren't DOM-based                                                                    // 138
		widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name                            // 139
	}, proxiedPrototype, {                                                                                                // 140
		constructor: constructor,                                                                                            // 141
		namespace: namespace,                                                                                                // 142
		widgetName: name,                                                                                                    // 143
		widgetFullName: fullName                                                                                             // 144
	});                                                                                                                   // 145
                                                                                                                       // 146
	// If this widget is being redefined then we need to find all widgets that                                            // 147
	// are inheriting from it and redefine all of them so that they inherit from                                          // 148
	// the new version of this widget. We're essentially trying to replace one                                            // 149
	// level in the prototype chain.                                                                                      // 150
	if ( existingConstructor ) {                                                                                          // 151
		$.each( existingConstructor._childConstructors, function( i, child ) {                                               // 152
			var childPrototype = child.prototype;                                                                               // 153
                                                                                                                       // 154
			// redefine the child widget using the same prototype that was                                                      // 155
			// originally used, but inherit from the new version of the base                                                    // 156
			$.widget( childPrototype.namespace + "." + childPrototype.widgetName, constructor, child._proto );                  // 157
		});                                                                                                                  // 158
		// remove the list of existing child constructors from the old constructor                                           // 159
		// so the old child constructors can be garbage collected                                                            // 160
		delete existingConstructor._childConstructors;                                                                       // 161
	} else {                                                                                                              // 162
		base._childConstructors.push( constructor );                                                                         // 163
	}                                                                                                                     // 164
                                                                                                                       // 165
	$.widget.bridge( name, constructor );                                                                                 // 166
                                                                                                                       // 167
	return constructor;                                                                                                   // 168
};                                                                                                                     // 169
                                                                                                                       // 170
$.widget.extend = function( target ) {                                                                                 // 171
	var input = widget_slice.call( arguments, 1 ),                                                                        // 172
		inputIndex = 0,                                                                                                      // 173
		inputLength = input.length,                                                                                          // 174
		key,                                                                                                                 // 175
		value;                                                                                                               // 176
	for ( ; inputIndex < inputLength; inputIndex++ ) {                                                                    // 177
		for ( key in input[ inputIndex ] ) {                                                                                 // 178
			value = input[ inputIndex ][ key ];                                                                                 // 179
			if ( input[ inputIndex ].hasOwnProperty( key ) && value !== undefined ) {                                           // 180
				// Clone objects                                                                                                   // 181
				if ( $.isPlainObject( value ) ) {                                                                                  // 182
					target[ key ] = $.isPlainObject( target[ key ] ) ?                                                                // 183
						$.widget.extend( {}, target[ key ], value ) :                                                                    // 184
						// Don't extend strings, arrays, etc. with objects                                                               // 185
						$.widget.extend( {}, value );                                                                                    // 186
				// Copy everything else by reference                                                                               // 187
				} else {                                                                                                           // 188
					target[ key ] = value;                                                                                            // 189
				}                                                                                                                  // 190
			}                                                                                                                   // 191
		}                                                                                                                    // 192
	}                                                                                                                     // 193
	return target;                                                                                                        // 194
};                                                                                                                     // 195
                                                                                                                       // 196
$.widget.bridge = function( name, object ) {                                                                           // 197
	var fullName = object.prototype.widgetFullName || name;                                                               // 198
	$.fn[ name ] = function( options ) {                                                                                  // 199
		var isMethodCall = typeof options === "string",                                                                      // 200
			args = widget_slice.call( arguments, 1 ),                                                                           // 201
			returnValue = this;                                                                                                 // 202
                                                                                                                       // 203
		// allow multiple hashes to be passed on init                                                                        // 204
		options = !isMethodCall && args.length ?                                                                             // 205
			$.widget.extend.apply( null, [ options ].concat(args) ) :                                                           // 206
			options;                                                                                                            // 207
                                                                                                                       // 208
		if ( isMethodCall ) {                                                                                                // 209
			this.each(function() {                                                                                              // 210
				var methodValue,                                                                                                   // 211
					instance = $.data( this, fullName );                                                                              // 212
				if ( options === "instance" ) {                                                                                    // 213
					returnValue = instance;                                                                                           // 214
					return false;                                                                                                     // 215
				}                                                                                                                  // 216
				if ( !instance ) {                                                                                                 // 217
					return $.error( "cannot call methods on " + name + " prior to initialization; " +                                 // 218
						"attempted to call method '" + options + "'" );                                                                  // 219
				}                                                                                                                  // 220
				if ( !$.isFunction( instance[options] ) || options.charAt( 0 ) === "_" ) {                                         // 221
					return $.error( "no such method '" + options + "' for " + name + " widget instance" );                            // 222
				}                                                                                                                  // 223
				methodValue = instance[ options ].apply( instance, args );                                                         // 224
				if ( methodValue !== instance && methodValue !== undefined ) {                                                     // 225
					returnValue = methodValue && methodValue.jquery ?                                                                 // 226
						returnValue.pushStack( methodValue.get() ) :                                                                     // 227
						methodValue;                                                                                                     // 228
					return false;                                                                                                     // 229
				}                                                                                                                  // 230
			});                                                                                                                 // 231
		} else {                                                                                                             // 232
			this.each(function() {                                                                                              // 233
				var instance = $.data( this, fullName );                                                                           // 234
				if ( instance ) {                                                                                                  // 235
					instance.option( options || {} );                                                                                 // 236
					if ( instance._init ) {                                                                                           // 237
						instance._init();                                                                                                // 238
					}                                                                                                                 // 239
				} else {                                                                                                           // 240
					$.data( this, fullName, new object( options, this ) );                                                            // 241
				}                                                                                                                  // 242
			});                                                                                                                 // 243
		}                                                                                                                    // 244
                                                                                                                       // 245
		return returnValue;                                                                                                  // 246
	};                                                                                                                    // 247
};                                                                                                                     // 248
                                                                                                                       // 249
$.Widget = function( /* options, element */ ) {};                                                                      // 250
$.Widget._childConstructors = [];                                                                                      // 251
                                                                                                                       // 252
$.Widget.prototype = {                                                                                                 // 253
	widgetName: "widget",                                                                                                 // 254
	widgetEventPrefix: "",                                                                                                // 255
	defaultElement: "<div>",                                                                                              // 256
	options: {                                                                                                            // 257
		disabled: false,                                                                                                     // 258
                                                                                                                       // 259
		// callbacks                                                                                                         // 260
		create: null                                                                                                         // 261
	},                                                                                                                    // 262
	_createWidget: function( options, element ) {                                                                         // 263
		element = $( element || this.defaultElement || this )[ 0 ];                                                          // 264
		this.element = $( element );                                                                                         // 265
		this.uuid = widget_uuid++;                                                                                           // 266
		this.eventNamespace = "." + this.widgetName + this.uuid;                                                             // 267
		this.options = $.widget.extend( {},                                                                                  // 268
			this.options,                                                                                                       // 269
			this._getCreateOptions(),                                                                                           // 270
			options );                                                                                                          // 271
                                                                                                                       // 272
		this.bindings = $();                                                                                                 // 273
		this.hoverable = $();                                                                                                // 274
		this.focusable = $();                                                                                                // 275
                                                                                                                       // 276
		if ( element !== this ) {                                                                                            // 277
			$.data( element, this.widgetFullName, this );                                                                       // 278
			this._on( true, this.element, {                                                                                     // 279
				remove: function( event ) {                                                                                        // 280
					if ( event.target === element ) {                                                                                 // 281
						this.destroy();                                                                                                  // 282
					}                                                                                                                 // 283
				}                                                                                                                  // 284
			});                                                                                                                 // 285
			this.document = $( element.style ?                                                                                  // 286
				// element within the document                                                                                     // 287
				element.ownerDocument :                                                                                            // 288
				// element is window or document                                                                                   // 289
				element.document || element );                                                                                     // 290
			this.window = $( this.document[0].defaultView || this.document[0].parentWindow );                                   // 291
		}                                                                                                                    // 292
                                                                                                                       // 293
		this._create();                                                                                                      // 294
		this._trigger( "create", null, this._getCreateEventData() );                                                         // 295
		this._init();                                                                                                        // 296
	},                                                                                                                    // 297
	_getCreateOptions: $.noop,                                                                                            // 298
	_getCreateEventData: $.noop,                                                                                          // 299
	_create: $.noop,                                                                                                      // 300
	_init: $.noop,                                                                                                        // 301
                                                                                                                       // 302
	destroy: function() {                                                                                                 // 303
		this._destroy();                                                                                                     // 304
		// we can probably remove the unbind calls in 2.0                                                                    // 305
		// all event bindings should go through this._on()                                                                   // 306
		this.element                                                                                                         // 307
			.unbind( this.eventNamespace )                                                                                      // 308
			.removeData( this.widgetFullName )                                                                                  // 309
			// support: jquery <1.6.3                                                                                           // 310
			// http://bugs.jquery.com/ticket/9413                                                                               // 311
			.removeData( $.camelCase( this.widgetFullName ) );                                                                  // 312
		this.widget()                                                                                                        // 313
			.unbind( this.eventNamespace )                                                                                      // 314
			.removeAttr( "aria-disabled" )                                                                                      // 315
			.removeClass(                                                                                                       // 316
				this.widgetFullName + "-disabled " +                                                                               // 317
				"ui-state-disabled" );                                                                                             // 318
                                                                                                                       // 319
		// clean up events and states                                                                                        // 320
		this.bindings.unbind( this.eventNamespace );                                                                         // 321
		this.hoverable.removeClass( "ui-state-hover" );                                                                      // 322
		this.focusable.removeClass( "ui-state-focus" );                                                                      // 323
	},                                                                                                                    // 324
	_destroy: $.noop,                                                                                                     // 325
                                                                                                                       // 326
	widget: function() {                                                                                                  // 327
		return this.element;                                                                                                 // 328
	},                                                                                                                    // 329
                                                                                                                       // 330
	option: function( key, value ) {                                                                                      // 331
		var options = key,                                                                                                   // 332
			parts,                                                                                                              // 333
			curOption,                                                                                                          // 334
			i;                                                                                                                  // 335
                                                                                                                       // 336
		if ( arguments.length === 0 ) {                                                                                      // 337
			// don't return a reference to the internal hash                                                                    // 338
			return $.widget.extend( {}, this.options );                                                                         // 339
		}                                                                                                                    // 340
                                                                                                                       // 341
		if ( typeof key === "string" ) {                                                                                     // 342
			// handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }                                                     // 343
			options = {};                                                                                                       // 344
			parts = key.split( "." );                                                                                           // 345
			key = parts.shift();                                                                                                // 346
			if ( parts.length ) {                                                                                               // 347
				curOption = options[ key ] = $.widget.extend( {}, this.options[ key ] );                                           // 348
				for ( i = 0; i < parts.length - 1; i++ ) {                                                                         // 349
					curOption[ parts[ i ] ] = curOption[ parts[ i ] ] || {};                                                          // 350
					curOption = curOption[ parts[ i ] ];                                                                              // 351
				}                                                                                                                  // 352
				key = parts.pop();                                                                                                 // 353
				if ( arguments.length === 1 ) {                                                                                    // 354
					return curOption[ key ] === undefined ? null : curOption[ key ];                                                  // 355
				}                                                                                                                  // 356
				curOption[ key ] = value;                                                                                          // 357
			} else {                                                                                                            // 358
				if ( arguments.length === 1 ) {                                                                                    // 359
					return this.options[ key ] === undefined ? null : this.options[ key ];                                            // 360
				}                                                                                                                  // 361
				options[ key ] = value;                                                                                            // 362
			}                                                                                                                   // 363
		}                                                                                                                    // 364
                                                                                                                       // 365
		this._setOptions( options );                                                                                         // 366
                                                                                                                       // 367
		return this;                                                                                                         // 368
	},                                                                                                                    // 369
	_setOptions: function( options ) {                                                                                    // 370
		var key;                                                                                                             // 371
                                                                                                                       // 372
		for ( key in options ) {                                                                                             // 373
			this._setOption( key, options[ key ] );                                                                             // 374
		}                                                                                                                    // 375
                                                                                                                       // 376
		return this;                                                                                                         // 377
	},                                                                                                                    // 378
	_setOption: function( key, value ) {                                                                                  // 379
		this.options[ key ] = value;                                                                                         // 380
                                                                                                                       // 381
		if ( key === "disabled" ) {                                                                                          // 382
			this.widget()                                                                                                       // 383
				.toggleClass( this.widgetFullName + "-disabled", !!value );                                                        // 384
                                                                                                                       // 385
			// If the widget is becoming disabled, then nothing is interactive                                                  // 386
			if ( value ) {                                                                                                      // 387
				this.hoverable.removeClass( "ui-state-hover" );                                                                    // 388
				this.focusable.removeClass( "ui-state-focus" );                                                                    // 389
			}                                                                                                                   // 390
		}                                                                                                                    // 391
                                                                                                                       // 392
		return this;                                                                                                         // 393
	},                                                                                                                    // 394
                                                                                                                       // 395
	enable: function() {                                                                                                  // 396
		return this._setOptions({ disabled: false });                                                                        // 397
	},                                                                                                                    // 398
	disable: function() {                                                                                                 // 399
		return this._setOptions({ disabled: true });                                                                         // 400
	},                                                                                                                    // 401
                                                                                                                       // 402
	_on: function( suppressDisabledCheck, element, handlers ) {                                                           // 403
		var delegateElement,                                                                                                 // 404
			instance = this;                                                                                                    // 405
                                                                                                                       // 406
		// no suppressDisabledCheck flag, shuffle arguments                                                                  // 407
		if ( typeof suppressDisabledCheck !== "boolean" ) {                                                                  // 408
			handlers = element;                                                                                                 // 409
			element = suppressDisabledCheck;                                                                                    // 410
			suppressDisabledCheck = false;                                                                                      // 411
		}                                                                                                                    // 412
                                                                                                                       // 413
		// no element argument, shuffle and use this.element                                                                 // 414
		if ( !handlers ) {                                                                                                   // 415
			handlers = element;                                                                                                 // 416
			element = this.element;                                                                                             // 417
			delegateElement = this.widget();                                                                                    // 418
		} else {                                                                                                             // 419
			element = delegateElement = $( element );                                                                           // 420
			this.bindings = this.bindings.add( element );                                                                       // 421
		}                                                                                                                    // 422
                                                                                                                       // 423
		$.each( handlers, function( event, handler ) {                                                                       // 424
			function handlerProxy() {                                                                                           // 425
				// allow widgets to customize the disabled handling                                                                // 426
				// - disabled as an array instead of boolean                                                                       // 427
				// - disabled class as method for disabling individual parts                                                       // 428
				if ( !suppressDisabledCheck &&                                                                                     // 429
						( instance.options.disabled === true ||                                                                          // 430
							$( this ).hasClass( "ui-state-disabled" ) ) ) {                                                                 // 431
					return;                                                                                                           // 432
				}                                                                                                                  // 433
				return ( typeof handler === "string" ? instance[ handler ] : handler )                                             // 434
					.apply( instance, arguments );                                                                                    // 435
			}                                                                                                                   // 436
                                                                                                                       // 437
			// copy the guid so direct unbinding works                                                                          // 438
			if ( typeof handler !== "string" ) {                                                                                // 439
				handlerProxy.guid = handler.guid =                                                                                 // 440
					handler.guid || handlerProxy.guid || $.guid++;                                                                    // 441
			}                                                                                                                   // 442
                                                                                                                       // 443
			var match = event.match( /^([\w:-]*)\s*(.*)$/ ),                                                                    // 444
				eventName = match[1] + instance.eventNamespace,                                                                    // 445
				selector = match[2];                                                                                               // 446
			if ( selector ) {                                                                                                   // 447
				delegateElement.delegate( selector, eventName, handlerProxy );                                                     // 448
			} else {                                                                                                            // 449
				element.bind( eventName, handlerProxy );                                                                           // 450
			}                                                                                                                   // 451
		});                                                                                                                  // 452
	},                                                                                                                    // 453
                                                                                                                       // 454
	_off: function( element, eventName ) {                                                                                // 455
		eventName = (eventName || "").split( " " ).join( this.eventNamespace + " " ) + this.eventNamespace;                  // 456
		element.unbind( eventName ).undelegate( eventName );                                                                 // 457
	},                                                                                                                    // 458
                                                                                                                       // 459
	_delay: function( handler, delay ) {                                                                                  // 460
		function handlerProxy() {                                                                                            // 461
			return ( typeof handler === "string" ? instance[ handler ] : handler )                                              // 462
				.apply( instance, arguments );                                                                                     // 463
		}                                                                                                                    // 464
		var instance = this;                                                                                                 // 465
		return setTimeout( handlerProxy, delay || 0 );                                                                       // 466
	},                                                                                                                    // 467
                                                                                                                       // 468
	_hoverable: function( element ) {                                                                                     // 469
		this.hoverable = this.hoverable.add( element );                                                                      // 470
		this._on( element, {                                                                                                 // 471
			mouseenter: function( event ) {                                                                                     // 472
				$( event.currentTarget ).addClass( "ui-state-hover" );                                                             // 473
			},                                                                                                                  // 474
			mouseleave: function( event ) {                                                                                     // 475
				$( event.currentTarget ).removeClass( "ui-state-hover" );                                                          // 476
			}                                                                                                                   // 477
		});                                                                                                                  // 478
	},                                                                                                                    // 479
                                                                                                                       // 480
	_focusable: function( element ) {                                                                                     // 481
		this.focusable = this.focusable.add( element );                                                                      // 482
		this._on( element, {                                                                                                 // 483
			focusin: function( event ) {                                                                                        // 484
				$( event.currentTarget ).addClass( "ui-state-focus" );                                                             // 485
			},                                                                                                                  // 486
			focusout: function( event ) {                                                                                       // 487
				$( event.currentTarget ).removeClass( "ui-state-focus" );                                                          // 488
			}                                                                                                                   // 489
		});                                                                                                                  // 490
	},                                                                                                                    // 491
                                                                                                                       // 492
	_trigger: function( type, event, data ) {                                                                             // 493
		var prop, orig,                                                                                                      // 494
			callback = this.options[ type ];                                                                                    // 495
                                                                                                                       // 496
		data = data || {};                                                                                                   // 497
		event = $.Event( event );                                                                                            // 498
		event.type = ( type === this.widgetEventPrefix ?                                                                     // 499
			type :                                                                                                              // 500
			this.widgetEventPrefix + type ).toLowerCase();                                                                      // 501
		// the original event may come from any element                                                                      // 502
		// so we need to reset the target on the new event                                                                   // 503
		event.target = this.element[ 0 ];                                                                                    // 504
                                                                                                                       // 505
		// copy original event properties over to the new event                                                              // 506
		orig = event.originalEvent;                                                                                          // 507
		if ( orig ) {                                                                                                        // 508
			for ( prop in orig ) {                                                                                              // 509
				if ( !( prop in event ) ) {                                                                                        // 510
					event[ prop ] = orig[ prop ];                                                                                     // 511
				}                                                                                                                  // 512
			}                                                                                                                   // 513
		}                                                                                                                    // 514
                                                                                                                       // 515
		this.element.trigger( event, data );                                                                                 // 516
		return !( $.isFunction( callback ) &&                                                                                // 517
			callback.apply( this.element[0], [ event ].concat( data ) ) === false ||                                            // 518
			event.isDefaultPrevented() );                                                                                       // 519
	}                                                                                                                     // 520
};                                                                                                                     // 521
                                                                                                                       // 522
$.each( { show: "fadeIn", hide: "fadeOut" }, function( method, defaultEffect ) {                                       // 523
	$.Widget.prototype[ "_" + method ] = function( element, options, callback ) {                                         // 524
		if ( typeof options === "string" ) {                                                                                 // 525
			options = { effect: options };                                                                                      // 526
		}                                                                                                                    // 527
		var hasOptions,                                                                                                      // 528
			effectName = !options ?                                                                                             // 529
				method :                                                                                                           // 530
				options === true || typeof options === "number" ?                                                                  // 531
					defaultEffect :                                                                                                   // 532
					options.effect || defaultEffect;                                                                                  // 533
		options = options || {};                                                                                             // 534
		if ( typeof options === "number" ) {                                                                                 // 535
			options = { duration: options };                                                                                    // 536
		}                                                                                                                    // 537
		hasOptions = !$.isEmptyObject( options );                                                                            // 538
		options.complete = callback;                                                                                         // 539
		if ( options.delay ) {                                                                                               // 540
			element.delay( options.delay );                                                                                     // 541
		}                                                                                                                    // 542
		if ( hasOptions && $.effects && $.effects.effect[ effectName ] ) {                                                   // 543
			element[ method ]( options );                                                                                       // 544
		} else if ( effectName !== method && element[ effectName ] ) {                                                       // 545
			element[ effectName ]( options.duration, options.easing, callback );                                                // 546
		} else {                                                                                                             // 547
			element.queue(function( next ) {                                                                                    // 548
				$( this )[ method ]();                                                                                             // 549
				if ( callback ) {                                                                                                  // 550
					callback.call( element[ 0 ] );                                                                                    // 551
				}                                                                                                                  // 552
				next();                                                                                                            // 553
			});                                                                                                                 // 554
		}                                                                                                                    // 555
	};                                                                                                                    // 556
});                                                                                                                    // 557
                                                                                                                       // 558
var widget = $.widget;                                                                                                 // 559
                                                                                                                       // 560
                                                                                                                       // 561
                                                                                                                       // 562
}));                                                                                                                   // 563
                                                                                                                       // 564
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/blueimp-file-upload/js/jquery.iframe-transport.js           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*                                                                                                                     // 1
 * jQuery Iframe Transport Plugin 1.8.3                                                                                // 2
 * https://github.com/blueimp/jQuery-File-Upload                                                                       // 3
 *                                                                                                                     // 4
 * Copyright 2011, Sebastian Tschan                                                                                    // 5
 * https://blueimp.net                                                                                                 // 6
 *                                                                                                                     // 7
 * Licensed under the MIT license:                                                                                     // 8
 * http://www.opensource.org/licenses/MIT                                                                              // 9
 */                                                                                                                    // 10
                                                                                                                       // 11
/* global define, require, window, document */                                                                         // 12
                                                                                                                       // 13
(function (factory) {                                                                                                  // 14
    'use strict';                                                                                                      // 15
    if (typeof define === 'function' && define.amd) {                                                                  // 16
        // Register as an anonymous AMD module:                                                                        // 17
        define(['jquery'], factory);                                                                                   // 18
    } else if (typeof exports === 'object') {                                                                          // 19
        // Node/CommonJS:                                                                                              // 20
        factory(require('jquery'));                                                                                    // 21
    } else {                                                                                                           // 22
        // Browser globals:                                                                                            // 23
        factory(window.jQuery);                                                                                        // 24
    }                                                                                                                  // 25
}(function ($) {                                                                                                       // 26
    'use strict';                                                                                                      // 27
                                                                                                                       // 28
    // Helper variable to create unique names for the transport iframes:                                               // 29
    var counter = 0;                                                                                                   // 30
                                                                                                                       // 31
    // The iframe transport accepts four additional options:                                                           // 32
    // options.fileInput: a jQuery collection of file input fields                                                     // 33
    // options.paramName: the parameter name for the file form data,                                                   // 34
    //  overrides the name property of the file input field(s),                                                        // 35
    //  can be a string or an array of strings.                                                                        // 36
    // options.formData: an array of objects with name and value properties,                                           // 37
    //  equivalent to the return data of .serializeArray(), e.g.:                                                      // 38
    //  [{name: 'a', value: 1}, {name: 'b', value: 2}]                                                                 // 39
    // options.initialIframeSrc: the URL of the initial iframe src,                                                    // 40
    //  by default set to "javascript:false;"                                                                          // 41
    $.ajaxTransport('iframe', function (options) {                                                                     // 42
        if (options.async) {                                                                                           // 43
            // javascript:false as initial iframe src                                                                  // 44
            // prevents warning popups on HTTPS in IE6:                                                                // 45
            /*jshint scripturl: true */                                                                                // 46
            var initialIframeSrc = options.initialIframeSrc || 'javascript:false;',                                    // 47
            /*jshint scripturl: false */                                                                               // 48
                form,                                                                                                  // 49
                iframe,                                                                                                // 50
                addParamChar;                                                                                          // 51
            return {                                                                                                   // 52
                send: function (_, completeCallback) {                                                                 // 53
                    form = $('<form style="display:none;"></form>');                                                   // 54
                    form.attr('accept-charset', options.formAcceptCharset);                                            // 55
                    addParamChar = /\?/.test(options.url) ? '&' : '?';                                                 // 56
                    // XDomainRequest only supports GET and POST:                                                      // 57
                    if (options.type === 'DELETE') {                                                                   // 58
                        options.url = options.url + addParamChar + '_method=DELETE';                                   // 59
                        options.type = 'POST';                                                                         // 60
                    } else if (options.type === 'PUT') {                                                               // 61
                        options.url = options.url + addParamChar + '_method=PUT';                                      // 62
                        options.type = 'POST';                                                                         // 63
                    } else if (options.type === 'PATCH') {                                                             // 64
                        options.url = options.url + addParamChar + '_method=PATCH';                                    // 65
                        options.type = 'POST';                                                                         // 66
                    }                                                                                                  // 67
                    // IE versions below IE8 cannot set the name property of                                           // 68
                    // elements that have already been added to the DOM,                                               // 69
                    // so we set the name along with the iframe HTML markup:                                           // 70
                    counter += 1;                                                                                      // 71
                    iframe = $(                                                                                        // 72
                        '<iframe src="' + initialIframeSrc +                                                           // 73
                            '" name="iframe-transport-' + counter + '"></iframe>'                                      // 74
                    ).bind('load', function () {                                                                       // 75
                        var fileInputClones,                                                                           // 76
                            paramNames = $.isArray(options.paramName) ?                                                // 77
                                    options.paramName : [options.paramName];                                           // 78
                        iframe                                                                                         // 79
                            .unbind('load')                                                                            // 80
                            .bind('load', function () {                                                                // 81
                                var response;                                                                          // 82
                                // Wrap in a try/catch block to catch exceptions thrown                                // 83
                                // when trying to access cross-domain iframe contents:                                 // 84
                                try {                                                                                  // 85
                                    response = iframe.contents();                                                      // 86
                                    // Google Chrome and Firefox do not throw an                                       // 87
                                    // exception when calling iframe.contents() on                                     // 88
                                    // cross-domain requests, so we unify the response:                                // 89
                                    if (!response.length || !response[0].firstChild) {                                 // 90
                                        throw new Error();                                                             // 91
                                    }                                                                                  // 92
                                } catch (e) {                                                                          // 93
                                    response = undefined;                                                              // 94
                                }                                                                                      // 95
                                // The complete callback returns the                                                   // 96
                                // iframe content document as response object:                                         // 97
                                completeCallback(                                                                      // 98
                                    200,                                                                               // 99
                                    'success',                                                                         // 100
                                    {'iframe': response}                                                               // 101
                                );                                                                                     // 102
                                // Fix for IE endless progress bar activity bug                                        // 103
                                // (happens on form submits to iframe targets):                                        // 104
                                $('<iframe src="' + initialIframeSrc + '"></iframe>')                                  // 105
                                    .appendTo(form);                                                                   // 106
                                window.setTimeout(function () {                                                        // 107
                                    // Removing the form in a setTimeout call                                          // 108
                                    // allows Chrome's developer tools to display                                      // 109
                                    // the response result                                                             // 110
                                    form.remove();                                                                     // 111
                                }, 0);                                                                                 // 112
                            });                                                                                        // 113
                        form                                                                                           // 114
                            .prop('target', iframe.prop('name'))                                                       // 115
                            .prop('action', options.url)                                                               // 116
                            .prop('method', options.type);                                                             // 117
                        if (options.formData) {                                                                        // 118
                            $.each(options.formData, function (index, field) {                                         // 119
                                $('<input type="hidden"/>')                                                            // 120
                                    .prop('name', field.name)                                                          // 121
                                    .val(field.value)                                                                  // 122
                                    .appendTo(form);                                                                   // 123
                            });                                                                                        // 124
                        }                                                                                              // 125
                        if (options.fileInput && options.fileInput.length &&                                           // 126
                                options.type === 'POST') {                                                             // 127
                            fileInputClones = options.fileInput.clone();                                               // 128
                            // Insert a clone for each file input field:                                               // 129
                            options.fileInput.after(function (index) {                                                 // 130
                                return fileInputClones[index];                                                         // 131
                            });                                                                                        // 132
                            if (options.paramName) {                                                                   // 133
                                options.fileInput.each(function (index) {                                              // 134
                                    $(this).prop(                                                                      // 135
                                        'name',                                                                        // 136
                                        paramNames[index] || options.paramName                                         // 137
                                    );                                                                                 // 138
                                });                                                                                    // 139
                            }                                                                                          // 140
                            // Appending the file input fields to the hidden form                                      // 141
                            // removes them from their original location:                                              // 142
                            form                                                                                       // 143
                                .append(options.fileInput)                                                             // 144
                                .prop('enctype', 'multipart/form-data')                                                // 145
                                // enctype must be set as encoding for IE:                                             // 146
                                .prop('encoding', 'multipart/form-data');                                              // 147
                            // Remove the HTML5 form attribute from the input(s):                                      // 148
                            options.fileInput.removeAttr('form');                                                      // 149
                        }                                                                                              // 150
                        form.submit();                                                                                 // 151
                        // Insert the file input fields at their original location                                     // 152
                        // by replacing the clones with the originals:                                                 // 153
                        if (fileInputClones && fileInputClones.length) {                                               // 154
                            options.fileInput.each(function (index, input) {                                           // 155
                                var clone = $(fileInputClones[index]);                                                 // 156
                                // Restore the original name and form properties:                                      // 157
                                $(input)                                                                               // 158
                                    .prop('name', clone.prop('name'))                                                  // 159
                                    .attr('form', clone.attr('form'));                                                 // 160
                                clone.replaceWith(input);                                                              // 161
                            });                                                                                        // 162
                        }                                                                                              // 163
                    });                                                                                                // 164
                    form.append(iframe).appendTo(document.body);                                                       // 165
                },                                                                                                     // 166
                abort: function () {                                                                                   // 167
                    if (iframe) {                                                                                      // 168
                        // javascript:false as iframe src aborts the request                                           // 169
                        // and prevents warning popups on HTTPS in IE6.                                                // 170
                        // concat is used to avoid the "Script URL" JSLint error:                                      // 171
                        iframe                                                                                         // 172
                            .unbind('load')                                                                            // 173
                            .prop('src', initialIframeSrc);                                                            // 174
                    }                                                                                                  // 175
                    if (form) {                                                                                        // 176
                        form.remove();                                                                                 // 177
                    }                                                                                                  // 178
                }                                                                                                      // 179
            };                                                                                                         // 180
        }                                                                                                              // 181
    });                                                                                                                // 182
                                                                                                                       // 183
    // The iframe transport returns the iframe content document as response.                                           // 184
    // The following adds converters from iframe to text, json, html, xml                                              // 185
    // and script.                                                                                                     // 186
    // Please note that the Content-Type for JSON responses has to be text/plain                                       // 187
    // or text/html, if the browser doesn't include application/json in the                                            // 188
    // Accept header, else IE will show a download dialog.                                                             // 189
    // The Content-Type for XML responses on the other hand has to be always                                           // 190
    // application/xml or text/xml, so IE properly parses the XML response.                                            // 191
    // See also                                                                                                        // 192
    // https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#content-type-negotiation                               // 193
    $.ajaxSetup({                                                                                                      // 194
        converters: {                                                                                                  // 195
            'iframe text': function (iframe) {                                                                         // 196
                return iframe && $(iframe[0].body).text();                                                             // 197
            },                                                                                                         // 198
            'iframe json': function (iframe) {                                                                         // 199
                return iframe && $.parseJSON($(iframe[0].body).text());                                                // 200
            },                                                                                                         // 201
            'iframe html': function (iframe) {                                                                         // 202
                return iframe && $(iframe[0].body).html();                                                             // 203
            },                                                                                                         // 204
            'iframe xml': function (iframe) {                                                                          // 205
                var xmlDoc = iframe && iframe[0];                                                                      // 206
                return xmlDoc && $.isXMLDoc(xmlDoc) ? xmlDoc :                                                         // 207
                        $.parseXML((xmlDoc.XMLDocument && xmlDoc.XMLDocument.xml) ||                                   // 208
                            $(xmlDoc.body).html());                                                                    // 209
            },                                                                                                         // 210
            'iframe script': function (iframe) {                                                                       // 211
                return iframe && $.globalEval($(iframe[0].body).text());                                               // 212
            }                                                                                                          // 213
        }                                                                                                              // 214
    });                                                                                                                // 215
                                                                                                                       // 216
}));                                                                                                                   // 217
                                                                                                                       // 218
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/blueimp-file-upload/js/jquery.fileupload.js                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*                                                                                                                     // 1
 * jQuery File Upload Plugin 5.42.3                                                                                    // 2
 * https://github.com/blueimp/jQuery-File-Upload                                                                       // 3
 *                                                                                                                     // 4
 * Copyright 2010, Sebastian Tschan                                                                                    // 5
 * https://blueimp.net                                                                                                 // 6
 *                                                                                                                     // 7
 * Licensed under the MIT license:                                                                                     // 8
 * http://www.opensource.org/licenses/MIT                                                                              // 9
 */                                                                                                                    // 10
                                                                                                                       // 11
/* jshint nomen:false */                                                                                               // 12
/* global define, require, window, document, location, Blob, FormData */                                               // 13
                                                                                                                       // 14
(function (factory) {                                                                                                  // 15
    'use strict';                                                                                                      // 16
    if (typeof define === 'function' && define.amd) {                                                                  // 17
        // Register as an anonymous AMD module:                                                                        // 18
        define([                                                                                                       // 19
            'jquery',                                                                                                  // 20
            'jquery.ui.widget'                                                                                         // 21
        ], factory);                                                                                                   // 22
    } else if (typeof exports === 'object') {                                                                          // 23
        // Node/CommonJS:                                                                                              // 24
        factory(                                                                                                       // 25
            require('jquery'),                                                                                         // 26
            require('./vendor/jquery.ui.widget')                                                                       // 27
        );                                                                                                             // 28
    } else {                                                                                                           // 29
        // Browser globals:                                                                                            // 30
        factory(window.jQuery);                                                                                        // 31
    }                                                                                                                  // 32
}(function ($) {                                                                                                       // 33
    'use strict';                                                                                                      // 34
                                                                                                                       // 35
    // Detect file input support, based on                                                                             // 36
    // http://viljamis.com/blog/2012/file-upload-support-on-mobile/                                                    // 37
    $.support.fileInput = !(new RegExp(                                                                                // 38
        // Handle devices which give false positives for the feature detection:                                        // 39
        '(Android (1\\.[0156]|2\\.[01]))' +                                                                            // 40
            '|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' +                                             // 41
            '|(w(eb)?OSBrowser)|(webOS)' +                                                                             // 42
            '|(Kindle/(1\\.0|2\\.[05]|3\\.0))'                                                                         // 43
    ).test(window.navigator.userAgent) ||                                                                              // 44
        // Feature detection for all other devices:                                                                    // 45
        $('<input type="file">').prop('disabled'));                                                                    // 46
                                                                                                                       // 47
    // The FileReader API is not actually used, but works as feature detection,                                        // 48
    // as some Safari versions (5?) support XHR file uploads via the FormData API,                                     // 49
    // but not non-multipart XHR file uploads.                                                                         // 50
    // window.XMLHttpRequestUpload is not available on IE10, so we check for                                           // 51
    // window.ProgressEvent instead to detect XHR2 file upload capability:                                             // 52
    $.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);                                           // 53
    $.support.xhrFormDataFileUpload = !!window.FormData;                                                               // 54
                                                                                                                       // 55
    // Detect support for Blob slicing (required for chunked uploads):                                                 // 56
    $.support.blobSlice = window.Blob && (Blob.prototype.slice ||                                                      // 57
        Blob.prototype.webkitSlice || Blob.prototype.mozSlice);                                                        // 58
                                                                                                                       // 59
    // Helper function to create drag handlers for dragover/dragenter/dragleave:                                       // 60
    function getDragHandler(type) {                                                                                    // 61
        var isDragOver = type === 'dragover';                                                                          // 62
        return function (e) {                                                                                          // 63
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;                                          // 64
            var dataTransfer = e.dataTransfer;                                                                         // 65
            if (dataTransfer && $.inArray('Files', dataTransfer.types) !== -1 &&                                       // 66
                    this._trigger(                                                                                     // 67
                        type,                                                                                          // 68
                        $.Event(type, {delegatedEvent: e})                                                             // 69
                    ) !== false) {                                                                                     // 70
                e.preventDefault();                                                                                    // 71
                if (isDragOver) {                                                                                      // 72
                    dataTransfer.dropEffect = 'copy';                                                                  // 73
                }                                                                                                      // 74
            }                                                                                                          // 75
        };                                                                                                             // 76
    }                                                                                                                  // 77
                                                                                                                       // 78
    // The fileupload widget listens for change events on file input fields defined                                    // 79
    // via fileInput setting and paste or drop events of the given dropZone.                                           // 80
    // In addition to the default jQuery Widget methods, the fileupload widget                                         // 81
    // exposes the "add" and "send" methods, to add or directly send files using                                       // 82
    // the fileupload API.                                                                                             // 83
    // By default, files added via file input selection, paste, drag & drop or                                         // 84
    // "add" method are uploaded immediately, but it is possible to override                                           // 85
    // the "add" callback option to queue file uploads.                                                                // 86
    $.widget('blueimp.fileupload', {                                                                                   // 87
                                                                                                                       // 88
        options: {                                                                                                     // 89
            // The drop target element(s), by the default the complete document.                                       // 90
            // Set to null to disable drag & drop support:                                                             // 91
            dropZone: $(document),                                                                                     // 92
            // The paste target element(s), by the default undefined.                                                  // 93
            // Set to a DOM node or jQuery object to enable file pasting:                                              // 94
            pasteZone: undefined,                                                                                      // 95
            // The file input field(s), that are listened to for change events.                                        // 96
            // If undefined, it is set to the file input fields inside                                                 // 97
            // of the widget element on plugin initialization.                                                         // 98
            // Set to null to disable the change listener.                                                             // 99
            fileInput: undefined,                                                                                      // 100
            // By default, the file input field is replaced with a clone after                                         // 101
            // each input field change event. This is required for iframe transport                                    // 102
            // queues and allows change events to be fired for the same file                                           // 103
            // selection, but can be disabled by setting the following option to false:                                // 104
            replaceFileInput: true,                                                                                    // 105
            // The parameter name for the file form data (the request argument name).                                  // 106
            // If undefined or empty, the name property of the file input field is                                     // 107
            // used, or "files[]" if the file input name property is also empty,                                       // 108
            // can be a string or an array of strings:                                                                 // 109
            paramName: undefined,                                                                                      // 110
            // By default, each file of a selection is uploaded using an individual                                    // 111
            // request for XHR type uploads. Set to false to upload file                                               // 112
            // selections in one request each:                                                                         // 113
            singleFileUploads: true,                                                                                   // 114
            // To limit the number of files uploaded with one XHR request,                                             // 115
            // set the following option to an integer greater than 0:                                                  // 116
            limitMultiFileUploads: undefined,                                                                          // 117
            // The following option limits the number of files uploaded with one                                       // 118
            // XHR request to keep the request size under or equal to the defined                                      // 119
            // limit in bytes:                                                                                         // 120
            limitMultiFileUploadSize: undefined,                                                                       // 121
            // Multipart file uploads add a number of bytes to each uploaded file,                                     // 122
            // therefore the following option adds an overhead for each file used                                      // 123
            // in the limitMultiFileUploadSize configuration:                                                          // 124
            limitMultiFileUploadSizeOverhead: 512,                                                                     // 125
            // Set the following option to true to issue all file upload requests                                      // 126
            // in a sequential order:                                                                                  // 127
            sequentialUploads: false,                                                                                  // 128
            // To limit the number of concurrent uploads,                                                              // 129
            // set the following option to an integer greater than 0:                                                  // 130
            limitConcurrentUploads: undefined,                                                                         // 131
            // Set the following option to true to force iframe transport uploads:                                     // 132
            forceIframeTransport: false,                                                                               // 133
            // Set the following option to the location of a redirect url on the                                       // 134
            // origin server, for cross-domain iframe transport uploads:                                               // 135
            redirect: undefined,                                                                                       // 136
            // The parameter name for the redirect url, sent as part of the form                                       // 137
            // data and set to 'redirect' if this option is empty:                                                     // 138
            redirectParamName: undefined,                                                                              // 139
            // Set the following option to the location of a postMessage window,                                       // 140
            // to enable postMessage transport uploads:                                                                // 141
            postMessage: undefined,                                                                                    // 142
            // By default, XHR file uploads are sent as multipart/form-data.                                           // 143
            // The iframe transport is always using multipart/form-data.                                               // 144
            // Set to false to enable non-multipart XHR uploads:                                                       // 145
            multipart: true,                                                                                           // 146
            // To upload large files in smaller chunks, set the following option                                       // 147
            // to a preferred maximum chunk size. If set to 0, null or undefined,                                      // 148
            // or the browser does not support the required Blob API, files will                                       // 149
            // be uploaded as a whole.                                                                                 // 150
            maxChunkSize: undefined,                                                                                   // 151
            // When a non-multipart upload or a chunked multipart upload has been                                      // 152
            // aborted, this option can be used to resume the upload by setting                                        // 153
            // it to the size of the already uploaded bytes. This option is most                                       // 154
            // useful when modifying the options object inside of the "add" or                                         // 155
            // "send" callbacks, as the options are cloned for each file upload.                                       // 156
            uploadedBytes: undefined,                                                                                  // 157
            // By default, failed (abort or error) file uploads are removed from the                                   // 158
            // global progress calculation. Set the following option to false to                                       // 159
            // prevent recalculating the global progress data:                                                         // 160
            recalculateProgress: true,                                                                                 // 161
            // Interval in milliseconds to calculate and trigger progress events:                                      // 162
            progressInterval: 100,                                                                                     // 163
            // Interval in milliseconds to calculate progress bitrate:                                                 // 164
            bitrateInterval: 500,                                                                                      // 165
            // By default, uploads are started automatically when adding files:                                        // 166
            autoUpload: true,                                                                                          // 167
                                                                                                                       // 168
            // Error and info messages:                                                                                // 169
            messages: {                                                                                                // 170
                uploadedBytes: 'Uploaded bytes exceed file size'                                                       // 171
            },                                                                                                         // 172
                                                                                                                       // 173
            // Translation function, gets the message key to be translated                                             // 174
            // and an object with context specific data as arguments:                                                  // 175
            i18n: function (message, context) {                                                                        // 176
                message = this.messages[message] || message.toString();                                                // 177
                if (context) {                                                                                         // 178
                    $.each(context, function (key, value) {                                                            // 179
                        message = message.replace('{' + key + '}', value);                                             // 180
                    });                                                                                                // 181
                }                                                                                                      // 182
                return message;                                                                                        // 183
            },                                                                                                         // 184
                                                                                                                       // 185
            // Additional form data to be sent along with the file uploads can be set                                  // 186
            // using this option, which accepts an array of objects with name and                                      // 187
            // value properties, a function returning such an array, a FormData                                        // 188
            // object (for XHR file uploads), or a simple object.                                                      // 189
            // The form of the first fileInput is given as parameter to the function:                                  // 190
            formData: function (form) {                                                                                // 191
                return form.serializeArray();                                                                          // 192
            },                                                                                                         // 193
                                                                                                                       // 194
            // The add callback is invoked as soon as files are added to the fileupload                                // 195
            // widget (via file input selection, drag & drop, paste or add API call).                                  // 196
            // If the singleFileUploads option is enabled, this callback will be                                       // 197
            // called once for each file in the selection for XHR file uploads, else                                   // 198
            // once for each file selection.                                                                           // 199
            //                                                                                                         // 200
            // The upload starts when the submit method is invoked on the data parameter.                              // 201
            // The data object contains a files property holding the added files                                       // 202
            // and allows you to override plugin options as well as define ajax settings.                              // 203
            //                                                                                                         // 204
            // Listeners for this callback can also be bound the following way:                                        // 205
            // .bind('fileuploadadd', func);                                                                           // 206
            //                                                                                                         // 207
            // data.submit() returns a Promise object and allows to attach additional                                  // 208
            // handlers using jQuery's Deferred callbacks:                                                             // 209
            // data.submit().done(func).fail(func).always(func);                                                       // 210
            add: function (e, data) {                                                                                  // 211
                if (e.isDefaultPrevented()) {                                                                          // 212
                    return false;                                                                                      // 213
                }                                                                                                      // 214
                if (data.autoUpload || (data.autoUpload !== false &&                                                   // 215
                        $(this).fileupload('option', 'autoUpload'))) {                                                 // 216
                    data.process().done(function () {                                                                  // 217
                        data.submit();                                                                                 // 218
                    });                                                                                                // 219
                }                                                                                                      // 220
            },                                                                                                         // 221
                                                                                                                       // 222
            // Other callbacks:                                                                                        // 223
                                                                                                                       // 224
            // Callback for the submit event of each file upload:                                                      // 225
            // submit: function (e, data) {}, // .bind('fileuploadsubmit', func);                                      // 226
                                                                                                                       // 227
            // Callback for the start of each file upload request:                                                     // 228
            // send: function (e, data) {}, // .bind('fileuploadsend', func);                                          // 229
                                                                                                                       // 230
            // Callback for successful uploads:                                                                        // 231
            // done: function (e, data) {}, // .bind('fileuploaddone', func);                                          // 232
                                                                                                                       // 233
            // Callback for failed (abort or error) uploads:                                                           // 234
            // fail: function (e, data) {}, // .bind('fileuploadfail', func);                                          // 235
                                                                                                                       // 236
            // Callback for completed (success, abort or error) requests:                                              // 237
            // always: function (e, data) {}, // .bind('fileuploadalways', func);                                      // 238
                                                                                                                       // 239
            // Callback for upload progress events:                                                                    // 240
            // progress: function (e, data) {}, // .bind('fileuploadprogress', func);                                  // 241
                                                                                                                       // 242
            // Callback for global upload progress events:                                                             // 243
            // progressall: function (e, data) {}, // .bind('fileuploadprogressall', func);                            // 244
                                                                                                                       // 245
            // Callback for uploads start, equivalent to the global ajaxStart event:                                   // 246
            // start: function (e) {}, // .bind('fileuploadstart', func);                                              // 247
                                                                                                                       // 248
            // Callback for uploads stop, equivalent to the global ajaxStop event:                                     // 249
            // stop: function (e) {}, // .bind('fileuploadstop', func);                                                // 250
                                                                                                                       // 251
            // Callback for change events of the fileInput(s):                                                         // 252
            // change: function (e, data) {}, // .bind('fileuploadchange', func);                                      // 253
                                                                                                                       // 254
            // Callback for paste events to the pasteZone(s):                                                          // 255
            // paste: function (e, data) {}, // .bind('fileuploadpaste', func);                                        // 256
                                                                                                                       // 257
            // Callback for drop events of the dropZone(s):                                                            // 258
            // drop: function (e, data) {}, // .bind('fileuploaddrop', func);                                          // 259
                                                                                                                       // 260
            // Callback for dragover events of the dropZone(s):                                                        // 261
            // dragover: function (e) {}, // .bind('fileuploaddragover', func);                                        // 262
                                                                                                                       // 263
            // Callback for the start of each chunk upload request:                                                    // 264
            // chunksend: function (e, data) {}, // .bind('fileuploadchunksend', func);                                // 265
                                                                                                                       // 266
            // Callback for successful chunk uploads:                                                                  // 267
            // chunkdone: function (e, data) {}, // .bind('fileuploadchunkdone', func);                                // 268
                                                                                                                       // 269
            // Callback for failed (abort or error) chunk uploads:                                                     // 270
            // chunkfail: function (e, data) {}, // .bind('fileuploadchunkfail', func);                                // 271
                                                                                                                       // 272
            // Callback for completed (success, abort or error) chunk upload requests:                                 // 273
            // chunkalways: function (e, data) {}, // .bind('fileuploadchunkalways', func);                            // 274
                                                                                                                       // 275
            // The plugin options are used as settings object for the ajax calls.                                      // 276
            // The following are jQuery ajax settings required for the file uploads:                                   // 277
            processData: false,                                                                                        // 278
            contentType: false,                                                                                        // 279
            cache: false                                                                                               // 280
        },                                                                                                             // 281
                                                                                                                       // 282
        // A list of options that require reinitializing event listeners and/or                                        // 283
        // special initialization code:                                                                                // 284
        _specialOptions: [                                                                                             // 285
            'fileInput',                                                                                               // 286
            'dropZone',                                                                                                // 287
            'pasteZone',                                                                                               // 288
            'multipart',                                                                                               // 289
            'forceIframeTransport'                                                                                     // 290
        ],                                                                                                             // 291
                                                                                                                       // 292
        _blobSlice: $.support.blobSlice && function () {                                                               // 293
            var slice = this.slice || this.webkitSlice || this.mozSlice;                                               // 294
            return slice.apply(this, arguments);                                                                       // 295
        },                                                                                                             // 296
                                                                                                                       // 297
        _BitrateTimer: function () {                                                                                   // 298
            this.timestamp = ((Date.now) ? Date.now() : (new Date()).getTime());                                       // 299
            this.loaded = 0;                                                                                           // 300
            this.bitrate = 0;                                                                                          // 301
            this.getBitrate = function (now, loaded, interval) {                                                       // 302
                var timeDiff = now - this.timestamp;                                                                   // 303
                if (!this.bitrate || !interval || timeDiff > interval) {                                               // 304
                    this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;                                     // 305
                    this.loaded = loaded;                                                                              // 306
                    this.timestamp = now;                                                                              // 307
                }                                                                                                      // 308
                return this.bitrate;                                                                                   // 309
            };                                                                                                         // 310
        },                                                                                                             // 311
                                                                                                                       // 312
        _isXHRUpload: function (options) {                                                                             // 313
            return !options.forceIframeTransport &&                                                                    // 314
                ((!options.multipart && $.support.xhrFileUpload) ||                                                    // 315
                $.support.xhrFormDataFileUpload);                                                                      // 316
        },                                                                                                             // 317
                                                                                                                       // 318
        _getFormData: function (options) {                                                                             // 319
            var formData;                                                                                              // 320
            if ($.type(options.formData) === 'function') {                                                             // 321
                return options.formData(options.form);                                                                 // 322
            }                                                                                                          // 323
            if ($.isArray(options.formData)) {                                                                         // 324
                return options.formData;                                                                               // 325
            }                                                                                                          // 326
            if ($.type(options.formData) === 'object') {                                                               // 327
                formData = [];                                                                                         // 328
                $.each(options.formData, function (name, value) {                                                      // 329
                    formData.push({name: name, value: value});                                                         // 330
                });                                                                                                    // 331
                return formData;                                                                                       // 332
            }                                                                                                          // 333
            return [];                                                                                                 // 334
        },                                                                                                             // 335
                                                                                                                       // 336
        _getTotal: function (files) {                                                                                  // 337
            var total = 0;                                                                                             // 338
            $.each(files, function (index, file) {                                                                     // 339
                total += file.size || 1;                                                                               // 340
            });                                                                                                        // 341
            return total;                                                                                              // 342
        },                                                                                                             // 343
                                                                                                                       // 344
        _initProgressObject: function (obj) {                                                                          // 345
            var progress = {                                                                                           // 346
                loaded: 0,                                                                                             // 347
                total: 0,                                                                                              // 348
                bitrate: 0                                                                                             // 349
            };                                                                                                         // 350
            if (obj._progress) {                                                                                       // 351
                $.extend(obj._progress, progress);                                                                     // 352
            } else {                                                                                                   // 353
                obj._progress = progress;                                                                              // 354
            }                                                                                                          // 355
        },                                                                                                             // 356
                                                                                                                       // 357
        _initResponseObject: function (obj) {                                                                          // 358
            var prop;                                                                                                  // 359
            if (obj._response) {                                                                                       // 360
                for (prop in obj._response) {                                                                          // 361
                    if (obj._response.hasOwnProperty(prop)) {                                                          // 362
                        delete obj._response[prop];                                                                    // 363
                    }                                                                                                  // 364
                }                                                                                                      // 365
            } else {                                                                                                   // 366
                obj._response = {};                                                                                    // 367
            }                                                                                                          // 368
        },                                                                                                             // 369
                                                                                                                       // 370
        _onProgress: function (e, data) {                                                                              // 371
            if (e.lengthComputable) {                                                                                  // 372
                var now = ((Date.now) ? Date.now() : (new Date()).getTime()),                                          // 373
                    loaded;                                                                                            // 374
                if (data._time && data.progressInterval &&                                                             // 375
                        (now - data._time < data.progressInterval) &&                                                  // 376
                        e.loaded !== e.total) {                                                                        // 377
                    return;                                                                                            // 378
                }                                                                                                      // 379
                data._time = now;                                                                                      // 380
                loaded = Math.floor(                                                                                   // 381
                    e.loaded / e.total * (data.chunkSize || data._progress.total)                                      // 382
                ) + (data.uploadedBytes || 0);                                                                         // 383
                // Add the difference from the previously loaded state                                                 // 384
                // to the global loaded counter:                                                                       // 385
                this._progress.loaded += (loaded - data._progress.loaded);                                             // 386
                this._progress.bitrate = this._bitrateTimer.getBitrate(                                                // 387
                    now,                                                                                               // 388
                    this._progress.loaded,                                                                             // 389
                    data.bitrateInterval                                                                               // 390
                );                                                                                                     // 391
                data._progress.loaded = data.loaded = loaded;                                                          // 392
                data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(                                 // 393
                    now,                                                                                               // 394
                    loaded,                                                                                            // 395
                    data.bitrateInterval                                                                               // 396
                );                                                                                                     // 397
                // Trigger a custom progress event with a total data property set                                      // 398
                // to the file size(s) of the current upload and a loaded data                                         // 399
                // property calculated accordingly:                                                                    // 400
                this._trigger(                                                                                         // 401
                    'progress',                                                                                        // 402
                    $.Event('progress', {delegatedEvent: e}),                                                          // 403
                    data                                                                                               // 404
                );                                                                                                     // 405
                // Trigger a global progress event for all current file uploads,                                       // 406
                // including ajax calls queued for sequential file uploads:                                            // 407
                this._trigger(                                                                                         // 408
                    'progressall',                                                                                     // 409
                    $.Event('progressall', {delegatedEvent: e}),                                                       // 410
                    this._progress                                                                                     // 411
                );                                                                                                     // 412
            }                                                                                                          // 413
        },                                                                                                             // 414
                                                                                                                       // 415
        _initProgressListener: function (options) {                                                                    // 416
            var that = this,                                                                                           // 417
                xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();                                              // 418
            // Accesss to the native XHR object is required to add event listeners                                     // 419
            // for the upload progress event:                                                                          // 420
            if (xhr.upload) {                                                                                          // 421
                $(xhr.upload).bind('progress', function (e) {                                                          // 422
                    var oe = e.originalEvent;                                                                          // 423
                    // Make sure the progress event properties get copied over:                                        // 424
                    e.lengthComputable = oe.lengthComputable;                                                          // 425
                    e.loaded = oe.loaded;                                                                              // 426
                    e.total = oe.total;                                                                                // 427
                    that._onProgress(e, options);                                                                      // 428
                });                                                                                                    // 429
                options.xhr = function () {                                                                            // 430
                    return xhr;                                                                                        // 431
                };                                                                                                     // 432
            }                                                                                                          // 433
        },                                                                                                             // 434
                                                                                                                       // 435
        _isInstanceOf: function (type, obj) {                                                                          // 436
            // Cross-frame instanceof check                                                                            // 437
            return Object.prototype.toString.call(obj) === '[object ' + type + ']';                                    // 438
        },                                                                                                             // 439
                                                                                                                       // 440
        _initXHRData: function (options) {                                                                             // 441
            var that = this,                                                                                           // 442
                formData,                                                                                              // 443
                file = options.files[0],                                                                               // 444
                // Ignore non-multipart setting if not supported:                                                      // 445
                multipart = options.multipart || !$.support.xhrFileUpload,                                             // 446
                paramName = $.type(options.paramName) === 'array' ?                                                    // 447
                    options.paramName[0] : options.paramName;                                                          // 448
            options.headers = $.extend({}, options.headers);                                                           // 449
            if (options.contentRange) {                                                                                // 450
                options.headers['Content-Range'] = options.contentRange;                                               // 451
            }                                                                                                          // 452
            if (!multipart || options.blob || !this._isInstanceOf('File', file)) {                                     // 453
                options.headers['Content-Disposition'] = 'attachment; filename="' +                                    // 454
                    encodeURI(file.name) + '"';                                                                        // 455
            }                                                                                                          // 456
            if (!multipart) {                                                                                          // 457
                options.contentType = file.type || 'application/octet-stream';                                         // 458
                options.data = options.blob || file;                                                                   // 459
            } else if ($.support.xhrFormDataFileUpload) {                                                              // 460
                if (options.postMessage) {                                                                             // 461
                    // window.postMessage does not allow sending FormData                                              // 462
                    // objects, so we just add the File/Blob objects to                                                // 463
                    // the formData array and let the postMessage window                                               // 464
                    // create the FormData object out of this array:                                                   // 465
                    formData = this._getFormData(options);                                                             // 466
                    if (options.blob) {                                                                                // 467
                        formData.push({                                                                                // 468
                            name: paramName,                                                                           // 469
                            value: options.blob                                                                        // 470
                        });                                                                                            // 471
                    } else {                                                                                           // 472
                        $.each(options.files, function (index, file) {                                                 // 473
                            formData.push({                                                                            // 474
                                name: ($.type(options.paramName) === 'array' &&                                        // 475
                                    options.paramName[index]) || paramName,                                            // 476
                                value: file                                                                            // 477
                            });                                                                                        // 478
                        });                                                                                            // 479
                    }                                                                                                  // 480
                } else {                                                                                               // 481
                    if (that._isInstanceOf('FormData', options.formData)) {                                            // 482
                        formData = options.formData;                                                                   // 483
                    } else {                                                                                           // 484
                        formData = new FormData();                                                                     // 485
                        $.each(this._getFormData(options), function (index, field) {                                   // 486
                            formData.append(field.name, field.value);                                                  // 487
                        });                                                                                            // 488
                    }                                                                                                  // 489
                    if (options.blob) {                                                                                // 490
                        formData.append(paramName, options.blob, file.name);                                           // 491
                    } else {                                                                                           // 492
                        $.each(options.files, function (index, file) {                                                 // 493
                            // This check allows the tests to run with                                                 // 494
                            // dummy objects:                                                                          // 495
                            if (that._isInstanceOf('File', file) ||                                                    // 496
                                    that._isInstanceOf('Blob', file)) {                                                // 497
                                formData.append(                                                                       // 498
                                    ($.type(options.paramName) === 'array' &&                                          // 499
                                        options.paramName[index]) || paramName,                                        // 500
                                    file,                                                                              // 501
                                    file.uploadName || file.name                                                       // 502
                                );                                                                                     // 503
                            }                                                                                          // 504
                        });                                                                                            // 505
                    }                                                                                                  // 506
                }                                                                                                      // 507
                options.data = formData;                                                                               // 508
            }                                                                                                          // 509
            // Blob reference is not needed anymore, free memory:                                                      // 510
            options.blob = null;                                                                                       // 511
        },                                                                                                             // 512
                                                                                                                       // 513
        _initIframeSettings: function (options) {                                                                      // 514
            var targetHost = $('<a></a>').prop('href', options.url).prop('host');                                      // 515
            // Setting the dataType to iframe enables the iframe transport:                                            // 516
            options.dataType = 'iframe ' + (options.dataType || '');                                                   // 517
            // The iframe transport accepts a serialized array as form data:                                           // 518
            options.formData = this._getFormData(options);                                                             // 519
            // Add redirect url to form data on cross-domain uploads:                                                  // 520
            if (options.redirect && targetHost && targetHost !== location.host) {                                      // 521
                options.formData.push({                                                                                // 522
                    name: options.redirectParamName || 'redirect',                                                     // 523
                    value: options.redirect                                                                            // 524
                });                                                                                                    // 525
            }                                                                                                          // 526
        },                                                                                                             // 527
                                                                                                                       // 528
        _initDataSettings: function (options) {                                                                        // 529
            if (this._isXHRUpload(options)) {                                                                          // 530
                if (!this._chunkedUpload(options, true)) {                                                             // 531
                    if (!options.data) {                                                                               // 532
                        this._initXHRData(options);                                                                    // 533
                    }                                                                                                  // 534
                    this._initProgressListener(options);                                                               // 535
                }                                                                                                      // 536
                if (options.postMessage) {                                                                             // 537
                    // Setting the dataType to postmessage enables the                                                 // 538
                    // postMessage transport:                                                                          // 539
                    options.dataType = 'postmessage ' + (options.dataType || '');                                      // 540
                }                                                                                                      // 541
            } else {                                                                                                   // 542
                this._initIframeSettings(options);                                                                     // 543
            }                                                                                                          // 544
        },                                                                                                             // 545
                                                                                                                       // 546
        _getParamName: function (options) {                                                                            // 547
            var fileInput = $(options.fileInput),                                                                      // 548
                paramName = options.paramName;                                                                         // 549
            if (!paramName) {                                                                                          // 550
                paramName = [];                                                                                        // 551
                fileInput.each(function () {                                                                           // 552
                    var input = $(this),                                                                               // 553
                        name = input.prop('name') || 'files[]',                                                        // 554
                        i = (input.prop('files') || [1]).length;                                                       // 555
                    while (i) {                                                                                        // 556
                        paramName.push(name);                                                                          // 557
                        i -= 1;                                                                                        // 558
                    }                                                                                                  // 559
                });                                                                                                    // 560
                if (!paramName.length) {                                                                               // 561
                    paramName = [fileInput.prop('name') || 'files[]'];                                                 // 562
                }                                                                                                      // 563
            } else if (!$.isArray(paramName)) {                                                                        // 564
                paramName = [paramName];                                                                               // 565
            }                                                                                                          // 566
            return paramName;                                                                                          // 567
        },                                                                                                             // 568
                                                                                                                       // 569
        _initFormSettings: function (options) {                                                                        // 570
            // Retrieve missing options from the input field and the                                                   // 571
            // associated form, if available:                                                                          // 572
            if (!options.form || !options.form.length) {                                                               // 573
                options.form = $(options.fileInput.prop('form'));                                                      // 574
                // If the given file input doesn't have an associated form,                                            // 575
                // use the default widget file input's form:                                                           // 576
                if (!options.form.length) {                                                                            // 577
                    options.form = $(this.options.fileInput.prop('form'));                                             // 578
                }                                                                                                      // 579
            }                                                                                                          // 580
            options.paramName = this._getParamName(options);                                                           // 581
            if (!options.url) {                                                                                        // 582
                options.url = options.form.prop('action') || location.href;                                            // 583
            }                                                                                                          // 584
            // The HTTP request method must be "POST" or "PUT":                                                        // 585
            options.type = (options.type ||                                                                            // 586
                ($.type(options.form.prop('method')) === 'string' &&                                                   // 587
                    options.form.prop('method')) || ''                                                                 // 588
                ).toUpperCase();                                                                                       // 589
            if (options.type !== 'POST' && options.type !== 'PUT' &&                                                   // 590
                    options.type !== 'PATCH') {                                                                        // 591
                options.type = 'POST';                                                                                 // 592
            }                                                                                                          // 593
            if (!options.formAcceptCharset) {                                                                          // 594
                options.formAcceptCharset = options.form.attr('accept-charset');                                       // 595
            }                                                                                                          // 596
        },                                                                                                             // 597
                                                                                                                       // 598
        _getAJAXSettings: function (data) {                                                                            // 599
            var options = $.extend({}, this.options, data);                                                            // 600
            this._initFormSettings(options);                                                                           // 601
            this._initDataSettings(options);                                                                           // 602
            return options;                                                                                            // 603
        },                                                                                                             // 604
                                                                                                                       // 605
        // jQuery 1.6 doesn't provide .state(),                                                                        // 606
        // while jQuery 1.8+ removed .isRejected() and .isResolved():                                                  // 607
        _getDeferredState: function (deferred) {                                                                       // 608
            if (deferred.state) {                                                                                      // 609
                return deferred.state();                                                                               // 610
            }                                                                                                          // 611
            if (deferred.isResolved()) {                                                                               // 612
                return 'resolved';                                                                                     // 613
            }                                                                                                          // 614
            if (deferred.isRejected()) {                                                                               // 615
                return 'rejected';                                                                                     // 616
            }                                                                                                          // 617
            return 'pending';                                                                                          // 618
        },                                                                                                             // 619
                                                                                                                       // 620
        // Maps jqXHR callbacks to the equivalent                                                                      // 621
        // methods of the given Promise object:                                                                        // 622
        _enhancePromise: function (promise) {                                                                          // 623
            promise.success = promise.done;                                                                            // 624
            promise.error = promise.fail;                                                                              // 625
            promise.complete = promise.always;                                                                         // 626
            return promise;                                                                                            // 627
        },                                                                                                             // 628
                                                                                                                       // 629
        // Creates and returns a Promise object enhanced with                                                          // 630
        // the jqXHR methods abort, success, error and complete:                                                       // 631
        _getXHRPromise: function (resolveOrReject, context, args) {                                                    // 632
            var dfd = $.Deferred(),                                                                                    // 633
                promise = dfd.promise();                                                                               // 634
            context = context || this.options.context || promise;                                                      // 635
            if (resolveOrReject === true) {                                                                            // 636
                dfd.resolveWith(context, args);                                                                        // 637
            } else if (resolveOrReject === false) {                                                                    // 638
                dfd.rejectWith(context, args);                                                                         // 639
            }                                                                                                          // 640
            promise.abort = dfd.promise;                                                                               // 641
            return this._enhancePromise(promise);                                                                      // 642
        },                                                                                                             // 643
                                                                                                                       // 644
        // Adds convenience methods to the data callback argument:                                                     // 645
        _addConvenienceMethods: function (e, data) {                                                                   // 646
            var that = this,                                                                                           // 647
                getPromise = function (args) {                                                                         // 648
                    return $.Deferred().resolveWith(that, args).promise();                                             // 649
                };                                                                                                     // 650
            data.process = function (resolveFunc, rejectFunc) {                                                        // 651
                if (resolveFunc || rejectFunc) {                                                                       // 652
                    data._processQueue = this._processQueue =                                                          // 653
                        (this._processQueue || getPromise([this])).pipe(                                               // 654
                            function () {                                                                              // 655
                                if (data.errorThrown) {                                                                // 656
                                    return $.Deferred()                                                                // 657
                                        .rejectWith(that, [data]).promise();                                           // 658
                                }                                                                                      // 659
                                return getPromise(arguments);                                                          // 660
                            }                                                                                          // 661
                        ).pipe(resolveFunc, rejectFunc);                                                               // 662
                }                                                                                                      // 663
                return this._processQueue || getPromise([this]);                                                       // 664
            };                                                                                                         // 665
            data.submit = function () {                                                                                // 666
                if (this.state() !== 'pending') {                                                                      // 667
                    data.jqXHR = this.jqXHR =                                                                          // 668
                        (that._trigger(                                                                                // 669
                            'submit',                                                                                  // 670
                            $.Event('submit', {delegatedEvent: e}),                                                    // 671
                            this                                                                                       // 672
                        ) !== false) && that._onSend(e, this);                                                         // 673
                }                                                                                                      // 674
                return this.jqXHR || that._getXHRPromise();                                                            // 675
            };                                                                                                         // 676
            data.abort = function () {                                                                                 // 677
                if (this.jqXHR) {                                                                                      // 678
                    return this.jqXHR.abort();                                                                         // 679
                }                                                                                                      // 680
                this.errorThrown = 'abort';                                                                            // 681
                that._trigger('fail', null, this);                                                                     // 682
                return that._getXHRPromise(false);                                                                     // 683
            };                                                                                                         // 684
            data.state = function () {                                                                                 // 685
                if (this.jqXHR) {                                                                                      // 686
                    return that._getDeferredState(this.jqXHR);                                                         // 687
                }                                                                                                      // 688
                if (this._processQueue) {                                                                              // 689
                    return that._getDeferredState(this._processQueue);                                                 // 690
                }                                                                                                      // 691
            };                                                                                                         // 692
            data.processing = function () {                                                                            // 693
                return !this.jqXHR && this._processQueue && that                                                       // 694
                    ._getDeferredState(this._processQueue) === 'pending';                                              // 695
            };                                                                                                         // 696
            data.progress = function () {                                                                              // 697
                return this._progress;                                                                                 // 698
            };                                                                                                         // 699
            data.response = function () {                                                                              // 700
                return this._response;                                                                                 // 701
            };                                                                                                         // 702
        },                                                                                                             // 703
                                                                                                                       // 704
        // Parses the Range header from the server response                                                            // 705
        // and returns the uploaded bytes:                                                                             // 706
        _getUploadedBytes: function (jqXHR) {                                                                          // 707
            var range = jqXHR.getResponseHeader('Range'),                                                              // 708
                parts = range && range.split('-'),                                                                     // 709
                upperBytesPos = parts && parts.length > 1 &&                                                           // 710
                    parseInt(parts[1], 10);                                                                            // 711
            return upperBytesPos && upperBytesPos + 1;                                                                 // 712
        },                                                                                                             // 713
                                                                                                                       // 714
        // Uploads a file in multiple, sequential requests                                                             // 715
        // by splitting the file up in multiple blob chunks.                                                           // 716
        // If the second parameter is true, only tests if the file                                                     // 717
        // should be uploaded in chunks, but does not invoke any                                                       // 718
        // upload requests:                                                                                            // 719
        _chunkedUpload: function (options, testOnly) {                                                                 // 720
            options.uploadedBytes = options.uploadedBytes || 0;                                                        // 721
            var that = this,                                                                                           // 722
                file = options.files[0],                                                                               // 723
                fs = file.size,                                                                                        // 724
                ub = options.uploadedBytes,                                                                            // 725
                mcs = options.maxChunkSize || fs,                                                                      // 726
                slice = this._blobSlice,                                                                               // 727
                dfd = $.Deferred(),                                                                                    // 728
                promise = dfd.promise(),                                                                               // 729
                jqXHR,                                                                                                 // 730
                upload;                                                                                                // 731
            if (!(this._isXHRUpload(options) && slice && (ub || mcs < fs)) ||                                          // 732
                    options.data) {                                                                                    // 733
                return false;                                                                                          // 734
            }                                                                                                          // 735
            if (testOnly) {                                                                                            // 736
                return true;                                                                                           // 737
            }                                                                                                          // 738
            if (ub >= fs) {                                                                                            // 739
                file.error = options.i18n('uploadedBytes');                                                            // 740
                return this._getXHRPromise(                                                                            // 741
                    false,                                                                                             // 742
                    options.context,                                                                                   // 743
                    [null, 'error', file.error]                                                                        // 744
                );                                                                                                     // 745
            }                                                                                                          // 746
            // The chunk upload method:                                                                                // 747
            upload = function () {                                                                                     // 748
                // Clone the options object for each chunk upload:                                                     // 749
                var o = $.extend({}, options),                                                                         // 750
                    currentLoaded = o._progress.loaded;                                                                // 751
                o.blob = slice.call(                                                                                   // 752
                    file,                                                                                              // 753
                    ub,                                                                                                // 754
                    ub + mcs,                                                                                          // 755
                    file.type                                                                                          // 756
                );                                                                                                     // 757
                // Store the current chunk size, as the blob itself                                                    // 758
                // will be dereferenced after data processing:                                                         // 759
                o.chunkSize = o.blob.size;                                                                             // 760
                // Expose the chunk bytes position range:                                                              // 761
                o.contentRange = 'bytes ' + ub + '-' +                                                                 // 762
                    (ub + o.chunkSize - 1) + '/' + fs;                                                                 // 763
                // Process the upload data (the blob and potential form data):                                         // 764
                that._initXHRData(o);                                                                                  // 765
                // Add progress listeners for this chunk upload:                                                       // 766
                that._initProgressListener(o);                                                                         // 767
                jqXHR = ((that._trigger('chunksend', null, o) !== false && $.ajax(o)) ||                               // 768
                        that._getXHRPromise(false, o.context))                                                         // 769
                    .done(function (result, textStatus, jqXHR) {                                                       // 770
                        ub = that._getUploadedBytes(jqXHR) ||                                                          // 771
                            (ub + o.chunkSize);                                                                        // 772
                        // Create a progress event if no final progress event                                          // 773
                        // with loaded equaling total has been triggered                                               // 774
                        // for this chunk:                                                                             // 775
                        if (currentLoaded + o.chunkSize - o._progress.loaded) {                                        // 776
                            that._onProgress($.Event('progress', {                                                     // 777
                                lengthComputable: true,                                                                // 778
                                loaded: ub - o.uploadedBytes,                                                          // 779
                                total: ub - o.uploadedBytes                                                            // 780
                            }), o);                                                                                    // 781
                        }                                                                                              // 782
                        options.uploadedBytes = o.uploadedBytes = ub;                                                  // 783
                        o.result = result;                                                                             // 784
                        o.textStatus = textStatus;                                                                     // 785
                        o.jqXHR = jqXHR;                                                                               // 786
                        that._trigger('chunkdone', null, o);                                                           // 787
                        that._trigger('chunkalways', null, o);                                                         // 788
                        if (ub < fs) {                                                                                 // 789
                            // File upload not yet complete,                                                           // 790
                            // continue with the next chunk:                                                           // 791
                            upload();                                                                                  // 792
                        } else {                                                                                       // 793
                            dfd.resolveWith(                                                                           // 794
                                o.context,                                                                             // 795
                                [result, textStatus, jqXHR]                                                            // 796
                            );                                                                                         // 797
                        }                                                                                              // 798
                    })                                                                                                 // 799
                    .fail(function (jqXHR, textStatus, errorThrown) {                                                  // 800
                        o.jqXHR = jqXHR;                                                                               // 801
                        o.textStatus = textStatus;                                                                     // 802
                        o.errorThrown = errorThrown;                                                                   // 803
                        that._trigger('chunkfail', null, o);                                                           // 804
                        that._trigger('chunkalways', null, o);                                                         // 805
                        dfd.rejectWith(                                                                                // 806
                            o.context,                                                                                 // 807
                            [jqXHR, textStatus, errorThrown]                                                           // 808
                        );                                                                                             // 809
                    });                                                                                                // 810
            };                                                                                                         // 811
            this._enhancePromise(promise);                                                                             // 812
            promise.abort = function () {                                                                              // 813
                return jqXHR.abort();                                                                                  // 814
            };                                                                                                         // 815
            upload();                                                                                                  // 816
            return promise;                                                                                            // 817
        },                                                                                                             // 818
                                                                                                                       // 819
        _beforeSend: function (e, data) {                                                                              // 820
            if (this._active === 0) {                                                                                  // 821
                // the start callback is triggered when an upload starts                                               // 822
                // and no other uploads are currently running,                                                         // 823
                // equivalent to the global ajaxStart event:                                                           // 824
                this._trigger('start');                                                                                // 825
                // Set timer for global bitrate progress calculation:                                                  // 826
                this._bitrateTimer = new this._BitrateTimer();                                                         // 827
                // Reset the global progress values:                                                                   // 828
                this._progress.loaded = this._progress.total = 0;                                                      // 829
                this._progress.bitrate = 0;                                                                            // 830
            }                                                                                                          // 831
            // Make sure the container objects for the .response() and                                                 // 832
            // .progress() methods on the data object are available                                                    // 833
            // and reset to their initial state:                                                                       // 834
            this._initResponseObject(data);                                                                            // 835
            this._initProgressObject(data);                                                                            // 836
            data._progress.loaded = data.loaded = data.uploadedBytes || 0;                                             // 837
            data._progress.total = data.total = this._getTotal(data.files) || 1;                                       // 838
            data._progress.bitrate = data.bitrate = 0;                                                                 // 839
            this._active += 1;                                                                                         // 840
            // Initialize the global progress values:                                                                  // 841
            this._progress.loaded += data.loaded;                                                                      // 842
            this._progress.total += data.total;                                                                        // 843
        },                                                                                                             // 844
                                                                                                                       // 845
        _onDone: function (result, textStatus, jqXHR, options) {                                                       // 846
            var total = options._progress.total,                                                                       // 847
                response = options._response;                                                                          // 848
            if (options._progress.loaded < total) {                                                                    // 849
                // Create a progress event if no final progress event                                                  // 850
                // with loaded equaling total has been triggered:                                                      // 851
                this._onProgress($.Event('progress', {                                                                 // 852
                    lengthComputable: true,                                                                            // 853
                    loaded: total,                                                                                     // 854
                    total: total                                                                                       // 855
                }), options);                                                                                          // 856
            }                                                                                                          // 857
            response.result = options.result = result;                                                                 // 858
            response.textStatus = options.textStatus = textStatus;                                                     // 859
            response.jqXHR = options.jqXHR = jqXHR;                                                                    // 860
            this._trigger('done', null, options);                                                                      // 861
        },                                                                                                             // 862
                                                                                                                       // 863
        _onFail: function (jqXHR, textStatus, errorThrown, options) {                                                  // 864
            var response = options._response;                                                                          // 865
            if (options.recalculateProgress) {                                                                         // 866
                // Remove the failed (error or abort) file upload from                                                 // 867
                // the global progress calculation:                                                                    // 868
                this._progress.loaded -= options._progress.loaded;                                                     // 869
                this._progress.total -= options._progress.total;                                                       // 870
            }                                                                                                          // 871
            response.jqXHR = options.jqXHR = jqXHR;                                                                    // 872
            response.textStatus = options.textStatus = textStatus;                                                     // 873
            response.errorThrown = options.errorThrown = errorThrown;                                                  // 874
            this._trigger('fail', null, options);                                                                      // 875
        },                                                                                                             // 876
                                                                                                                       // 877
        _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {                                       // 878
            // jqXHRorResult, textStatus and jqXHRorError are added to the                                             // 879
            // options object via done and fail callbacks                                                              // 880
            this._trigger('always', null, options);                                                                    // 881
        },                                                                                                             // 882
                                                                                                                       // 883
        _onSend: function (e, data) {                                                                                  // 884
            if (!data.submit) {                                                                                        // 885
                this._addConvenienceMethods(e, data);                                                                  // 886
            }                                                                                                          // 887
            var that = this,                                                                                           // 888
                jqXHR,                                                                                                 // 889
                aborted,                                                                                               // 890
                slot,                                                                                                  // 891
                pipe,                                                                                                  // 892
                options = that._getAJAXSettings(data),                                                                 // 893
                send = function () {                                                                                   // 894
                    that._sending += 1;                                                                                // 895
                    // Set timer for bitrate progress calculation:                                                     // 896
                    options._bitrateTimer = new that._BitrateTimer();                                                  // 897
                    jqXHR = jqXHR || (                                                                                 // 898
                        ((aborted || that._trigger(                                                                    // 899
                            'send',                                                                                    // 900
                            $.Event('send', {delegatedEvent: e}),                                                      // 901
                            options                                                                                    // 902
                        ) === false) &&                                                                                // 903
                        that._getXHRPromise(false, options.context, aborted)) ||                                       // 904
                        that._chunkedUpload(options) || $.ajax(options)                                                // 905
                    ).done(function (result, textStatus, jqXHR) {                                                      // 906
                        that._onDone(result, textStatus, jqXHR, options);                                              // 907
                    }).fail(function (jqXHR, textStatus, errorThrown) {                                                // 908
                        that._onFail(jqXHR, textStatus, errorThrown, options);                                         // 909
                    }).always(function (jqXHRorResult, textStatus, jqXHRorError) {                                     // 910
                        that._onAlways(                                                                                // 911
                            jqXHRorResult,                                                                             // 912
                            textStatus,                                                                                // 913
                            jqXHRorError,                                                                              // 914
                            options                                                                                    // 915
                        );                                                                                             // 916
                        that._sending -= 1;                                                                            // 917
                        that._active -= 1;                                                                             // 918
                        if (options.limitConcurrentUploads &&                                                          // 919
                                options.limitConcurrentUploads > that._sending) {                                      // 920
                            // Start the next queued upload,                                                           // 921
                            // that has not been aborted:                                                              // 922
                            var nextSlot = that._slots.shift();                                                        // 923
                            while (nextSlot) {                                                                         // 924
                                if (that._getDeferredState(nextSlot) === 'pending') {                                  // 925
                                    nextSlot.resolve();                                                                // 926
                                    break;                                                                             // 927
                                }                                                                                      // 928
                                nextSlot = that._slots.shift();                                                        // 929
                            }                                                                                          // 930
                        }                                                                                              // 931
                        if (that._active === 0) {                                                                      // 932
                            // The stop callback is triggered when all uploads have                                    // 933
                            // been completed, equivalent to the global ajaxStop event:                                // 934
                            that._trigger('stop');                                                                     // 935
                        }                                                                                              // 936
                    });                                                                                                // 937
                    return jqXHR;                                                                                      // 938
                };                                                                                                     // 939
            this._beforeSend(e, options);                                                                              // 940
            if (this.options.sequentialUploads ||                                                                      // 941
                    (this.options.limitConcurrentUploads &&                                                            // 942
                    this.options.limitConcurrentUploads <= this._sending)) {                                           // 943
                if (this.options.limitConcurrentUploads > 1) {                                                         // 944
                    slot = $.Deferred();                                                                               // 945
                    this._slots.push(slot);                                                                            // 946
                    pipe = slot.pipe(send);                                                                            // 947
                } else {                                                                                               // 948
                    this._sequence = this._sequence.pipe(send, send);                                                  // 949
                    pipe = this._sequence;                                                                             // 950
                }                                                                                                      // 951
                // Return the piped Promise object, enhanced with an abort method,                                     // 952
                // which is delegated to the jqXHR object of the current upload,                                       // 953
                // and jqXHR callbacks mapped to the equivalent Promise methods:                                       // 954
                pipe.abort = function () {                                                                             // 955
                    aborted = [undefined, 'abort', 'abort'];                                                           // 956
                    if (!jqXHR) {                                                                                      // 957
                        if (slot) {                                                                                    // 958
                            slot.rejectWith(options.context, aborted);                                                 // 959
                        }                                                                                              // 960
                        return send();                                                                                 // 961
                    }                                                                                                  // 962
                    return jqXHR.abort();                                                                              // 963
                };                                                                                                     // 964
                return this._enhancePromise(pipe);                                                                     // 965
            }                                                                                                          // 966
            return send();                                                                                             // 967
        },                                                                                                             // 968
                                                                                                                       // 969
        _onAdd: function (e, data) {                                                                                   // 970
            var that = this,                                                                                           // 971
                result = true,                                                                                         // 972
                options = $.extend({}, this.options, data),                                                            // 973
                files = data.files,                                                                                    // 974
                filesLength = files.length,                                                                            // 975
                limit = options.limitMultiFileUploads,                                                                 // 976
                limitSize = options.limitMultiFileUploadSize,                                                          // 977
                overhead = options.limitMultiFileUploadSizeOverhead,                                                   // 978
                batchSize = 0,                                                                                         // 979
                paramName = this._getParamName(options),                                                               // 980
                paramNameSet,                                                                                          // 981
                paramNameSlice,                                                                                        // 982
                fileSet,                                                                                               // 983
                i,                                                                                                     // 984
                j = 0;                                                                                                 // 985
            if (limitSize && (!filesLength || files[0].size === undefined)) {                                          // 986
                limitSize = undefined;                                                                                 // 987
            }                                                                                                          // 988
            if (!(options.singleFileUploads || limit || limitSize) ||                                                  // 989
                    !this._isXHRUpload(options)) {                                                                     // 990
                fileSet = [files];                                                                                     // 991
                paramNameSet = [paramName];                                                                            // 992
            } else if (!(options.singleFileUploads || limitSize) && limit) {                                           // 993
                fileSet = [];                                                                                          // 994
                paramNameSet = [];                                                                                     // 995
                for (i = 0; i < filesLength; i += limit) {                                                             // 996
                    fileSet.push(files.slice(i, i + limit));                                                           // 997
                    paramNameSlice = paramName.slice(i, i + limit);                                                    // 998
                    if (!paramNameSlice.length) {                                                                      // 999
                        paramNameSlice = paramName;                                                                    // 1000
                    }                                                                                                  // 1001
                    paramNameSet.push(paramNameSlice);                                                                 // 1002
                }                                                                                                      // 1003
            } else if (!options.singleFileUploads && limitSize) {                                                      // 1004
                fileSet = [];                                                                                          // 1005
                paramNameSet = [];                                                                                     // 1006
                for (i = 0; i < filesLength; i = i + 1) {                                                              // 1007
                    batchSize += files[i].size + overhead;                                                             // 1008
                    if (i + 1 === filesLength ||                                                                       // 1009
                            ((batchSize + files[i + 1].size + overhead) > limitSize) ||                                // 1010
                            (limit && i + 1 - j >= limit)) {                                                           // 1011
                        fileSet.push(files.slice(j, i + 1));                                                           // 1012
                        paramNameSlice = paramName.slice(j, i + 1);                                                    // 1013
                        if (!paramNameSlice.length) {                                                                  // 1014
                            paramNameSlice = paramName;                                                                // 1015
                        }                                                                                              // 1016
                        paramNameSet.push(paramNameSlice);                                                             // 1017
                        j = i + 1;                                                                                     // 1018
                        batchSize = 0;                                                                                 // 1019
                    }                                                                                                  // 1020
                }                                                                                                      // 1021
            } else {                                                                                                   // 1022
                paramNameSet = paramName;                                                                              // 1023
            }                                                                                                          // 1024
            data.originalFiles = files;                                                                                // 1025
            $.each(fileSet || files, function (index, element) {                                                       // 1026
                var newData = $.extend({}, data);                                                                      // 1027
                newData.files = fileSet ? element : [element];                                                         // 1028
                newData.paramName = paramNameSet[index];                                                               // 1029
                that._initResponseObject(newData);                                                                     // 1030
                that._initProgressObject(newData);                                                                     // 1031
                that._addConvenienceMethods(e, newData);                                                               // 1032
                result = that._trigger(                                                                                // 1033
                    'add',                                                                                             // 1034
                    $.Event('add', {delegatedEvent: e}),                                                               // 1035
                    newData                                                                                            // 1036
                );                                                                                                     // 1037
                return result;                                                                                         // 1038
            });                                                                                                        // 1039
            return result;                                                                                             // 1040
        },                                                                                                             // 1041
                                                                                                                       // 1042
        _replaceFileInput: function (data) {                                                                           // 1043
            var input = data.fileInput,                                                                                // 1044
                inputClone = input.clone(true);                                                                        // 1045
            // Add a reference for the new cloned file input to the data argument:                                     // 1046
            data.fileInputClone = inputClone;                                                                          // 1047
            $('<form></form>').append(inputClone)[0].reset();                                                          // 1048
            // Detaching allows to insert the fileInput on another form                                                // 1049
            // without loosing the file input value:                                                                   // 1050
            input.after(inputClone).detach();                                                                          // 1051
            // Avoid memory leaks with the detached file input:                                                        // 1052
            $.cleanData(input.unbind('remove'));                                                                       // 1053
            // Replace the original file input element in the fileInput                                                // 1054
            // elements set with the clone, which has been copied including                                            // 1055
            // event handlers:                                                                                         // 1056
            this.options.fileInput = this.options.fileInput.map(function (i, el) {                                     // 1057
                if (el === input[0]) {                                                                                 // 1058
                    return inputClone[0];                                                                              // 1059
                }                                                                                                      // 1060
                return el;                                                                                             // 1061
            });                                                                                                        // 1062
            // If the widget has been initialized on the file input itself,                                            // 1063
            // override this.element with the file input clone:                                                        // 1064
            if (input[0] === this.element[0]) {                                                                        // 1065
                this.element = inputClone;                                                                             // 1066
            }                                                                                                          // 1067
        },                                                                                                             // 1068
                                                                                                                       // 1069
        _handleFileTreeEntry: function (entry, path) {                                                                 // 1070
            var that = this,                                                                                           // 1071
                dfd = $.Deferred(),                                                                                    // 1072
                errorHandler = function (e) {                                                                          // 1073
                    if (e && !e.entry) {                                                                               // 1074
                        e.entry = entry;                                                                               // 1075
                    }                                                                                                  // 1076
                    // Since $.when returns immediately if one                                                         // 1077
                    // Deferred is rejected, we use resolve instead.                                                   // 1078
                    // This allows valid files and invalid items                                                       // 1079
                    // to be returned together in one set:                                                             // 1080
                    dfd.resolve([e]);                                                                                  // 1081
                },                                                                                                     // 1082
                successHandler = function (entries) {                                                                  // 1083
                    that._handleFileTreeEntries(                                                                       // 1084
                        entries,                                                                                       // 1085
                        path + entry.name + '/'                                                                        // 1086
                    ).done(function (files) {                                                                          // 1087
                        dfd.resolve(files);                                                                            // 1088
                    }).fail(errorHandler);                                                                             // 1089
                },                                                                                                     // 1090
                readEntries = function () {                                                                            // 1091
                    dirReader.readEntries(function (results) {                                                         // 1092
                        if (!results.length) {                                                                         // 1093
                            successHandler(entries);                                                                   // 1094
                        } else {                                                                                       // 1095
                            entries = entries.concat(results);                                                         // 1096
                            readEntries();                                                                             // 1097
                        }                                                                                              // 1098
                    }, errorHandler);                                                                                  // 1099
                },                                                                                                     // 1100
                dirReader, entries = [];                                                                               // 1101
            path = path || '';                                                                                         // 1102
            if (entry.isFile) {                                                                                        // 1103
                if (entry._file) {                                                                                     // 1104
                    // Workaround for Chrome bug #149735                                                               // 1105
                    entry._file.relativePath = path;                                                                   // 1106
                    dfd.resolve(entry._file);                                                                          // 1107
                } else {                                                                                               // 1108
                    entry.file(function (file) {                                                                       // 1109
                        file.relativePath = path;                                                                      // 1110
                        dfd.resolve(file);                                                                             // 1111
                    }, errorHandler);                                                                                  // 1112
                }                                                                                                      // 1113
            } else if (entry.isDirectory) {                                                                            // 1114
                dirReader = entry.createReader();                                                                      // 1115
                readEntries();                                                                                         // 1116
            } else {                                                                                                   // 1117
                // Return an empy list for file system items                                                           // 1118
                // other than files or directories:                                                                    // 1119
                dfd.resolve([]);                                                                                       // 1120
            }                                                                                                          // 1121
            return dfd.promise();                                                                                      // 1122
        },                                                                                                             // 1123
                                                                                                                       // 1124
        _handleFileTreeEntries: function (entries, path) {                                                             // 1125
            var that = this;                                                                                           // 1126
            return $.when.apply(                                                                                       // 1127
                $,                                                                                                     // 1128
                $.map(entries, function (entry) {                                                                      // 1129
                    return that._handleFileTreeEntry(entry, path);                                                     // 1130
                })                                                                                                     // 1131
            ).pipe(function () {                                                                                       // 1132
                return Array.prototype.concat.apply(                                                                   // 1133
                    [],                                                                                                // 1134
                    arguments                                                                                          // 1135
                );                                                                                                     // 1136
            });                                                                                                        // 1137
        },                                                                                                             // 1138
                                                                                                                       // 1139
        _getDroppedFiles: function (dataTransfer) {                                                                    // 1140
            dataTransfer = dataTransfer || {};                                                                         // 1141
            var items = dataTransfer.items;                                                                            // 1142
            if (items && items.length && (items[0].webkitGetAsEntry ||                                                 // 1143
                    items[0].getAsEntry)) {                                                                            // 1144
                return this._handleFileTreeEntries(                                                                    // 1145
                    $.map(items, function (item) {                                                                     // 1146
                        var entry;                                                                                     // 1147
                        if (item.webkitGetAsEntry) {                                                                   // 1148
                            entry = item.webkitGetAsEntry();                                                           // 1149
                            if (entry) {                                                                               // 1150
                                // Workaround for Chrome bug #149735:                                                  // 1151
                                entry._file = item.getAsFile();                                                        // 1152
                            }                                                                                          // 1153
                            return entry;                                                                              // 1154
                        }                                                                                              // 1155
                        return item.getAsEntry();                                                                      // 1156
                    })                                                                                                 // 1157
                );                                                                                                     // 1158
            }                                                                                                          // 1159
            return $.Deferred().resolve(                                                                               // 1160
                $.makeArray(dataTransfer.files)                                                                        // 1161
            ).promise();                                                                                               // 1162
        },                                                                                                             // 1163
                                                                                                                       // 1164
        _getSingleFileInputFiles: function (fileInput) {                                                               // 1165
            fileInput = $(fileInput);                                                                                  // 1166
            var entries = fileInput.prop('webkitEntries') ||                                                           // 1167
                    fileInput.prop('entries'),                                                                         // 1168
                files,                                                                                                 // 1169
                value;                                                                                                 // 1170
            if (entries && entries.length) {                                                                           // 1171
                return this._handleFileTreeEntries(entries);                                                           // 1172
            }                                                                                                          // 1173
            files = $.makeArray(fileInput.prop('files'));                                                              // 1174
            if (!files.length) {                                                                                       // 1175
                value = fileInput.prop('value');                                                                       // 1176
                if (!value) {                                                                                          // 1177
                    return $.Deferred().resolve([]).promise();                                                         // 1178
                }                                                                                                      // 1179
                // If the files property is not available, the browser does not                                        // 1180
                // support the File API and we add a pseudo File object with                                           // 1181
                // the input value as name with path information removed:                                              // 1182
                files = [{name: value.replace(/^.*\\/, '')}];                                                          // 1183
            } else if (files[0].name === undefined && files[0].fileName) {                                             // 1184
                // File normalization for Safari 4 and Firefox 3:                                                      // 1185
                $.each(files, function (index, file) {                                                                 // 1186
                    file.name = file.fileName;                                                                         // 1187
                    file.size = file.fileSize;                                                                         // 1188
                });                                                                                                    // 1189
            }                                                                                                          // 1190
            return $.Deferred().resolve(files).promise();                                                              // 1191
        },                                                                                                             // 1192
                                                                                                                       // 1193
        _getFileInputFiles: function (fileInput) {                                                                     // 1194
            if (!(fileInput instanceof $) || fileInput.length === 1) {                                                 // 1195
                return this._getSingleFileInputFiles(fileInput);                                                       // 1196
            }                                                                                                          // 1197
            return $.when.apply(                                                                                       // 1198
                $,                                                                                                     // 1199
                $.map(fileInput, this._getSingleFileInputFiles)                                                        // 1200
            ).pipe(function () {                                                                                       // 1201
                return Array.prototype.concat.apply(                                                                   // 1202
                    [],                                                                                                // 1203
                    arguments                                                                                          // 1204
                );                                                                                                     // 1205
            });                                                                                                        // 1206
        },                                                                                                             // 1207
                                                                                                                       // 1208
        _onChange: function (e) {                                                                                      // 1209
            var that = this,                                                                                           // 1210
                data = {                                                                                               // 1211
                    fileInput: $(e.target),                                                                            // 1212
                    form: $(e.target.form)                                                                             // 1213
                };                                                                                                     // 1214
            this._getFileInputFiles(data.fileInput).always(function (files) {                                          // 1215
                data.files = files;                                                                                    // 1216
                if (that.options.replaceFileInput) {                                                                   // 1217
                    that._replaceFileInput(data);                                                                      // 1218
                }                                                                                                      // 1219
                if (that._trigger(                                                                                     // 1220
                        'change',                                                                                      // 1221
                        $.Event('change', {delegatedEvent: e}),                                                        // 1222
                        data                                                                                           // 1223
                    ) !== false) {                                                                                     // 1224
                    that._onAdd(e, data);                                                                              // 1225
                }                                                                                                      // 1226
            });                                                                                                        // 1227
        },                                                                                                             // 1228
                                                                                                                       // 1229
        _onPaste: function (e) {                                                                                       // 1230
            var items = e.originalEvent && e.originalEvent.clipboardData &&                                            // 1231
                    e.originalEvent.clipboardData.items,                                                               // 1232
                data = {files: []};                                                                                    // 1233
            if (items && items.length) {                                                                               // 1234
                $.each(items, function (index, item) {                                                                 // 1235
                    var file = item.getAsFile && item.getAsFile();                                                     // 1236
                    if (file) {                                                                                        // 1237
                        data.files.push(file);                                                                         // 1238
                    }                                                                                                  // 1239
                });                                                                                                    // 1240
                if (this._trigger(                                                                                     // 1241
                        'paste',                                                                                       // 1242
                        $.Event('paste', {delegatedEvent: e}),                                                         // 1243
                        data                                                                                           // 1244
                    ) !== false) {                                                                                     // 1245
                    this._onAdd(e, data);                                                                              // 1246
                }                                                                                                      // 1247
            }                                                                                                          // 1248
        },                                                                                                             // 1249
                                                                                                                       // 1250
        _onDrop: function (e) {                                                                                        // 1251
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;                                          // 1252
            var that = this,                                                                                           // 1253
                dataTransfer = e.dataTransfer,                                                                         // 1254
                data = {};                                                                                             // 1255
            if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {                                     // 1256
                e.preventDefault();                                                                                    // 1257
                this._getDroppedFiles(dataTransfer).always(function (files) {                                          // 1258
                    data.files = files;                                                                                // 1259
                    if (that._trigger(                                                                                 // 1260
                            'drop',                                                                                    // 1261
                            $.Event('drop', {delegatedEvent: e}),                                                      // 1262
                            data                                                                                       // 1263
                        ) !== false) {                                                                                 // 1264
                        that._onAdd(e, data);                                                                          // 1265
                    }                                                                                                  // 1266
                });                                                                                                    // 1267
            }                                                                                                          // 1268
        },                                                                                                             // 1269
                                                                                                                       // 1270
        _onDragOver: getDragHandler('dragover'),                                                                       // 1271
                                                                                                                       // 1272
        _onDragEnter: getDragHandler('dragenter'),                                                                     // 1273
                                                                                                                       // 1274
        _onDragLeave: getDragHandler('dragleave'),                                                                     // 1275
                                                                                                                       // 1276
        _initEventHandlers: function () {                                                                              // 1277
            if (this._isXHRUpload(this.options)) {                                                                     // 1278
                this._on(this.options.dropZone, {                                                                      // 1279
                    dragover: this._onDragOver,                                                                        // 1280
                    drop: this._onDrop,                                                                                // 1281
                    // event.preventDefault() on dragenter is required for IE10+:                                      // 1282
                    dragenter: this._onDragEnter,                                                                      // 1283
                    // dragleave is not required, but added for completeness:                                          // 1284
                    dragleave: this._onDragLeave                                                                       // 1285
                });                                                                                                    // 1286
                this._on(this.options.pasteZone, {                                                                     // 1287
                    paste: this._onPaste                                                                               // 1288
                });                                                                                                    // 1289
            }                                                                                                          // 1290
            if ($.support.fileInput) {                                                                                 // 1291
                this._on(this.options.fileInput, {                                                                     // 1292
                    change: this._onChange                                                                             // 1293
                });                                                                                                    // 1294
            }                                                                                                          // 1295
        },                                                                                                             // 1296
                                                                                                                       // 1297
        _destroyEventHandlers: function () {                                                                           // 1298
            this._off(this.options.dropZone, 'dragenter dragleave dragover drop');                                     // 1299
            this._off(this.options.pasteZone, 'paste');                                                                // 1300
            this._off(this.options.fileInput, 'change');                                                               // 1301
        },                                                                                                             // 1302
                                                                                                                       // 1303
        _setOption: function (key, value) {                                                                            // 1304
            var reinit = $.inArray(key, this._specialOptions) !== -1;                                                  // 1305
            if (reinit) {                                                                                              // 1306
                this._destroyEventHandlers();                                                                          // 1307
            }                                                                                                          // 1308
            this._super(key, value);                                                                                   // 1309
            if (reinit) {                                                                                              // 1310
                this._initSpecialOptions();                                                                            // 1311
                this._initEventHandlers();                                                                             // 1312
            }                                                                                                          // 1313
        },                                                                                                             // 1314
                                                                                                                       // 1315
        _initSpecialOptions: function () {                                                                             // 1316
            var options = this.options;                                                                                // 1317
            if (options.fileInput === undefined) {                                                                     // 1318
                options.fileInput = this.element.is('input[type="file"]') ?                                            // 1319
                        this.element : this.element.find('input[type="file"]');                                        // 1320
            } else if (!(options.fileInput instanceof $)) {                                                            // 1321
                options.fileInput = $(options.fileInput);                                                              // 1322
            }                                                                                                          // 1323
            if (!(options.dropZone instanceof $)) {                                                                    // 1324
                options.dropZone = $(options.dropZone);                                                                // 1325
            }                                                                                                          // 1326
            if (!(options.pasteZone instanceof $)) {                                                                   // 1327
                options.pasteZone = $(options.pasteZone);                                                              // 1328
            }                                                                                                          // 1329
        },                                                                                                             // 1330
                                                                                                                       // 1331
        _getRegExp: function (str) {                                                                                   // 1332
            var parts = str.split('/'),                                                                                // 1333
                modifiers = parts.pop();                                                                               // 1334
            parts.shift();                                                                                             // 1335
            return new RegExp(parts.join('/'), modifiers);                                                             // 1336
        },                                                                                                             // 1337
                                                                                                                       // 1338
        _isRegExpOption: function (key, value) {                                                                       // 1339
            return key !== 'url' && $.type(value) === 'string' &&                                                      // 1340
                /^\/.*\/[igm]{0,3}$/.test(value);                                                                      // 1341
        },                                                                                                             // 1342
                                                                                                                       // 1343
        _initDataAttributes: function () {                                                                             // 1344
            var that = this,                                                                                           // 1345
                options = this.options,                                                                                // 1346
                data = this.element.data();                                                                            // 1347
            // Initialize options set via HTML5 data-attributes:                                                       // 1348
            $.each(                                                                                                    // 1349
                this.element[0].attributes,                                                                            // 1350
                function (index, attr) {                                                                               // 1351
                    var key = attr.name.toLowerCase(),                                                                 // 1352
                        value;                                                                                         // 1353
                    if (/^data-/.test(key)) {                                                                          // 1354
                        // Convert hyphen-ated key to camelCase:                                                       // 1355
                        key = key.slice(5).replace(/-[a-z]/g, function (str) {                                         // 1356
                            return str.charAt(1).toUpperCase();                                                        // 1357
                        });                                                                                            // 1358
                        value = data[key];                                                                             // 1359
                        if (that._isRegExpOption(key, value)) {                                                        // 1360
                            value = that._getRegExp(value);                                                            // 1361
                        }                                                                                              // 1362
                        options[key] = value;                                                                          // 1363
                    }                                                                                                  // 1364
                }                                                                                                      // 1365
            );                                                                                                         // 1366
        },                                                                                                             // 1367
                                                                                                                       // 1368
        _create: function () {                                                                                         // 1369
            this._initDataAttributes();                                                                                // 1370
            this._initSpecialOptions();                                                                                // 1371
            this._slots = [];                                                                                          // 1372
            this._sequence = this._getXHRPromise(true);                                                                // 1373
            this._sending = this._active = 0;                                                                          // 1374
            this._initProgressObject(this);                                                                            // 1375
            this._initEventHandlers();                                                                                 // 1376
        },                                                                                                             // 1377
                                                                                                                       // 1378
        // This method is exposed to the widget API and allows to query                                                // 1379
        // the number of active uploads:                                                                               // 1380
        active: function () {                                                                                          // 1381
            return this._active;                                                                                       // 1382
        },                                                                                                             // 1383
                                                                                                                       // 1384
        // This method is exposed to the widget API and allows to query                                                // 1385
        // the widget upload progress.                                                                                 // 1386
        // It returns an object with loaded, total and bitrate properties                                              // 1387
        // for the running uploads:                                                                                    // 1388
        progress: function () {                                                                                        // 1389
            return this._progress;                                                                                     // 1390
        },                                                                                                             // 1391
                                                                                                                       // 1392
        // This method is exposed to the widget API and allows adding files                                            // 1393
        // using the fileupload API. The data parameter accepts an object which                                        // 1394
        // must have a files property and can contain additional options:                                              // 1395
        // .fileupload('add', {files: filesList});                                                                     // 1396
        add: function (data) {                                                                                         // 1397
            var that = this;                                                                                           // 1398
            if (!data || this.options.disabled) {                                                                      // 1399
                return;                                                                                                // 1400
            }                                                                                                          // 1401
            if (data.fileInput && !data.files) {                                                                       // 1402
                this._getFileInputFiles(data.fileInput).always(function (files) {                                      // 1403
                    data.files = files;                                                                                // 1404
                    that._onAdd(null, data);                                                                           // 1405
                });                                                                                                    // 1406
            } else {                                                                                                   // 1407
                data.files = $.makeArray(data.files);                                                                  // 1408
                this._onAdd(null, data);                                                                               // 1409
            }                                                                                                          // 1410
        },                                                                                                             // 1411
                                                                                                                       // 1412
        // This method is exposed to the widget API and allows sending files                                           // 1413
        // using the fileupload API. The data parameter accepts an object which                                        // 1414
        // must have a files or fileInput property and can contain additional options:                                 // 1415
        // .fileupload('send', {files: filesList});                                                                    // 1416
        // The method returns a Promise object for the file upload call.                                               // 1417
        send: function (data) {                                                                                        // 1418
            if (data && !this.options.disabled) {                                                                      // 1419
                if (data.fileInput && !data.files) {                                                                   // 1420
                    var that = this,                                                                                   // 1421
                        dfd = $.Deferred(),                                                                            // 1422
                        promise = dfd.promise(),                                                                       // 1423
                        jqXHR,                                                                                         // 1424
                        aborted;                                                                                       // 1425
                    promise.abort = function () {                                                                      // 1426
                        aborted = true;                                                                                // 1427
                        if (jqXHR) {                                                                                   // 1428
                            return jqXHR.abort();                                                                      // 1429
                        }                                                                                              // 1430
                        dfd.reject(null, 'abort', 'abort');                                                            // 1431
                        return promise;                                                                                // 1432
                    };                                                                                                 // 1433
                    this._getFileInputFiles(data.fileInput).always(                                                    // 1434
                        function (files) {                                                                             // 1435
                            if (aborted) {                                                                             // 1436
                                return;                                                                                // 1437
                            }                                                                                          // 1438
                            if (!files.length) {                                                                       // 1439
                                dfd.reject();                                                                          // 1440
                                return;                                                                                // 1441
                            }                                                                                          // 1442
                            data.files = files;                                                                        // 1443
                            jqXHR = that._onSend(null, data);                                                          // 1444
                            jqXHR.then(                                                                                // 1445
                                function (result, textStatus, jqXHR) {                                                 // 1446
                                    dfd.resolve(result, textStatus, jqXHR);                                            // 1447
                                },                                                                                     // 1448
                                function (jqXHR, textStatus, errorThrown) {                                            // 1449
                                    dfd.reject(jqXHR, textStatus, errorThrown);                                        // 1450
                                }                                                                                      // 1451
                            );                                                                                         // 1452
                        }                                                                                              // 1453
                    );                                                                                                 // 1454
                    return this._enhancePromise(promise);                                                              // 1455
                }                                                                                                      // 1456
                data.files = $.makeArray(data.files);                                                                  // 1457
                if (data.files.length) {                                                                               // 1458
                    return this._onSend(null, data);                                                                   // 1459
                }                                                                                                      // 1460
            }                                                                                                          // 1461
            return this._getXHRPromise(false, data && data.context);                                                   // 1462
        }                                                                                                              // 1463
                                                                                                                       // 1464
    });                                                                                                                // 1465
                                                                                                                       // 1466
}));                                                                                                                   // 1467
                                                                                                                       // 1468
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bower_components/medium-editor-insert-plugin/dist/js/medium-editor-insert-pl //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
 * medium-editor-insert-plugin v2.0.1 - jQuery insert plugin for MediumEditor                                          // 2
 *                                                                                                                     // 3
 * https://github.com/orthes/medium-editor-insert-plugin                                                               // 4
 *                                                                                                                     // 5
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.sk)                                                              // 6
 * Released under the MIT license                                                                                      // 7
 */                                                                                                                    // 8
                                                                                                                       // 9
this["MediumInsert"] = this["MediumInsert"] || {};                                                                     // 10
this["MediumInsert"]["Templates"] = this["MediumInsert"]["Templates"] || {};                                           // 11
                                                                                                                       // 12
this["MediumInsert"]["Templates"]["src/js/templates/core-buttons.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "            <li><a data-addon=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 15
    + "\" data-action=\"add\" class=\"medium-insert-action\">";                                                        // 16
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 18
  return buffer + "</a></li>\n";                                                                                       // 19
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 20
  var stack1, buffer = "<div class=\"medium-insert-buttons\" contenteditable=\"false\" style=\"display: none\">\n    <a class=\"medium-insert-buttons-show\">+</a>\n    <ul class=\"medium-insert-buttons-addons\" style=\"display: none\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.addons : depth0), {"name":"each","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 23
  return buffer + "    </ul>\n</div>\n";                                                                               // 24
},"useData":true});                                                                                                    // 25
                                                                                                                       // 26
this["MediumInsert"]["Templates"]["src/js/templates/core-caption.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;    // 28
  return "<figcaption contenteditable=\"true\" class=\"medium-insert-caption-placeholder\" data-placeholder=\""        // 29
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\"></figcaption>";                                                                                              // 31
},"useData":true});                                                                                                    // 32
                                                                                                                       // 33
this["MediumInsert"]["Templates"]["src/js/templates/core-empty-line.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<p><br></p>\n";                                                                                              // 35
  },"useData":true});                                                                                                  // 36
                                                                                                                       // 37
this["MediumInsert"]["Templates"]["src/js/templates/embeds-toolbar.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, buffer = "    <div class=\"medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\">\n        <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"each","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 41
  return buffer + "        </ul>\n    </div>\n";                                                                       // 42
},"2":function(depth0,helpers,partials,data) {                                                                         // 43
  var stack1, buffer = "";                                                                                             // 44
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 46
  return buffer;                                                                                                       // 47
},"3":function(depth0,helpers,partials,data) {                                                                         // 48
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "                    <li>\n                        <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 50
    + "\">";                                                                                                           // 51
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 53
  return buffer + "</button>\n                    </li>\n";                                                            // 54
},"5":function(depth0,helpers,partials,data) {                                                                         // 55
  var stack1, buffer = "    <div class=\"medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active\">\n        <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"each","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 58
  return buffer + "        </ul>\n    </div>\n";                                                                       // 59
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 60
  var stack1, buffer = "";                                                                                             // 61
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 63
  buffer += "\n";                                                                                                      // 64
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"if","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 66
  return buffer;                                                                                                       // 67
},"useData":true});                                                                                                    // 68
                                                                                                                       // 69
this["MediumInsert"]["Templates"]["src/js/templates/embeds-wrapper.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"medium-insert-embeds\" contenteditable=\"false\">\n	<figure>\n		<div class=\"medium-insert-embed\">\n			";
  stack1 = ((helper = (helper = helpers.html || (depth0 != null ? depth0.html : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"html","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 73
  return buffer + "\n		</div>\n	</figure>\n	<div class=\"medium-insert-embeds-overlay\"></div>\n</div>";               // 74
},"useData":true});                                                                                                    // 75
                                                                                                                       // 76
this["MediumInsert"]["Templates"]["src/js/templates/images-fileupload.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<input type=\"file\" multiple>";                                                                             // 78
  },"useData":true});                                                                                                  // 79
                                                                                                                       // 80
this["MediumInsert"]["Templates"]["src/js/templates/images-image.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  return "        <div class=\"medium-insert-images-progress\"></div>\n";                                              // 82
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                   // 83
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<figure contenteditable=\"false\">\n    <img src=\""
    + escapeExpression(((helper = (helper = helpers.img || (depth0 != null ? depth0.img : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"img","hash":{},"data":data}) : helper)))
    + "\" alt=\"\">\n";                                                                                                // 86
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.progress : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 88
  return buffer + "</figure>";                                                                                         // 89
},"useData":true});                                                                                                    // 90
                                                                                                                       // 91
this["MediumInsert"]["Templates"]["src/js/templates/images-progressbar.hbs"] = Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<progress min=\"0\" max=\"100\" value=\"0\">0</progress>";                                                   // 93
  },"useData":true});                                                                                                  // 94
                                                                                                                       // 95
this["MediumInsert"]["Templates"]["src/js/templates/images-toolbar.hbs"] = Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, buffer = "";                                                                                             // 97
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(2, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 99
  return buffer;                                                                                                       // 100
},"2":function(depth0,helpers,partials,data) {                                                                         // 101
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "                <li>\n                    <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 103
    + "\">";                                                                                                           // 104
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 106
  return buffer + "</button>\n                </li>\n";                                                                // 107
},"4":function(depth0,helpers,partials,data) {                                                                         // 108
  var stack1, buffer = "	<div class=\"medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active\">\n		<ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"each","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 111
  return buffer + "    	</ul>\n    </div>\n";                                                                          // 112
},"5":function(depth0,helpers,partials,data) {                                                                         // 113
  var stack1, buffer = "";                                                                                             // 114
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.label : depth0), {"name":"if","hash":{},"fn":this.program(6, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 116
  return buffer;                                                                                                       // 117
},"6":function(depth0,helpers,partials,data) {                                                                         // 118
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "        	        <li>\n        	            <button class=\"medium-editor-action\" data-action=\""
    + escapeExpression(lambda((data && data.key), depth0))                                                             // 120
    + "\">";                                                                                                           // 121
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }                                                                            // 123
  return buffer + "</button>\n        	        </li>\n";                                                               // 124
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {                                     // 125
  var stack1, buffer = "<div class=\"medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\">\n    <ul class=\"medium-editor-toolbar-actions clearfix\">\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.styles : depth0), {"name":"each","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 128
  buffer += "    </ul>\n</div>\n\n";                                                                                   // 129
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.actions : depth0), {"name":"if","hash":{},"fn":this.program(4, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }                                                                            // 131
  return buffer;                                                                                                       // 132
},"useData":true});                                                                                                    // 133
;(function ($, window, document, undefined) {                                                                          // 134
                                                                                                                       // 135
    'use strict';                                                                                                      // 136
                                                                                                                       // 137
    /** Default values */                                                                                              // 138
    var pluginName = 'mediumInsert',                                                                                   // 139
        defaults = {                                                                                                   // 140
            editor: null,                                                                                              // 141
            enabled: true,                                                                                             // 142
            addons: {                                                                                                  // 143
                images: true, // boolean or object containing configuration                                            // 144
                embeds: true                                                                                           // 145
            }                                                                                                          // 146
        };                                                                                                             // 147
                                                                                                                       // 148
    /**                                                                                                                // 149
     * Capitalize first character                                                                                      // 150
     *                                                                                                                 // 151
     * @param {string} str                                                                                             // 152
     * @return {string}                                                                                                // 153
     */                                                                                                                // 154
                                                                                                                       // 155
    function ucfirst (str) {                                                                                           // 156
        return str.charAt(0).toUpperCase() + str.slice(1);                                                             // 157
    }                                                                                                                  // 158
                                                                                                                       // 159
    /**                                                                                                                // 160
     * Core plugin's object                                                                                            // 161
     *                                                                                                                 // 162
     * Sets options, variables and calls init() function                                                               // 163
     *                                                                                                                 // 164
     * @constructor                                                                                                    // 165
     * @param {DOM} el - DOM element to init the plugin on                                                             // 166
     * @param {object} options - Options to override defaults                                                          // 167
     * @return {void}                                                                                                  // 168
     */                                                                                                                // 169
                                                                                                                       // 170
    function Core (el, options) {                                                                                      // 171
        var editor;                                                                                                    // 172
                                                                                                                       // 173
        this.el = el;                                                                                                  // 174
        this.$el = $(el);                                                                                              // 175
        this.templates = window.MediumInsert.Templates;                                                                // 176
                                                                                                                       // 177
        if (options) {                                                                                                 // 178
            // Fix #142                                                                                                // 179
            // Avoid deep copying editor object, because since v2.3.0 it contains circular references which causes jQuery.extend to break
            // Instead copy editor object to this.options manually                                                     // 181
            editor = options.editor;                                                                                   // 182
            options.editor = null;                                                                                     // 183
        }                                                                                                              // 184
        this.options = $.extend(true, {}, defaults, options);                                                          // 185
        this.options.editor = editor;                                                                                  // 186
                                                                                                                       // 187
        this._defaults = defaults;                                                                                     // 188
        this._name = pluginName;                                                                                       // 189
                                                                                                                       // 190
        // Extend editor's functions                                                                                   // 191
        if (this.options && this.options.editor) {                                                                     // 192
            this.options.editor._serialize = this.options.editor.serialize;                                            // 193
            this.options.editor._destroy = this.options.editor.destroy;                                                // 194
            this.options.editor._setup = this.options.editor.setup;                                                    // 195
            this.options.editor._hideInsertButtons = this.hideButtons;                                                 // 196
                                                                                                                       // 197
            this.options.editor.serialize = this.editorSerialize;                                                      // 198
            this.options.editor.destroy = this.editorDestroy;                                                          // 199
            this.options.editor.setup = this.editorSetup;                                                              // 200
                                                                                                                       // 201
            this.options.editor.getExtensionByName('placeholder').updatePlaceholder = this.editorUpdatePlaceholder;    // 202
        }                                                                                                              // 203
    }                                                                                                                  // 204
                                                                                                                       // 205
    /**                                                                                                                // 206
     * Initialization                                                                                                  // 207
     *                                                                                                                 // 208
     * @return {void}                                                                                                  // 209
     */                                                                                                                // 210
                                                                                                                       // 211
    Core.prototype.init = function () {                                                                                // 212
        this.$el.addClass('medium-editor-insert-plugin');                                                              // 213
                                                                                                                       // 214
        if (typeof this.options.addons !== 'object' || Object.keys(this.options.addons).length === 0) {                // 215
            this.disable();                                                                                            // 216
        }                                                                                                              // 217
                                                                                                                       // 218
        this.initAddons();                                                                                             // 219
        this.clean();                                                                                                  // 220
        this.events();                                                                                                 // 221
    };                                                                                                                 // 222
                                                                                                                       // 223
    /**                                                                                                                // 224
     * Event listeners                                                                                                 // 225
     *                                                                                                                 // 226
     * @return {void}                                                                                                  // 227
     */                                                                                                                // 228
                                                                                                                       // 229
    Core.prototype.events = function () {                                                                              // 230
        var that = this;                                                                                               // 231
                                                                                                                       // 232
        this.$el                                                                                                       // 233
            .on('dragover drop', function (e) {                                                                        // 234
                e.preventDefault();                                                                                    // 235
            })                                                                                                         // 236
            .on('keyup click', $.proxy(this, 'toggleButtons'))                                                         // 237
            .on('selectstart mousedown', '.medium-insert, .medium-insert-buttons', $.proxy(this, 'disableSelection'))  // 238
            .on('click', '.medium-insert-buttons-show', $.proxy(this, 'toggleAddons'))                                 // 239
            .on('click', '.medium-insert-action', $.proxy(this, 'addonAction'))                                        // 240
            .on('paste', '.medium-insert-caption-placeholder', function (e) {                                          // 241
                $.proxy(that, 'removeCaptionPlaceholder')($(e.target));                                                // 242
            });                                                                                                        // 243
                                                                                                                       // 244
        $(window).on('resize', $.proxy(this, 'positionButtons', null));                                                // 245
    };                                                                                                                 // 246
                                                                                                                       // 247
    /**                                                                                                                // 248
     * Return editor instance                                                                                          // 249
     *                                                                                                                 // 250
     * @return {object} MediumEditor                                                                                   // 251
     */                                                                                                                // 252
                                                                                                                       // 253
    Core.prototype.getEditor = function () {                                                                           // 254
        return this.options.editor;                                                                                    // 255
    };                                                                                                                 // 256
                                                                                                                       // 257
    /**                                                                                                                // 258
     * Extend editor's serialize function                                                                              // 259
     *                                                                                                                 // 260
     * @return {object} Serialized data                                                                                // 261
     */                                                                                                                // 262
                                                                                                                       // 263
    Core.prototype.editorSerialize = function () {                                                                     // 264
        var data = this._serialize();                                                                                  // 265
                                                                                                                       // 266
        $.each(data, function (key) {                                                                                  // 267
            var $data = $('<div />').html(data[key].value);                                                            // 268
                                                                                                                       // 269
            $data.find('.medium-insert-buttons').remove();                                                             // 270
                                                                                                                       // 271
            data[key].value = $data.html();                                                                            // 272
        });                                                                                                            // 273
                                                                                                                       // 274
        return data;                                                                                                   // 275
    };                                                                                                                 // 276
                                                                                                                       // 277
    /**                                                                                                                // 278
     * Extend editor's destroy function to deactivate this plugin too                                                  // 279
     *                                                                                                                 // 280
     * @return {void}                                                                                                  // 281
     */                                                                                                                // 282
                                                                                                                       // 283
    Core.prototype.editorDestroy = function () {                                                                       // 284
        $.each(this.elements, function (key, el) {                                                                     // 285
            $(el).data('plugin_' + pluginName).disable();                                                              // 286
        });                                                                                                            // 287
                                                                                                                       // 288
        this._destroy();                                                                                               // 289
    };                                                                                                                 // 290
                                                                                                                       // 291
    /**                                                                                                                // 292
     * Extend editor's setup function to activate this plugin too                                                      // 293
     *                                                                                                                 // 294
     * @return {void}                                                                                                  // 295
     */                                                                                                                // 296
                                                                                                                       // 297
    Core.prototype.editorSetup = function () {                                                                         // 298
        this._setup();                                                                                                 // 299
                                                                                                                       // 300
        $.each(this.elements, function (key, el) {                                                                     // 301
            $(el).data('plugin_' + pluginName).enable();                                                               // 302
        });                                                                                                            // 303
    };                                                                                                                 // 304
                                                                                                                       // 305
    /**                                                                                                                // 306
     * Extend editor's placeholder.updatePlaceholder function to show placeholder dispite of the plugin buttons        // 307
     *                                                                                                                 // 308
     * @return {void}                                                                                                  // 309
     */                                                                                                                // 310
                                                                                                                       // 311
    Core.prototype.editorUpdatePlaceholder = function (el) {                                                           // 312
        var $clone = $(el).clone(),                                                                                    // 313
            cloneHtml;                                                                                                 // 314
                                                                                                                       // 315
        $clone.find('.medium-insert-buttons').remove();                                                                // 316
        cloneHtml = $clone.html()                                                                                      // 317
            .replace(/^\s+|\s+$/g, '')                                                                                 // 318
            .replace(/^<p( class="medium-insert-active")?><br><\/p>$/, '');                                            // 319
                                                                                                                       // 320
        if (!(el.querySelector('img, blockquote')) && cloneHtml === '') {                                              // 321
            this.showPlaceholder(el);                                                                                  // 322
            this.base._hideInsertButtons($(el));                                                                       // 323
        } else {                                                                                                       // 324
            this.hidePlaceholder(el);                                                                                  // 325
        }                                                                                                              // 326
    };                                                                                                                 // 327
                                                                                                                       // 328
    /**                                                                                                                // 329
     * Deselects selected text                                                                                         // 330
     *                                                                                                                 // 331
     * @return {void}                                                                                                  // 332
     */                                                                                                                // 333
                                                                                                                       // 334
    Core.prototype.deselect = function () {                                                                            // 335
        document.getSelection().removeAllRanges();                                                                     // 336
    };                                                                                                                 // 337
                                                                                                                       // 338
    /**                                                                                                                // 339
     * Disables the plugin                                                                                             // 340
     *                                                                                                                 // 341
     * @return {void}                                                                                                  // 342
     */                                                                                                                // 343
                                                                                                                       // 344
    Core.prototype.disable = function () {                                                                             // 345
        this.options.enabled = false;                                                                                  // 346
                                                                                                                       // 347
        this.$el.find('.medium-insert-buttons').addClass('hide');                                                      // 348
    };                                                                                                                 // 349
                                                                                                                       // 350
    /**                                                                                                                // 351
     * Enables the plugin                                                                                              // 352
     *                                                                                                                 // 353
     * @return {void}                                                                                                  // 354
     */                                                                                                                // 355
                                                                                                                       // 356
    Core.prototype.enable = function () {                                                                              // 357
        this.options.enabled = true;                                                                                   // 358
                                                                                                                       // 359
        this.$el.find('.medium-insert-buttons').removeClass('hide');                                                   // 360
    };                                                                                                                 // 361
                                                                                                                       // 362
    /**                                                                                                                // 363
     * Disables selectstart mousedown events on plugin elements except images                                          // 364
     *                                                                                                                 // 365
     * @return {void}                                                                                                  // 366
     */                                                                                                                // 367
                                                                                                                       // 368
    Core.prototype.disableSelection = function (e) {                                                                   // 369
        var $el = $(e.target);                                                                                         // 370
                                                                                                                       // 371
        if ($el.is('img') === false || $el.hasClass('medium-insert-buttons-show')) {                                   // 372
            e.preventDefault();                                                                                        // 373
        }                                                                                                              // 374
    };                                                                                                                 // 375
                                                                                                                       // 376
    /**                                                                                                                // 377
     * Initialize addons                                                                                               // 378
     *                                                                                                                 // 379
     * @return {void}                                                                                                  // 380
     */                                                                                                                // 381
                                                                                                                       // 382
    Core.prototype.initAddons = function () {                                                                          // 383
        var that = this;                                                                                               // 384
                                                                                                                       // 385
        if (!this.options.addons || this.options.addons.length === 0) {                                                // 386
            return;                                                                                                    // 387
        }                                                                                                              // 388
                                                                                                                       // 389
        $.each(this.options.addons, function (addon, options) {                                                        // 390
            var addonName = pluginName + ucfirst(addon);                                                               // 391
                                                                                                                       // 392
            if (options === false) {                                                                                   // 393
                delete that.options.addons[addon];                                                                     // 394
                return;                                                                                                // 395
            }                                                                                                          // 396
                                                                                                                       // 397
            that.$el[addonName](options);                                                                              // 398
            that.options.addons[addon] = that.$el.data('plugin_'+ addonName).options;                                  // 399
        });                                                                                                            // 400
    };                                                                                                                 // 401
                                                                                                                       // 402
    /**                                                                                                                // 403
     * Cleans a content of the editor                                                                                  // 404
     *                                                                                                                 // 405
     * @return {void}                                                                                                  // 406
     */                                                                                                                // 407
                                                                                                                       // 408
    Core.prototype.clean = function () {                                                                               // 409
        var that = this,                                                                                               // 410
            $buttons, $lastEl, $text;                                                                                  // 411
                                                                                                                       // 412
        if (this.options.enabled === false) {                                                                          // 413
            return;                                                                                                    // 414
        }                                                                                                              // 415
                                                                                                                       // 416
        // Fix #39                                                                                                     // 417
        // After deleting all content (ctrl+A and delete) in Firefox, all content is deleted and only <br> appears     // 418
        // To force placeholder to appear, set <p><br></p> as content of the $el                                       // 419
                                                                                                                       // 420
        if (this.$el.html().trim() === '' || this.$el.html().trim() === '<br>') {                                      // 421
            this.$el.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());                            // 422
        }                                                                                                              // 423
                                                                                                                       // 424
        // Fix #29                                                                                                     // 425
        // Wrap content text in <p></p> to avoid Firefox problems                                                      // 426
        $text = this.$el                                                                                               // 427
            .contents()                                                                                                // 428
            .filter(function () {                                                                                      // 429
                return this.nodeName === '#text' && $.trim($(this).text()) !== '';                                     // 430
            });                                                                                                        // 431
                                                                                                                       // 432
        $text.each(function () {                                                                                       // 433
            $(this).wrap('<p />');                                                                                     // 434
                                                                                                                       // 435
            // Fix #145                                                                                                // 436
            // Move caret at the end of the element that's being wrapped                                               // 437
            that.moveCaret($(this).parent(), $(this).text().length);                                                   // 438
        });                                                                                                            // 439
                                                                                                                       // 440
        this.addButtons();                                                                                             // 441
                                                                                                                       // 442
        $buttons = this.$el.find('.medium-insert-buttons');                                                            // 443
        $lastEl = $buttons.prev();                                                                                     // 444
        if ($lastEl.attr('class') && $lastEl.attr('class').match(/medium\-insert(?!\-active)/)) {                      // 445
            $buttons.before(this.templates['src/js/templates/core-empty-line.hbs']().trim());                          // 446
        }                                                                                                              // 447
    };                                                                                                                 // 448
                                                                                                                       // 449
    /**                                                                                                                // 450
     * Returns HTML template of buttons                                                                                // 451
     *                                                                                                                 // 452
     * @return {string} HTML template of buttons                                                                       // 453
     */                                                                                                                // 454
                                                                                                                       // 455
    Core.prototype.getButtons = function () {                                                                          // 456
        if (this.options.enabled === false) {                                                                          // 457
            return;                                                                                                    // 458
        }                                                                                                              // 459
                                                                                                                       // 460
        return this.templates['src/js/templates/core-buttons.hbs']({                                                   // 461
            addons: this.options.addons                                                                                // 462
        }).trim();                                                                                                     // 463
    };                                                                                                                 // 464
                                                                                                                       // 465
    /**                                                                                                                // 466
     * Appends buttons at the end of the $el                                                                           // 467
     *                                                                                                                 // 468
     * @return {void}                                                                                                  // 469
     */                                                                                                                // 470
                                                                                                                       // 471
    Core.prototype.addButtons = function () {                                                                          // 472
        if (this.$el.find('.medium-insert-buttons').length === 0) {                                                    // 473
            this.$el.append(this.getButtons());                                                                        // 474
        }                                                                                                              // 475
    };                                                                                                                 // 476
                                                                                                                       // 477
    /**                                                                                                                // 478
     * Move buttons to current active, empty paragraph and show them                                                   // 479
     *                                                                                                                 // 480
     * @return {void}                                                                                                  // 481
     */                                                                                                                // 482
                                                                                                                       // 483
    Core.prototype.toggleButtons = function (e) {                                                                      // 484
        var $el = $(e.target),                                                                                         // 485
            selection = window.getSelection(),                                                                         // 486
            that = this,                                                                                               // 487
            range, $current, $p, activeAddon;                                                                          // 488
                                                                                                                       // 489
        if (this.options.enabled === false) {                                                                          // 490
            return;                                                                                                    // 491
        }                                                                                                              // 492
                                                                                                                       // 493
        if (!selection || selection.rangeCount === 0) {                                                                // 494
            $current = $el;                                                                                            // 495
        } else {                                                                                                       // 496
            range = selection.getRangeAt(0);                                                                           // 497
            $current = $(range.commonAncestorContainer);                                                               // 498
        }                                                                                                              // 499
                                                                                                                       // 500
        // When user clicks on  editor's placeholder in FF, $current el is editor itself, not the first paragraph as it should
        if ($current.hasClass('medium-editor-insert-plugin')) {                                                        // 502
            $current = $current.find('p:first');                                                                       // 503
        }                                                                                                              // 504
                                                                                                                       // 505
        $p = $current.is('p') ? $current : $current.closest('p');                                                      // 506
                                                                                                                       // 507
        this.clean();                                                                                                  // 508
                                                                                                                       // 509
        if ($el.hasClass('medium-editor-placeholder') === false && $el.closest('.medium-insert-buttons').length === 0 && $current.closest('.medium-insert-buttons').length === 0) {
                                                                                                                       // 511
            this.$el.find('.medium-insert-active').removeClass('medium-insert-active');                                // 512
                                                                                                                       // 513
            $.each(this.options.addons, function (addon) {                                                             // 514
                if ($el.closest('.medium-insert-'+ addon).length) {                                                    // 515
                    $current = $el;                                                                                    // 516
                }                                                                                                      // 517
                                                                                                                       // 518
                if ($current.closest('.medium-insert-'+ addon).length) {                                               // 519
                    $p = $current.closest('.medium-insert-'+ addon);                                                   // 520
                    activeAddon = addon;                                                                               // 521
                    return;                                                                                            // 522
                }                                                                                                      // 523
            });                                                                                                        // 524
                                                                                                                       // 525
            if ($p.length && (($p.text().trim() === '' && !activeAddon) || activeAddon === 'images')) {                // 526
                $p.addClass('medium-insert-active');                                                                   // 527
                                                                                                                       // 528
                // If buttons are displayed on addon paragraph, wait 100ms for possible captions to display            // 529
                setTimeout(function () {                                                                               // 530
                    that.positionButtons(activeAddon);                                                                 // 531
                    that.showButtons(activeAddon);                                                                     // 532
                }, activeAddon ? 100 : 0);                                                                             // 533
            } else {                                                                                                   // 534
                this.hideButtons();                                                                                    // 535
            }                                                                                                          // 536
        }                                                                                                              // 537
    };                                                                                                                 // 538
                                                                                                                       // 539
    /**                                                                                                                // 540
     * Show buttons                                                                                                    // 541
     *                                                                                                                 // 542
     * @param {string} activeAddon - Name of active addon                                                              // 543
     * @returns {void}                                                                                                 // 544
     */                                                                                                                // 545
                                                                                                                       // 546
    Core.prototype.showButtons = function (activeAddon) {                                                              // 547
        var $buttons = this.$el.find('.medium-insert-buttons');                                                        // 548
                                                                                                                       // 549
        $buttons.show();                                                                                               // 550
        $buttons.find('li').show();                                                                                    // 551
                                                                                                                       // 552
        if (activeAddon) {                                                                                             // 553
            $buttons.find('li').hide();                                                                                // 554
            $buttons.find('a[data-addon="'+ activeAddon +'"]').parent().show();                                        // 555
        }                                                                                                              // 556
    };                                                                                                                 // 557
                                                                                                                       // 558
    /**                                                                                                                // 559
     * Hides buttons                                                                                                   // 560
     *                                                                                                                 // 561
     * @param {jQuery} $el - Editor element                                                                            // 562
     * @returns {void}                                                                                                 // 563
     */                                                                                                                // 564
                                                                                                                       // 565
    Core.prototype.hideButtons = function ($el) {                                                                      // 566
        $el = $el || this.$el;                                                                                         // 567
                                                                                                                       // 568
        $el.find('.medium-insert-buttons').hide();                                                                     // 569
        $el.find('.medium-insert-buttons-addons').hide();                                                              // 570
        $el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');                           // 571
    };                                                                                                                 // 572
                                                                                                                       // 573
    /**                                                                                                                // 574
     * Position buttons                                                                                                // 575
     *                                                                                                                 // 576
     * @param {string} activeAddon - Name of active addon                                                              // 577
     * @return {void}                                                                                                  // 578
     */                                                                                                                // 579
                                                                                                                       // 580
    Core.prototype.positionButtons = function (activeAddon) {                                                          // 581
        var $buttons = this.$el.find('.medium-insert-buttons'),                                                        // 582
            $p = this.$el.find('.medium-insert-active'),                                                               // 583
            $first = $p.find('figure:first').length ? $p.find('figure:first') : $p,                                    // 584
            left, top;                                                                                                 // 585
                                                                                                                       // 586
        if ($p.length) {                                                                                               // 587
                                                                                                                       // 588
            left = $p.position().left - parseInt($buttons.find('.medium-insert-buttons-addons').css('left'), 10) - parseInt($buttons.find('.medium-insert-buttons-addons a:first').css('margin-left'), 10);
            left = left < 0 ? $p.position().left : left;                                                               // 590
            top = $p.position().top + parseInt($p.css('margin-top'), 10);                                              // 591
                                                                                                                       // 592
            if (activeAddon) {                                                                                         // 593
                if ($p.position().left !== $first.position().left) {                                                   // 594
                    left = $first.position().left;                                                                     // 595
                }                                                                                                      // 596
                                                                                                                       // 597
                top += $p.height() + 15; // 15px offset                                                                // 598
            }                                                                                                          // 599
                                                                                                                       // 600
            $buttons.css({                                                                                             // 601
                left: left,                                                                                            // 602
                top: top                                                                                               // 603
            });                                                                                                        // 604
        }                                                                                                              // 605
    };                                                                                                                 // 606
                                                                                                                       // 607
    /**                                                                                                                // 608
     * Toggles addons buttons                                                                                          // 609
     *                                                                                                                 // 610
     * @return {void}                                                                                                  // 611
     */                                                                                                                // 612
                                                                                                                       // 613
    Core.prototype.toggleAddons = function () {                                                                        // 614
        this.$el.find('.medium-insert-buttons-addons').fadeToggle();                                                   // 615
        this.$el.find('.medium-insert-buttons-show').toggleClass('medium-insert-buttons-rotate');                      // 616
    };                                                                                                                 // 617
                                                                                                                       // 618
    /**                                                                                                                // 619
     * Hide addons buttons                                                                                             // 620
     *                                                                                                                 // 621
     * @return {void}                                                                                                  // 622
     */                                                                                                                // 623
                                                                                                                       // 624
    Core.prototype.hideAddons = function () {                                                                          // 625
        this.$el.find('.medium-insert-buttons-addons').hide();                                                         // 626
        this.$el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');                      // 627
    };                                                                                                                 // 628
                                                                                                                       // 629
    /**                                                                                                                // 630
     * Call addon's action                                                                                             // 631
     *                                                                                                                 // 632
     * @param {Event} e                                                                                                // 633
     * @return {void}                                                                                                  // 634
     */                                                                                                                // 635
                                                                                                                       // 636
    Core.prototype.addonAction = function (e) {                                                                        // 637
        var $a = $(e.target).is('a') ? $(e.target) : $(e.target).closest('a'),                                         // 638
            addon = $a.data('addon'),                                                                                  // 639
            action = $a.data('action');                                                                                // 640
                                                                                                                       // 641
        this.$el.data('plugin_'+ pluginName + ucfirst(addon))[action]();                                               // 642
    };                                                                                                                 // 643
                                                                                                                       // 644
    /**                                                                                                                // 645
     * Move caret at the beginning of the empty paragraph                                                              // 646
     *                                                                                                                 // 647
     * @param {jQuery} $el Element where to place the caret                                                            // 648
     * @param {integer} position Position where to move caret. Default: 0                                              // 649
     *                                                                                                                 // 650
     * @return {void}                                                                                                  // 651
     */                                                                                                                // 652
                                                                                                                       // 653
    Core.prototype.moveCaret = function ($el, position) {                                                              // 654
        var range, sel, el;                                                                                            // 655
                                                                                                                       // 656
        position = position || 0;                                                                                      // 657
        range = document.createRange();                                                                                // 658
        sel = window.getSelection();                                                                                   // 659
        el = $el.get(0);                                                                                               // 660
                                                                                                                       // 661
        if (!el.childNodes.length) {                                                                                   // 662
            var textEl = document.createTextNode(' ');                                                                 // 663
            el.appendChild(textEl);                                                                                    // 664
        }                                                                                                              // 665
                                                                                                                       // 666
        range.setStart(el.childNodes[0], position);                                                                    // 667
        range.collapse(true);                                                                                          // 668
        sel.removeAllRanges();                                                                                         // 669
        sel.addRange(range);                                                                                           // 670
    };                                                                                                                 // 671
                                                                                                                       // 672
    /**                                                                                                                // 673
     * Add caption                                                                                                     // 674
     *                                                                                                                 // 675
     * @param {jQuery Element} $el                                                                                     // 676
     * @param {string} placeholder                                                                                     // 677
     * @return {void}                                                                                                  // 678
     */                                                                                                                // 679
                                                                                                                       // 680
    Core.prototype.addCaption = function ($el, placeholder) {                                                          // 681
        var $caption = $el.find('figcaption');                                                                         // 682
                                                                                                                       // 683
        if ($caption.length === 0) {                                                                                   // 684
            $el.append(this.templates['src/js/templates/core-caption.hbs']({                                           // 685
                placeholder: placeholder                                                                               // 686
            }));                                                                                                       // 687
        }                                                                                                              // 688
    };                                                                                                                 // 689
                                                                                                                       // 690
    /**                                                                                                                // 691
     * Remove captions                                                                                                 // 692
     *                                                                                                                 // 693
     * @param {jQuery Element} $ignore                                                                                 // 694
     * @return {void}                                                                                                  // 695
     */                                                                                                                // 696
                                                                                                                       // 697
    Core.prototype.removeCaptions = function ($ignore) {                                                               // 698
        var $captions = this.$el.find('figcaption');                                                                   // 699
                                                                                                                       // 700
        if ($ignore) {                                                                                                 // 701
            $captions = $captions.not($ignore);                                                                        // 702
        }                                                                                                              // 703
                                                                                                                       // 704
        $captions.each(function () {                                                                                   // 705
            if ($(this).hasClass('medium-insert-caption-placeholder') || $(this).text().trim() === '') {               // 706
                $(this).remove();                                                                                      // 707
            }                                                                                                          // 708
        });                                                                                                            // 709
    };                                                                                                                 // 710
                                                                                                                       // 711
    /**                                                                                                                // 712
     * Remove caption placeholder                                                                                      // 713
     *                                                                                                                 // 714
     * @param {jQuery Element} $el                                                                                     // 715
     * @return {void}                                                                                                  // 716
     */                                                                                                                // 717
                                                                                                                       // 718
    Core.prototype.removeCaptionPlaceholder = function ($el) {                                                         // 719
        var $caption = $el.is('figcaption') ? $el : $el.find('figcaption');                                            // 720
                                                                                                                       // 721
        if ($caption.length) {                                                                                         // 722
            $caption                                                                                                   // 723
                .removeClass('medium-insert-caption-placeholder')                                                      // 724
                .removeAttr('data-placeholder');                                                                       // 725
        }                                                                                                              // 726
    };                                                                                                                 // 727
                                                                                                                       // 728
    /** Plugin initialization */                                                                                       // 729
                                                                                                                       // 730
    $.fn[pluginName] = function (options) {                                                                            // 731
        return this.each(function () {                                                                                 // 732
            if (!$.data(this, 'plugin_' + pluginName)) {                                                               // 733
                // Plugin initialization                                                                               // 734
                $.data(this, 'plugin_' + pluginName, new Core(this, options));                                         // 735
                $.data(this, 'plugin_' + pluginName).init();                                                           // 736
            } else if (typeof options === 'string' && $.data(this, 'plugin_' + pluginName)[options]) {                 // 737
                // Method call                                                                                         // 738
                $.data(this, 'plugin_' + pluginName)[options]();                                                       // 739
            }                                                                                                          // 740
        });                                                                                                            // 741
    };                                                                                                                 // 742
                                                                                                                       // 743
})(jQuery, window, document);                                                                                          // 744
                                                                                                                       // 745
;(function ($, window, document, undefined) {                                                                          // 746
                                                                                                                       // 747
    'use strict';                                                                                                      // 748
                                                                                                                       // 749
    /** Default values */                                                                                              // 750
    var pluginName = 'mediumInsert',                                                                                   // 751
        addonName = 'Embeds', // first char is uppercase                                                               // 752
        defaults = {                                                                                                   // 753
            label: '<span class="fa fa-youtube-play"></span>',                                                         // 754
            placeholder: 'Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter',                // 755
            oembedProxy: 'http://medium.iframe.ly/api/oembed?iframe=1',                                                // 756
            captions: true,                                                                                            // 757
            captionPlaceholder: 'Type caption (optional)',                                                             // 758
            styles: {                                                                                                  // 759
                wide: {                                                                                                // 760
                    label: '<span class="fa fa-align-justify"></span>',                                                // 761
                    // added: function ($el) {},                                                                       // 762
                    // removed: function ($el) {}                                                                      // 763
                },                                                                                                     // 764
                left: {                                                                                                // 765
                    label: '<span class="fa fa-align-left"></span>',                                                   // 766
                    // added: function ($el) {},                                                                       // 767
                    // removed: function ($el) {}                                                                      // 768
                },                                                                                                     // 769
                right: {                                                                                               // 770
                    label: '<span class="fa fa-align-right"></span>',                                                  // 771
                    // added: function ($el) {},                                                                       // 772
                    // removed: function ($el) {}                                                                      // 773
                }                                                                                                      // 774
            },                                                                                                         // 775
            actions: {                                                                                                 // 776
                remove: {                                                                                              // 777
                    label: '<span class="fa fa-times"></span>',                                                        // 778
                    clicked: function () {                                                                             // 779
                        var $event = $.Event('keydown');                                                               // 780
                                                                                                                       // 781
                        $event.which = 8;                                                                              // 782
                        $(document).trigger($event);                                                                   // 783
                    }                                                                                                  // 784
                }                                                                                                      // 785
            }                                                                                                          // 786
        };                                                                                                             // 787
                                                                                                                       // 788
    /**                                                                                                                // 789
     * Embeds object                                                                                                   // 790
     *                                                                                                                 // 791
     * Sets options, variables and calls init() function                                                               // 792
     *                                                                                                                 // 793
     * @constructor                                                                                                    // 794
     * @param {DOM} el - DOM element to init the plugin on                                                             // 795
     * @param {object} options - Options to override defaults                                                          // 796
     * @return {void}                                                                                                  // 797
     */                                                                                                                // 798
                                                                                                                       // 799
    function Embeds (el, options) {                                                                                    // 800
        this.el = el;                                                                                                  // 801
        this.$el = $(el);                                                                                              // 802
        this.templates = window.MediumInsert.Templates;                                                                // 803
        this.core = this.$el.data('plugin_'+ pluginName);                                                              // 804
                                                                                                                       // 805
        this.options = $.extend(true, {}, defaults, options);                                                          // 806
                                                                                                                       // 807
        this._defaults = defaults;                                                                                     // 808
        this._name = pluginName;                                                                                       // 809
                                                                                                                       // 810
        // Extend editor's functions                                                                                   // 811
        if (this.core.getEditor()) {                                                                                   // 812
            this.core.getEditor()._serializePreEmbeds = this.core.getEditor().serialize;                               // 813
            this.core.getEditor().serialize = this.editorSerialize;                                                    // 814
        }                                                                                                              // 815
                                                                                                                       // 816
        this.init();                                                                                                   // 817
    }                                                                                                                  // 818
                                                                                                                       // 819
    /**                                                                                                                // 820
     * Initialization                                                                                                  // 821
     *                                                                                                                 // 822
     * @return {void}                                                                                                  // 823
     */                                                                                                                // 824
                                                                                                                       // 825
    Embeds.prototype.init = function () {                                                                              // 826
        var $embeds = this.$el.find('.medium-insert-embeds');                                                          // 827
                                                                                                                       // 828
        $embeds.attr('contenteditable', false);                                                                        // 829
        $embeds.each(function () {                                                                                     // 830
            if ($(this).find('.medium-insert-embeds-overlay').length === 0) {                                          // 831
                $(this).append($('<div />').addClass('medium-insert-embeds-overlay'));                                 // 832
            }                                                                                                          // 833
        });                                                                                                            // 834
                                                                                                                       // 835
        this.events();                                                                                                 // 836
        this.backwardsCompatibility();                                                                                 // 837
    };                                                                                                                 // 838
                                                                                                                       // 839
    /**                                                                                                                // 840
     * Event listeners                                                                                                 // 841
     *                                                                                                                 // 842
     * @return {void}                                                                                                  // 843
     */                                                                                                                // 844
                                                                                                                       // 845
    Embeds.prototype.events = function () {                                                                            // 846
        $(document)                                                                                                    // 847
            .on('click', $.proxy(this, 'unselectEmbed'))                                                               // 848
            .on('keydown', $.proxy(this, 'removeEmbed'))                                                               // 849
            .on('click', '.medium-insert-embeds-toolbar .medium-editor-action', $.proxy(this, 'toolbarAction'))        // 850
            .on('click', '.medium-insert-embeds-toolbar2 .medium-editor-action', $.proxy(this, 'toolbar2Action'));     // 851
                                                                                                                       // 852
        this.$el                                                                                                       // 853
            .on('keyup click paste', $.proxy(this, 'togglePlaceholder'))                                               // 854
            .on('keydown', $.proxy(this, 'processLink'))                                                               // 855
            .on('click', '.medium-insert-embeds-overlay', $.proxy(this, 'selectEmbed'))                                // 856
            .on('contextmenu', '.medium-insert-embeds-placeholder', $.proxy(this, 'fixRightClickOnPlaceholder'));      // 857
    };                                                                                                                 // 858
                                                                                                                       // 859
    /**                                                                                                                // 860
     * Replace v0.* class names with new ones, wrap embedded content to new structure                                  // 861
     *                                                                                                                 // 862
     * @return {void}                                                                                                  // 863
     */                                                                                                                // 864
                                                                                                                       // 865
    Embeds.prototype.backwardsCompatibility = function () {                                                            // 866
        var that = this;                                                                                               // 867
                                                                                                                       // 868
        this.$el.find('.mediumInsert-embeds')                                                                          // 869
            .removeClass('mediumInsert-embeds')                                                                        // 870
            .addClass('medium-insert-embeds');                                                                         // 871
                                                                                                                       // 872
        this.$el.find('.medium-insert-embeds').each(function () {                                                      // 873
            if ($(this).find('.medium-insert-embed').length === 0) {                                                   // 874
                $(this).after(that.templates['src/js/templates/embeds-wrapper.hbs']({                                  // 875
                    html: $(this).html()                                                                               // 876
                }));                                                                                                   // 877
                $(this).remove();                                                                                      // 878
            }                                                                                                          // 879
        });                                                                                                            // 880
    };                                                                                                                 // 881
                                                                                                                       // 882
    /**                                                                                                                // 883
     * Extend editor's serialize function                                                                              // 884
     *                                                                                                                 // 885
     * @return {object} Serialized data                                                                                // 886
     */                                                                                                                // 887
                                                                                                                       // 888
    Embeds.prototype.editorSerialize = function () {                                                                   // 889
        var data = this._serializePreEmbeds();                                                                         // 890
                                                                                                                       // 891
        $.each(data, function (key) {                                                                                  // 892
            var $data = $('<div />').html(data[key].value);                                                            // 893
                                                                                                                       // 894
            $data.find('.medium-insert-embeds').removeAttr('contenteditable');                                         // 895
            $data.find('.medium-insert-embeds-overlay').remove();                                                      // 896
                                                                                                                       // 897
            data[key].value = $data.html();                                                                            // 898
        });                                                                                                            // 899
                                                                                                                       // 900
        return data;                                                                                                   // 901
    };                                                                                                                 // 902
                                                                                                                       // 903
    /**                                                                                                                // 904
     * Add embedded element                                                                                            // 905
     *                                                                                                                 // 906
     * @return {void}                                                                                                  // 907
     */                                                                                                                // 908
                                                                                                                       // 909
    Embeds.prototype.add = function () {                                                                               // 910
        var $place = this.$el.find('.medium-insert-active');                                                           // 911
                                                                                                                       // 912
        // Fix #132                                                                                                    // 913
        // Make sure that the content of the paragraph is empty and <br> is wrapped in <p></p> to avoid Firefox problems
        $place.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());                                  // 915
                                                                                                                       // 916
        // Replace paragraph with div to prevent #124 issue with pasting in Chrome,                                    // 917
        // because medium editor wraps inserted content into paragraph and paragraphs can't be nested                  // 918
        if ($place.is('p')) {                                                                                          // 919
            $place.replaceWith('<div class="medium-insert-active">'+ $place.html() +'</div>');                         // 920
            $place = this.$el.find('.medium-insert-active');                                                           // 921
            this.core.moveCaret($place);                                                                               // 922
        }                                                                                                              // 923
                                                                                                                       // 924
        $place.addClass('medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active');                // 925
                                                                                                                       // 926
        this.togglePlaceholder({ target: $place.get(0) });                                                             // 927
                                                                                                                       // 928
        $place.click();                                                                                                // 929
        this.core.hideButtons();                                                                                       // 930
    };                                                                                                                 // 931
                                                                                                                       // 932
    /**                                                                                                                // 933
     * Toggles placeholder                                                                                             // 934
     *                                                                                                                 // 935
     * @param {Event} e                                                                                                // 936
     * @return {void}                                                                                                  // 937
     */                                                                                                                // 938
                                                                                                                       // 939
    Embeds.prototype.togglePlaceholder = function (e) {                                                                // 940
        var $place = $(e.target),                                                                                      // 941
            selection = window.getSelection(),                                                                         // 942
            range, $current, text;                                                                                     // 943
                                                                                                                       // 944
        if (!selection || selection.rangeCount === 0) {                                                                // 945
            return;                                                                                                    // 946
        }                                                                                                              // 947
                                                                                                                       // 948
        range = selection.getRangeAt(0);                                                                               // 949
        $current = $(range.commonAncestorContainer);                                                                   // 950
                                                                                                                       // 951
        if ($current.hasClass('medium-insert-embeds-active')) {                                                        // 952
            $place = $current;                                                                                         // 953
        } else if ($current.closest('.medium-insert-embeds-active').length) {                                          // 954
            $place = $current.closest('.medium-insert-embeds-active');                                                 // 955
        }                                                                                                              // 956
                                                                                                                       // 957
        if ($place.hasClass('medium-insert-embeds-active')) {                                                          // 958
                                                                                                                       // 959
            text = $place.text().trim();                                                                               // 960
                                                                                                                       // 961
            if (text === '' && $place.hasClass('medium-insert-embeds-placeholder') === false) {                        // 962
                $place                                                                                                 // 963
                    .addClass('medium-insert-embeds-placeholder')                                                      // 964
                    .attr('data-placeholder', this.options.placeholder);                                               // 965
            } else if (text !== '' && $place.hasClass('medium-insert-embeds-placeholder')) {                           // 966
                $place                                                                                                 // 967
                    .removeClass('medium-insert-embeds-placeholder')                                                   // 968
                    .removeAttr('data-placeholder');                                                                   // 969
            }                                                                                                          // 970
                                                                                                                       // 971
        } else {                                                                                                       // 972
            this.$el.find('.medium-insert-embeds-active').remove();                                                    // 973
        }                                                                                                              // 974
    };                                                                                                                 // 975
                                                                                                                       // 976
    /**                                                                                                                // 977
     * Right click on placeholder in Chrome selects whole line. Fix this by placing caret at the end of line           // 978
     *                                                                                                                 // 979
     * @param {Event} e                                                                                                // 980
     * @return {void}                                                                                                  // 981
     */                                                                                                                // 982
                                                                                                                       // 983
    Embeds.prototype.fixRightClickOnPlaceholder = function (e) {                                                       // 984
        this.core.moveCaret($(e.target));                                                                              // 985
    };                                                                                                                 // 986
                                                                                                                       // 987
    /**                                                                                                                // 988
     * Process link                                                                                                    // 989
     *                                                                                                                 // 990
     * @param {Event} e                                                                                                // 991
     * @return {void}                                                                                                  // 992
     */                                                                                                                // 993
                                                                                                                       // 994
    Embeds.prototype.processLink = function (e) {                                                                      // 995
        var $place = this.$el.find('.medium-insert-embeds-active'),                                                    // 996
            url;                                                                                                       // 997
                                                                                                                       // 998
        if (!$place.length) {                                                                                          // 999
            return;                                                                                                    // 1000
        }                                                                                                              // 1001
                                                                                                                       // 1002
        url = $place.text().trim();                                                                                    // 1003
                                                                                                                       // 1004
        // Return empty placeholder on backspace, delete or enter                                                      // 1005
        if (url === '' && [8, 46, 13].indexOf(e.which) !== -1) {                                                       // 1006
            $place.remove();                                                                                           // 1007
            return;                                                                                                    // 1008
        }                                                                                                              // 1009
                                                                                                                       // 1010
        if (e.which === 13) {                                                                                          // 1011
            e.preventDefault();                                                                                        // 1012
            e.stopPropagation();                                                                                       // 1013
                                                                                                                       // 1014
            if (this.options.oembedProxy) {                                                                            // 1015
                this.oembed(url);                                                                                      // 1016
            } else {                                                                                                   // 1017
                this.parseUrl(url);                                                                                    // 1018
            }                                                                                                          // 1019
        }                                                                                                              // 1020
    };                                                                                                                 // 1021
                                                                                                                       // 1022
    /**                                                                                                                // 1023
     * Get HTML via oEmbed proxy                                                                                       // 1024
     *                                                                                                                 // 1025
     * @param {string} url                                                                                             // 1026
     * @return {void}                                                                                                  // 1027
     */                                                                                                                // 1028
                                                                                                                       // 1029
    Embeds.prototype.oembed = function (url) {                                                                         // 1030
        var that = this;                                                                                               // 1031
                                                                                                                       // 1032
        $.support.cors = true;                                                                                         // 1033
                                                                                                                       // 1034
        $.ajax({                                                                                                       // 1035
            crossDomain: true,                                                                                         // 1036
            cache: false,                                                                                              // 1037
            url: this.options.oembedProxy,                                                                             // 1038
            dataType: 'json',                                                                                          // 1039
            data: {                                                                                                    // 1040
                url: url                                                                                               // 1041
            },                                                                                                         // 1042
            success: function(data) {                                                                                  // 1043
                var html = data && data.html;                                                                          // 1044
                                                                                                                       // 1045
                if (data && !data.html && data.type === 'photo' && data.url) {                                         // 1046
                    html = '<img src="' + data.url + '" alt="">';                                                      // 1047
                }                                                                                                      // 1048
                                                                                                                       // 1049
                $.proxy(that, 'embed', html)();                                                                        // 1050
            },                                                                                                         // 1051
            error: function(jqXHR, textStatus, errorThrown) {                                                          // 1052
                var responseJSON = (function() {                                                                       // 1053
                    try {                                                                                              // 1054
                        return JSON.parse(jqXHR.responseText);                                                         // 1055
                    } catch(e) {}                                                                                      // 1056
                })();                                                                                                  // 1057
                                                                                                                       // 1058
                if (typeof window.console !== 'undefined') {                                                           // 1059
                    window.console.log((responseJSON && responseJSON.error) || jqXHR.status || errorThrown.message);   // 1060
                } else {                                                                                               // 1061
                    window.alert('Error requesting media from ' + that.options.oembedProxy + ' to insert: ' + errorThrown + ' (response status: ' + jqXHR.status + ')');
                }                                                                                                      // 1063
                                                                                                                       // 1064
                $.proxy(that, 'convertBadEmbed', url)();                                                               // 1065
            }                                                                                                          // 1066
        });                                                                                                            // 1067
    };                                                                                                                 // 1068
                                                                                                                       // 1069
    /**                                                                                                                // 1070
     * Get HTML using regexp                                                                                           // 1071
     *                                                                                                                 // 1072
     * @param {string} url                                                                                             // 1073
     * @return {void}                                                                                                  // 1074
     */                                                                                                                // 1075
                                                                                                                       // 1076
    Embeds.prototype.parseUrl = function (url) {                                                                       // 1077
        var html;                                                                                                      // 1078
                                                                                                                       // 1079
        if (!(new RegExp(['youtube', 'youtu.be', 'vimeo', 'instagram'].join('|')).test(url))) {                        // 1080
            $.proxy(this, 'convertBadEmbed', url)();                                                                   // 1081
            return false;                                                                                              // 1082
        }                                                                                                              // 1083
                                                                                                                       // 1084
        html = url.replace(/\n?/g, '')                                                                                 // 1085
            .replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/, '<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>')
            .replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/, '<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>')
            //.replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/, '<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>')
            //.replace(/^https:\/\/www\.facebook\.com\/(video.php|photo.php)\?v=(\d+).+$/, '<div class="fb-post" data-href="https://www.facebook.com/photo.php?v=$2"><div class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/photo.php?v=$2">Post</a></div></div>')
            .replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/, '<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>');
                                                                                                                       // 1091
                                                                                                                       // 1092
        this.embed((/<("[^"]*"|'[^']*'|[^'">])*>/).test(html) ? html : false);                                         // 1093
    };                                                                                                                 // 1094
                                                                                                                       // 1095
    /**                                                                                                                // 1096
     * Add html to page                                                                                                // 1097
     *                                                                                                                 // 1098
     * @param {string} html                                                                                            // 1099
     * @return {void}                                                                                                  // 1100
     */                                                                                                                // 1101
                                                                                                                       // 1102
    Embeds.prototype.embed = function (html) {                                                                         // 1103
        var $place = this.$el.find('.medium-insert-embeds-active');                                                    // 1104
                                                                                                                       // 1105
        if (!html) {                                                                                                   // 1106
            alert('Incorrect URL format specified');                                                                   // 1107
            return false;                                                                                              // 1108
        } else {                                                                                                       // 1109
            $place.after(this.templates['src/js/templates/embeds-wrapper.hbs']({                                       // 1110
                html: html                                                                                             // 1111
            }));                                                                                                       // 1112
            $place.remove();                                                                                           // 1113
                                                                                                                       // 1114
            this.$el.trigger('input');                                                                                 // 1115
                                                                                                                       // 1116
            if (html.indexOf('facebook') !== -1) {                                                                     // 1117
                if (typeof(FB) !== 'undefined') {                                                                      // 1118
                    setTimeout(function () {                                                                           // 1119
                        FB.XFBML.parse();                                                                              // 1120
                    }, 2000);                                                                                          // 1121
                }                                                                                                      // 1122
            }                                                                                                          // 1123
        }                                                                                                              // 1124
    };                                                                                                                 // 1125
                                                                                                                       // 1126
    /**                                                                                                                // 1127
     * Convert bad oEmbed content to an actual line.                                                                   // 1128
     * Instead of displaying the error message we convert the bad embed                                                // 1129
     *                                                                                                                 // 1130
     * @param {string} content Bad content                                                                             // 1131
     *                                                                                                                 // 1132
     * @return {void}                                                                                                  // 1133
     */                                                                                                                // 1134
    Embeds.prototype.convertBadEmbed = function (content) {                                                            // 1135
        var $place, $empty, $content,                                                                                  // 1136
            emptyTemplate = this.templates['src/js/templates/core-empty-line.hbs']().trim();                           // 1137
                                                                                                                       // 1138
        $place = this.$el.find('.medium-insert-embeds-active');                                                        // 1139
                                                                                                                       // 1140
        // convert embed node to an empty node and insert the bad embed inside                                         // 1141
        $content = $(emptyTemplate);                                                                                   // 1142
        $place.before($content);                                                                                       // 1143
        $place.remove();                                                                                               // 1144
        $content.html(content);                                                                                        // 1145
                                                                                                                       // 1146
        // add an new empty node right after to simulate Enter press                                                   // 1147
        $empty = $(emptyTemplate);                                                                                     // 1148
        $content.after($empty);                                                                                        // 1149
                                                                                                                       // 1150
        this.$el.trigger('input');                                                                                     // 1151
                                                                                                                       // 1152
        this.core.moveCaret($place);                                                                                   // 1153
    };                                                                                                                 // 1154
                                                                                                                       // 1155
    /**                                                                                                                // 1156
     * Select clicked embed                                                                                            // 1157
     *                                                                                                                 // 1158
     * @param {Event} e                                                                                                // 1159
     * @returns {void}                                                                                                 // 1160
     */                                                                                                                // 1161
                                                                                                                       // 1162
    Embeds.prototype.selectEmbed = function (e) {                                                                      // 1163
        if(this.core.options.enabled) {                                                                                // 1164
            var $embed = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds'),
                that = this;                                                                                           // 1166
                                                                                                                       // 1167
            $embed.addClass('medium-insert-embeds-selected');                                                          // 1168
                                                                                                                       // 1169
            setTimeout(function () {                                                                                   // 1170
                that.addToolbar();                                                                                     // 1171
                                                                                                                       // 1172
                if (that.options.captions) {                                                                           // 1173
                    that.core.addCaption($embed.find('figure'), that.options.captionPlaceholder);                      // 1174
                }                                                                                                      // 1175
            }, 50);                                                                                                    // 1176
        }                                                                                                              // 1177
    };                                                                                                                 // 1178
                                                                                                                       // 1179
    /**                                                                                                                // 1180
     * Unselect selected embed                                                                                         // 1181
     *                                                                                                                 // 1182
     * @param {Event} e                                                                                                // 1183
     * @returns {void}                                                                                                 // 1184
     */                                                                                                                // 1185
                                                                                                                       // 1186
    Embeds.prototype.unselectEmbed = function (e) {                                                                    // 1187
        var $el = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds'),
            $embed = this.$el.find('.medium-insert-embeds-selected');                                                  // 1189
                                                                                                                       // 1190
        if ($el.hasClass('medium-insert-embeds-selected')) {                                                           // 1191
            $embed.not($el).removeClass('medium-insert-embeds-selected');                                              // 1192
            $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                               // 1193
            this.core.removeCaptions($el.find('figcaption'));                                                          // 1194
                                                                                                                       // 1195
            if ($(e.target).is('.medium-insert-caption-placeholder') || $(e.target).is('figcaption')) {                // 1196
                $el.removeClass('medium-insert-embeds-selected');                                                      // 1197
                this.core.removeCaptionPlaceholder($el.find('figure'));                                                // 1198
            }                                                                                                          // 1199
            return;                                                                                                    // 1200
        }                                                                                                              // 1201
                                                                                                                       // 1202
        $embed.removeClass('medium-insert-embeds-selected');                                                           // 1203
        $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                                   // 1204
                                                                                                                       // 1205
        if ($(e.target).is('.medium-insert-caption-placeholder')) {                                                    // 1206
            this.core.removeCaptionPlaceholder($el.find('figure'));                                                    // 1207
        } else if ($(e.target).is('figcaption') === false) {                                                           // 1208
            this.core.removeCaptions();                                                                                // 1209
        }                                                                                                              // 1210
    };                                                                                                                 // 1211
                                                                                                                       // 1212
    /**                                                                                                                // 1213
     * Remove embed                                                                                                    // 1214
     *                                                                                                                 // 1215
     * @param {Event} e                                                                                                // 1216
     * @returns {void}                                                                                                 // 1217
     */                                                                                                                // 1218
                                                                                                                       // 1219
    Embeds.prototype.removeEmbed = function (e) {                                                                      // 1220
        var $embed, $empty;                                                                                            // 1221
                                                                                                                       // 1222
        if (e.which === 8 || e.which === 46) {                                                                         // 1223
            $embed = this.$el.find('.medium-insert-embeds-selected');                                                  // 1224
                                                                                                                       // 1225
            if ($embed.length) {                                                                                       // 1226
                e.preventDefault();                                                                                    // 1227
                                                                                                                       // 1228
                $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();                           // 1229
                                                                                                                       // 1230
                $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());                           // 1231
                $embed.before($empty);                                                                                 // 1232
                $embed.remove();                                                                                       // 1233
                                                                                                                       // 1234
                // Hide addons                                                                                         // 1235
                this.core.hideAddons();                                                                                // 1236
                                                                                                                       // 1237
                this.core.moveCaret($empty);                                                                           // 1238
                this.$el.trigger('input');                                                                             // 1239
            }                                                                                                          // 1240
        }                                                                                                              // 1241
    };                                                                                                                 // 1242
                                                                                                                       // 1243
    /**                                                                                                                // 1244
     * Adds embed toolbar to editor                                                                                    // 1245
     *                                                                                                                 // 1246
     * @returns {void}                                                                                                 // 1247
     */                                                                                                                // 1248
                                                                                                                       // 1249
    Embeds.prototype.addToolbar = function () {                                                                        // 1250
        var $embed = this.$el.find('.medium-insert-embeds-selected'),                                                  // 1251
            active = false,                                                                                            // 1252
            $toolbar, $toolbar2, top;                                                                                  // 1253
                                                                                                                       // 1254
        if ($embed.length === 0) {                                                                                     // 1255
            return;                                                                                                    // 1256
        }                                                                                                              // 1257
                                                                                                                       // 1258
        $('body').append(this.templates['src/js/templates/embeds-toolbar.hbs']({                                       // 1259
            styles: this.options.styles,                                                                               // 1260
            actions: this.options.actions                                                                              // 1261
        }).trim());                                                                                                    // 1262
                                                                                                                       // 1263
        $toolbar = $('.medium-insert-embeds-toolbar');                                                                 // 1264
        $toolbar2 = $('.medium-insert-embeds-toolbar2');                                                               // 1265
                                                                                                                       // 1266
        top = $embed.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an embed outset, 5px - distance from an embed
        if (top < 0) {                                                                                                 // 1268
            top = 0;                                                                                                   // 1269
        }                                                                                                              // 1270
                                                                                                                       // 1271
        $toolbar                                                                                                       // 1272
            .css({                                                                                                     // 1273
                top: top,                                                                                              // 1274
                left: $embed.offset().left + $embed.width() / 2 - $toolbar.width() / 2                                 // 1275
            })                                                                                                         // 1276
            .show();                                                                                                   // 1277
                                                                                                                       // 1278
        $toolbar2                                                                                                      // 1279
            .css({                                                                                                     // 1280
                top: $embed.offset().top + 2, // 2px - distance from a border                                          // 1281
                left: $embed.offset().left + $embed.width() - $toolbar2.width() - 4 // 4px - distance from a border    // 1282
            })                                                                                                         // 1283
            .show();                                                                                                   // 1284
                                                                                                                       // 1285
        $toolbar.find('button').each(function () {                                                                     // 1286
            if ($embed.hasClass('medium-insert-embeds-'+ $(this).data('action'))) {                                    // 1287
                $(this).addClass('medium-editor-button-active');                                                       // 1288
                active = true;                                                                                         // 1289
            }                                                                                                          // 1290
        });                                                                                                            // 1291
                                                                                                                       // 1292
        if (active === false) {                                                                                        // 1293
            $toolbar.find('button').first().addClass('medium-editor-button-active');                                   // 1294
        }                                                                                                              // 1295
    };                                                                                                                 // 1296
                                                                                                                       // 1297
    /**                                                                                                                // 1298
     * Fires toolbar action                                                                                            // 1299
     *                                                                                                                 // 1300
     * @param {Event} e                                                                                                // 1301
     * @returns {void}                                                                                                 // 1302
     */                                                                                                                // 1303
                                                                                                                       // 1304
    Embeds.prototype.toolbarAction = function (e) {                                                                    // 1305
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1306
            $li = $button.closest('li'),                                                                               // 1307
            $ul = $li.closest('ul'),                                                                                   // 1308
            $lis = $ul.find('li'),                                                                                     // 1309
            $embed = this.$el.find('.medium-insert-embeds-selected'),                                                  // 1310
            that = this;                                                                                               // 1311
                                                                                                                       // 1312
        $button.addClass('medium-editor-button-active');                                                               // 1313
        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');                // 1314
                                                                                                                       // 1315
        $lis.find('button').each(function () {                                                                         // 1316
            var className = 'medium-insert-embeds-'+ $(this).data('action');                                           // 1317
                                                                                                                       // 1318
            if ($(this).hasClass('medium-editor-button-active')) {                                                     // 1319
                $embed.addClass(className);                                                                            // 1320
                                                                                                                       // 1321
                if (that.options.styles[$(this).data('action')].added) {                                               // 1322
                    that.options.styles[$(this).data('action')].added($embed);                                         // 1323
                }                                                                                                      // 1324
            } else {                                                                                                   // 1325
                $embed.removeClass(className);                                                                         // 1326
                                                                                                                       // 1327
                if (that.options.styles[$(this).data('action')].removed) {                                             // 1328
                    that.options.styles[$(this).data('action')].removed($embed);                                       // 1329
                }                                                                                                      // 1330
            }                                                                                                          // 1331
        });                                                                                                            // 1332
                                                                                                                       // 1333
        this.$el.trigger('input');                                                                                     // 1334
    };                                                                                                                 // 1335
                                                                                                                       // 1336
    /**                                                                                                                // 1337
     * Fires toolbar2 action                                                                                           // 1338
     *                                                                                                                 // 1339
     * @param {Event} e                                                                                                // 1340
     * @returns {void}                                                                                                 // 1341
     */                                                                                                                // 1342
                                                                                                                       // 1343
    Embeds.prototype.toolbar2Action = function (e) {                                                                   // 1344
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1345
            callback = this.options.actions[$button.data('action')].clicked;                                           // 1346
                                                                                                                       // 1347
        if (callback) {                                                                                                // 1348
            callback(this.$el.find('.medium-insert-embeds-selected'));                                                 // 1349
        }                                                                                                              // 1350
                                                                                                                       // 1351
        this.$el.trigger('input');                                                                                     // 1352
    };                                                                                                                 // 1353
                                                                                                                       // 1354
    /** Plugin initialization */                                                                                       // 1355
                                                                                                                       // 1356
    $.fn[pluginName + addonName] = function (options) {                                                                // 1357
        return this.each(function () {                                                                                 // 1358
            if (!$.data(this, 'plugin_' + pluginName + addonName)) {                                                   // 1359
                $.data(this, 'plugin_' + pluginName + addonName, new Embeds(this, options));                           // 1360
            }                                                                                                          // 1361
        });                                                                                                            // 1362
    };                                                                                                                 // 1363
                                                                                                                       // 1364
})(jQuery, window, document);                                                                                          // 1365
                                                                                                                       // 1366
/*global MediumEditor*/                                                                                                // 1367
                                                                                                                       // 1368
;(function ($, window, document, Util, undefined) {                                                                    // 1369
                                                                                                                       // 1370
    'use strict';                                                                                                      // 1371
                                                                                                                       // 1372
    /** Default values */                                                                                              // 1373
    var pluginName = 'mediumInsert',                                                                                   // 1374
        addonName = 'Images', // first char is uppercase                                                               // 1375
        defaults = {                                                                                                   // 1376
            label: '<span class="fa fa-camera"></span>',                                                               // 1377
            deleteScript: 'delete.php',                                                                                // 1378
            preview: true,                                                                                             // 1379
            captions: true,                                                                                            // 1380
            captionPlaceholder: 'Type caption for image (optional)',                                                   // 1381
            autoGrid: 3,                                                                                               // 1382
            fileUploadOptions: { // See https://github.com/blueimp/jQuery-File-Upload/wiki/Options                     // 1383
                url: 'upload.php',                                                                                     // 1384
                acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i                                                            // 1385
            },                                                                                                         // 1386
            styles: {                                                                                                  // 1387
                wide: {                                                                                                // 1388
                    label: '<span class="fa fa-align-justify"></span>',                                                // 1389
                    // added: function ($el) {},                                                                       // 1390
                    // removed: function ($el) {}                                                                      // 1391
                },                                                                                                     // 1392
                left: {                                                                                                // 1393
                    label: '<span class="fa fa-align-left"></span>',                                                   // 1394
                    // added: function ($el) {},                                                                       // 1395
                    // removed: function ($el) {}                                                                      // 1396
                },                                                                                                     // 1397
                right: {                                                                                               // 1398
                    label: '<span class="fa fa-align-right"></span>',                                                  // 1399
                    // added: function ($el) {},                                                                       // 1400
                    // removed: function ($el) {}                                                                      // 1401
                },                                                                                                     // 1402
                grid: {                                                                                                // 1403
                    label: '<span class="fa fa-th"></span>',                                                           // 1404
                    // added: function ($el) {},                                                                       // 1405
                    // removed: function ($el) {}                                                                      // 1406
                }                                                                                                      // 1407
            },                                                                                                         // 1408
            actions: {                                                                                                 // 1409
                remove: {                                                                                              // 1410
                    label: '<span class="fa fa-times"></span>',                                                        // 1411
                    clicked: function () {                                                                             // 1412
                        var $event = $.Event('keydown');                                                               // 1413
                                                                                                                       // 1414
                        $event.which = 8;                                                                              // 1415
                        $(document).trigger($event);                                                                   // 1416
                    }                                                                                                  // 1417
                }                                                                                                      // 1418
            },                                                                                                         // 1419
            sorting: function () {                                                                                     // 1420
                var that = this;                                                                                       // 1421
                                                                                                                       // 1422
                $('.medium-insert-images').sortable({                                                                  // 1423
                    group: 'medium-insert-images',                                                                     // 1424
                    containerSelector: '.medium-insert-images',                                                        // 1425
                    itemSelector: 'figure',                                                                            // 1426
                    placeholder: '<figure class="placeholder">',                                                       // 1427
                    handle: 'img',                                                                                     // 1428
                    nested: false,                                                                                     // 1429
                    vertical: false,                                                                                   // 1430
                    afterMove: function () {                                                                           // 1431
                        that.$el.trigger('input');                                                                     // 1432
                    }                                                                                                  // 1433
                });                                                                                                    // 1434
            },                                                                                                         // 1435
            messages: {                                                                                                // 1436
                acceptFileTypesError: 'This file is not in a supported format: ',                                      // 1437
                maxFileSizeError: 'This file is too big: '                                                             // 1438
            }                                                                                                          // 1439
            // uploadCompleted: function ($el, data) {}                                                                // 1440
        };                                                                                                             // 1441
                                                                                                                       // 1442
    /**                                                                                                                // 1443
     * Images object                                                                                                   // 1444
     *                                                                                                                 // 1445
     * Sets options, variables and calls init() function                                                               // 1446
     *                                                                                                                 // 1447
     * @constructor                                                                                                    // 1448
     * @param {DOM} el - DOM element to init the plugin on                                                             // 1449
     * @param {object} options - Options to override defaults                                                          // 1450
     * @return {void}                                                                                                  // 1451
     */                                                                                                                // 1452
                                                                                                                       // 1453
    function Images (el, options) {                                                                                    // 1454
        this.el = el;                                                                                                  // 1455
        this.$el = $(el);                                                                                              // 1456
        this.templates = window.MediumInsert.Templates;                                                                // 1457
        this.core = this.$el.data('plugin_'+ pluginName);                                                              // 1458
                                                                                                                       // 1459
        this.options = $.extend(true, {}, defaults, options);                                                          // 1460
                                                                                                                       // 1461
        this._defaults = defaults;                                                                                     // 1462
        this._name = pluginName;                                                                                       // 1463
                                                                                                                       // 1464
        // Allow image preview only in browsers, that support's that                                                   // 1465
        if (this.options.preview && !window.FileReader) {                                                              // 1466
            this.options.preview = false;                                                                              // 1467
        }                                                                                                              // 1468
                                                                                                                       // 1469
        // Extend editor's functions                                                                                   // 1470
        if (this.core.getEditor()) {                                                                                   // 1471
            this.core.getEditor()._serializePreImages = this.core.getEditor().serialize;                               // 1472
            this.core.getEditor().serialize = this.editorSerialize;                                                    // 1473
        }                                                                                                              // 1474
                                                                                                                       // 1475
        this.init();                                                                                                   // 1476
    }                                                                                                                  // 1477
                                                                                                                       // 1478
    /**                                                                                                                // 1479
     * Initialization                                                                                                  // 1480
     *                                                                                                                 // 1481
     * @return {void}                                                                                                  // 1482
     */                                                                                                                // 1483
                                                                                                                       // 1484
    Images.prototype.init = function () {                                                                              // 1485
        var $images = this.$el.find('.medium-insert-images');                                                          // 1486
                                                                                                                       // 1487
        $images.find('figcaption').attr('contenteditable', true);                                                      // 1488
        $images.find('figure').attr('contenteditable', false);                                                         // 1489
                                                                                                                       // 1490
        this.events();                                                                                                 // 1491
        this.backwardsCompatibility();                                                                                 // 1492
        this.sorting();                                                                                                // 1493
    };                                                                                                                 // 1494
                                                                                                                       // 1495
    /**                                                                                                                // 1496
     * Event listeners                                                                                                 // 1497
     *                                                                                                                 // 1498
     * @return {void}                                                                                                  // 1499
     */                                                                                                                // 1500
                                                                                                                       // 1501
    Images.prototype.events = function () {                                                                            // 1502
        $(document)                                                                                                    // 1503
            .on('click', $.proxy(this, 'unselectImage'))                                                               // 1504
            .on('keydown', $.proxy(this, 'removeImage'))                                                               // 1505
            .on('click', '.medium-insert-images-toolbar .medium-editor-action', $.proxy(this, 'toolbarAction'))        // 1506
            .on('click', '.medium-insert-images-toolbar2 .medium-editor-action', $.proxy(this, 'toolbar2Action'));     // 1507
                                                                                                                       // 1508
        this.$el                                                                                                       // 1509
            .on('click', '.medium-insert-images img', $.proxy(this, 'selectImage'));                                   // 1510
    };                                                                                                                 // 1511
                                                                                                                       // 1512
    /**                                                                                                                // 1513
     * Replace v0.* class names with new ones                                                                          // 1514
     *                                                                                                                 // 1515
     * @return {void}                                                                                                  // 1516
     */                                                                                                                // 1517
                                                                                                                       // 1518
    Images.prototype.backwardsCompatibility = function () {                                                            // 1519
        this.$el.find('.mediumInsert')                                                                                 // 1520
            .removeClass('mediumInsert')                                                                               // 1521
            .addClass('medium-insert-images');                                                                         // 1522
                                                                                                                       // 1523
        this.$el.find('.medium-insert-images.small')                                                                   // 1524
            .removeClass('small')                                                                                      // 1525
            .addClass('medium-insert-images-left');                                                                    // 1526
    };                                                                                                                 // 1527
                                                                                                                       // 1528
    /**                                                                                                                // 1529
     * Extend editor's serialize function                                                                              // 1530
     *                                                                                                                 // 1531
     * @return {object} Serialized data                                                                                // 1532
     */                                                                                                                // 1533
                                                                                                                       // 1534
    Images.prototype.editorSerialize = function () {                                                                   // 1535
        var data = this._serializePreImages();                                                                         // 1536
                                                                                                                       // 1537
        $.each(data, function (key) {                                                                                  // 1538
            var $data = $('<div />').html(data[key].value);                                                            // 1539
                                                                                                                       // 1540
            $data.find('.medium-insert-images').find('figcaption, figure').removeAttr('contenteditable');              // 1541
                                                                                                                       // 1542
            data[key].value = $data.html();                                                                            // 1543
        });                                                                                                            // 1544
                                                                                                                       // 1545
        return data;                                                                                                   // 1546
    };                                                                                                                 // 1547
                                                                                                                       // 1548
    /**                                                                                                                // 1549
     * Add image                                                                                                       // 1550
     *                                                                                                                 // 1551
     * @return {void}                                                                                                  // 1552
     */                                                                                                                // 1553
                                                                                                                       // 1554
    Images.prototype.add = function () {                                                                               // 1555
        var that = this,                                                                                               // 1556
            $file = $(this.templates['src/js/templates/images-fileupload.hbs']()),                                     // 1557
            fileUploadOptions = {                                                                                      // 1558
                dataType: 'json',                                                                                      // 1559
                add: function (e, data) {                                                                              // 1560
                    $.proxy(that, 'uploadAdd', e, data)();                                                             // 1561
                },                                                                                                     // 1562
                done: function (e, data) {                                                                             // 1563
                    $.proxy(that, 'uploadDone', e, data)();                                                            // 1564
                }                                                                                                      // 1565
            };                                                                                                         // 1566
                                                                                                                       // 1567
        // Only add progress callbacks for browsers that support XHR2,                                                 // 1568
        // and test for XHR2 per:                                                                                      // 1569
        // http://stackoverflow.com/questions/6767887/                                                                 // 1570
        // what-is-the-best-way-to-check-for-xhr2-file-upload-support                                                  // 1571
        if (new XMLHttpRequest().upload) {                                                                             // 1572
            fileUploadOptions.progress = function (e, data) {                                                          // 1573
                $.proxy(that, 'uploadProgress', e, data)();                                                            // 1574
            };                                                                                                         // 1575
                                                                                                                       // 1576
            fileUploadOptions.progressall = function (e, data) {                                                       // 1577
                $.proxy(that, 'uploadProgressall', e, data)();                                                         // 1578
            };                                                                                                         // 1579
        }                                                                                                              // 1580
                                                                                                                       // 1581
        $file.fileupload($.extend(true, {}, this.options.fileUploadOptions, fileUploadOptions));                       // 1582
                                                                                                                       // 1583
        $file.click();                                                                                                 // 1584
    };                                                                                                                 // 1585
                                                                                                                       // 1586
    /**                                                                                                                // 1587
     * Callback invoked as soon as files are added to the fileupload widget - via file input selection, drag & drop or add API call.
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#add                                                  // 1589
     *                                                                                                                 // 1590
     * @param {Event} e                                                                                                // 1591
     * @param {object} data                                                                                            // 1592
     * @return {void}                                                                                                  // 1593
     */                                                                                                                // 1594
                                                                                                                       // 1595
    Images.prototype.uploadAdd = function (e, data) {                                                                  // 1596
        var $place = this.$el.find('.medium-insert-active'),                                                           // 1597
            that = this,                                                                                               // 1598
            uploadErrors = [],                                                                                         // 1599
            file = data.files[0],                                                                                      // 1600
            acceptFileTypes = this.options.fileUploadOptions.acceptFileTypes,                                          // 1601
            maxFileSize = this.options.fileUploadOptions.maxFileSize,                                                  // 1602
            reader;                                                                                                    // 1603
                                                                                                                       // 1604
        if (acceptFileTypes && !acceptFileTypes.test(file['type'])) {                                                  // 1605
            uploadErrors.push(this.options.messages.acceptFileTypesError + file['name']);                              // 1606
        } else if (maxFileSize && file['size'] > maxFileSize) {                                                        // 1607
            uploadErrors.push(this.options.messages.maxFileSizeError + file['name']);                                  // 1608
        }                                                                                                              // 1609
        if (uploadErrors.length > 0) {                                                                                 // 1610
            alert(uploadErrors.join("\n"));                                                                            // 1611
            return;                                                                                                    // 1612
        }                                                                                                              // 1613
                                                                                                                       // 1614
        this.core.hideButtons();                                                                                       // 1615
                                                                                                                       // 1616
        // Replace paragraph with div, because figure elements can't be inside paragraph                               // 1617
        if ($place.is('p')) {                                                                                          // 1618
            $place.replaceWith('<div class="medium-insert-active">'+ $place.html() +'</div>');                         // 1619
            $place = this.$el.find('.medium-insert-active');                                                           // 1620
            this.core.moveCaret($place);                                                                               // 1621
        }                                                                                                              // 1622
                                                                                                                       // 1623
        $place.addClass('medium-insert-images');                                                                       // 1624
                                                                                                                       // 1625
        if (this.options.preview === false && $place.find('progress').length === 0 && (new XMLHttpRequest().upload)) {
            $place.append(this.templates['src/js/templates/images-progressbar.hbs']());                                // 1627
        }                                                                                                              // 1628
                                                                                                                       // 1629
        if (data.autoUpload || (data.autoUpload !== false && $(e.target).fileupload('option', 'autoUpload'))) {        // 1630
            data.process().done(function () {                                                                          // 1631
                // If preview is set to true, let the showImage handle the upload start                                // 1632
                if (that.options.preview) {                                                                            // 1633
                    reader = new FileReader();                                                                         // 1634
                                                                                                                       // 1635
                    reader.onload = function (e) {                                                                     // 1636
                        $.proxy(that, 'showImage', e.target.result, data)();                                           // 1637
                    };                                                                                                 // 1638
                                                                                                                       // 1639
                    reader.readAsDataURL(data.files[0]);                                                               // 1640
                } else {                                                                                               // 1641
                    data.submit();                                                                                     // 1642
                }                                                                                                      // 1643
            });                                                                                                        // 1644
        }                                                                                                              // 1645
    };                                                                                                                 // 1646
                                                                                                                       // 1647
    /**                                                                                                                // 1648
     * Callback for global upload progress events                                                                      // 1649
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progressall                                          // 1650
     *                                                                                                                 // 1651
     * @param {Event} e                                                                                                // 1652
     * @param {object} data                                                                                            // 1653
     * @return {void}                                                                                                  // 1654
     */                                                                                                                // 1655
                                                                                                                       // 1656
    Images.prototype.uploadProgressall = function (e, data) {                                                          // 1657
        var progress, $progressbar;                                                                                    // 1658
                                                                                                                       // 1659
        if (this.options.preview === false) {                                                                          // 1660
            progress = parseInt(data.loaded / data.total * 100, 10);                                                   // 1661
            $progressbar = this.$el.find('.medium-insert-active').find('progress');                                    // 1662
                                                                                                                       // 1663
            $progressbar                                                                                               // 1664
                .attr('value', progress)                                                                               // 1665
                .text(progress);                                                                                       // 1666
                                                                                                                       // 1667
            if (progress === 100) {                                                                                    // 1668
                $progressbar.remove();                                                                                 // 1669
            }                                                                                                          // 1670
        }                                                                                                              // 1671
    };                                                                                                                 // 1672
                                                                                                                       // 1673
    /**                                                                                                                // 1674
     * Callback for upload progress events.                                                                            // 1675
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progress                                             // 1676
     *                                                                                                                 // 1677
     * @param {Event} e                                                                                                // 1678
     * @param {object} data                                                                                            // 1679
     * @return {void}                                                                                                  // 1680
     */                                                                                                                // 1681
                                                                                                                       // 1682
    Images.prototype.uploadProgress = function (e, data) {                                                             // 1683
        var progress, $progressbar;                                                                                    // 1684
                                                                                                                       // 1685
        if (this.options.preview) {                                                                                    // 1686
            progress = 100 - parseInt(data.loaded / data.total * 100, 10);                                             // 1687
            $progressbar = data.context.find('.medium-insert-images-progress');                                        // 1688
                                                                                                                       // 1689
            $progressbar.css('width', progress +'%');                                                                  // 1690
                                                                                                                       // 1691
            if (progress === 0) {                                                                                      // 1692
                $progressbar.remove();                                                                                 // 1693
            }                                                                                                          // 1694
        }                                                                                                              // 1695
    };                                                                                                                 // 1696
                                                                                                                       // 1697
    /**                                                                                                                // 1698
     * Callback for successful upload requests.                                                                        // 1699
     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#done                                                 // 1700
     *                                                                                                                 // 1701
     * @param {Event} e                                                                                                // 1702
     * @param {object} data                                                                                            // 1703
     * @return {void}                                                                                                  // 1704
     */                                                                                                                // 1705
                                                                                                                       // 1706
    Images.prototype.uploadDone = function (e, data) {                                                                 // 1707
        var $el = $.proxy(this, 'showImage', data.result.files[0].url, data)();                                        // 1708
                                                                                                                       // 1709
        this.core.clean();                                                                                             // 1710
        this.sorting();                                                                                                // 1711
                                                                                                                       // 1712
        if (this.options.uploadCompleted) {                                                                            // 1713
            this.options.uploadCompleted($el, data);                                                                   // 1714
        }                                                                                                              // 1715
    };                                                                                                                 // 1716
                                                                                                                       // 1717
    /**                                                                                                                // 1718
     * Add uploaded / preview image to DOM                                                                             // 1719
     *                                                                                                                 // 1720
     * @param {string} img                                                                                             // 1721
     * @returns {void}                                                                                                 // 1722
     */                                                                                                                // 1723
                                                                                                                       // 1724
    Images.prototype.showImage = function (img, data) {                                                                // 1725
        var $place = this.$el.find('.medium-insert-active'),                                                           // 1726
            domImage,                                                                                                  // 1727
            that;                                                                                                      // 1728
                                                                                                                       // 1729
        // Hide editor's placeholder                                                                                   // 1730
        $place.click();                                                                                                // 1731
                                                                                                                       // 1732
        // If preview is allowed and preview image already exists,                                                     // 1733
        // replace it with uploaded image                                                                              // 1734
        that = this;                                                                                                   // 1735
        if (this.options.preview && data.context) {                                                                    // 1736
            domImage = this.getDOMImage();                                                                             // 1737
            domImage.onload = function () {                                                                            // 1738
                data.context.find('img').attr('src', domImage.src);                                                    // 1739
                that.$el.trigger('input');                                                                             // 1740
            };                                                                                                         // 1741
            domImage.src = img;                                                                                        // 1742
        } else {                                                                                                       // 1743
            data.context = $(this.templates['src/js/templates/images-image.hbs']({                                     // 1744
                img: img,                                                                                              // 1745
                progress: this.options.preview                                                                         // 1746
            })).appendTo($place);                                                                                      // 1747
                                                                                                                       // 1748
            $place.find('br').remove();                                                                                // 1749
                                                                                                                       // 1750
            if (this.options.autoGrid && $place.find('figure').length >= this.options.autoGrid) {                      // 1751
                $.each(this.options.styles, function (style, options) {                                                // 1752
                    var className = 'medium-insert-images-'+ style;                                                    // 1753
                                                                                                                       // 1754
                    $place.removeClass(className);                                                                     // 1755
                                                                                                                       // 1756
                    if (options.removed) {                                                                             // 1757
                        options.removed($place);                                                                       // 1758
                    }                                                                                                  // 1759
                });                                                                                                    // 1760
                                                                                                                       // 1761
                $place.addClass('medium-insert-images-grid');                                                          // 1762
                                                                                                                       // 1763
                if (this.options.styles.grid.added) {                                                                  // 1764
                    this.options.styles.grid.added($place);                                                            // 1765
                }                                                                                                      // 1766
            }                                                                                                          // 1767
                                                                                                                       // 1768
            if (this.options.preview) {                                                                                // 1769
                data.submit();                                                                                         // 1770
            }                                                                                                          // 1771
        }                                                                                                              // 1772
                                                                                                                       // 1773
        this.$el.trigger('input');                                                                                     // 1774
                                                                                                                       // 1775
        return data.context;                                                                                           // 1776
    };                                                                                                                 // 1777
                                                                                                                       // 1778
    Images.prototype.getDOMImage = function () {                                                                       // 1779
        return new window.Image();                                                                                     // 1780
    };                                                                                                                 // 1781
                                                                                                                       // 1782
    /**                                                                                                                // 1783
     * Select clicked image                                                                                            // 1784
     *                                                                                                                 // 1785
     * @param {Event} e                                                                                                // 1786
     * @returns {void}                                                                                                 // 1787
     */                                                                                                                // 1788
                                                                                                                       // 1789
    Images.prototype.selectImage = function (e) {                                                                      // 1790
        if(this.core.options.enabled) {                                                                                // 1791
            var $image = $(e.target),                                                                                  // 1792
                that = this;                                                                                           // 1793
                                                                                                                       // 1794
            // Hide keyboard on mobile devices                                                                         // 1795
            this.$el.blur();                                                                                           // 1796
                                                                                                                       // 1797
            $image.addClass('medium-insert-image-active');                                                             // 1798
            $image.closest('.medium-insert-images').addClass('medium-insert-active');                                  // 1799
                                                                                                                       // 1800
            setTimeout(function () {                                                                                   // 1801
                that.addToolbar();                                                                                     // 1802
                                                                                                                       // 1803
                if (that.options.captions) {                                                                           // 1804
                    that.core.addCaption($image.closest('figure'), that.options.captionPlaceholder);                   // 1805
                }                                                                                                      // 1806
            }, 50);                                                                                                    // 1807
        }                                                                                                              // 1808
    };                                                                                                                 // 1809
                                                                                                                       // 1810
    /**                                                                                                                // 1811
     * Unselect selected image                                                                                         // 1812
     *                                                                                                                 // 1813
     * @param {Event} e                                                                                                // 1814
     * @returns {void}                                                                                                 // 1815
     */                                                                                                                // 1816
                                                                                                                       // 1817
    Images.prototype.unselectImage = function (e) {                                                                    // 1818
        var $el = $(e.target),                                                                                         // 1819
            $image = this.$el.find('.medium-insert-image-active');                                                     // 1820
                                                                                                                       // 1821
        if ($el.is('img') && $el.hasClass('medium-insert-image-active')) {                                             // 1822
            $image.not($el).removeClass('medium-insert-image-active');                                                 // 1823
            $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                               // 1824
            this.core.removeCaptions($el);                                                                             // 1825
            return;                                                                                                    // 1826
        }                                                                                                              // 1827
                                                                                                                       // 1828
        $image.removeClass('medium-insert-image-active');                                                              // 1829
        $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                                   // 1830
                                                                                                                       // 1831
        if ($el.is('.medium-insert-caption-placeholder')) {                                                            // 1832
            this.core.removeCaptionPlaceholder($image.closest('figure'));                                              // 1833
        } else if ($el.is('figcaption') === false) {                                                                   // 1834
            this.core.removeCaptions();                                                                                // 1835
        }                                                                                                              // 1836
    };                                                                                                                 // 1837
                                                                                                                       // 1838
    /**                                                                                                                // 1839
     * Remove image                                                                                                    // 1840
     *                                                                                                                 // 1841
     * @param {Event} e                                                                                                // 1842
     * @returns {void}                                                                                                 // 1843
     */                                                                                                                // 1844
                                                                                                                       // 1845
    Images.prototype.removeImage = function (e) {                                                                      // 1846
        var $image, $parent, $empty;                                                                                   // 1847
                                                                                                                       // 1848
        if (e.which === 8 || e.which === 46) {                                                                         // 1849
            $image = this.$el.find('.medium-insert-image-active');                                                     // 1850
                                                                                                                       // 1851
            if ($image.length) {                                                                                       // 1852
                e.preventDefault();                                                                                    // 1853
                                                                                                                       // 1854
                this.deleteFile($image.attr('src'));                                                                   // 1855
                                                                                                                       // 1856
                $parent = $image.closest('.medium-insert-images');                                                     // 1857
                $image.closest('figure').remove();                                                                     // 1858
                                                                                                                       // 1859
                $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();                           // 1860
                                                                                                                       // 1861
                if ($parent.find('figure').length === 0) {                                                             // 1862
                    $empty = $parent.next();                                                                           // 1863
                    if ($empty.is('p') === false || $empty.text() !== '') {                                            // 1864
                        $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());                   // 1865
                        $parent.before($empty);                                                                        // 1866
                    }                                                                                                  // 1867
                    $parent.remove();                                                                                  // 1868
                                                                                                                       // 1869
                    // Hide addons                                                                                     // 1870
                    this.core.hideAddons();                                                                            // 1871
                                                                                                                       // 1872
                    this.core.moveCaret($empty);                                                                       // 1873
                }                                                                                                      // 1874
                                                                                                                       // 1875
                this.$el.trigger('input');                                                                             // 1876
            }                                                                                                          // 1877
        }                                                                                                              // 1878
    };                                                                                                                 // 1879
                                                                                                                       // 1880
    /**                                                                                                                // 1881
     * Makes ajax call to deleteScript                                                                                 // 1882
     *                                                                                                                 // 1883
     * @param {String} file File name                                                                                  // 1884
     * @returns {void}                                                                                                 // 1885
     */                                                                                                                // 1886
                                                                                                                       // 1887
    Images.prototype.deleteFile = function (file) {                                                                    // 1888
        if (this.options.deleteScript) {                                                                               // 1889
            $.post(this.options.deleteScript, { file: file });                                                         // 1890
        }                                                                                                              // 1891
    };                                                                                                                 // 1892
                                                                                                                       // 1893
    /**                                                                                                                // 1894
     * Adds image toolbar to editor                                                                                    // 1895
     *                                                                                                                 // 1896
     * @returns {void}                                                                                                 // 1897
     */                                                                                                                // 1898
                                                                                                                       // 1899
    Images.prototype.addToolbar = function () {                                                                        // 1900
        var $image = this.$el.find('.medium-insert-image-active'),                                                     // 1901
            $p = $image.closest('.medium-insert-images'),                                                              // 1902
            active = false,                                                                                            // 1903
            $toolbar, $toolbar2, top;                                                                                  // 1904
                                                                                                                       // 1905
        $('body').append(this.templates['src/js/templates/images-toolbar.hbs']({                                       // 1906
            styles: this.options.styles,                                                                               // 1907
            actions: this.options.actions                                                                              // 1908
        }).trim());                                                                                                    // 1909
                                                                                                                       // 1910
        $toolbar = $('.medium-insert-images-toolbar');                                                                 // 1911
        $toolbar2 = $('.medium-insert-images-toolbar2');                                                               // 1912
                                                                                                                       // 1913
        top = $image.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an image outset, 5px - distance from an image
        if (top < 0) {                                                                                                 // 1915
            top = 0;                                                                                                   // 1916
        }                                                                                                              // 1917
                                                                                                                       // 1918
        $toolbar                                                                                                       // 1919
            .css({                                                                                                     // 1920
                top: top,                                                                                              // 1921
                left: $image.offset().left + $image.width() / 2 - $toolbar.width() / 2                                 // 1922
            })                                                                                                         // 1923
            .show();                                                                                                   // 1924
                                                                                                                       // 1925
        $toolbar2                                                                                                      // 1926
            .css({                                                                                                     // 1927
                top: $image.offset().top + 2, // 2px - distance from a border                                          // 1928
                left: $image.offset().left + $image.width() - $toolbar2.width() - 4 // 4px - distance from a border    // 1929
            })                                                                                                         // 1930
            .show();                                                                                                   // 1931
                                                                                                                       // 1932
        $toolbar.find('button').each(function () {                                                                     // 1933
            if ($p.hasClass('medium-insert-images-'+ $(this).data('action'))) {                                        // 1934
                $(this).addClass('medium-editor-button-active');                                                       // 1935
                active = true;                                                                                         // 1936
            }                                                                                                          // 1937
        });                                                                                                            // 1938
                                                                                                                       // 1939
        if (active === false) {                                                                                        // 1940
            $toolbar.find('button').first().addClass('medium-editor-button-active');                                   // 1941
        }                                                                                                              // 1942
    };                                                                                                                 // 1943
                                                                                                                       // 1944
    /**                                                                                                                // 1945
     * Fires toolbar action                                                                                            // 1946
     *                                                                                                                 // 1947
     * @param {Event} e                                                                                                // 1948
     * @returns {void}                                                                                                 // 1949
     */                                                                                                                // 1950
                                                                                                                       // 1951
    Images.prototype.toolbarAction = function (e) {                                                                    // 1952
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1953
            $li = $button.closest('li'),                                                                               // 1954
            $ul = $li.closest('ul'),                                                                                   // 1955
            $lis = $ul.find('li'),                                                                                     // 1956
            $p = this.$el.find('.medium-insert-active'),                                                               // 1957
            that = this;                                                                                               // 1958
                                                                                                                       // 1959
        $button.addClass('medium-editor-button-active');                                                               // 1960
        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');                // 1961
                                                                                                                       // 1962
        $lis.find('button').each(function () {                                                                         // 1963
            var className = 'medium-insert-images-'+ $(this).data('action');                                           // 1964
                                                                                                                       // 1965
            if ($(this).hasClass('medium-editor-button-active')) {                                                     // 1966
                $p.addClass(className);                                                                                // 1967
                                                                                                                       // 1968
                if (that.options.styles[$(this).data('action')].added) {                                               // 1969
                    that.options.styles[$(this).data('action')].added($p);                                             // 1970
                }                                                                                                      // 1971
            } else {                                                                                                   // 1972
                $p.removeClass(className);                                                                             // 1973
                                                                                                                       // 1974
                if (that.options.styles[$(this).data('action')].removed) {                                             // 1975
                    that.options.styles[$(this).data('action')].removed($p);                                           // 1976
                }                                                                                                      // 1977
            }                                                                                                          // 1978
        });                                                                                                            // 1979
                                                                                                                       // 1980
        this.core.hideButtons();                                                                                       // 1981
                                                                                                                       // 1982
        this.$el.trigger('input');                                                                                     // 1983
    };                                                                                                                 // 1984
                                                                                                                       // 1985
    /**                                                                                                                // 1986
     * Fires toolbar2 action                                                                                           // 1987
     *                                                                                                                 // 1988
     * @param {Event} e                                                                                                // 1989
     * @returns {void}                                                                                                 // 1990
     */                                                                                                                // 1991
                                                                                                                       // 1992
    Images.prototype.toolbar2Action = function (e) {                                                                   // 1993
        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),                          // 1994
            callback = this.options.actions[$button.data('action')].clicked;                                           // 1995
                                                                                                                       // 1996
        if (callback) {                                                                                                // 1997
            callback(this.$el.find('.medium-insert-image-active'));                                                    // 1998
        }                                                                                                              // 1999
                                                                                                                       // 2000
        this.core.hideButtons();                                                                                       // 2001
                                                                                                                       // 2002
        this.$el.trigger('input');                                                                                     // 2003
    };                                                                                                                 // 2004
                                                                                                                       // 2005
    /**                                                                                                                // 2006
     * Initialize sorting                                                                                              // 2007
     *                                                                                                                 // 2008
     * @returns {void}                                                                                                 // 2009
     */                                                                                                                // 2010
                                                                                                                       // 2011
    Images.prototype.sorting = function () {                                                                           // 2012
        this.options.sorting();                                                                                        // 2013
    };                                                                                                                 // 2014
                                                                                                                       // 2015
    /** Plugin initialization */                                                                                       // 2016
                                                                                                                       // 2017
    $.fn[pluginName + addonName] = function (options) {                                                                // 2018
        return this.each(function () {                                                                                 // 2019
            if (!$.data(this, 'plugin_' + pluginName + addonName)) {                                                   // 2020
                $.data(this, 'plugin_' + pluginName + addonName, new Images(this, options));                           // 2021
            }                                                                                                          // 2022
        });                                                                                                            // 2023
    };                                                                                                                 // 2024
                                                                                                                       // 2025
})(jQuery, window, document, MediumEditor.util);                                                                       // 2026
                                                                                                                       // 2027
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/bootstrap-tagsinput.js                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
(function ($) {                                                                                                        // 1
  "use strict";                                                                                                        // 2
                                                                                                                       // 3
  var defaultOptions = {                                                                                               // 4
    tagClass: function(item) {                                                                                         // 5
      return 'label label-info';                                                                                       // 6
    },                                                                                                                 // 7
    itemValue: function(item) {                                                                                        // 8
      return item ? item.toString() : item;                                                                            // 9
    },                                                                                                                 // 10
    itemText: function(item) {                                                                                         // 11
      return this.itemValue(item);                                                                                     // 12
    },                                                                                                                 // 13
    freeInput: true,                                                                                                   // 14
    maxTags: undefined,                                                                                                // 15
    confirmKeys: [13],                                                                                                 // 16
    onTagExists: function(item, $tag) {                                                                                // 17
      $tag.hide().fadeIn();                                                                                            // 18
    }                                                                                                                  // 19
  };                                                                                                                   // 20
                                                                                                                       // 21
  /**                                                                                                                  // 22
  * Constructor function                                                                                               // 23
  */                                                                                                                   // 24
  function TagsInput(element, options) {                                                                               // 25
    this.itemsArray = [];                                                                                              // 26
                                                                                                                       // 27
    this.$element = $(element);                                                                                        // 28
    this.$element.hide();                                                                                              // 29
                                                                                                                       // 30
    this.isSelect = (element.tagName === 'SELECT');                                                                    // 31
    this.multiple = (this.isSelect && element.hasAttribute('multiple'));                                               // 32
    this.objectItems = options && options.itemValue;                                                                   // 33
    this.placeholderText = element.hasAttribute('placeholder') ? this.$element.attr('placeholder') : '';               // 34
    this.inputSize = Math.max(1, this.placeholderText.length);                                                         // 35
                                                                                                                       // 36
    this.$container = $('<div class="bootstrap-tagsinput"></div>');                                                    // 37
    this.$input = $('<input size="' + this.inputSize + '" type="text" placeholder="' + this.placeholderText + '"/>').appendTo(this.$container);
                                                                                                                       // 39
    this.$element.after(this.$container);                                                                              // 40
                                                                                                                       // 41
    this.build(options);                                                                                               // 42
  }                                                                                                                    // 43
                                                                                                                       // 44
  TagsInput.prototype = {                                                                                              // 45
    constructor: TagsInput,                                                                                            // 46
                                                                                                                       // 47
    /**                                                                                                                // 48
    * Adds the given item as a new tag. Pass true to dontPushVal to prevent                                            // 49
    * updating the elements val()                                                                                      // 50
    */                                                                                                                 // 51
    add: function(item, dontPushVal) {                                                                                 // 52
      var self = this;                                                                                                 // 53
                                                                                                                       // 54
      if (self.options.maxTags && self.itemsArray.length >= self.options.maxTags)                                      // 55
        return;                                                                                                        // 56
                                                                                                                       // 57
        // Ignore falsey values, except false                                                                          // 58
        if (item !== false && !item)                                                                                   // 59
          return;                                                                                                      // 60
                                                                                                                       // 61
          // Throw an error when trying to add an object while the itemValue option was not set                        // 62
          if (typeof item === "object" && !self.objectItems)                                                           // 63
            throw("Can't add objects when itemValue option is not set");                                               // 64
                                                                                                                       // 65
            // Ignore strings only containg whitespace                                                                 // 66
            if (item.toString().match(/^\s*$/))                                                                        // 67
              return;                                                                                                  // 68
                                                                                                                       // 69
              // If SELECT but not multiple, remove current tag                                                        // 70
              if (self.isSelect && !self.multiple && self.itemsArray.length > 0)                                       // 71
                self.remove(self.itemsArray[0]);                                                                       // 72
                                                                                                                       // 73
                if (typeof item === "string" && this.$element[0].tagName === 'INPUT') {                                // 74
                  var items = item.split(',');                                                                         // 75
                  if (items.length > 1) {                                                                              // 76
                    for (var i = 0; i < items.length; i++) {                                                           // 77
                      this.add(items[i], true);                                                                        // 78
                    }                                                                                                  // 79
                                                                                                                       // 80
                    if (!dontPushVal)                                                                                  // 81
                      self.pushVal();                                                                                  // 82
                      return;                                                                                          // 83
                    }                                                                                                  // 84
                  }                                                                                                    // 85
                                                                                                                       // 86
                  var itemValue = self.options.itemValue(item),                                                        // 87
                  itemText = self.options.itemText(item),                                                              // 88
                  tagClass = self.options.tagClass(item);                                                              // 89
                                                                                                                       // 90
                  // Ignore items allready added                                                                       // 91
                  var existing = $.grep(self.itemsArray, function(item) { return self.options.itemValue(item) === itemValue; } )[0];
                  if (existing) {                                                                                      // 93
                    // Invoke onTagExists                                                                              // 94
                    if (self.options.onTagExists) {                                                                    // 95
                      var $existingTag = $(".tag", self.$container).filter(function() { return $(this).data("item") === existing; });
                      self.options.onTagExists(item, $existingTag);                                                    // 97
                    }                                                                                                  // 98
                    return;                                                                                            // 99
                  }                                                                                                    // 100
                                                                                                                       // 101
                  // register item in internal array and map                                                           // 102
                  self.itemsArray.push(item);                                                                          // 103
                                                                                                                       // 104
                  // add a tag element                                                                                 // 105
                  var $tag = $('<span class="tag ' + htmlEncode(tagClass) + '">' + htmlEncode(itemText) + '<span data-role="remove"></span></span>');
                  $tag.data('item', item);                                                                             // 107
                  self.findInputWrapper().before($tag);                                                                // 108
                  $tag.after(' ');                                                                                     // 109
                                                                                                                       // 110
                  // add <option /> if item represents a value not present in one of the <select />'s options          // 111
                  if (self.isSelect && !$('option[value="' + escape(itemValue) + '"]',self.$element)[0]) {             // 112
                    var $option = $('<option selected>' + htmlEncode(itemText) + '</option>');                         // 113
                    $option.data('item', item);                                                                        // 114
                    $option.attr('value', itemValue);                                                                  // 115
                    self.$element.append($option);                                                                     // 116
                  }                                                                                                    // 117
                                                                                                                       // 118
                  if (!dontPushVal)                                                                                    // 119
                    self.pushVal();                                                                                    // 120
                                                                                                                       // 121
                    // Add class when reached maxTags                                                                  // 122
                    if (self.options.maxTags === self.itemsArray.length)                                               // 123
                      self.$container.addClass('bootstrap-tagsinput-max');                                             // 124
                                                                                                                       // 125
                      self.$element.trigger($.Event('itemAdded', { item: item }));                                     // 126
                    },                                                                                                 // 127
                                                                                                                       // 128
                    /**                                                                                                // 129
                    * Removes the given item. Pass true to dontPushVal to prevent updating the                         // 130
                    * elements val()                                                                                   // 131
                    */                                                                                                 // 132
                    remove: function(item, dontPushVal) {                                                              // 133
                      var self = this;                                                                                 // 134
                                                                                                                       // 135
                      if (self.objectItems) {                                                                          // 136
                        if (typeof item === "object")                                                                  // 137
                          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  self.options.itemValue(item); } )[0];
                        else                                                                                           // 139
                          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  item; } )[0];
                        }                                                                                              // 141
                                                                                                                       // 142
                        if (item) {                                                                                    // 143
                          $('.tag', self.$container).filter(function() { return $(this).data('item') === item; }).remove();
                          $('option', self.$element).filter(function() { return $(this).data('item') === item; }).remove();
                          self.itemsArray.splice($.inArray(item, self.itemsArray), 1);                                 // 146
                        }                                                                                              // 147
                                                                                                                       // 148
                        if (!dontPushVal)                                                                              // 149
                          self.pushVal();                                                                              // 150
                                                                                                                       // 151
                          // Remove class when reached maxTags                                                         // 152
                          if (self.options.maxTags > self.itemsArray.length)                                           // 153
                            self.$container.removeClass('bootstrap-tagsinput-max');                                    // 154
                                                                                                                       // 155
                            self.$element.trigger($.Event('itemRemoved',  { item: item }));                            // 156
                          },                                                                                           // 157
                                                                                                                       // 158
                          /**                                                                                          // 159
                          * Removes all items                                                                          // 160
                          */                                                                                           // 161
                          removeAll: function() {                                                                      // 162
                            var self = this;                                                                           // 163
                                                                                                                       // 164
                            $('.tag', self.$container).remove();                                                       // 165
                            $('option', self.$element).remove();                                                       // 166
                                                                                                                       // 167
                            while(self.itemsArray.length > 0)                                                          // 168
                              self.itemsArray.pop();                                                                   // 169
                                                                                                                       // 170
                              self.pushVal();                                                                          // 171
                                                                                                                       // 172
                              if (self.options.maxTags && !this.isEnabled())                                           // 173
                                this.enable();                                                                         // 174
                              },                                                                                       // 175
                                                                                                                       // 176
                              /**                                                                                      // 177
                              * Refreshes the tags so they match the text/value of their corresponding                 // 178
                              * item.                                                                                  // 179
                              */                                                                                       // 180
                              refresh: function() {                                                                    // 181
                                var self = this;                                                                       // 182
                                $('.tag', self.$container).each(function() {                                           // 183
                                  var $tag = $(this),                                                                  // 184
                                  item = $tag.data('item'),                                                            // 185
                                  itemValue = self.options.itemValue(item),                                            // 186
                                  itemText = self.options.itemText(item),                                              // 187
                                  tagClass = self.options.tagClass(item);                                              // 188
                                                                                                                       // 189
                                  // Update tag's class and inner text                                                 // 190
                                  $tag.attr('class', null);                                                            // 191
                                  $tag.addClass('tag ' + htmlEncode(tagClass));                                        // 192
                                  $tag.contents().filter(function() {                                                  // 193
                                    return this.nodeType == 3;                                                         // 194
                                  })[0].nodeValue = htmlEncode(itemText);                                              // 195
                                                                                                                       // 196
                                  if (self.isSelect) {                                                                 // 197
                                    var option = $('option', self.$element).filter(function() { return $(this).data('item') === item; });
                                    option.attr('value', itemValue);                                                   // 199
                                  }                                                                                    // 200
                                });                                                                                    // 201
                              },                                                                                       // 202
                                                                                                                       // 203
                              /**                                                                                      // 204
                              * Returns the items added as tags                                                        // 205
                              */                                                                                       // 206
                              items: function() {                                                                      // 207
                                return this.itemsArray;                                                                // 208
                              },                                                                                       // 209
                                                                                                                       // 210
                              /**                                                                                      // 211
                              * Assembly value by retrieving the value of each item, and set it on the                 // 212
                              * element.                                                                               // 213
                              */                                                                                       // 214
                              pushVal: function() {                                                                    // 215
                                var self = this,                                                                       // 216
                                val = $.map(self.items(), function(item) {                                             // 217
                                  return self.options.itemValue(item).toString();                                      // 218
                                });                                                                                    // 219
                                                                                                                       // 220
                                self.$element.val(val, true).trigger('change');                                        // 221
                              },                                                                                       // 222
                                                                                                                       // 223
                              /**                                                                                      // 224
                              * Initializes the tags input behaviour on the element                                    // 225
                              */                                                                                       // 226
                              build: function(options) {                                                               // 227
                                var self = this;                                                                       // 228
                                                                                                                       // 229
                                self.options = $.extend({}, defaultOptions, options);                                  // 230
                                var typeahead = self.options.typeahead || {};                                          // 231
                                                                                                                       // 232
                                // When itemValue is set, freeInput should always be false                             // 233
                                if (self.objectItems)                                                                  // 234
                                  self.options.freeInput = false;                                                      // 235
                                                                                                                       // 236
                                  makeOptionItemFunction(self.options, 'itemValue');                                   // 237
                                  makeOptionItemFunction(self.options, 'itemText');                                    // 238
                                  makeOptionItemFunction(self.options, 'tagClass');                                    // 239
                                                                                                                       // 240
                                  // for backwards compatibility, self.options.source is deprecated                    // 241
                                  if (self.options.source)                                                             // 242
                                    typeahead.source = self.options.source;                                            // 243
                                                                                                                       // 244
                                    if (typeahead.source && $.fn.typeahead) {                                          // 245
                                      makeOptionFunction(typeahead, 'source');                                         // 246
                                                                                                                       // 247
                                      self.$input.typeahead({                                                          // 248
                                        source: function (query, process) {                                            // 249
                                          function processItems(items) {                                               // 250
                                            var texts = [];                                                            // 251
                                                                                                                       // 252
                                            for (var i = 0; i < items.length; i++) {                                   // 253
                                              var text = self.options.itemText(items[i]);                              // 254
                                              map[text] = items[i];                                                    // 255
                                              texts.push(text);                                                        // 256
                                            }                                                                          // 257
                                            process(texts);                                                            // 258
                                          }                                                                            // 259
                                                                                                                       // 260
                                          this.map = {};                                                               // 261
                                          var map = this.map,                                                          // 262
                                          data = typeahead.source(query);                                              // 263
                                                                                                                       // 264
                                          if ($.isFunction(data.success)) {                                            // 265
                                            // support for Angular promises                                            // 266
                                            data.success(processItems);                                                // 267
                                          } else {                                                                     // 268
                                            // support for functions and jquery promises                               // 269
                                            $.when(data)                                                               // 270
                                            .then(processItems);                                                       // 271
                                          }                                                                            // 272
                                        },                                                                             // 273
                                        updater: function (text) {                                                     // 274
                                          self.add(this.map[text]);                                                    // 275
                                        },                                                                             // 276
                                        matcher: function (text) {                                                     // 277
                                          return (text.toLowerCase().indexOf(this.query.trim().toLowerCase()) !== -1);
                                        },                                                                             // 279
                                        sorter: function (texts) {                                                     // 280
                                          return texts.sort();                                                         // 281
                                        },                                                                             // 282
                                        highlighter: function (text) {                                                 // 283
                                          var regex = new RegExp( '(' + this.query + ')', 'gi' );                      // 284
                                          return text.replace( regex, "<strong>$1</strong>" );                         // 285
                                        }                                                                              // 286
                                      });                                                                              // 287
                                    }                                                                                  // 288
                                                                                                                       // 289
                                    self.$container.on('click', $.proxy(function(event) {                              // 290
                                      self.$input.focus();                                                             // 291
                                    }, self));                                                                         // 292
                                                                                                                       // 293
                                    self.$container.on('keydown', 'input', $.proxy(function(event) {                   // 294
                                      var $input = $(event.target),                                                    // 295
                                      $inputWrapper = self.findInputWrapper();                                         // 296
                                                                                                                       // 297
                                      switch (event.which) {                                                           // 298
                                        // BACKSPACE                                                                   // 299
                                      case 8:                                                                          // 300
                                        if (doGetCaretPosition($input[0]) === 0) {                                     // 301
                                          var prev = $inputWrapper.prev();                                             // 302
                                          if (prev) {                                                                  // 303
                                            self.remove(prev.data('item'));                                            // 304
                                          }                                                                            // 305
                                        }                                                                              // 306
                                        break;                                                                         // 307
                                                                                                                       // 308
                                        // DELETE                                                                      // 309
                                      case 46:                                                                         // 310
                                        if (doGetCaretPosition($input[0]) === 0) {                                     // 311
                                          var next = $inputWrapper.next();                                             // 312
                                          if (next) {                                                                  // 313
                                            self.remove(next.data('item'));                                            // 314
                                          }                                                                            // 315
                                        }                                                                              // 316
                                        break;                                                                         // 317
                                                                                                                       // 318
                                        // LEFT ARROW                                                                  // 319
                                      case 37:                                                                         // 320
                                        // Try to move the input before the previous tag                               // 321
                                        var $prevTag = $inputWrapper.prev();                                           // 322
                                        if ($input.val().length === 0 && $prevTag[0]) {                                // 323
                                          $prevTag.before($inputWrapper);                                              // 324
                                          $input.focus();                                                              // 325
                                        }                                                                              // 326
                                        break;                                                                         // 327
                                        // RIGHT ARROW                                                                 // 328
                                      case 39:                                                                         // 329
                                        // Try to move the input after the next tag                                    // 330
                                        var $nextTag = $inputWrapper.next();                                           // 331
                                        if ($input.val().length === 0 && $nextTag[0]) {                                // 332
                                          $nextTag.after($inputWrapper);                                               // 333
                                          $input.focus();                                                              // 334
                                        }                                                                              // 335
                                        break;                                                                         // 336
                                      default:                                                                         // 337
                                        // When key corresponds one of the confirmKeys, add current input              // 338
                                        // as a new tag                                                                // 339
                                        if (self.options.freeInput && $.inArray(event.which, self.options.confirmKeys) >= 0) {
                                          self.add($input.val());                                                      // 341
                                          $input.val('');                                                              // 342
                                          event.preventDefault();                                                      // 343
                                        }                                                                              // 344
                                      }                                                                                // 345
                                                                                                                       // 346
                                      // Reset internal input's size                                                   // 347
                                      $input.attr('size', Math.max(this.inputSize, $input.val().length));              // 348
                                    }, self));                                                                         // 349
                                                                                                                       // 350
                                    // Remove icon clicked                                                             // 351
                                    self.$container.on('click', '[data-role=remove]', $.proxy(function(event) {        // 352
                                      self.remove($(event.target).closest('.tag').data('item'));                       // 353
                                    }, self));                                                                         // 354
                                                                                                                       // 355
                                    // Only add existing value as tags when using strings as tags                      // 356
                                    if (self.options.itemValue === defaultOptions.itemValue) {                         // 357
                                      if (self.$element[0].tagName === 'INPUT') {                                      // 358
                                        self.add(self.$element.val());                                                 // 359
                                      } else {                                                                         // 360
                                        $('option', self.$element).each(function() {                                   // 361
                                          self.add($(this).attr('value'), true);                                       // 362
                                        });                                                                            // 363
                                      }                                                                                // 364
                                    }                                                                                  // 365
                                  },                                                                                   // 366
                                                                                                                       // 367
                                  /**                                                                                  // 368
                                  * Removes all tagsinput behaviour and unregsiter all event handlers                  // 369
                                  */                                                                                   // 370
                                  destroy: function() {                                                                // 371
                                    var self = this;                                                                   // 372
                                                                                                                       // 373
                                    // Unbind events                                                                   // 374
                                    self.$container.off('keypress', 'input');                                          // 375
                                    self.$container.off('click', '[role=remove]');                                     // 376
                                                                                                                       // 377
                                    self.$container.remove();                                                          // 378
                                    self.$element.removeData('tagsinput');                                             // 379
                                    self.$element.show();                                                              // 380
                                  },                                                                                   // 381
                                                                                                                       // 382
                                  /**                                                                                  // 383
                                  * Sets focus on the tagsinput                                                        // 384
                                  */                                                                                   // 385
                                  focus: function() {                                                                  // 386
                                    this.$input.focus();                                                               // 387
                                  },                                                                                   // 388
                                                                                                                       // 389
                                  /**                                                                                  // 390
                                  * Returns the internal input element                                                 // 391
                                  */                                                                                   // 392
                                  input: function() {                                                                  // 393
                                    return this.$input;                                                                // 394
                                  },                                                                                   // 395
                                                                                                                       // 396
                                  /**                                                                                  // 397
                                  * Returns the element which is wrapped around the internal input. This               // 398
                                  * is normally the $container, but typeahead.js moves the $input element.             // 399
                                  */                                                                                   // 400
                                  findInputWrapper: function() {                                                       // 401
                                    var elt = this.$input[0],                                                          // 402
                                    container = this.$container[0];                                                    // 403
                                    while(elt && elt.parentNode !== container)                                         // 404
                                      elt = elt.parentNode;                                                            // 405
                                                                                                                       // 406
                                      return $(elt);                                                                   // 407
                                    }                                                                                  // 408
                                  };                                                                                   // 409
                                                                                                                       // 410
                                  /**                                                                                  // 411
                                  * Register JQuery plugin                                                             // 412
                                  */                                                                                   // 413
                                  $.fn.tagsinput = function(arg1, arg2) {                                              // 414
                                    var results = [];                                                                  // 415
                                                                                                                       // 416
                                    this.each(function() {                                                             // 417
                                      var tagsinput = $(this).data('tagsinput');                                       // 418
                                                                                                                       // 419
                                      // Initialize a new tags input                                                   // 420
                                      if (!tagsinput) {                                                                // 421
                                        tagsinput = new TagsInput(this, arg1);                                         // 422
                                        $(this).data('tagsinput', tagsinput);                                          // 423
                                        results.push(tagsinput);                                                       // 424
                                                                                                                       // 425
                                        if (this.tagName === 'SELECT') {                                               // 426
                                          $('option', $(this)).attr('selected', 'selected');                           // 427
                                        }                                                                              // 428
                                                                                                                       // 429
                                        // Init tags from $(this).val()                                                // 430
                                        $(this).val($(this).val());                                                    // 431
                                      } else {                                                                         // 432
                                        // Invoke function on existing tags input                                      // 433
                                        var retVal = tagsinput[arg1](arg2);                                            // 434
                                        if (retVal !== undefined)                                                      // 435
                                          results.push(retVal);                                                        // 436
                                        }                                                                              // 437
                                      });                                                                              // 438
                                                                                                                       // 439
                                      if ( typeof arg1 == 'string') {                                                  // 440
                                        // Return the results from the invoked function calls                          // 441
                                        return results.length > 1 ? results : results[0];                              // 442
                                      } else {                                                                         // 443
                                        return results;                                                                // 444
                                      }                                                                                // 445
                                    };                                                                                 // 446
                                                                                                                       // 447
                                    $.fn.tagsinput.Constructor = TagsInput;                                            // 448
                                                                                                                       // 449
                                    /**                                                                                // 450
                                    * Most options support both a string or number as well as a function as            // 451
                                    * option value. This function makes sure that the option with the given            // 452
                                    * key in the given options is wrapped in a function                                // 453
                                    */                                                                                 // 454
                                    function makeOptionItemFunction(options, key) {                                    // 455
                                      if (typeof options[key] !== 'function') {                                        // 456
                                        var propertyName = options[key];                                               // 457
                                        options[key] = function(item) { return item[propertyName]; };                  // 458
                                      }                                                                                // 459
                                    }                                                                                  // 460
                                    function makeOptionFunction(options, key) {                                        // 461
                                      if (typeof options[key] !== 'function') {                                        // 462
                                        var value = options[key];                                                      // 463
                                        options[key] = function() { return value; };                                   // 464
                                      }                                                                                // 465
                                    }                                                                                  // 466
                                    /**                                                                                // 467
                                    * HtmlEncodes the given value                                                      // 468
                                    */                                                                                 // 469
                                    var htmlEncodeContainer = $('<div />');                                            // 470
                                    function htmlEncode(value) {                                                       // 471
                                      if (value) {                                                                     // 472
                                        return htmlEncodeContainer.text(value).html();                                 // 473
                                      } else {                                                                         // 474
                                        return '';                                                                     // 475
                                      }                                                                                // 476
                                    }                                                                                  // 477
                                                                                                                       // 478
                                    /**                                                                                // 479
                                    * Returns the position of the caret in the given input field                       // 480
                                    * http://flightschool.acylt.com/devnotes/caret-position-woes/                      // 481
                                    */                                                                                 // 482
                                    function doGetCaretPosition(oField) {                                              // 483
                                      var iCaretPos = 0;                                                               // 484
                                      if (document.selection) {                                                        // 485
                                        oField.focus ();                                                               // 486
                                        var oSel = document.selection.createRange();                                   // 487
                                        oSel.moveStart ('character', -oField.value.length);                            // 488
                                        iCaretPos = oSel.text.length;                                                  // 489
                                      } else if (oField.selectionStart || oField.selectionStart == '0') {              // 490
                                        iCaretPos = oField.selectionStart;                                             // 491
                                      }                                                                                // 492
                                      return (iCaretPos);                                                              // 493
                                    }                                                                                  // 494
                                                                                                                       // 495
                                    /**                                                                                // 496
                                    * Initialize tagsinput behaviour on inputs and selects which have                  // 497
                                    * data-role=tagsinput                                                              // 498
                                    */                                                                                 // 499
                                    $(function() {                                                                     // 500
                                      $("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput();
                                    });                                                                                // 502
                                  })(window.jQuery);                                                                   // 503
                                                                                                                       // 504
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/typeahead.jquery.js                                                          //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*!                                                                                                                    // 1
 * typeahead.js 0.10.2                                                                                                 // 2
 * https://github.com/twitter/typeahead.js                                                                             // 3
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT                                              // 4
 */                                                                                                                    // 5
                                                                                                                       // 6
(function($) {                                                                                                         // 7
    var _ = {                                                                                                          // 8
        isMsie: function() {                                                                                           // 9
            return /(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : false;
        },                                                                                                             // 11
        isBlankString: function(str) {                                                                                 // 12
            return !str || /^\s*$/.test(str);                                                                          // 13
        },                                                                                                             // 14
        escapeRegExChars: function(str) {                                                                              // 15
            return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");                                         // 16
        },                                                                                                             // 17
        isString: function(obj) {                                                                                      // 18
            return typeof obj === "string";                                                                            // 19
        },                                                                                                             // 20
        isNumber: function(obj) {                                                                                      // 21
            return typeof obj === "number";                                                                            // 22
        },                                                                                                             // 23
        isArray: $.isArray,                                                                                            // 24
        isFunction: $.isFunction,                                                                                      // 25
        isObject: $.isPlainObject,                                                                                     // 26
        isUndefined: function(obj) {                                                                                   // 27
            return typeof obj === "undefined";                                                                         // 28
        },                                                                                                             // 29
        bind: $.proxy,                                                                                                 // 30
        each: function(collection, cb) {                                                                               // 31
            $.each(collection, reverseArgs);                                                                           // 32
            function reverseArgs(index, value) {                                                                       // 33
                return cb(value, index);                                                                               // 34
            }                                                                                                          // 35
        },                                                                                                             // 36
        map: $.map,                                                                                                    // 37
        filter: $.grep,                                                                                                // 38
        every: function(obj, test) {                                                                                   // 39
            var result = true;                                                                                         // 40
            if (!obj) {                                                                                                // 41
                return result;                                                                                         // 42
            }                                                                                                          // 43
            $.each(obj, function(key, val) {                                                                           // 44
                if (!(result = test.call(null, val, key, obj))) {                                                      // 45
                    return false;                                                                                      // 46
                }                                                                                                      // 47
            });                                                                                                        // 48
            return !!result;                                                                                           // 49
        },                                                                                                             // 50
        some: function(obj, test) {                                                                                    // 51
            var result = false;                                                                                        // 52
            if (!obj) {                                                                                                // 53
                return result;                                                                                         // 54
            }                                                                                                          // 55
            $.each(obj, function(key, val) {                                                                           // 56
                if (result = test.call(null, val, key, obj)) {                                                         // 57
                    return false;                                                                                      // 58
                }                                                                                                      // 59
            });                                                                                                        // 60
            return !!result;                                                                                           // 61
        },                                                                                                             // 62
        mixin: $.extend,                                                                                               // 63
        getUniqueId: function() {                                                                                      // 64
            var counter = 0;                                                                                           // 65
            return function() {                                                                                        // 66
                return counter++;                                                                                      // 67
            };                                                                                                         // 68
        }(),                                                                                                           // 69
        templatify: function templatify(obj) {                                                                         // 70
            return $.isFunction(obj) ? obj : template;                                                                 // 71
            function template() {                                                                                      // 72
                return String(obj);                                                                                    // 73
            }                                                                                                          // 74
        },                                                                                                             // 75
        defer: function(fn) {                                                                                          // 76
            setTimeout(fn, 0);                                                                                         // 77
        },                                                                                                             // 78
        debounce: function(func, wait, immediate) {                                                                    // 79
            var timeout, result;                                                                                       // 80
            return function() {                                                                                        // 81
                var context = this, args = arguments, later, callNow;                                                  // 82
                later = function() {                                                                                   // 83
                    timeout = null;                                                                                    // 84
                    if (!immediate) {                                                                                  // 85
                        result = func.apply(context, args);                                                            // 86
                    }                                                                                                  // 87
                };                                                                                                     // 88
                callNow = immediate && !timeout;                                                                       // 89
                clearTimeout(timeout);                                                                                 // 90
                timeout = setTimeout(later, wait);                                                                     // 91
                if (callNow) {                                                                                         // 92
                    result = func.apply(context, args);                                                                // 93
                }                                                                                                      // 94
                return result;                                                                                         // 95
            };                                                                                                         // 96
        },                                                                                                             // 97
        throttle: function(func, wait) {                                                                               // 98
            var context, args, timeout, result, previous, later;                                                       // 99
            previous = 0;                                                                                              // 100
            later = function() {                                                                                       // 101
                previous = new Date();                                                                                 // 102
                timeout = null;                                                                                        // 103
                result = func.apply(context, args);                                                                    // 104
            };                                                                                                         // 105
            return function() {                                                                                        // 106
                var now = new Date(), remaining = wait - (now - previous);                                             // 107
                context = this;                                                                                        // 108
                args = arguments;                                                                                      // 109
                if (remaining <= 0) {                                                                                  // 110
                    clearTimeout(timeout);                                                                             // 111
                    timeout = null;                                                                                    // 112
                    previous = now;                                                                                    // 113
                    result = func.apply(context, args);                                                                // 114
                } else if (!timeout) {                                                                                 // 115
                    timeout = setTimeout(later, remaining);                                                            // 116
                }                                                                                                      // 117
                return result;                                                                                         // 118
            };                                                                                                         // 119
        },                                                                                                             // 120
        noop: function() {}                                                                                            // 121
    };                                                                                                                 // 122
    var html = {                                                                                                       // 123
        wrapper: '<span class="twitter-typeahead"></span>',                                                            // 124
        dropdown: '<span class="tt-dropdown-menu"></span>',                                                            // 125
        dataset: '<div class="tt-dataset-%CLASS%"></div>',                                                             // 126
        suggestions: '<span class="tt-suggestions"></span>',                                                           // 127
        suggestion: '<div class="tt-suggestion"></div>'                                                                // 128
    };                                                                                                                 // 129
    var css = {                                                                                                        // 130
        wrapper: {                                                                                                     // 131
            position: "relative",                                                                                      // 132
            display: "inline-block"                                                                                    // 133
        },                                                                                                             // 134
        hint: {                                                                                                        // 135
            position: "absolute",                                                                                      // 136
            top: "0",                                                                                                  // 137
            left: "0",                                                                                                 // 138
            borderColor: "transparent",                                                                                // 139
            boxShadow: "none"                                                                                          // 140
        },                                                                                                             // 141
        input: {                                                                                                       // 142
            position: "relative",                                                                                      // 143
            verticalAlign: "top",                                                                                      // 144
            backgroundColor: "transparent"                                                                             // 145
        },                                                                                                             // 146
        inputWithNoHint: {                                                                                             // 147
            position: "relative",                                                                                      // 148
            verticalAlign: "top"                                                                                       // 149
        },                                                                                                             // 150
        dropdown: {                                                                                                    // 151
            position: "absolute",                                                                                      // 152
            top: "100%",                                                                                               // 153
            left: "0",                                                                                                 // 154
            zIndex: "100",                                                                                             // 155
            display: "none"                                                                                            // 156
        },                                                                                                             // 157
        suggestions: {                                                                                                 // 158
            display: "block"                                                                                           // 159
        },                                                                                                             // 160
        suggestion: {                                                                                                  // 161
            whiteSpace: "nowrap",                                                                                      // 162
            cursor: "pointer"                                                                                          // 163
        },                                                                                                             // 164
        suggestionChild: {                                                                                             // 165
            whiteSpace: "normal"                                                                                       // 166
        },                                                                                                             // 167
        ltr: {                                                                                                         // 168
            left: "0",                                                                                                 // 169
            right: "auto"                                                                                              // 170
        },                                                                                                             // 171
        rtl: {                                                                                                         // 172
            left: "auto",                                                                                              // 173
            right: " 0"                                                                                                // 174
        }                                                                                                              // 175
    };                                                                                                                 // 176
    if (_.isMsie()) {                                                                                                  // 177
        _.mixin(css.input, {                                                                                           // 178
            backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"     // 179
        });                                                                                                            // 180
    }                                                                                                                  // 181
    if (_.isMsie() && _.isMsie() <= 7) {                                                                               // 182
        _.mixin(css.input, {                                                                                           // 183
            marginTop: "-1px"                                                                                          // 184
        });                                                                                                            // 185
    }                                                                                                                  // 186
    var EventBus = function() {                                                                                        // 187
        var namespace = "typeahead:";                                                                                  // 188
        function EventBus(o) {                                                                                         // 189
            if (!o || !o.el) {                                                                                         // 190
                $.error("EventBus initialized without el");                                                            // 191
            }                                                                                                          // 192
            this.$el = $(o.el);                                                                                        // 193
        }                                                                                                              // 194
        _.mixin(EventBus.prototype, {                                                                                  // 195
            trigger: function(type) {                                                                                  // 196
                var args = [].slice.call(arguments, 1);                                                                // 197
                this.$el.trigger(namespace + type, args);                                                              // 198
            }                                                                                                          // 199
        });                                                                                                            // 200
        return EventBus;                                                                                               // 201
    }();                                                                                                               // 202
    var EventEmitter = function() {                                                                                    // 203
        var splitter = /\s+/, nextTick = getNextTick();                                                                // 204
        return {                                                                                                       // 205
            onSync: onSync,                                                                                            // 206
            onAsync: onAsync,                                                                                          // 207
            off: off,                                                                                                  // 208
            trigger: trigger                                                                                           // 209
        };                                                                                                             // 210
        function on(method, types, cb, context) {                                                                      // 211
            var type;                                                                                                  // 212
            if (!cb) {                                                                                                 // 213
                return this;                                                                                           // 214
            }                                                                                                          // 215
            types = types.split(splitter);                                                                             // 216
            cb = context ? bindContext(cb, context) : cb;                                                              // 217
            this._callbacks = this._callbacks || {};                                                                   // 218
            while (type = types.shift()) {                                                                             // 219
                this._callbacks[type] = this._callbacks[type] || {                                                     // 220
                    sync: [],                                                                                          // 221
                    async: []                                                                                          // 222
                };                                                                                                     // 223
                this._callbacks[type][method].push(cb);                                                                // 224
            }                                                                                                          // 225
            return this;                                                                                               // 226
        }                                                                                                              // 227
        function onAsync(types, cb, context) {                                                                         // 228
            return on.call(this, "async", types, cb, context);                                                         // 229
        }                                                                                                              // 230
        function onSync(types, cb, context) {                                                                          // 231
            return on.call(this, "sync", types, cb, context);                                                          // 232
        }                                                                                                              // 233
        function off(types) {                                                                                          // 234
            var type;                                                                                                  // 235
            if (!this._callbacks) {                                                                                    // 236
                return this;                                                                                           // 237
            }                                                                                                          // 238
            types = types.split(splitter);                                                                             // 239
            while (type = types.shift()) {                                                                             // 240
                delete this._callbacks[type];                                                                          // 241
            }                                                                                                          // 242
            return this;                                                                                               // 243
        }                                                                                                              // 244
        function trigger(types) {                                                                                      // 245
            var type, callbacks, args, syncFlush, asyncFlush;                                                          // 246
            if (!this._callbacks) {                                                                                    // 247
                return this;                                                                                           // 248
            }                                                                                                          // 249
            types = types.split(splitter);                                                                             // 250
            args = [].slice.call(arguments, 1);                                                                        // 251
            while ((type = types.shift()) && (callbacks = this._callbacks[type])) {                                    // 252
                syncFlush = getFlush(callbacks.sync, this, [ type ].concat(args));                                     // 253
                asyncFlush = getFlush(callbacks.async, this, [ type ].concat(args));                                   // 254
                syncFlush() && nextTick(asyncFlush);                                                                   // 255
            }                                                                                                          // 256
            return this;                                                                                               // 257
        }                                                                                                              // 258
        function getFlush(callbacks, context, args) {                                                                  // 259
            return flush;                                                                                              // 260
            function flush() {                                                                                         // 261
                var cancelled;                                                                                         // 262
                for (var i = 0; !cancelled && i < callbacks.length; i += 1) {                                          // 263
                    cancelled = callbacks[i].apply(context, args) === false;                                           // 264
                }                                                                                                      // 265
                return !cancelled;                                                                                     // 266
            }                                                                                                          // 267
        }                                                                                                              // 268
        function getNextTick() {                                                                                       // 269
            var nextTickFn;                                                                                            // 270
            if (window.setImmediate) {                                                                                 // 271
                nextTickFn = function nextTickSetImmediate(fn) {                                                       // 272
                    setImmediate(function() {                                                                          // 273
                        fn();                                                                                          // 274
                    });                                                                                                // 275
                };                                                                                                     // 276
            } else {                                                                                                   // 277
                nextTickFn = function nextTickSetTimeout(fn) {                                                         // 278
                    setTimeout(function() {                                                                            // 279
                        fn();                                                                                          // 280
                    }, 0);                                                                                             // 281
                };                                                                                                     // 282
            }                                                                                                          // 283
            return nextTickFn;                                                                                         // 284
        }                                                                                                              // 285
        function bindContext(fn, context) {                                                                            // 286
            return fn.bind ? fn.bind(context) : function() {                                                           // 287
                fn.apply(context, [].slice.call(arguments, 0));                                                        // 288
            };                                                                                                         // 289
        }                                                                                                              // 290
    }();                                                                                                               // 291
    var highlight = function(doc) {                                                                                    // 292
        var defaults = {                                                                                               // 293
            node: null,                                                                                                // 294
            pattern: null,                                                                                             // 295
            tagName: "strong",                                                                                         // 296
            className: null,                                                                                           // 297
            wordsOnly: false,                                                                                          // 298
            caseSensitive: false                                                                                       // 299
        };                                                                                                             // 300
        return function hightlight(o) {                                                                                // 301
            var regex;                                                                                                 // 302
            o = _.mixin({}, defaults, o);                                                                              // 303
            if (!o.node || !o.pattern) {                                                                               // 304
                return;                                                                                                // 305
            }                                                                                                          // 306
            o.pattern = _.isArray(o.pattern) ? o.pattern : [ o.pattern ];                                              // 307
            regex = getRegex(o.pattern, o.caseSensitive, o.wordsOnly);                                                 // 308
            traverse(o.node, hightlightTextNode);                                                                      // 309
            function hightlightTextNode(textNode) {                                                                    // 310
                var match, patternNode;                                                                                // 311
                if (match = regex.exec(textNode.data)) {                                                               // 312
                    wrapperNode = doc.createElement(o.tagName);                                                        // 313
                    o.className && (wrapperNode.className = o.className);                                              // 314
                    patternNode = textNode.splitText(match.index);                                                     // 315
                    patternNode.splitText(match[0].length);                                                            // 316
                    wrapperNode.appendChild(patternNode.cloneNode(true));                                              // 317
                    textNode.parentNode.replaceChild(wrapperNode, patternNode);                                        // 318
                }                                                                                                      // 319
                return !!match;                                                                                        // 320
            }                                                                                                          // 321
            function traverse(el, hightlightTextNode) {                                                                // 322
                var childNode, TEXT_NODE_TYPE = 3;                                                                     // 323
                for (var i = 0; i < el.childNodes.length; i++) {                                                       // 324
                    childNode = el.childNodes[i];                                                                      // 325
                    if (childNode.nodeType === TEXT_NODE_TYPE) {                                                       // 326
                        i += hightlightTextNode(childNode) ? 1 : 0;                                                    // 327
                    } else {                                                                                           // 328
                        traverse(childNode, hightlightTextNode);                                                       // 329
                    }                                                                                                  // 330
                }                                                                                                      // 331
            }                                                                                                          // 332
        };                                                                                                             // 333
        function getRegex(patterns, caseSensitive, wordsOnly) {                                                        // 334
            var escapedPatterns = [], regexStr;                                                                        // 335
            for (var i = 0; i < patterns.length; i++) {                                                                // 336
                escapedPatterns.push(_.escapeRegExChars(patterns[i]));                                                 // 337
            }                                                                                                          // 338
            regexStr = wordsOnly ? "\\b(" + escapedPatterns.join("|") + ")\\b" : "(" + escapedPatterns.join("|") + ")";
            return caseSensitive ? new RegExp(regexStr) : new RegExp(regexStr, "i");                                   // 340
        }                                                                                                              // 341
    }(window.document);                                                                                                // 342
    var Input = function() {                                                                                           // 343
        var specialKeyCodeMap;                                                                                         // 344
        specialKeyCodeMap = {                                                                                          // 345
            9: "tab",                                                                                                  // 346
            27: "esc",                                                                                                 // 347
            37: "left",                                                                                                // 348
            39: "right",                                                                                               // 349
            13: "enter",                                                                                               // 350
            38: "up",                                                                                                  // 351
            40: "down"                                                                                                 // 352
        };                                                                                                             // 353
        function Input(o) {                                                                                            // 354
            var that = this, onBlur, onFocus, onKeydown, onInput;                                                      // 355
            o = o || {};                                                                                               // 356
            if (!o.input) {                                                                                            // 357
                $.error("input is missing");                                                                           // 358
            }                                                                                                          // 359
            onBlur = _.bind(this._onBlur, this);                                                                       // 360
            onFocus = _.bind(this._onFocus, this);                                                                     // 361
            onKeydown = _.bind(this._onKeydown, this);                                                                 // 362
            onInput = _.bind(this._onInput, this);                                                                     // 363
            this.$hint = $(o.hint);                                                                                    // 364
            this.$input = $(o.input).on("blur.tt", onBlur).on("focus.tt", onFocus).on("keydown.tt", onKeydown);        // 365
            if (this.$hint.length === 0) {                                                                             // 366
                this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = _.noop;                       // 367
            }                                                                                                          // 368
            if (!_.isMsie()) {                                                                                         // 369
                this.$input.on("input.tt", onInput);                                                                   // 370
            } else {                                                                                                   // 371
                this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function($e) {                                // 372
                    if (specialKeyCodeMap[$e.which || $e.keyCode]) {                                                   // 373
                        return;                                                                                        // 374
                    }                                                                                                  // 375
                    _.defer(_.bind(that._onInput, that, $e));                                                          // 376
                });                                                                                                    // 377
            }                                                                                                          // 378
            this.query = this.$input.val();                                                                            // 379
            this.$overflowHelper = buildOverflowHelper(this.$input);                                                   // 380
        }                                                                                                              // 381
        Input.normalizeQuery = function(str) {                                                                         // 382
            return (str || "").replace(/^\s*/g, "").replace(/\s{2,}/g, " ");                                           // 383
        };                                                                                                             // 384
        _.mixin(Input.prototype, EventEmitter, {                                                                       // 385
            _onBlur: function onBlur() {                                                                               // 386
                this.resetInputValue();                                                                                // 387
                this.trigger("blurred");                                                                               // 388
            },                                                                                                         // 389
            _onFocus: function onFocus() {                                                                             // 390
                this.trigger("focused");                                                                               // 391
            },                                                                                                         // 392
            _onKeydown: function onKeydown($e) {                                                                       // 393
                var keyName = specialKeyCodeMap[$e.which || $e.keyCode];                                               // 394
                this._managePreventDefault(keyName, $e);                                                               // 395
                if (keyName && this._shouldTrigger(keyName, $e)) {                                                     // 396
                    this.trigger(keyName + "Keyed", $e);                                                               // 397
                }                                                                                                      // 398
            },                                                                                                         // 399
            _onInput: function onInput() {                                                                             // 400
                this._checkInputValue();                                                                               // 401
            },                                                                                                         // 402
            _managePreventDefault: function managePreventDefault(keyName, $e) {                                        // 403
                var preventDefault, hintValue, inputValue;                                                             // 404
                switch (keyName) {                                                                                     // 405
                  case "tab":                                                                                          // 406
                    hintValue = this.getHint();                                                                        // 407
                    inputValue = this.getInputValue();                                                                 // 408
                    preventDefault = hintValue && hintValue !== inputValue && !withModifier($e);                       // 409
                    break;                                                                                             // 410
                                                                                                                       // 411
                  case "up":                                                                                           // 412
                  case "down":                                                                                         // 413
                    preventDefault = !withModifier($e);                                                                // 414
                    break;                                                                                             // 415
                                                                                                                       // 416
                  default:                                                                                             // 417
                    preventDefault = false;                                                                            // 418
                }                                                                                                      // 419
                preventDefault && $e.preventDefault();                                                                 // 420
            },                                                                                                         // 421
            _shouldTrigger: function shouldTrigger(keyName, $e) {                                                      // 422
                var trigger;                                                                                           // 423
                switch (keyName) {                                                                                     // 424
                  case "tab":                                                                                          // 425
                    trigger = !withModifier($e);                                                                       // 426
                    break;                                                                                             // 427
                                                                                                                       // 428
                  default:                                                                                             // 429
                    trigger = true;                                                                                    // 430
                }                                                                                                      // 431
                return trigger;                                                                                        // 432
            },                                                                                                         // 433
            _checkInputValue: function checkInputValue() {                                                             // 434
                var inputValue, areEquivalent, hasDifferentWhitespace;                                                 // 435
                inputValue = this.getInputValue();                                                                     // 436
                areEquivalent = areQueriesEquivalent(inputValue, this.query);                                          // 437
                hasDifferentWhitespace = areEquivalent ? this.query.length !== inputValue.length : false;              // 438
                if (!areEquivalent) {                                                                                  // 439
                    this.trigger("queryChanged", this.query = inputValue);                                             // 440
                } else if (hasDifferentWhitespace) {                                                                   // 441
                    this.trigger("whitespaceChanged", this.query);                                                     // 442
                }                                                                                                      // 443
            },                                                                                                         // 444
            focus: function focus() {                                                                                  // 445
                this.$input.focus();                                                                                   // 446
            },                                                                                                         // 447
            blur: function blur() {                                                                                    // 448
                this.$input.blur();                                                                                    // 449
            },                                                                                                         // 450
            getQuery: function getQuery() {                                                                            // 451
                return this.query;                                                                                     // 452
            },                                                                                                         // 453
            setQuery: function setQuery(query) {                                                                       // 454
                this.query = query;                                                                                    // 455
            },                                                                                                         // 456
            getInputValue: function getInputValue() {                                                                  // 457
                return this.$input.val();                                                                              // 458
            },                                                                                                         // 459
            setInputValue: function setInputValue(value, silent) {                                                     // 460
                this.$input.val(value);                                                                                // 461
                silent ? this.clearHint() : this._checkInputValue();                                                   // 462
            },                                                                                                         // 463
            resetInputValue: function resetInputValue() {                                                              // 464
                this.setInputValue(this.query, true);                                                                  // 465
            },                                                                                                         // 466
            getHint: function getHint() {                                                                              // 467
                return this.$hint.val();                                                                               // 468
            },                                                                                                         // 469
            setHint: function setHint(value) {                                                                         // 470
                this.$hint.val(value);                                                                                 // 471
            },                                                                                                         // 472
            clearHint: function clearHint() {                                                                          // 473
                this.setHint("");                                                                                      // 474
            },                                                                                                         // 475
            clearHintIfInvalid: function clearHintIfInvalid() {                                                        // 476
                var val, hint, valIsPrefixOfHint, isValid;                                                             // 477
                val = this.getInputValue();                                                                            // 478
                hint = this.getHint();                                                                                 // 479
                valIsPrefixOfHint = val !== hint && hint.indexOf(val) === 0;                                           // 480
                isValid = val !== "" && valIsPrefixOfHint && !this.hasOverflow();                                      // 481
                !isValid && this.clearHint();                                                                          // 482
            },                                                                                                         // 483
            getLanguageDirection: function getLanguageDirection() {                                                    // 484
                return (this.$input.css("direction") || "ltr").toLowerCase();                                          // 485
            },                                                                                                         // 486
            hasOverflow: function hasOverflow() {                                                                      // 487
                var constraint = this.$input.width() - 2;                                                              // 488
                this.$overflowHelper.text(this.getInputValue());                                                       // 489
                return this.$overflowHelper.width() >= constraint;                                                     // 490
            },                                                                                                         // 491
            isCursorAtEnd: function() {                                                                                // 492
                var valueLength, selectionStart, range;                                                                // 493
                valueLength = this.$input.val().length;                                                                // 494
                selectionStart = this.$input[0].selectionStart;                                                        // 495
                if (_.isNumber(selectionStart)) {                                                                      // 496
                    return selectionStart === valueLength;                                                             // 497
                } else if (document.selection) {                                                                       // 498
                    range = document.selection.createRange();                                                          // 499
                    range.moveStart("character", -valueLength);                                                        // 500
                    return valueLength === range.text.length;                                                          // 501
                }                                                                                                      // 502
                return true;                                                                                           // 503
            },                                                                                                         // 504
            destroy: function destroy() {                                                                              // 505
                this.$hint.off(".tt");                                                                                 // 506
                this.$input.off(".tt");                                                                                // 507
                this.$hint = this.$input = this.$overflowHelper = null;                                                // 508
            }                                                                                                          // 509
        });                                                                                                            // 510
        return Input;                                                                                                  // 511
        function buildOverflowHelper($input) {                                                                         // 512
            return $('<pre aria-hidden="true"></pre>').css({                                                           // 513
                position: "absolute",                                                                                  // 514
                visibility: "hidden",                                                                                  // 515
                whiteSpace: "pre",                                                                                     // 516
                fontFamily: $input.css("font-family"),                                                                 // 517
                fontSize: $input.css("font-size"),                                                                     // 518
                fontStyle: $input.css("font-style"),                                                                   // 519
                fontVariant: $input.css("font-variant"),                                                               // 520
                fontWeight: $input.css("font-weight"),                                                                 // 521
                wordSpacing: $input.css("word-spacing"),                                                               // 522
                letterSpacing: $input.css("letter-spacing"),                                                           // 523
                textIndent: $input.css("text-indent"),                                                                 // 524
                textRendering: $input.css("text-rendering"),                                                           // 525
                textTransform: $input.css("text-transform")                                                            // 526
            }).insertAfter($input);                                                                                    // 527
        }                                                                                                              // 528
        function areQueriesEquivalent(a, b) {                                                                          // 529
            return Input.normalizeQuery(a) === Input.normalizeQuery(b);                                                // 530
        }                                                                                                              // 531
        function withModifier($e) {                                                                                    // 532
            return $e.altKey || $e.ctrlKey || $e.metaKey || $e.shiftKey;                                               // 533
        }                                                                                                              // 534
    }();                                                                                                               // 535
    var Dataset = function() {                                                                                         // 536
        var datasetKey = "ttDataset", valueKey = "ttValue", datumKey = "ttDatum";                                      // 537
        function Dataset(o) {                                                                                          // 538
            o = o || {};                                                                                               // 539
            o.templates = o.templates || {};                                                                           // 540
            if (!o.source) {                                                                                           // 541
                $.error("missing source");                                                                             // 542
            }                                                                                                          // 543
            if (o.name && !isValidName(o.name)) {                                                                      // 544
                $.error("invalid dataset name: " + o.name);                                                            // 545
            }                                                                                                          // 546
            this.query = null;                                                                                         // 547
            this.highlight = !!o.highlight;                                                                            // 548
            this.name = o.name || _.getUniqueId();                                                                     // 549
            this.source = o.source;                                                                                    // 550
            this.displayFn = getDisplayFn(o.display || o.displayKey);                                                  // 551
            this.templates = getTemplates(o.templates, this.displayFn);                                                // 552
            this.$el = $(html.dataset.replace("%CLASS%", this.name));                                                  // 553
        }                                                                                                              // 554
        Dataset.extractDatasetName = function extractDatasetName(el) {                                                 // 555
            return $(el).data(datasetKey);                                                                             // 556
        };                                                                                                             // 557
        Dataset.extractValue = function extractDatum(el) {                                                             // 558
            return $(el).data(valueKey);                                                                               // 559
        };                                                                                                             // 560
        Dataset.extractDatum = function extractDatum(el) {                                                             // 561
            return $(el).data(datumKey);                                                                               // 562
        };                                                                                                             // 563
        _.mixin(Dataset.prototype, EventEmitter, {                                                                     // 564
            _render: function render(query, suggestions) {                                                             // 565
                if (!this.$el) {                                                                                       // 566
                    return;                                                                                            // 567
                }                                                                                                      // 568
                var that = this, hasSuggestions;                                                                       // 569
                this.$el.empty();                                                                                      // 570
                hasSuggestions = suggestions && suggestions.length;                                                    // 571
                if (!hasSuggestions && this.templates.empty) {                                                         // 572
                    this.$el.html(getEmptyHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                } else if (hasSuggestions) {                                                                           // 574
                    this.$el.html(getSuggestionsHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                }                                                                                                      // 576
                this.trigger("rendered");                                                                              // 577
                function getEmptyHtml() {                                                                              // 578
                    return that.templates.empty({                                                                      // 579
                        query: query,                                                                                  // 580
                        isEmpty: true                                                                                  // 581
                    });                                                                                                // 582
                }                                                                                                      // 583
                function getSuggestionsHtml() {                                                                        // 584
                    var $suggestions, nodes;                                                                           // 585
                    $suggestions = $(html.suggestions).css(css.suggestions);                                           // 586
                    nodes = _.map(suggestions, getSuggestionNode);                                                     // 587
                    $suggestions.append.apply($suggestions, nodes);                                                    // 588
                    that.highlight && highlight({                                                                      // 589
                        node: $suggestions[0],                                                                         // 590
                        pattern: query                                                                                 // 591
                    });                                                                                                // 592
                    return $suggestions;                                                                               // 593
                    function getSuggestionNode(suggestion) {                                                           // 594
                        var $el;                                                                                       // 595
                        $el = $(html.suggestion).append(that.templates.suggestion(suggestion)).data(datasetKey, that.name).data(valueKey, that.displayFn(suggestion)).data(datumKey, suggestion);
                        $el.children().each(function() {                                                               // 597
                            $(this).css(css.suggestionChild);                                                          // 598
                        });                                                                                            // 599
                        return $el;                                                                                    // 600
                    }                                                                                                  // 601
                }                                                                                                      // 602
                function getHeaderHtml() {                                                                             // 603
                    return that.templates.header({                                                                     // 604
                        query: query,                                                                                  // 605
                        isEmpty: !hasSuggestions                                                                       // 606
                    });                                                                                                // 607
                }                                                                                                      // 608
                function getFooterHtml() {                                                                             // 609
                    return that.templates.footer({                                                                     // 610
                        query: query,                                                                                  // 611
                        isEmpty: !hasSuggestions                                                                       // 612
                    });                                                                                                // 613
                }                                                                                                      // 614
            },                                                                                                         // 615
            getRoot: function getRoot() {                                                                              // 616
                return this.$el;                                                                                       // 617
            },                                                                                                         // 618
            update: function update(query) {                                                                           // 619
                var that = this;                                                                                       // 620
                this.query = query;                                                                                    // 621
                this.canceled = false;                                                                                 // 622
                this.source(query, render);                                                                            // 623
                function render(suggestions) {                                                                         // 624
                    if (!that.canceled && query === that.query) {                                                      // 625
                        that._render(query, suggestions);                                                              // 626
                    }                                                                                                  // 627
                }                                                                                                      // 628
            },                                                                                                         // 629
            cancel: function cancel() {                                                                                // 630
                this.canceled = true;                                                                                  // 631
            },                                                                                                         // 632
            clear: function clear() {                                                                                  // 633
                this.cancel();                                                                                         // 634
                this.$el.empty();                                                                                      // 635
                this.trigger("rendered");                                                                              // 636
            },                                                                                                         // 637
            isEmpty: function isEmpty() {                                                                              // 638
                return this.$el.is(":empty");                                                                          // 639
            },                                                                                                         // 640
            destroy: function destroy() {                                                                              // 641
                this.$el = null;                                                                                       // 642
            }                                                                                                          // 643
        });                                                                                                            // 644
        return Dataset;                                                                                                // 645
        function getDisplayFn(display) {                                                                               // 646
            display = display || "value";                                                                              // 647
            return _.isFunction(display) ? display : displayFn;                                                        // 648
            function displayFn(obj) {                                                                                  // 649
                return obj[display];                                                                                   // 650
            }                                                                                                          // 651
        }                                                                                                              // 652
        function getTemplates(templates, displayFn) {                                                                  // 653
            return {                                                                                                   // 654
                empty: templates.empty && _.templatify(templates.empty),                                               // 655
                header: templates.header && _.templatify(templates.header),                                            // 656
                footer: templates.footer && _.templatify(templates.footer),                                            // 657
                suggestion: templates.suggestion || suggestionTemplate                                                 // 658
            };                                                                                                         // 659
            function suggestionTemplate(context) {                                                                     // 660
                return "<p>" + displayFn(context) + "</p>";                                                            // 661
            }                                                                                                          // 662
        }                                                                                                              // 663
        function isValidName(str) {                                                                                    // 664
            return /^[_a-zA-Z0-9-]+$/.test(str);                                                                       // 665
        }                                                                                                              // 666
    }();                                                                                                               // 667
    var Dropdown = function() {                                                                                        // 668
        function Dropdown(o) {                                                                                         // 669
            var that = this, onSuggestionClick, onSuggestionMouseEnter, onSuggestionMouseLeave;                        // 670
            o = o || {};                                                                                               // 671
            if (!o.menu) {                                                                                             // 672
                $.error("menu is required");                                                                           // 673
            }                                                                                                          // 674
            this.isOpen = false;                                                                                       // 675
            this.isEmpty = true;                                                                                       // 676
            this.datasets = _.map(o.datasets, initializeDataset);                                                      // 677
            onSuggestionClick = _.bind(this._onSuggestionClick, this);                                                 // 678
            onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);                                       // 679
            onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);                                       // 680
            this.$menu = $(o.menu).on("click.tt", ".tt-suggestion", onSuggestionClick).on("mouseenter.tt", ".tt-suggestion", onSuggestionMouseEnter).on("mouseleave.tt", ".tt-suggestion", onSuggestionMouseLeave);
            _.each(this.datasets, function(dataset) {                                                                  // 682
                that.$menu.append(dataset.getRoot());                                                                  // 683
                dataset.onSync("rendered", that._onRendered, that);                                                    // 684
            });                                                                                                        // 685
        }                                                                                                              // 686
        _.mixin(Dropdown.prototype, EventEmitter, {                                                                    // 687
            _onSuggestionClick: function onSuggestionClick($e) {                                                       // 688
                this.trigger("suggestionClicked", $($e.currentTarget));                                                // 689
            },                                                                                                         // 690
            _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {                                             // 691
                this._removeCursor();                                                                                  // 692
                this._setCursor($($e.currentTarget), true);                                                            // 693
            },                                                                                                         // 694
            _onSuggestionMouseLeave: function onSuggestionMouseLeave() {                                               // 695
                this._removeCursor();                                                                                  // 696
            },                                                                                                         // 697
            _onRendered: function onRendered() {                                                                       // 698
                this.isEmpty = _.every(this.datasets, isDatasetEmpty);                                                 // 699
                this.isEmpty ? this._hide() : this.isOpen && this._show();                                             // 700
                this.trigger("datasetRendered");                                                                       // 701
                function isDatasetEmpty(dataset) {                                                                     // 702
                    return dataset.isEmpty();                                                                          // 703
                }                                                                                                      // 704
            },                                                                                                         // 705
            _hide: function() {                                                                                        // 706
                this.$menu.hide();                                                                                     // 707
            },                                                                                                         // 708
            _show: function() {                                                                                        // 709
                this.$menu.css("display", "block");                                                                    // 710
            },                                                                                                         // 711
            _getSuggestions: function getSuggestions() {                                                               // 712
                return this.$menu.find(".tt-suggestion");                                                              // 713
            },                                                                                                         // 714
            _getCursor: function getCursor() {                                                                         // 715
                return this.$menu.find(".tt-cursor").first();                                                          // 716
            },                                                                                                         // 717
            _setCursor: function setCursor($el, silent) {                                                              // 718
                $el.first().addClass("tt-cursor");                                                                     // 719
                !silent && this.trigger("cursorMoved");                                                                // 720
            },                                                                                                         // 721
            _removeCursor: function removeCursor() {                                                                   // 722
                this._getCursor().removeClass("tt-cursor");                                                            // 723
            },                                                                                                         // 724
            _moveCursor: function moveCursor(increment) {                                                              // 725
                var $suggestions, $oldCursor, newCursorIndex, $newCursor;                                              // 726
                if (!this.isOpen) {                                                                                    // 727
                    return;                                                                                            // 728
                }                                                                                                      // 729
                $oldCursor = this._getCursor();                                                                        // 730
                $suggestions = this._getSuggestions();                                                                 // 731
                this._removeCursor();                                                                                  // 732
                newCursorIndex = $suggestions.index($oldCursor) + increment;                                           // 733
                newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;                                 // 734
                if (newCursorIndex === -1) {                                                                           // 735
                    this.trigger("cursorRemoved");                                                                     // 736
                    return;                                                                                            // 737
                } else if (newCursorIndex < -1) {                                                                      // 738
                    newCursorIndex = $suggestions.length - 1;                                                          // 739
                }                                                                                                      // 740
                this._setCursor($newCursor = $suggestions.eq(newCursorIndex));                                         // 741
                this._ensureVisible($newCursor);                                                                       // 742
            },                                                                                                         // 743
            _ensureVisible: function ensureVisible($el) {                                                              // 744
                var elTop, elBottom, menuScrollTop, menuHeight;                                                        // 745
                elTop = $el.position().top;                                                                            // 746
                elBottom = elTop + $el.outerHeight(true);                                                              // 747
                menuScrollTop = this.$menu.scrollTop();                                                                // 748
                menuHeight = this.$menu.height() + parseInt(this.$menu.css("paddingTop"), 10) + parseInt(this.$menu.css("paddingBottom"), 10);
                if (elTop < 0) {                                                                                       // 750
                    this.$menu.scrollTop(menuScrollTop + elTop);                                                       // 751
                } else if (menuHeight < elBottom) {                                                                    // 752
                    this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));                                     // 753
                }                                                                                                      // 754
            },                                                                                                         // 755
            close: function close() {                                                                                  // 756
                if (this.isOpen) {                                                                                     // 757
                    this.isOpen = false;                                                                               // 758
                    this._removeCursor();                                                                              // 759
                    this._hide();                                                                                      // 760
                    this.trigger("closed");                                                                            // 761
                }                                                                                                      // 762
            },                                                                                                         // 763
            open: function open() {                                                                                    // 764
                if (!this.isOpen) {                                                                                    // 765
                    this.isOpen = true;                                                                                // 766
                    !this.isEmpty && this._show();                                                                     // 767
                    this.trigger("opened");                                                                            // 768
                }                                                                                                      // 769
            },                                                                                                         // 770
            setLanguageDirection: function setLanguageDirection(dir) {                                                 // 771
                this.$menu.css(dir === "ltr" ? css.ltr : css.rtl);                                                     // 772
            },                                                                                                         // 773
            moveCursorUp: function moveCursorUp() {                                                                    // 774
                this._moveCursor(-1);                                                                                  // 775
            },                                                                                                         // 776
            moveCursorDown: function moveCursorDown() {                                                                // 777
                this._moveCursor(+1);                                                                                  // 778
            },                                                                                                         // 779
            getDatumForSuggestion: function getDatumForSuggestion($el) {                                               // 780
                var datum = null;                                                                                      // 781
                if ($el.length) {                                                                                      // 782
                    datum = {                                                                                          // 783
                        raw: Dataset.extractDatum($el),                                                                // 784
                        value: Dataset.extractValue($el),                                                              // 785
                        datasetName: Dataset.extractDatasetName($el)                                                   // 786
                    };                                                                                                 // 787
                }                                                                                                      // 788
                return datum;                                                                                          // 789
            },                                                                                                         // 790
            getDatumForCursor: function getDatumForCursor() {                                                          // 791
                return this.getDatumForSuggestion(this._getCursor().first());                                          // 792
            },                                                                                                         // 793
            getDatumForTopSuggestion: function getDatumForTopSuggestion() {                                            // 794
                return this.getDatumForSuggestion(this._getSuggestions().first());                                     // 795
            },                                                                                                         // 796
            update: function update(query) {                                                                           // 797
                _.each(this.datasets, updateDataset);                                                                  // 798
                function updateDataset(dataset) {                                                                      // 799
                    dataset.update(query);                                                                             // 800
                }                                                                                                      // 801
            },                                                                                                         // 802
            empty: function empty() {                                                                                  // 803
                _.each(this.datasets, clearDataset);                                                                   // 804
                this.isEmpty = true;                                                                                   // 805
                function clearDataset(dataset) {                                                                       // 806
                    dataset.clear();                                                                                   // 807
                }                                                                                                      // 808
            },                                                                                                         // 809
            isVisible: function isVisible() {                                                                          // 810
                return this.isOpen && !this.isEmpty;                                                                   // 811
            },                                                                                                         // 812
            destroy: function destroy() {                                                                              // 813
                this.$menu.off(".tt");                                                                                 // 814
                this.$menu = null;                                                                                     // 815
                _.each(this.datasets, destroyDataset);                                                                 // 816
                function destroyDataset(dataset) {                                                                     // 817
                    dataset.destroy();                                                                                 // 818
                }                                                                                                      // 819
            }                                                                                                          // 820
        });                                                                                                            // 821
        return Dropdown;                                                                                               // 822
        function initializeDataset(oDataset) {                                                                         // 823
            return new Dataset(oDataset);                                                                              // 824
        }                                                                                                              // 825
    }();                                                                                                               // 826
    var Typeahead = function() {                                                                                       // 827
        var attrsKey = "ttAttrs";                                                                                      // 828
        function Typeahead(o) {                                                                                        // 829
            var $menu, $input, $hint;                                                                                  // 830
            o = o || {};                                                                                               // 831
            if (!o.input) {                                                                                            // 832
                $.error("missing input");                                                                              // 833
            }                                                                                                          // 834
            this.isActivated = false;                                                                                  // 835
            this.autoselect = !!o.autoselect;                                                                          // 836
            this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;                                                // 837
            this.$node = buildDomStructure(o.input, o.withHint);                                                       // 838
            $menu = this.$node.find(".tt-dropdown-menu");                                                              // 839
            $input = this.$node.find(".tt-input");                                                                     // 840
            $hint = this.$node.find(".tt-hint");                                                                       // 841
            $input.on("blur.tt", function($e) {                                                                        // 842
                var active, isActive, hasActive;                                                                       // 843
                active = document.activeElement;                                                                       // 844
                isActive = $menu.is(active);                                                                           // 845
                hasActive = $menu.has(active).length > 0;                                                              // 846
                if (_.isMsie() && (isActive || hasActive)) {                                                           // 847
                    $e.preventDefault();                                                                               // 848
                    $e.stopImmediatePropagation();                                                                     // 849
                    _.defer(function() {                                                                               // 850
                        $input.focus();                                                                                // 851
                    });                                                                                                // 852
                }                                                                                                      // 853
            });                                                                                                        // 854
            $menu.on("mousedown.tt", function($e) {                                                                    // 855
                $e.preventDefault();                                                                                   // 856
            });                                                                                                        // 857
            this.eventBus = o.eventBus || new EventBus({                                                               // 858
                el: $input                                                                                             // 859
            });                                                                                                        // 860
            this.dropdown = new Dropdown({                                                                             // 861
                menu: $menu,                                                                                           // 862
                datasets: o.datasets                                                                                   // 863
            }).onSync("suggestionClicked", this._onSuggestionClicked, this).onSync("cursorMoved", this._onCursorMoved, this).onSync("cursorRemoved", this._onCursorRemoved, this).onSync("opened", this._onOpened, this).onSync("closed", this._onClosed, this).onAsync("datasetRendered", this._onDatasetRendered, this);
            this.input = new Input({                                                                                   // 865
                input: $input,                                                                                         // 866
                hint: $hint                                                                                            // 867
            }).onSync("focused", this._onFocused, this).onSync("blurred", this._onBlurred, this).onSync("enterKeyed", this._onEnterKeyed, this).onSync("tabKeyed", this._onTabKeyed, this).onSync("escKeyed", this._onEscKeyed, this).onSync("upKeyed", this._onUpKeyed, this).onSync("downKeyed", this._onDownKeyed, this).onSync("leftKeyed", this._onLeftKeyed, this).onSync("rightKeyed", this._onRightKeyed, this).onSync("queryChanged", this._onQueryChanged, this).onSync("whitespaceChanged", this._onWhitespaceChanged, this);
            this._setLanguageDirection();                                                                              // 869
        }                                                                                                              // 870
        _.mixin(Typeahead.prototype, {                                                                                 // 871
            _onSuggestionClicked: function onSuggestionClicked(type, $el) {                                            // 872
                var datum;                                                                                             // 873
                if (datum = this.dropdown.getDatumForSuggestion($el)) {                                                // 874
                    this._select(datum);                                                                               // 875
                }                                                                                                      // 876
            },                                                                                                         // 877
            _onCursorMoved: function onCursorMoved() {                                                                 // 878
                var datum = this.dropdown.getDatumForCursor();                                                         // 879
                this.input.setInputValue(datum.value, true);                                                           // 880
                this.eventBus.trigger("cursorchanged", datum.raw, datum.datasetName);                                  // 881
            },                                                                                                         // 882
            _onCursorRemoved: function onCursorRemoved() {                                                             // 883
                this.input.resetInputValue();                                                                          // 884
                this._updateHint();                                                                                    // 885
            },                                                                                                         // 886
            _onDatasetRendered: function onDatasetRendered() {                                                         // 887
                this._updateHint();                                                                                    // 888
            },                                                                                                         // 889
            _onOpened: function onOpened() {                                                                           // 890
                this._updateHint();                                                                                    // 891
                this.eventBus.trigger("opened");                                                                       // 892
            },                                                                                                         // 893
            _onClosed: function onClosed() {                                                                           // 894
                this.input.clearHint();                                                                                // 895
                this.eventBus.trigger("closed");                                                                       // 896
            },                                                                                                         // 897
            _onFocused: function onFocused() {                                                                         // 898
                this.isActivated = true;                                                                               // 899
                this.dropdown.open();                                                                                  // 900
            },                                                                                                         // 901
            _onBlurred: function onBlurred() {                                                                         // 902
                this.isActivated = false;                                                                              // 903
                this.dropdown.empty();                                                                                 // 904
                this.dropdown.close();                                                                                 // 905
            },                                                                                                         // 906
            _onEnterKeyed: function onEnterKeyed(type, $e) {                                                           // 907
                var cursorDatum, topSuggestionDatum;                                                                   // 908
                cursorDatum = this.dropdown.getDatumForCursor();                                                       // 909
                topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();                                         // 910
                if (cursorDatum) {                                                                                     // 911
                    this._select(cursorDatum);                                                                         // 912
                    $e.preventDefault();                                                                               // 913
                } else if (this.autoselect && topSuggestionDatum) {                                                    // 914
                    this._select(topSuggestionDatum);                                                                  // 915
                    $e.preventDefault();                                                                               // 916
                }                                                                                                      // 917
            },                                                                                                         // 918
            _onTabKeyed: function onTabKeyed(type, $e) {                                                               // 919
                var datum;                                                                                             // 920
                if (datum = this.dropdown.getDatumForCursor()) {                                                       // 921
                    this._select(datum);                                                                               // 922
                    $e.preventDefault();                                                                               // 923
                } else {                                                                                               // 924
                    this._autocomplete(true);                                                                          // 925
                }                                                                                                      // 926
            },                                                                                                         // 927
            _onEscKeyed: function onEscKeyed() {                                                                       // 928
                this.dropdown.close();                                                                                 // 929
                this.input.resetInputValue();                                                                          // 930
            },                                                                                                         // 931
            _onUpKeyed: function onUpKeyed() {                                                                         // 932
                var query = this.input.getQuery();                                                                     // 933
                this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorUp();
                this.dropdown.open();                                                                                  // 935
            },                                                                                                         // 936
            _onDownKeyed: function onDownKeyed() {                                                                     // 937
                var query = this.input.getQuery();                                                                     // 938
                this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorDown();
                this.dropdown.open();                                                                                  // 940
            },                                                                                                         // 941
            _onLeftKeyed: function onLeftKeyed() {                                                                     // 942
                this.dir === "rtl" && this._autocomplete();                                                            // 943
            },                                                                                                         // 944
            _onRightKeyed: function onRightKeyed() {                                                                   // 945
                this.dir === "ltr" && this._autocomplete();                                                            // 946
            },                                                                                                         // 947
            _onQueryChanged: function onQueryChanged(e, query) {                                                       // 948
                this.input.clearHintIfInvalid();                                                                       // 949
                query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.empty();                  // 950
                this.dropdown.open();                                                                                  // 951
                this._setLanguageDirection();                                                                          // 952
            },                                                                                                         // 953
            _onWhitespaceChanged: function onWhitespaceChanged() {                                                     // 954
                this._updateHint();                                                                                    // 955
                this.dropdown.open();                                                                                  // 956
            },                                                                                                         // 957
            _setLanguageDirection: function setLanguageDirection() {                                                   // 958
                var dir;                                                                                               // 959
                if (this.dir !== (dir = this.input.getLanguageDirection())) {                                          // 960
                    this.dir = dir;                                                                                    // 961
                    this.$node.css("direction", dir);                                                                  // 962
                    this.dropdown.setLanguageDirection(dir);                                                           // 963
                }                                                                                                      // 964
            },                                                                                                         // 965
            _updateHint: function updateHint() {                                                                       // 966
                var datum, val, query, escapedQuery, frontMatchRegEx, match;                                           // 967
                datum = this.dropdown.getDatumForTopSuggestion();                                                      // 968
                if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {                                 // 969
                    val = this.input.getInputValue();                                                                  // 970
                    query = Input.normalizeQuery(val);                                                                 // 971
                    escapedQuery = _.escapeRegExChars(query);                                                          // 972
                    frontMatchRegEx = new RegExp("^(?:" + escapedQuery + ")(.+$)", "i");                               // 973
                    match = frontMatchRegEx.exec(datum.value);                                                         // 974
                    match ? this.input.setHint(val + match[1]) : this.input.clearHint();                               // 975
                } else {                                                                                               // 976
                    this.input.clearHint();                                                                            // 977
                }                                                                                                      // 978
            },                                                                                                         // 979
            _autocomplete: function autocomplete(laxCursor) {                                                          // 980
                var hint, query, isCursorAtEnd, datum;                                                                 // 981
                hint = this.input.getHint();                                                                           // 982
                query = this.input.getQuery();                                                                         // 983
                isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();                                               // 984
                if (hint && query !== hint && isCursorAtEnd) {                                                         // 985
                    datum = this.dropdown.getDatumForTopSuggestion();                                                  // 986
                    datum && this.input.setInputValue(datum.value);                                                    // 987
                    this.eventBus.trigger("autocompleted", datum.raw, datum.datasetName);                              // 988
                }                                                                                                      // 989
            },                                                                                                         // 990
            _select: function select(datum) {                                                                          // 991
                this.input.setQuery(datum.value);                                                                      // 992
                this.input.setInputValue(datum.value, true);                                                           // 993
                this._setLanguageDirection();                                                                          // 994
                this.eventBus.trigger("selected", datum.raw, datum.datasetName);                                       // 995
                this.dropdown.close();                                                                                 // 996
                _.defer(_.bind(this.dropdown.empty, this.dropdown));                                                   // 997
            },                                                                                                         // 998
            open: function open() {                                                                                    // 999
                this.dropdown.open();                                                                                  // 1000
            },                                                                                                         // 1001
            close: function close() {                                                                                  // 1002
                this.dropdown.close();                                                                                 // 1003
            },                                                                                                         // 1004
            setVal: function setVal(val) {                                                                             // 1005
                if (this.isActivated) {                                                                                // 1006
                    this.input.setInputValue(val);                                                                     // 1007
                } else {                                                                                               // 1008
                    this.input.setQuery(val);                                                                          // 1009
                    this.input.setInputValue(val, true);                                                               // 1010
                }                                                                                                      // 1011
                this._setLanguageDirection();                                                                          // 1012
            },                                                                                                         // 1013
            getVal: function getVal() {                                                                                // 1014
                return this.input.getQuery();                                                                          // 1015
            },                                                                                                         // 1016
            destroy: function destroy() {                                                                              // 1017
                this.input.destroy();                                                                                  // 1018
                this.dropdown.destroy();                                                                               // 1019
                destroyDomStructure(this.$node);                                                                       // 1020
                this.$node = null;                                                                                     // 1021
            }                                                                                                          // 1022
        });                                                                                                            // 1023
        return Typeahead;                                                                                              // 1024
        function buildDomStructure(input, withHint) {                                                                  // 1025
            var $input, $wrapper, $dropdown, $hint;                                                                    // 1026
            $input = $(input);                                                                                         // 1027
            $wrapper = $(html.wrapper).css(css.wrapper);                                                               // 1028
            $dropdown = $(html.dropdown).css(css.dropdown);                                                            // 1029
            $hint = $input.clone().css(css.hint).css(getBackgroundStyles($input));                                     // 1030
            $hint.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled", true).attr({
                autocomplete: "off",                                                                                   // 1032
                spellcheck: "false"                                                                                    // 1033
            });                                                                                                        // 1034
            $input.data(attrsKey, {                                                                                    // 1035
                dir: $input.attr("dir"),                                                                               // 1036
                autocomplete: $input.attr("autocomplete"),                                                             // 1037
                spellcheck: $input.attr("spellcheck"),                                                                 // 1038
                style: $input.attr("style")                                                                            // 1039
            });                                                                                                        // 1040
            $input.addClass("tt-input").attr({                                                                         // 1041
                autocomplete: "off",                                                                                   // 1042
                spellcheck: false                                                                                      // 1043
            }).css(withHint ? css.input : css.inputWithNoHint);                                                        // 1044
            try {                                                                                                      // 1045
                !$input.attr("dir") && $input.attr("dir", "auto");                                                     // 1046
            } catch (e) {}                                                                                             // 1047
            return $input.wrap($wrapper).parent().prepend(withHint ? $hint : null).append($dropdown);                  // 1048
        }                                                                                                              // 1049
        function getBackgroundStyles($el) {                                                                            // 1050
            return {                                                                                                   // 1051
                backgroundAttachment: $el.css("background-attachment"),                                                // 1052
                backgroundClip: $el.css("background-clip"),                                                            // 1053
                backgroundColor: $el.css("background-color"),                                                          // 1054
                backgroundImage: $el.css("background-image"),                                                          // 1055
                backgroundOrigin: $el.css("background-origin"),                                                        // 1056
                backgroundPosition: $el.css("background-position"),                                                    // 1057
                backgroundRepeat: $el.css("background-repeat"),                                                        // 1058
                backgroundSize: $el.css("background-size")                                                             // 1059
            };                                                                                                         // 1060
        }                                                                                                              // 1061
        function destroyDomStructure($node) {                                                                          // 1062
            var $input = $node.find(".tt-input");                                                                      // 1063
            _.each($input.data(attrsKey), function(val, key) {                                                         // 1064
                _.isUndefined(val) ? $input.removeAttr(key) : $input.attr(key, val);                                   // 1065
            });                                                                                                        // 1066
            $input.detach().removeData(attrsKey).removeClass("tt-input").insertAfter($node);                           // 1067
            $node.remove();                                                                                            // 1068
        }                                                                                                              // 1069
    }();                                                                                                               // 1070
    (function() {                                                                                                      // 1071
        var old, typeaheadKey, methods;                                                                                // 1072
        old = $.fn.typeahead;                                                                                          // 1073
        typeaheadKey = "ttTypeahead";                                                                                  // 1074
        methods = {                                                                                                    // 1075
            initialize: function initialize(o, datasets) {                                                             // 1076
                datasets = _.isArray(datasets) ? datasets : [].slice.call(arguments, 1);                               // 1077
                o = o || {};                                                                                           // 1078
                return this.each(attach);                                                                              // 1079
                function attach() {                                                                                    // 1080
                    var $input = $(this), eventBus, typeahead;                                                         // 1081
                    _.each(datasets, function(d) {                                                                     // 1082
                        d.highlight = !!o.highlight;                                                                   // 1083
                    });                                                                                                // 1084
                    typeahead = new Typeahead({                                                                        // 1085
                        input: $input,                                                                                 // 1086
                        eventBus: eventBus = new EventBus({                                                            // 1087
                            el: $input                                                                                 // 1088
                        }),                                                                                            // 1089
                        withHint: _.isUndefined(o.hint) ? true : !!o.hint,                                             // 1090
                        minLength: o.minLength,                                                                        // 1091
                        autoselect: o.autoselect,                                                                      // 1092
                        datasets: datasets                                                                             // 1093
                    });                                                                                                // 1094
                    $input.data(typeaheadKey, typeahead);                                                              // 1095
                }                                                                                                      // 1096
            },                                                                                                         // 1097
            open: function open() {                                                                                    // 1098
                return this.each(openTypeahead);                                                                       // 1099
                function openTypeahead() {                                                                             // 1100
                    var $input = $(this), typeahead;                                                                   // 1101
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1102
                        typeahead.open();                                                                              // 1103
                    }                                                                                                  // 1104
                }                                                                                                      // 1105
            },                                                                                                         // 1106
            close: function close() {                                                                                  // 1107
                return this.each(closeTypeahead);                                                                      // 1108
                function closeTypeahead() {                                                                            // 1109
                    var $input = $(this), typeahead;                                                                   // 1110
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1111
                        typeahead.close();                                                                             // 1112
                    }                                                                                                  // 1113
                }                                                                                                      // 1114
            },                                                                                                         // 1115
            val: function val(newVal) {                                                                                // 1116
                return !arguments.length ? getVal(this.first()) : this.each(setVal);                                   // 1117
                function setVal() {                                                                                    // 1118
                    var $input = $(this), typeahead;                                                                   // 1119
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1120
                        typeahead.setVal(newVal);                                                                      // 1121
                    }                                                                                                  // 1122
                }                                                                                                      // 1123
                function getVal($input) {                                                                              // 1124
                    var typeahead, query;                                                                              // 1125
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1126
                        query = typeahead.getVal();                                                                    // 1127
                    }                                                                                                  // 1128
                    return query;                                                                                      // 1129
                }                                                                                                      // 1130
            },                                                                                                         // 1131
            destroy: function destroy() {                                                                              // 1132
                return this.each(unattach);                                                                            // 1133
                function unattach() {                                                                                  // 1134
                    var $input = $(this), typeahead;                                                                   // 1135
                    if (typeahead = $input.data(typeaheadKey)) {                                                       // 1136
                        typeahead.destroy();                                                                           // 1137
                        $input.removeData(typeaheadKey);                                                               // 1138
                    }                                                                                                  // 1139
                }                                                                                                      // 1140
            }                                                                                                          // 1141
        };                                                                                                             // 1142
        $.fn.typeahead = function(method) {                                                                            // 1143
            if (methods[method]) {                                                                                     // 1144
                return methods[method].apply(this, [].slice.call(arguments, 1));                                       // 1145
            } else {                                                                                                   // 1146
                return methods.initialize.apply(this, arguments);                                                      // 1147
            }                                                                                                          // 1148
        };                                                                                                             // 1149
        $.fn.typeahead.noConflict = function noConflict() {                                                            // 1150
            $.fn.typeahead = old;                                                                                      // 1151
            return this;                                                                                               // 1152
        };                                                                                                             // 1153
    })();                                                                                                              // 1154
})(window.jQuery);                                                                                                     // 1155
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/beautify-html.js                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/*jshint curly:true, eqeqeq:true, laxbreak:true, noempty:false */                                                      // 1
/*                                                                                                                     // 2
                                                                                                                       // 3
  The MIT License (MIT)                                                                                                // 4
                                                                                                                       // 5
  Copyright (c) 2007-2013 Einar Lielmanis and contributors.                                                            // 6
                                                                                                                       // 7
  Permission is hereby granted, free of charge, to any person                                                          // 8
  obtaining a copy of this software and associated documentation files                                                 // 9
  (the "Software"), to deal in the Software without restriction,                                                       // 10
  including without limitation the rights to use, copy, modify, merge,                                                 // 11
  publish, distribute, sublicense, and/or sell copies of the Software,                                                 // 12
  and to permit persons to whom the Software is furnished to do so,                                                    // 13
  subject to the following conditions:                                                                                 // 14
                                                                                                                       // 15
  The above copyright notice and this permission notice shall be                                                       // 16
  included in all copies or substantial portions of the Software.                                                      // 17
                                                                                                                       // 18
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,                                                      // 19
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF                                                   // 20
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND                                                                // 21
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS                                                  // 22
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN                                                   // 23
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN                                                    // 24
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE                                                     // 25
  SOFTWARE.                                                                                                            // 26
                                                                                                                       // 27
                                                                                                                       // 28
 Style HTML                                                                                                            // 29
---------------                                                                                                        // 30
                                                                                                                       // 31
  Written by Nochum Sossonko, (nsossonko@hotmail.com)                                                                  // 32
                                                                                                                       // 33
  Based on code initially developed by: Einar Lielmanis, <einar@jsbeautifier.org>                                      // 34
    http://jsbeautifier.org/                                                                                           // 35
                                                                                                                       // 36
  Usage:                                                                                                               // 37
    style_html(html_source);                                                                                           // 38
                                                                                                                       // 39
    style_html(html_source, options);                                                                                  // 40
                                                                                                                       // 41
  The options are:                                                                                                     // 42
    indent_inner_html (default false)  — indent <head> and <body> sections,                                            // 43
    indent_size (default 4)          — indentation size,                                                               // 44
    indent_char (default space)      — character to indent with,                                                       // 45
    wrap_line_length (default 250)            -  maximum amount of characters per line (0 = disable)                   // 46
    brace_style (default "collapse") - "collapse" | "expand" | "end-expand"                                            // 47
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.
    unformatted (defaults to inline tags) - list of tags, that shouldn't be reformatted                                // 49
    indent_scripts (default normal)  - "keep"|"separate"|"normal"                                                      // 50
    preserve_newlines (default true) - whether existing line breaks before elements should be preserved                // 51
                                        Only works before elements, not inside tags or for text.                       // 52
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk             // 53
    indent_handlebars (default false) - format and indent {{#foo}} and {{/foo}}                                        // 54
                                                                                                                       // 55
    e.g.                                                                                                               // 56
                                                                                                                       // 57
    style_html(html_source, {                                                                                          // 58
      'indent_inner_html': false,                                                                                      // 59
      'indent_size': 2,                                                                                                // 60
      'indent_char': ' ',                                                                                              // 61
      'wrap_line_length': 78,                                                                                          // 62
      'brace_style': 'expand',                                                                                         // 63
      'unformatted': ['a', 'sub', 'sup', 'b', 'i', 'u'],                                                               // 64
      'preserve_newlines': true,                                                                                       // 65
      'max_preserve_newlines': 5,                                                                                      // 66
      'indent_handlebars': false                                                                                       // 67
    });                                                                                                                // 68
*/                                                                                                                     // 69
                                                                                                                       // 70
(function() {                                                                                                          // 71
                                                                                                                       // 72
    function trim(s) {                                                                                                 // 73
        return s.replace(/^\s+|\s+$/g, '');                                                                            // 74
    }                                                                                                                  // 75
                                                                                                                       // 76
    function ltrim(s) {                                                                                                // 77
        return s.replace(/^\s+/g, '');                                                                                 // 78
    }                                                                                                                  // 79
                                                                                                                       // 80
    function style_html(html_source, options, js_beautify, css_beautify) {                                             // 81
        //Wrapper function to invoke all the necessary constructors and deal with the output.                          // 82
                                                                                                                       // 83
        var multi_parser,                                                                                              // 84
            indent_inner_html,                                                                                         // 85
            indent_size,                                                                                               // 86
            indent_character,                                                                                          // 87
            wrap_line_length,                                                                                          // 88
            brace_style,                                                                                               // 89
            unformatted,                                                                                               // 90
            preserve_newlines,                                                                                         // 91
            max_preserve_newlines,                                                                                     // 92
            indent_handlebars;                                                                                         // 93
                                                                                                                       // 94
        options = options || {};                                                                                       // 95
                                                                                                                       // 96
        // backwards compatibility to 1.3.4                                                                            // 97
        if ((options.wrap_line_length === undefined || parseInt(options.wrap_line_length, 10) === 0) &&                // 98
                (options.max_char !== undefined && parseInt(options.max_char, 10) !== 0)) {                            // 99
            options.wrap_line_length = options.max_char;                                                               // 100
        }                                                                                                              // 101
                                                                                                                       // 102
        indent_inner_html = (options.indent_inner_html === undefined) ? false : options.indent_inner_html;             // 103
        indent_size = (options.indent_size === undefined) ? 4 : parseInt(options.indent_size, 10);                     // 104
        indent_character = (options.indent_char === undefined) ? ' ' : options.indent_char;                            // 105
        brace_style = (options.brace_style === undefined) ? 'collapse' : options.brace_style;                          // 106
        wrap_line_length =  parseInt(options.wrap_line_length, 10) === 0 ? 32786 : parseInt(options.wrap_line_length || 250, 10);
        unformatted = options.unformatted || ['a', 'span', 'bdo', 'em', 'strong', 'dfn', 'code', 'samp', 'kbd', 'var', 'cite', 'abbr', 'acronym', 'q', 'sub', 'sup', 'tt', 'i', 'b', 'big', 'small', 'u', 's', 'strike', 'font', 'ins', 'del', 'pre', 'address', 'dt', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];
        preserve_newlines = (options.preserve_newlines === undefined) ? true : options.preserve_newlines;              // 109
        max_preserve_newlines = preserve_newlines ?                                                                    // 110
            (isNaN(parseInt(options.max_preserve_newlines, 10)) ? 32786 : parseInt(options.max_preserve_newlines, 10))
            : 0;                                                                                                       // 112
        indent_handlebars = (options.indent_handlebars === undefined) ? false : options.indent_handlebars;             // 113
                                                                                                                       // 114
        function Parser() {                                                                                            // 115
                                                                                                                       // 116
            this.pos = 0; //Parser position                                                                            // 117
            this.token = '';                                                                                           // 118
            this.current_mode = 'CONTENT'; //reflects the current Parser mode: TAG/CONTENT                             // 119
            this.tags = { //An object to hold tags, their position, and their parent-tags, initiated with default values
                parent: 'parent1',                                                                                     // 121
                parentcount: 1,                                                                                        // 122
                parent1: ''                                                                                            // 123
            };                                                                                                         // 124
            this.tag_type = '';                                                                                        // 125
            this.token_text = this.last_token = this.last_text = this.token_type = '';                                 // 126
            this.newlines = 0;                                                                                         // 127
            this.indent_content = indent_inner_html;                                                                   // 128
                                                                                                                       // 129
            this.Utils = { //Uilities made available to the various functions                                          // 130
                whitespace: "\n\r\t ".split(''),                                                                       // 131
                single_token: 'br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?='.split(','), //all the single tags for HTML
                extra_liners: 'head,body,/html'.split(','), //for tags that need a line of whitespace before them      // 133
                in_array: function(what, arr) {                                                                        // 134
                    for (var i = 0; i < arr.length; i++) {                                                             // 135
                        if (what === arr[i]) {                                                                         // 136
                            return true;                                                                               // 137
                        }                                                                                              // 138
                    }                                                                                                  // 139
                    return false;                                                                                      // 140
                }                                                                                                      // 141
            };                                                                                                         // 142
                                                                                                                       // 143
            this.traverse_whitespace = function() {                                                                    // 144
                var input_char = '';                                                                                   // 145
                                                                                                                       // 146
                input_char = this.input.charAt(this.pos);                                                              // 147
                if (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                          // 148
                    this.newlines = 0;                                                                                 // 149
                    while (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                   // 150
                        if (preserve_newlines && input_char === '\n' && this.newlines <= max_preserve_newlines) {      // 151
                            this.newlines += 1;                                                                        // 152
                        }                                                                                              // 153
                                                                                                                       // 154
                        this.pos++;                                                                                    // 155
                        input_char = this.input.charAt(this.pos);                                                      // 156
                    }                                                                                                  // 157
                    return true;                                                                                       // 158
                }                                                                                                      // 159
                return false;                                                                                          // 160
            };                                                                                                         // 161
                                                                                                                       // 162
            this.get_content = function() { //function to capture regular content between tags                         // 163
                                                                                                                       // 164
                var input_char = '',                                                                                   // 165
                    content = [],                                                                                      // 166
                    space = false; //if a space is needed                                                              // 167
                                                                                                                       // 168
                while (this.input.charAt(this.pos) !== '<') {                                                          // 169
                    if (this.pos >= this.input.length) {                                                               // 170
                        return content.length ? content.join('') : ['', 'TK_EOF'];                                     // 171
                    }                                                                                                  // 172
                                                                                                                       // 173
                    if (this.traverse_whitespace()) {                                                                  // 174
                        if (content.length) {                                                                          // 175
                            space = true;                                                                              // 176
                        }                                                                                              // 177
                        continue; //don't want to insert unnecessary space                                             // 178
                    }                                                                                                  // 179
                                                                                                                       // 180
                    if (indent_handlebars) {                                                                           // 181
                        // Handlebars parsing is complicated.                                                          // 182
                        // {{#foo}} and {{/foo}} are formatted tags.                                                   // 183
                        // {{something}} should get treated as content, except:                                        // 184
                        // {{else}} specifically behaves like {{#if}} and {{/if}}                                      // 185
                        var peek3 = this.input.substr(this.pos, 3);                                                    // 186
                        if (peek3 === '{{#' || peek3 === '{{/') {                                                      // 187
                            // These are tags and not content.                                                         // 188
                            break;                                                                                     // 189
                        } else if (this.input.substr(this.pos, 2) === '{{') {                                          // 190
                            if (this.get_tag(true) === '{{else}}') {                                                   // 191
                                break;                                                                                 // 192
                            }                                                                                          // 193
                        }                                                                                              // 194
                    }                                                                                                  // 195
                                                                                                                       // 196
                    input_char = this.input.charAt(this.pos);                                                          // 197
                    this.pos++;                                                                                        // 198
                                                                                                                       // 199
                    if (space) {                                                                                       // 200
                        if (this.line_char_count >= this.wrap_line_length) { //insert a line when the wrap_line_length is reached
                            this.print_newline(false, content);                                                        // 202
                            this.print_indentation(content);                                                           // 203
                        } else {                                                                                       // 204
                            this.line_char_count++;                                                                    // 205
                            content.push(' ');                                                                         // 206
                        }                                                                                              // 207
                        space = false;                                                                                 // 208
                    }                                                                                                  // 209
                    this.line_char_count++;                                                                            // 210
                    content.push(input_char); //letter at-a-time (or string) inserted to an array                      // 211
                }                                                                                                      // 212
                return content.length ? content.join('') : '';                                                         // 213
            };                                                                                                         // 214
                                                                                                                       // 215
            this.get_contents_to = function(name) { //get the full content of a script or style to pass to js_beautify
                if (this.pos === this.input.length) {                                                                  // 217
                    return ['', 'TK_EOF'];                                                                             // 218
                }                                                                                                      // 219
                var input_char = '';                                                                                   // 220
                var content = '';                                                                                      // 221
                var reg_match = new RegExp('</' + name + '\\s*>', 'igm');                                              // 222
                reg_match.lastIndex = this.pos;                                                                        // 223
                var reg_array = reg_match.exec(this.input);                                                            // 224
                var end_script = reg_array ? reg_array.index : this.input.length; //absolute end of script             // 225
                if (this.pos < end_script) { //get everything in between the script tags                               // 226
                    content = this.input.substring(this.pos, end_script);                                              // 227
                    this.pos = end_script;                                                                             // 228
                }                                                                                                      // 229
                return content;                                                                                        // 230
            };                                                                                                         // 231
                                                                                                                       // 232
            this.record_tag = function(tag) { //function to record a tag and its parent in this.tags Object            // 233
                if (this.tags[tag + 'count']) { //check for the existence of this tag type                             // 234
                    this.tags[tag + 'count']++;                                                                        // 235
                    this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level
                } else { //otherwise initialize this tag type                                                          // 237
                    this.tags[tag + 'count'] = 1;                                                                      // 238
                    this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level
                }                                                                                                      // 240
                this.tags[tag + this.tags[tag + 'count'] + 'parent'] = this.tags.parent; //set the parent (i.e. in the case of a div this.tags.div1parent)
                this.tags.parent = tag + this.tags[tag + 'count']; //and make this the current parent (i.e. in the case of a div 'div1')
            };                                                                                                         // 243
                                                                                                                       // 244
            this.retrieve_tag = function(tag) { //function to retrieve the opening tag to the corresponding closer     // 245
                if (this.tags[tag + 'count']) { //if the openener is not in the Object we ignore it                    // 246
                    var temp_parent = this.tags.parent; //check to see if it's a closable tag.                         // 247
                    while (temp_parent) { //till we reach '' (the initial value);                                      // 248
                        if (tag + this.tags[tag + 'count'] === temp_parent) { //if this is it use it                   // 249
                            break;                                                                                     // 250
                        }                                                                                              // 251
                        temp_parent = this.tags[temp_parent + 'parent']; //otherwise keep on climbing up the DOM Tree  // 252
                    }                                                                                                  // 253
                    if (temp_parent) { //if we caught something                                                        // 254
                        this.indent_level = this.tags[tag + this.tags[tag + 'count']]; //set the indent_level accordingly
                        this.tags.parent = this.tags[temp_parent + 'parent']; //and set the current parent             // 256
                    }                                                                                                  // 257
                    delete this.tags[tag + this.tags[tag + 'count'] + 'parent']; //delete the closed tags parent reference...
                    delete this.tags[tag + this.tags[tag + 'count']]; //...and the tag itself                          // 259
                    if (this.tags[tag + 'count'] === 1) {                                                              // 260
                        delete this.tags[tag + 'count'];                                                               // 261
                    } else {                                                                                           // 262
                        this.tags[tag + 'count']--;                                                                    // 263
                    }                                                                                                  // 264
                }                                                                                                      // 265
            };                                                                                                         // 266
                                                                                                                       // 267
            this.indent_to_tag = function(tag) {                                                                       // 268
                // Match the indentation level to the last use of this tag, but don't remove it.                       // 269
                if (!this.tags[tag + 'count']) {                                                                       // 270
                    return;                                                                                            // 271
                }                                                                                                      // 272
                var temp_parent = this.tags.parent;                                                                    // 273
                while (temp_parent) {                                                                                  // 274
                    if (tag + this.tags[tag + 'count'] === temp_parent) {                                              // 275
                        break;                                                                                         // 276
                    }                                                                                                  // 277
                    temp_parent = this.tags[temp_parent + 'parent'];                                                   // 278
                }                                                                                                      // 279
                if (temp_parent) {                                                                                     // 280
                    this.indent_level = this.tags[tag + this.tags[tag + 'count']];                                     // 281
                }                                                                                                      // 282
            };                                                                                                         // 283
                                                                                                                       // 284
            this.get_tag = function(peek) { //function to get a full tag and parse its type                            // 285
                var input_char = '',                                                                                   // 286
                    content = [],                                                                                      // 287
                    comment = '',                                                                                      // 288
                    space = false,                                                                                     // 289
                    tag_start, tag_end,                                                                                // 290
                    tag_start_char,                                                                                    // 291
                    orig_pos = this.pos,                                                                               // 292
                    orig_line_char_count = this.line_char_count;                                                       // 293
                                                                                                                       // 294
                peek = peek !== undefined ? peek : false;                                                              // 295
                                                                                                                       // 296
                do {                                                                                                   // 297
                    if (this.pos >= this.input.length) {                                                               // 298
                        if (peek) {                                                                                    // 299
                            this.pos = orig_pos;                                                                       // 300
                            this.line_char_count = orig_line_char_count;                                               // 301
                        }                                                                                              // 302
                        return content.length ? content.join('') : ['', 'TK_EOF'];                                     // 303
                    }                                                                                                  // 304
                                                                                                                       // 305
                    input_char = this.input.charAt(this.pos);                                                          // 306
                    this.pos++;                                                                                        // 307
                                                                                                                       // 308
                    if (this.Utils.in_array(input_char, this.Utils.whitespace)) { //don't want to insert unnecessary space
                        space = true;                                                                                  // 310
                        continue;                                                                                      // 311
                    }                                                                                                  // 312
                                                                                                                       // 313
                    if (input_char === "'" || input_char === '"') {                                                    // 314
                        input_char += this.get_unformatted(input_char);                                                // 315
                        space = true;                                                                                  // 316
                                                                                                                       // 317
                    }                                                                                                  // 318
                                                                                                                       // 319
                    if (input_char === '=') { //no space before =                                                      // 320
                        space = false;                                                                                 // 321
                    }                                                                                                  // 322
                                                                                                                       // 323
                    if (content.length && content[content.length - 1] !== '=' && input_char !== '>' && space) {        // 324
                        //no space after = or before >                                                                 // 325
                        if (this.line_char_count >= this.wrap_line_length) {                                           // 326
                            this.print_newline(false, content);                                                        // 327
                            this.print_indentation(content);                                                           // 328
                        } else {                                                                                       // 329
                            content.push(' ');                                                                         // 330
                            this.line_char_count++;                                                                    // 331
                        }                                                                                              // 332
                        space = false;                                                                                 // 333
                    }                                                                                                  // 334
                                                                                                                       // 335
                    if (indent_handlebars && tag_start_char === '<') {                                                 // 336
                        // When inside an angle-bracket tag, put spaces around                                         // 337
                        // handlebars not inside of strings.                                                           // 338
                        if ((input_char + this.input.charAt(this.pos)) === '{{') {                                     // 339
                            input_char += this.get_unformatted('}}');                                                  // 340
                            if (content.length && content[content.length - 1] !== ' ' && content[content.length - 1] !== '<') {
                                input_char = ' ' + input_char;                                                         // 342
                            }                                                                                          // 343
                            space = true;                                                                              // 344
                        }                                                                                              // 345
                    }                                                                                                  // 346
                                                                                                                       // 347
                    if (input_char === '<' && !tag_start_char) {                                                       // 348
                        tag_start = this.pos - 1;                                                                      // 349
                        tag_start_char = '<';                                                                          // 350
                    }                                                                                                  // 351
                                                                                                                       // 352
                    if (indent_handlebars && !tag_start_char) {                                                        // 353
                        if (content.length >= 2 && content[content.length - 1] === '{' && content[content.length - 2] == '{') {
                            if (input_char === '#' || input_char === '/') {                                            // 355
                                tag_start = this.pos - 3;                                                              // 356
                            } else {                                                                                   // 357
                                tag_start = this.pos - 2;                                                              // 358
                            }                                                                                          // 359
                            tag_start_char = '{';                                                                      // 360
                        }                                                                                              // 361
                    }                                                                                                  // 362
                                                                                                                       // 363
                    this.line_char_count++;                                                                            // 364
                    content.push(input_char); //inserts character at-a-time (or string)                                // 365
                                                                                                                       // 366
                    if (content[1] && content[1] === '!') { //if we're in a comment, do something special              // 367
                        // We treat all comments as literals, even more than preformatted tags                         // 368
                        // we just look for the appropriate close tag                                                  // 369
                        content = [this.get_comment(tag_start)];                                                       // 370
                        break;                                                                                         // 371
                    }                                                                                                  // 372
                                                                                                                       // 373
                    if (indent_handlebars && tag_start_char === '{' && content.length > 2 && content[content.length - 2] === '}' && content[content.length - 1] === '}') {
                        break;                                                                                         // 375
                    }                                                                                                  // 376
                } while (input_char !== '>');                                                                          // 377
                                                                                                                       // 378
                var tag_complete = content.join('');                                                                   // 379
                var tag_index;                                                                                         // 380
                var tag_offset;                                                                                        // 381
                                                                                                                       // 382
                if (tag_complete.indexOf(' ') !== -1) { //if there's whitespace, thats where the tag name ends         // 383
                    tag_index = tag_complete.indexOf(' ');                                                             // 384
                } else if (tag_complete[0] === '{') {                                                                  // 385
                    tag_index = tag_complete.indexOf('}');                                                             // 386
                } else { //otherwise go with the tag ending                                                            // 387
                    tag_index = tag_complete.indexOf('>');                                                             // 388
                }                                                                                                      // 389
                if (tag_complete[0] === '<' || !indent_handlebars) {                                                   // 390
                    tag_offset = 1;                                                                                    // 391
                } else {                                                                                               // 392
                    tag_offset = tag_complete[2] === '#' ? 3 : 2;                                                      // 393
                }                                                                                                      // 394
                var tag_check = tag_complete.substring(tag_offset, tag_index).toLowerCase();                           // 395
                if (tag_complete.charAt(tag_complete.length - 2) === '/' ||                                            // 396
                    this.Utils.in_array(tag_check, this.Utils.single_token)) { //if this tag name is a single tag type (either in the list or has a closing /)
                    if (!peek) {                                                                                       // 398
                        this.tag_type = 'SINGLE';                                                                      // 399
                    }                                                                                                  // 400
                } else if (indent_handlebars && tag_complete[0] === '{' && tag_check === 'else') {                     // 401
                    if (!peek) {                                                                                       // 402
                        this.indent_to_tag('if');                                                                      // 403
                        this.tag_type = 'HANDLEBARS_ELSE';                                                             // 404
                        this.indent_content = true;                                                                    // 405
                        this.traverse_whitespace();                                                                    // 406
                    }                                                                                                  // 407
                } else if (tag_check === 'script' &&                                                                   // 408
                    (tag_complete.search('type') === -1 ||                                                             // 409
                    (tag_complete.search('type') > -1 &&                                                               // 410
                    tag_complete.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/) > -1))) {
                    if (!peek) {                                                                                       // 412
                        this.record_tag(tag_check);                                                                    // 413
                        this.tag_type = 'SCRIPT';                                                                      // 414
                    }                                                                                                  // 415
                } else if (tag_check === 'style' &&                                                                    // 416
                    (tag_complete.search('type') === -1 ||                                                             // 417
                    (tag_complete.search('type') > -1 && tag_complete.search('text/css') > -1))) {                     // 418
                    if (!peek) {                                                                                       // 419
                        this.record_tag(tag_check);                                                                    // 420
                        this.tag_type = 'STYLE';                                                                       // 421
                    }                                                                                                  // 422
                } else if (this.is_unformatted(tag_check, unformatted)) { // do not reformat the "unformatted" tags    // 423
                    comment = this.get_unformatted('</' + tag_check + '>', tag_complete); //...delegate to get_unformatted function
                    content.push(comment);                                                                             // 425
                    // Preserve collapsed whitespace either before or after this tag.                                  // 426
                    if (tag_start > 0 && this.Utils.in_array(this.input.charAt(tag_start - 1), this.Utils.whitespace)) {
                        content.splice(0, 0, this.input.charAt(tag_start - 1));                                        // 428
                    }                                                                                                  // 429
                    tag_end = this.pos - 1;                                                                            // 430
                    if (this.Utils.in_array(this.input.charAt(tag_end + 1), this.Utils.whitespace)) {                  // 431
                        content.push(this.input.charAt(tag_end + 1));                                                  // 432
                    }                                                                                                  // 433
                    this.tag_type = 'SINGLE';                                                                          // 434
                } else if (tag_check.charAt(0) === '!') { //peek for <! comment                                        // 435
                    // for comments content is already correct.                                                        // 436
                    if (!peek) {                                                                                       // 437
                        this.tag_type = 'SINGLE';                                                                      // 438
                        this.traverse_whitespace();                                                                    // 439
                    }                                                                                                  // 440
                } else if (!peek) {                                                                                    // 441
                    if (tag_check.charAt(0) === '/') { //this tag is a double tag so check for tag-ending              // 442
                        this.retrieve_tag(tag_check.substring(1)); //remove it and all ancestors                       // 443
                        this.tag_type = 'END';                                                                         // 444
                        this.traverse_whitespace();                                                                    // 445
                    } else { //otherwise it's a start-tag                                                              // 446
                        this.record_tag(tag_check); //push it on the tag stack                                         // 447
                        if (tag_check.toLowerCase() !== 'html') {                                                      // 448
                            this.indent_content = true;                                                                // 449
                        }                                                                                              // 450
                        this.tag_type = 'START';                                                                       // 451
                                                                                                                       // 452
                        // Allow preserving of newlines after a start tag                                              // 453
                        this.traverse_whitespace();                                                                    // 454
                    }                                                                                                  // 455
                    if (this.Utils.in_array(tag_check, this.Utils.extra_liners)) { //check if this double needs an extra line
                        this.print_newline(false, this.output);                                                        // 457
                        if (this.output.length && this.output[this.output.length - 2] !== '\n') {                      // 458
                            this.print_newline(true, this.output);                                                     // 459
                        }                                                                                              // 460
                    }                                                                                                  // 461
                }                                                                                                      // 462
                                                                                                                       // 463
                if (peek) {                                                                                            // 464
                    this.pos = orig_pos;                                                                               // 465
                    this.line_char_count = orig_line_char_count;                                                       // 466
                }                                                                                                      // 467
                                                                                                                       // 468
                return content.join(''); //returns fully formatted tag                                                 // 469
            };                                                                                                         // 470
                                                                                                                       // 471
            this.get_comment = function(start_pos) { //function to return comment content in its entirety              // 472
                // this is will have very poor perf, but will work for now.                                            // 473
                var comment = '',                                                                                      // 474
                    delimiter = '>',                                                                                   // 475
                    matched = false;                                                                                   // 476
                                                                                                                       // 477
                this.pos = start_pos;                                                                                  // 478
                input_char = this.input.charAt(this.pos);                                                              // 479
                this.pos++;                                                                                            // 480
                                                                                                                       // 481
                while (this.pos <= this.input.length) {                                                                // 482
                    comment += input_char;                                                                             // 483
                                                                                                                       // 484
                    // only need to check for the delimiter if the last chars match                                    // 485
                    if (comment[comment.length - 1] === delimiter[delimiter.length - 1] &&                             // 486
                        comment.indexOf(delimiter) !== -1) {                                                           // 487
                        break;                                                                                         // 488
                    }                                                                                                  // 489
                                                                                                                       // 490
                    // only need to search for custom delimiter for the first few characters                           // 491
                    if (!matched && comment.length < 10) {                                                             // 492
                        if (comment.indexOf('<![if') === 0) { //peek for <![if conditional comment                     // 493
                            delimiter = '<![endif]>';                                                                  // 494
                            matched = true;                                                                            // 495
                        } else if (comment.indexOf('<![cdata[') === 0) { //if it's a <[cdata[ comment...               // 496
                            delimiter = ']]>';                                                                         // 497
                            matched = true;                                                                            // 498
                        } else if (comment.indexOf('<![') === 0) { // some other ![ comment? ...                       // 499
                            delimiter = ']>';                                                                          // 500
                            matched = true;                                                                            // 501
                        } else if (comment.indexOf('<!--') === 0) { // <!-- comment ...                                // 502
                            delimiter = '-->';                                                                         // 503
                            matched = true;                                                                            // 504
                        }                                                                                              // 505
                    }                                                                                                  // 506
                                                                                                                       // 507
                    input_char = this.input.charAt(this.pos);                                                          // 508
                    this.pos++;                                                                                        // 509
                }                                                                                                      // 510
                                                                                                                       // 511
                return comment;                                                                                        // 512
            };                                                                                                         // 513
                                                                                                                       // 514
            this.get_unformatted = function(delimiter, orig_tag) { //function to return unformatted content in its entirety
                                                                                                                       // 516
                if (orig_tag && orig_tag.toLowerCase().indexOf(delimiter) !== -1) {                                    // 517
                    return '';                                                                                         // 518
                }                                                                                                      // 519
                var input_char = '';                                                                                   // 520
                var content = '';                                                                                      // 521
                var min_index = 0;                                                                                     // 522
                var space = true;                                                                                      // 523
                do {                                                                                                   // 524
                                                                                                                       // 525
                    if (this.pos >= this.input.length) {                                                               // 526
                        return content;                                                                                // 527
                    }                                                                                                  // 528
                                                                                                                       // 529
                    input_char = this.input.charAt(this.pos);                                                          // 530
                    this.pos++;                                                                                        // 531
                                                                                                                       // 532
                    if (this.Utils.in_array(input_char, this.Utils.whitespace)) {                                      // 533
                        if (!space) {                                                                                  // 534
                            this.line_char_count--;                                                                    // 535
                            continue;                                                                                  // 536
                        }                                                                                              // 537
                        if (input_char === '\n' || input_char === '\r') {                                              // 538
                            content += '\n';                                                                           // 539
                            /*  Don't change tab indention for unformatted blocks.  If using code for html editing, this will greatly affect <pre> tags if they are specified in the 'unformatted array'
                for (var i=0; i<this.indent_level; i++) {                                                              // 541
                  content += this.indent_string;                                                                       // 542
                }                                                                                                      // 543
                space = false; //...and make sure other indentation is erased                                          // 544
                */                                                                                                     // 545
                            this.line_char_count = 0;                                                                  // 546
                            continue;                                                                                  // 547
                        }                                                                                              // 548
                    }                                                                                                  // 549
                    content += input_char;                                                                             // 550
                    this.line_char_count++;                                                                            // 551
                    space = true;                                                                                      // 552
                                                                                                                       // 553
                    if (indent_handlebars && input_char === '{' && content.length && content[content.length - 2] === '{') {
                        // Handlebars expressions in strings should also be unformatted.                               // 555
                        content += this.get_unformatted('}}');                                                         // 556
                        // These expressions are opaque.  Ignore delimiters found in them.                             // 557
                        min_index = content.length;                                                                    // 558
                    }                                                                                                  // 559
                } while (content.toLowerCase().indexOf(delimiter, min_index) === -1);                                  // 560
                return content;                                                                                        // 561
            };                                                                                                         // 562
                                                                                                                       // 563
            this.get_token = function() { //initial handler for token-retrieval                                        // 564
                var token;                                                                                             // 565
                                                                                                                       // 566
                if (this.last_token === 'TK_TAG_SCRIPT' || this.last_token === 'TK_TAG_STYLE') { //check if we need to format javascript
                    var type = this.last_token.substr(7);                                                              // 568
                    token = this.get_contents_to(type);                                                                // 569
                    if (typeof token !== 'string') {                                                                   // 570
                        return token;                                                                                  // 571
                    }                                                                                                  // 572
                    return [token, 'TK_' + type];                                                                      // 573
                }                                                                                                      // 574
                if (this.current_mode === 'CONTENT') {                                                                 // 575
                    token = this.get_content();                                                                        // 576
                    if (typeof token !== 'string') {                                                                   // 577
                        return token;                                                                                  // 578
                    } else {                                                                                           // 579
                        return [token, 'TK_CONTENT'];                                                                  // 580
                    }                                                                                                  // 581
                }                                                                                                      // 582
                                                                                                                       // 583
                if (this.current_mode === 'TAG') {                                                                     // 584
                    token = this.get_tag();                                                                            // 585
                    if (typeof token !== 'string') {                                                                   // 586
                        return token;                                                                                  // 587
                    } else {                                                                                           // 588
                        var tag_name_type = 'TK_TAG_' + this.tag_type;                                                 // 589
                        return [token, tag_name_type];                                                                 // 590
                    }                                                                                                  // 591
                }                                                                                                      // 592
            };                                                                                                         // 593
                                                                                                                       // 594
            this.get_full_indent = function(level) {                                                                   // 595
                level = this.indent_level + level || 0;                                                                // 596
                if (level < 1) {                                                                                       // 597
                    return '';                                                                                         // 598
                }                                                                                                      // 599
                                                                                                                       // 600
                return Array(level + 1).join(this.indent_string);                                                      // 601
            };                                                                                                         // 602
                                                                                                                       // 603
            this.is_unformatted = function(tag_check, unformatted) {                                                   // 604
                //is this an HTML5 block-level link?                                                                   // 605
                if (!this.Utils.in_array(tag_check, unformatted)) {                                                    // 606
                    return false;                                                                                      // 607
                }                                                                                                      // 608
                                                                                                                       // 609
                if (tag_check.toLowerCase() !== 'a' || !this.Utils.in_array('a', unformatted)) {                       // 610
                    return true;                                                                                       // 611
                }                                                                                                      // 612
                                                                                                                       // 613
                //at this point we have an  tag; is its first child something we want to remain                        // 614
                //unformatted?                                                                                         // 615
                var next_tag = this.get_tag(true /* peek. */ );                                                        // 616
                                                                                                                       // 617
                // test next_tag to see if it is just html tag (no external content)                                   // 618
                var tag = (next_tag || "").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);                                  // 619
                                                                                                                       // 620
                // if next_tag comes back but is not an isolated tag, then                                             // 621
                // let's treat the 'a' tag as having content                                                           // 622
                // and respect the unformatted option                                                                  // 623
                if (!tag || this.Utils.in_array(tag, unformatted)) {                                                   // 624
                    return true;                                                                                       // 625
                } else {                                                                                               // 626
                    return false;                                                                                      // 627
                }                                                                                                      // 628
            };                                                                                                         // 629
                                                                                                                       // 630
            this.printer = function(js_source, indent_character, indent_size, wrap_line_length, brace_style) { //handles input/output and some other printing functions
                                                                                                                       // 632
                this.input = js_source || ''; //gets the input for the Parser                                          // 633
                this.output = [];                                                                                      // 634
                this.indent_character = indent_character;                                                              // 635
                this.indent_string = '';                                                                               // 636
                this.indent_size = indent_size;                                                                        // 637
                this.brace_style = brace_style;                                                                        // 638
                this.indent_level = 0;                                                                                 // 639
                this.wrap_line_length = wrap_line_length;                                                              // 640
                this.line_char_count = 0; //count to see if wrap_line_length was exceeded                              // 641
                                                                                                                       // 642
                for (var i = 0; i < this.indent_size; i++) {                                                           // 643
                    this.indent_string += this.indent_character;                                                       // 644
                }                                                                                                      // 645
                                                                                                                       // 646
                this.print_newline = function(force, arr) {                                                            // 647
                    this.line_char_count = 0;                                                                          // 648
                    if (!arr || !arr.length) {                                                                         // 649
                        return;                                                                                        // 650
                    }                                                                                                  // 651
                    if (force || (arr[arr.length - 1] !== '\n')) { //we might want the extra line                      // 652
                        arr.push('\n');                                                                                // 653
                    }                                                                                                  // 654
                };                                                                                                     // 655
                                                                                                                       // 656
                this.print_indentation = function(arr) {                                                               // 657
                    for (var i = 0; i < this.indent_level; i++) {                                                      // 658
                        arr.push(this.indent_string);                                                                  // 659
                        this.line_char_count += this.indent_string.length;                                             // 660
                    }                                                                                                  // 661
                };                                                                                                     // 662
                                                                                                                       // 663
                this.print_token = function(text) {                                                                    // 664
                    if (text || text !== '') {                                                                         // 665
                        if (this.output.length && this.output[this.output.length - 1] === '\n') {                      // 666
                            this.print_indentation(this.output);                                                       // 667
                            text = ltrim(text);                                                                        // 668
                        }                                                                                              // 669
                    }                                                                                                  // 670
                    this.print_token_raw(text);                                                                        // 671
                };                                                                                                     // 672
                                                                                                                       // 673
                this.print_token_raw = function(text) {                                                                // 674
                    if (text && text !== '') {                                                                         // 675
                        if (text.length > 1 && text[text.length - 1] === '\n') {                                       // 676
                            // unformatted tags can grab newlines as their last character                              // 677
                            this.output.push(text.slice(0, -1));                                                       // 678
                            this.print_newline(false, this.output);                                                    // 679
                        } else {                                                                                       // 680
                            this.output.push(text);                                                                    // 681
                        }                                                                                              // 682
                    }                                                                                                  // 683
                                                                                                                       // 684
                    for (var n = 0; n < this.newlines; n++) {                                                          // 685
                        this.print_newline(n > 0, this.output);                                                        // 686
                    }                                                                                                  // 687
                    this.newlines = 0;                                                                                 // 688
                };                                                                                                     // 689
                                                                                                                       // 690
                this.indent = function() {                                                                             // 691
                    this.indent_level++;                                                                               // 692
                };                                                                                                     // 693
                                                                                                                       // 694
                this.unindent = function() {                                                                           // 695
                    if (this.indent_level > 0) {                                                                       // 696
                        this.indent_level--;                                                                           // 697
                    }                                                                                                  // 698
                };                                                                                                     // 699
            };                                                                                                         // 700
            return this;                                                                                               // 701
        }                                                                                                              // 702
                                                                                                                       // 703
        /*_____________________--------------------_____________________*/                                             // 704
                                                                                                                       // 705
        multi_parser = new Parser(); //wrapping functions Parser                                                       // 706
        multi_parser.printer(html_source, indent_character, indent_size, wrap_line_length, brace_style); //initialize starting values
                                                                                                                       // 708
        while (true) {                                                                                                 // 709
            var t = multi_parser.get_token();                                                                          // 710
            multi_parser.token_text = t[0];                                                                            // 711
            multi_parser.token_type = t[1];                                                                            // 712
                                                                                                                       // 713
            if (multi_parser.token_type === 'TK_EOF') {                                                                // 714
                break;                                                                                                 // 715
            }                                                                                                          // 716
                                                                                                                       // 717
            switch (multi_parser.token_type) {                                                                         // 718
                case 'TK_TAG_START':                                                                                   // 719
                    multi_parser.print_newline(false, multi_parser.output);                                            // 720
                    multi_parser.print_token(multi_parser.token_text);                                                 // 721
                    if (multi_parser.indent_content) {                                                                 // 722
                        multi_parser.indent();                                                                         // 723
                        multi_parser.indent_content = false;                                                           // 724
                    }                                                                                                  // 725
                    multi_parser.current_mode = 'CONTENT';                                                             // 726
                    break;                                                                                             // 727
                case 'TK_TAG_STYLE':                                                                                   // 728
                case 'TK_TAG_SCRIPT':                                                                                  // 729
                    multi_parser.print_newline(false, multi_parser.output);                                            // 730
                    multi_parser.print_token(multi_parser.token_text);                                                 // 731
                    multi_parser.current_mode = 'CONTENT';                                                             // 732
                    break;                                                                                             // 733
                case 'TK_TAG_END':                                                                                     // 734
                    //Print new line only if the tag has no content and has child                                      // 735
                    if (multi_parser.last_token === 'TK_CONTENT' && multi_parser.last_text === '') {                   // 736
                        var tag_name = multi_parser.token_text.match(/\w+/)[0];                                        // 737
                        var tag_extracted_from_last_output = null;                                                     // 738
                        if (multi_parser.output.length) {                                                              // 739
                            tag_extracted_from_last_output = multi_parser.output[multi_parser.output.length - 1].match(/(?:<|{{#)\s*(\w+)/);
                        }                                                                                              // 741
                        if (tag_extracted_from_last_output === null ||                                                 // 742
                            tag_extracted_from_last_output[1] !== tag_name) {                                          // 743
                            multi_parser.print_newline(false, multi_parser.output);                                    // 744
                        }                                                                                              // 745
                    }                                                                                                  // 746
                    multi_parser.print_token(multi_parser.token_text);                                                 // 747
                    multi_parser.current_mode = 'CONTENT';                                                             // 748
                    break;                                                                                             // 749
                case 'TK_TAG_SINGLE':                                                                                  // 750
                    // Don't add a newline before elements that should remain unformatted.                             // 751
                    var tag_check = multi_parser.token_text.match(/^\s*<([a-z]+)/i);                                   // 752
                    if (!tag_check || !multi_parser.Utils.in_array(tag_check[1], unformatted)) {                       // 753
                        multi_parser.print_newline(false, multi_parser.output);                                        // 754
                    }                                                                                                  // 755
                    multi_parser.print_token(multi_parser.token_text);                                                 // 756
                    multi_parser.current_mode = 'CONTENT';                                                             // 757
                    break;                                                                                             // 758
                case 'TK_TAG_HANDLEBARS_ELSE':                                                                         // 759
                    multi_parser.print_token(multi_parser.token_text);                                                 // 760
                    if (multi_parser.indent_content) {                                                                 // 761
                        multi_parser.indent();                                                                         // 762
                        multi_parser.indent_content = false;                                                           // 763
                    }                                                                                                  // 764
                    multi_parser.current_mode = 'CONTENT';                                                             // 765
                    break;                                                                                             // 766
                case 'TK_CONTENT':                                                                                     // 767
                    multi_parser.print_token(multi_parser.token_text);                                                 // 768
                    multi_parser.current_mode = 'TAG';                                                                 // 769
                    break;                                                                                             // 770
                case 'TK_STYLE':                                                                                       // 771
                case 'TK_SCRIPT':                                                                                      // 772
                    if (multi_parser.token_text !== '') {                                                              // 773
                        multi_parser.print_newline(false, multi_parser.output);                                        // 774
                        var text = multi_parser.token_text,                                                            // 775
                            _beautifier,                                                                               // 776
                            script_indent_level = 1;                                                                   // 777
                        if (multi_parser.token_type === 'TK_SCRIPT') {                                                 // 778
                            _beautifier = typeof js_beautify === 'function' && js_beautify;                            // 779
                        } else if (multi_parser.token_type === 'TK_STYLE') {                                           // 780
                            _beautifier = typeof css_beautify === 'function' && css_beautify;                          // 781
                        }                                                                                              // 782
                                                                                                                       // 783
                        if (options.indent_scripts === "keep") {                                                       // 784
                            script_indent_level = 0;                                                                   // 785
                        } else if (options.indent_scripts === "separate") {                                            // 786
                            script_indent_level = -multi_parser.indent_level;                                          // 787
                        }                                                                                              // 788
                                                                                                                       // 789
                        var indentation = multi_parser.get_full_indent(script_indent_level);                           // 790
                        if (_beautifier) {                                                                             // 791
                            // call the Beautifier if avaliable                                                        // 792
                            text = _beautifier(text.replace(/^\s*/, indentation), options);                            // 793
                        } else {                                                                                       // 794
                            // simply indent the string otherwise                                                      // 795
                            var white = text.match(/^\s*/)[0];                                                         // 796
                            var _level = white.match(/[^\n\r]*$/)[0].split(multi_parser.indent_string).length - 1;     // 797
                            var reindent = multi_parser.get_full_indent(script_indent_level - _level);                 // 798
                            text = text.replace(/^\s*/, indentation)                                                   // 799
                                .replace(/\r\n|\r|\n/g, '\n' + reindent)                                               // 800
                                .replace(/\s+$/, '');                                                                  // 801
                        }                                                                                              // 802
                        if (text) {                                                                                    // 803
                            multi_parser.print_token_raw(indentation + trim(text));                                    // 804
                            multi_parser.print_newline(false, multi_parser.output);                                    // 805
                        }                                                                                              // 806
                    }                                                                                                  // 807
                    multi_parser.current_mode = 'TAG';                                                                 // 808
                    break;                                                                                             // 809
            }                                                                                                          // 810
            multi_parser.last_token = multi_parser.token_type;                                                         // 811
            multi_parser.last_text = multi_parser.token_text;                                                          // 812
        }                                                                                                              // 813
        return multi_parser.output.join('');                                                                           // 814
    }                                                                                                                  // 815
                                                                                                                       // 816
    if (typeof define === "function" && define.amd) {                                                                  // 817
        // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )                     // 818
        define(["require", "./beautify", "./beautify-css"], function(requireamd) {                                     // 819
            var js_beautify =  requireamd("./beautify");                                                               // 820
            var css_beautify =  requireamd("./beautify-css");                                                          // 821
                                                                                                                       // 822
            return {                                                                                                   // 823
              html_beautify: function(html_source, options) {                                                          // 824
                return style_html(html_source, options, js_beautify.js_beautify, css_beautify.css_beautify);           // 825
              }                                                                                                        // 826
            };                                                                                                         // 827
        });                                                                                                            // 828
    } else if (typeof exports !== "undefined") {                                                                       // 829
        // Add support for CommonJS. Just put this file somewhere on your require.paths                                // 830
        // and you will be able to `var html_beautify = require("beautify").html_beautify`.                            // 831
        var js_beautify = require('./beautify.js');                                                                    // 832
        var css_beautify = require('./beautify-css.js');                                                               // 833
                                                                                                                       // 834
        exports.html_beautify = function(html_source, options) {                                                       // 835
            return style_html(html_source, options, js_beautify.js_beautify, css_beautify.css_beautify);               // 836
        };                                                                                                             // 837
    } else if (typeof window !== "undefined") {                                                                        // 838
        // If we're running a web page and don't have either of the above, add our one global                          // 839
        window.html_beautify = function(html_source, options) {                                                        // 840
            return style_html(html_source, options, window.js_beautify, window.css_beautify);                          // 841
        };                                                                                                             // 842
    } else if (typeof global !== "undefined") {                                                                        // 843
        // If we don't even have window, try global.                                                                   // 844
        global.html_beautify = function(html_source, options) {                                                        // 845
            return style_html(html_source, options, global.js_beautify, global.css_beautify);                          // 846
        };                                                                                                             // 847
    }                                                                                                                  // 848
                                                                                                                       // 849
}());                                                                                                                  // 850
                                                                                                                       // 851
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/compatibility/highlight.pack.js                                                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
!function(e){"undefined"!=typeof exports?e(exports):(window.hljs=e({}),"function"==typeof define&&define.amd&&define("hljs",[],function(){return window.hljs}))}(function(e){function n(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function t(e){return e.nodeName.toLowerCase()}function r(e,n){var t=e&&e.exec(n);return t&&0==t.index}function a(e){return/no-?highlight|plain|text/.test(e)}function i(e){var n,t,r,i=e.className+" ";if(i+=e.parentNode?e.parentNode.className:"",t=/\blang(?:uage)?-([\w-]+)\b/.exec(i))return E(t[1])?t[1]:"no-highlight";for(i=i.split(/\s+/),n=0,r=i.length;r>n;n++)if(E(i[n])||a(i[n]))return i[n]}function o(e,n){var t,r={};for(t in e)r[t]=e[t];if(n)for(t in n)r[t]=n[t];return r}function u(e){var n=[];return function r(e,a){for(var i=e.firstChild;i;i=i.nextSibling)3==i.nodeType?a+=i.nodeValue.length:1==i.nodeType&&(n.push({event:"start",offset:a,node:i}),a=r(i,a),t(i).match(/br|hr|img|input/)||n.push({event:"stop",offset:a,node:i}));return a}(e,0),n}function c(e,r,a){function i(){return e.length&&r.length?e[0].offset!=r[0].offset?e[0].offset<r[0].offset?e:r:"start"==r[0].event?e:r:e.length?e:r}function o(e){function r(e){return" "+e.nodeName+'="'+n(e.value)+'"'}f+="<"+t(e)+Array.prototype.map.call(e.attributes,r).join("")+">"}function u(e){f+="</"+t(e)+">"}function c(e){("start"==e.event?o:u)(e.node)}for(var s=0,f="",l=[];e.length||r.length;){var g=i();if(f+=n(a.substr(s,g[0].offset-s)),s=g[0].offset,g==e){l.reverse().forEach(u);do c(g.splice(0,1)[0]),g=i();while(g==e&&g.length&&g[0].offset==s);l.reverse().forEach(o)}else"start"==g[0].event?l.push(g[0].node):l.pop(),c(g.splice(0,1)[0])}return f+n(a.substr(s))}function s(e){function n(e){return e&&e.source||e}function t(t,r){return new RegExp(n(t),"m"+(e.cI?"i":"")+(r?"g":""))}function r(a,i){if(!a.compiled){if(a.compiled=!0,a.k=a.k||a.bK,a.k){var u={},c=function(n,t){e.cI&&(t=t.toLowerCase()),t.split(" ").forEach(function(e){var t=e.split("|");u[t[0]]=[n,t[1]?Number(t[1]):1]})};"string"==typeof a.k?c("keyword",a.k):Object.keys(a.k).forEach(function(e){c(e,a.k[e])}),a.k=u}a.lR=t(a.l||/\b\w+\b/,!0),i&&(a.bK&&(a.b="\\b("+a.bK.split(" ").join("|")+")\\b"),a.b||(a.b=/\B|\b/),a.bR=t(a.b),a.e||a.eW||(a.e=/\B|\b/),a.e&&(a.eR=t(a.e)),a.tE=n(a.e)||"",a.eW&&i.tE&&(a.tE+=(a.e?"|":"")+i.tE)),a.i&&(a.iR=t(a.i)),void 0===a.r&&(a.r=1),a.c||(a.c=[]);var s=[];a.c.forEach(function(e){e.v?e.v.forEach(function(n){s.push(o(e,n))}):s.push("self"==e?a:e)}),a.c=s,a.c.forEach(function(e){r(e,a)}),a.starts&&r(a.starts,i);var f=a.c.map(function(e){return e.bK?"\\.?("+e.b+")\\.?":e.b}).concat([a.tE,a.i]).map(n).filter(Boolean);a.t=f.length?t(f.join("|"),!0):{exec:function(){return null}}}}r(e)}function f(e,t,a,i){function o(e,n){for(var t=0;t<n.c.length;t++)if(r(n.c[t].bR,e))return n.c[t]}function u(e,n){if(r(e.eR,n)){for(;e.endsParent&&e.parent;)e=e.parent;return e}return e.eW?u(e.parent,n):void 0}function c(e,n){return!a&&r(n.iR,e)}function g(e,n){var t=N.cI?n[0].toLowerCase():n[0];return e.k.hasOwnProperty(t)&&e.k[t]}function h(e,n,t,r){var a=r?"":w.classPrefix,i='<span class="'+a,o=t?"":"</span>";return i+=e+'">',i+n+o}function p(){if(!L.k)return n(B);var e="",t=0;L.lR.lastIndex=0;for(var r=L.lR.exec(B);r;){e+=n(B.substr(t,r.index-t));var a=g(L,r);a?(y+=a[1],e+=h(a[0],n(r[0]))):e+=n(r[0]),t=L.lR.lastIndex,r=L.lR.exec(B)}return e+n(B.substr(t))}function d(){if(L.sL&&!x[L.sL])return n(B);var e=L.sL?f(L.sL,B,!0,M[L.sL]):l(B);return L.r>0&&(y+=e.r),"continuous"==L.subLanguageMode&&(M[L.sL]=e.top),h(e.language,e.value,!1,!0)}function b(){return void 0!==L.sL?d():p()}function v(e,t){var r=e.cN?h(e.cN,"",!0):"";e.rB?(k+=r,B=""):e.eB?(k+=n(t)+r,B=""):(k+=r,B=t),L=Object.create(e,{parent:{value:L}})}function m(e,t){if(B+=e,void 0===t)return k+=b(),0;var r=o(t,L);if(r)return k+=b(),v(r,t),r.rB?0:t.length;var a=u(L,t);if(a){var i=L;i.rE||i.eE||(B+=t),k+=b();do L.cN&&(k+="</span>"),y+=L.r,L=L.parent;while(L!=a.parent);return i.eE&&(k+=n(t)),B="",a.starts&&v(a.starts,""),i.rE?0:t.length}if(c(t,L))throw new Error('Illegal lexeme "'+t+'" for mode "'+(L.cN||"<unnamed>")+'"');return B+=t,t.length||1}var N=E(e);if(!N)throw new Error('Unknown language: "'+e+'"');s(N);var R,L=i||N,M={},k="";for(R=L;R!=N;R=R.parent)R.cN&&(k=h(R.cN,"",!0)+k);var B="",y=0;try{for(var C,j,I=0;;){if(L.t.lastIndex=I,C=L.t.exec(t),!C)break;j=m(t.substr(I,C.index-I),C[0]),I=C.index+j}for(m(t.substr(I)),R=L;R.parent;R=R.parent)R.cN&&(k+="</span>");return{r:y,value:k,language:e,top:L}}catch(O){if(-1!=O.message.indexOf("Illegal"))return{r:0,value:n(t)};throw O}}function l(e,t){t=t||w.languages||Object.keys(x);var r={r:0,value:n(e)},a=r;return t.forEach(function(n){if(E(n)){var t=f(n,e,!1);t.language=n,t.r>a.r&&(a=t),t.r>r.r&&(a=r,r=t)}}),a.language&&(r.second_best=a),r}function g(e){return w.tabReplace&&(e=e.replace(/^((<[^>]+>|\t)+)/gm,function(e,n){return n.replace(/\t/g,w.tabReplace)})),w.useBR&&(e=e.replace(/\n/g,"<br>")),e}function h(e,n,t){var r=n?R[n]:t,a=[e.trim()];return e.match(/\bhljs\b/)||a.push("hljs"),-1===e.indexOf(r)&&a.push(r),a.join(" ").trim()}function p(e){var n=i(e);if(!a(n)){var t;w.useBR?(t=document.createElementNS("http://www.w3.org/1999/xhtml","div"),t.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n")):t=e;var r=t.textContent,o=n?f(n,r,!0):l(r),s=u(t);if(s.length){var p=document.createElementNS("http://www.w3.org/1999/xhtml","div");p.innerHTML=o.value,o.value=c(s,u(p),r)}o.value=g(o.value),e.innerHTML=o.value,e.className=h(e.className,n,o.language),e.result={language:o.language,re:o.r},o.second_best&&(e.second_best={language:o.second_best.language,re:o.second_best.r})}}function d(e){w=o(w,e)}function b(){if(!b.called){b.called=!0;var e=document.querySelectorAll("pre code");Array.prototype.forEach.call(e,p)}}function v(){addEventListener("DOMContentLoaded",b,!1),addEventListener("load",b,!1)}function m(n,t){var r=x[n]=t(e);r.aliases&&r.aliases.forEach(function(e){R[e]=n})}function N(){return Object.keys(x)}function E(e){return x[e]||x[R[e]]}var w={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},x={},R={};return e.highlight=f,e.highlightAuto=l,e.fixMarkup=g,e.highlightBlock=p,e.configure=d,e.initHighlighting=b,e.initHighlightingOnLoad=v,e.registerLanguage=m,e.listLanguages=N,e.getLanguage=E,e.inherit=o,e.IR="[a-zA-Z]\\w*",e.UIR="[a-zA-Z_]\\w*",e.NR="\\b\\d+(\\.\\d+)?",e.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BNR="\\b(0b[01]+)",e.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BE={b:"\\\\[\\s\\S]",r:0},e.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[e.BE]},e.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[e.BE]},e.PWM={b:/\b(a|an|the|are|I|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such)\b/},e.C=function(n,t,r){var a=e.inherit({cN:"comment",b:n,e:t,c:[]},r||{});return a.c.push(e.PWM),a.c.push({cN:"doctag",bK:"TODO FIXME NOTE BUG XXX",r:0}),a},e.CLCM=e.C("//","$"),e.CBCM=e.C("/\\*","\\*/"),e.HCM=e.C("#","$"),e.NM={cN:"number",b:e.NR,r:0},e.CNM={cN:"number",b:e.CNR,r:0},e.BNM={cN:"number",b:e.BNR,r:0},e.CSSNM={cN:"number",b:e.NR+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",r:0},e.RM={cN:"regexp",b:/\//,e:/\/[gimuy]*/,i:/\n/,c:[e.BE,{b:/\[/,e:/\]/,r:0,c:[e.BE]}]},e.TM={cN:"title",b:e.IR,r:0},e.UTM={cN:"title",b:e.UIR,r:0},e});hljs.registerLanguage("coffeescript",function(e){var c={keyword:"in if for while finally new do return else break catch instanceof throw try this switch continue typeof delete debugger super then unless until loop of by when and or is isnt not",literal:"true false null undefined yes no on off",reserved:"case default function var void with const let enum export import native __hasProp __extends __slice __bind __indexOf",built_in:"npm require console print module global window document"},n="[A-Za-z$_][0-9A-Za-z$_]*",t={cN:"subst",b:/#\{/,e:/}/,k:c},r=[e.BNM,e.inherit(e.CNM,{starts:{e:"(\\s*/)?",r:0}}),{cN:"string",v:[{b:/'''/,e:/'''/,c:[e.BE]},{b:/'/,e:/'/,c:[e.BE]},{b:/"""/,e:/"""/,c:[e.BE,t]},{b:/"/,e:/"/,c:[e.BE,t]}]},{cN:"regexp",v:[{b:"///",e:"///",c:[t,e.HCM]},{b:"//[gim]*",r:0},{b:/\/(?![ *])(\\\/|.)*?\/[gim]*(?=\W|$)/}]},{cN:"property",b:"@"+n},{b:"`",e:"`",eB:!0,eE:!0,sL:"javascript"}];t.c=r;var i=e.inherit(e.TM,{b:n}),s="(\\(.*\\))?\\s*\\B[-=]>",o={cN:"params",b:"\\([^\\(]",rB:!0,c:[{b:/\(/,e:/\)/,k:c,c:["self"].concat(r)}]};return{aliases:["coffee","cson","iced"],k:c,i:/\/\*/,c:r.concat([e.C("###","###"),e.HCM,{cN:"function",b:"^\\s*"+n+"\\s*=\\s*"+s,e:"[-=]>",rB:!0,c:[i,o]},{b:/[:\(,=]\s*/,r:0,c:[{cN:"function",b:s,e:"[-=]>",rB:!0,c:[o]}]},{cN:"class",bK:"class",e:"$",i:/[:="\[\]]/,c:[{bK:"extends",eW:!0,i:/[:="\[\]]/,c:[i]},i]},{cN:"attribute",b:n+":",e:":",rB:!0,rE:!0,r:0}])}});hljs.registerLanguage("cpp",function(t){var e={cN:"keyword",b:"[a-z\\d_]*_t"},r={keyword:"false int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long volatile static protected bool template mutable if public friend do goto auto void enum else break extern using true class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue inline delete alignof constexpr decltype noexcept nullptr static_assert thread_local restrict _Bool complex _Complex _Imaginary atomic_bool atomic_char atomic_schar atomic_uchar atomic_short atomic_ushort atomic_int atomic_uint atomic_long atomic_ulong atomic_llong atomic_ullong",built_in:"std string cin cout cerr clog stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr abort abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf"};return{aliases:["c","cc","h","c++","h++","hpp"],k:r,i:"</",c:[e,t.CLCM,t.CBCM,{cN:"string",v:[t.inherit(t.QSM,{b:'((u8?|U)|L)?"'}),{b:'(u8?|U)?R"',e:'"',c:[t.BE]},{b:"'\\\\?.",e:"'",i:"."}]},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},t.CNM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line pragma",c:[{b:/\\\n/,r:0},{b:'include\\s*[<"]',e:'[>"]',k:"include",i:"\\n"},t.CLCM]},{b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:r,c:["self",e]},{b:t.IR+"::",k:r},{bK:"new throw return else",r:0},{cN:"function",b:"("+t.IR+"\\s+)+"+t.IR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:r,c:[{b:t.IR+"\\s*\\(",rB:!0,c:[t.TM],r:0},{cN:"params",b:/\(/,e:/\)/,k:r,r:0,c:[t.CBCM]},t.CLCM,t.CBCM]}]}});hljs.registerLanguage("swift",function(e){var i={keyword:"class deinit enum extension func import init let protocol static struct subscript typealias var break case continue default do else fallthrough if in for return switch where while as dynamicType is new super self Self Type __COLUMN__ __FILE__ __FUNCTION__ __LINE__ associativity didSet get infix inout left mutating none nonmutating operator override postfix precedence prefix right set unowned unowned safe unsafe weak willSet",literal:"true false nil",built_in:"abs advance alignof alignofValue assert bridgeFromObjectiveC bridgeFromObjectiveCUnconditional bridgeToObjectiveC bridgeToObjectiveCUnconditional c contains count countElements countLeadingZeros debugPrint debugPrintln distance dropFirst dropLast dump encodeBitsAsWords enumerate equal filter find getBridgedObjectiveCType getVaList indices insertionSort isBridgedToObjectiveC isBridgedVerbatimToObjectiveC isUniquelyReferenced join lexicographicalCompare map max maxElement min minElement numericCast partition posix print println quickSort reduce reflect reinterpretCast reverse roundUpToAlignment sizeof sizeofValue sort split startsWith strideof strideofValue swap swift toString transcode underestimateCount unsafeReflect withExtendedLifetime withObjectAtPlusZero withUnsafePointer withUnsafePointerToObject withUnsafePointers withVaList"},t={cN:"type",b:"\\b[A-Z][\\w']*",r:0},n=e.C("/\\*","\\*/",{c:["self"]}),r={cN:"subst",b:/\\\(/,e:"\\)",k:i,c:[]},s={cN:"number",b:"\\b([\\d_]+(\\.[\\deE_]+)?|0x[a-fA-F0-9_]+(\\.[a-fA-F0-9p_]+)?|0b[01_]+|0o[0-7_]+)\\b",r:0},o=e.inherit(e.QSM,{c:[r,e.BE]});return r.c=[s],{k:i,c:[o,e.CLCM,n,t,s,{cN:"func",bK:"func",e:"{",eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/,i:/\(/}),{cN:"generics",b:/</,e:/>/,i:/>/},{cN:"params",b:/\(/,e:/\)/,endsParent:!0,k:i,c:["self",s,o,e.CBCM,{b:":"}],i:/["']/}],i:/\[|%/},{cN:"class",bK:"struct protocol class extension enum",k:i,e:"\\{",eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/})]},{cN:"preprocessor",b:"(@assignment|@class_protocol|@exported|@final|@lazy|@noreturn|@NSCopying|@NSManaged|@objc|@optional|@required|@auto_closure|@noreturn|@IBAction|@IBDesignable|@IBInspectable|@IBOutlet|@infix|@prefix|@postfix)"}]}});hljs.registerLanguage("python",function(e){var r={cN:"prompt",b:/^(>>>|\.\.\.) /},b={cN:"string",c:[e.BE],v:[{b:/(u|b)?r?'''/,e:/'''/,c:[r],r:10},{b:/(u|b)?r?"""/,e:/"""/,c:[r],r:10},{b:/(u|r|ur)'/,e:/'/,r:10},{b:/(u|r|ur)"/,e:/"/,r:10},{b:/(b|br)'/,e:/'/},{b:/(b|br)"/,e:/"/},e.ASM,e.QSM]},l={cN:"number",r:0,v:[{b:e.BNR+"[lLjJ]?"},{b:"\\b(0o[0-7]+)[lLjJ]?"},{b:e.CNR+"[lLjJ]?"}]},c={cN:"params",b:/\(/,e:/\)/,c:["self",r,l,b]};return{aliases:["py","gyp"],k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda nonlocal|10 None True False",built_in:"Ellipsis NotImplemented"},i:/(<\/|->|\?)/,c:[r,l,b,e.HCM,{v:[{cN:"function",bK:"def",r:10},{cN:"class",bK:"class"}],e:/:/,i:/[${=;\n,]/,c:[e.UTM,c]},{cN:"decorator",b:/@/,e:/$/},{b:/\b(print|exec)\(/}]}});hljs.registerLanguage("sql",function(e){var t=e.C("--","$");return{cI:!0,i:/[<>]/,c:[{cN:"operator",bK:"begin end start commit rollback savepoint lock alter create drop rename call delete do handler insert load replace select truncate update set show pragma grant merge describe use explain help declare prepare execute deallocate savepoint release unlock purge reset change stop analyze cache flush optimize repair kill install uninstall checksum restore check backup revoke",e:/;/,eW:!0,k:{keyword:"abs absolute acos action add adddate addtime aes_decrypt aes_encrypt after aggregate all allocate alter analyze and any are as asc ascii asin assertion at atan atan2 atn2 authorization authors avg backup before begin benchmark between bin binlog bit_and bit_count bit_length bit_or bit_xor both by cache call cascade cascaded case cast catalog ceil ceiling chain change changed char_length character_length charindex charset check checksum checksum_agg choose close coalesce coercibility collate collation collationproperty column columns columns_updated commit compress concat concat_ws concurrent connect connection connection_id consistent constraint constraints continue contributors conv convert convert_tz corresponding cos cot count count_big crc32 create cross cume_dist curdate current current_date current_time current_timestamp current_user cursor curtime data database databases datalength date_add date_format date_sub dateadd datediff datefromparts datename datepart datetime2fromparts datetimeoffsetfromparts day dayname dayofmonth dayofweek dayofyear deallocate declare decode default deferrable deferred degrees delayed delete des_decrypt des_encrypt des_key_file desc describe descriptor diagnostics difference disconnect distinct distinctrow div do domain double drop dumpfile each else elt enclosed encode encrypt end end-exec engine engines eomonth errors escape escaped event eventdata events except exception exec execute exists exp explain export_set extended external extract fast fetch field fields find_in_set first first_value floor flush for force foreign format found found_rows from from_base64 from_days from_unixtime full function get get_format get_lock getdate getutcdate global go goto grant grants greatest group group_concat grouping grouping_id gtid_subset gtid_subtract handler having help hex high_priority hosts hour ident_current ident_incr ident_seed identified identity if ifnull ignore iif ilike immediate in index indicator inet6_aton inet6_ntoa inet_aton inet_ntoa infile initially inner innodb input insert install instr intersect into is is_free_lock is_ipv4 is_ipv4_compat is_ipv4_mapped is_not is_not_null is_used_lock isdate isnull isolation join key kill language last last_day last_insert_id last_value lcase lead leading least leaves left len lenght level like limit lines ln load load_file local localtime localtimestamp locate lock log log10 log2 logfile logs low_priority lower lpad ltrim make_set makedate maketime master master_pos_wait match matched max md5 medium merge microsecond mid min minute mod mode module month monthname mutex name_const names national natural nchar next no no_write_to_binlog not now nullif nvarchar oct octet_length of old_password on only open optimize option optionally or ord order outer outfile output pad parse partial partition password patindex percent_rank percentile_cont percentile_disc period_add period_diff pi plugin position pow power pragma precision prepare preserve primary prior privileges procedure procedure_analyze processlist profile profiles public publishingservername purge quarter query quick quote quotename radians rand read references regexp relative relaylog release release_lock rename repair repeat replace replicate reset restore restrict return returns reverse revoke right rlike rollback rollup round row row_count rows rpad rtrim savepoint schema scroll sec_to_time second section select serializable server session session_user set sha sha1 sha2 share show sign sin size slave sleep smalldatetimefromparts snapshot some soname soundex sounds_like space sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sql_variant_property sqlstate sqrt square start starting status std stddev stddev_pop stddev_samp stdev stdevp stop str str_to_date straight_join strcmp string stuff subdate substr substring subtime subtring_index sum switchoffset sysdate sysdatetime sysdatetimeoffset system_user sysutcdatetime table tables tablespace tan temporary terminated tertiary_weights then time time_format time_to_sec timediff timefromparts timestamp timestampadd timestampdiff timezone_hour timezone_minute to to_base64 to_days to_seconds todatetimeoffset trailing transaction translation trigger trigger_nestlevel triggers trim truncate try_cast try_convert try_parse ucase uncompress uncompressed_length unhex unicode uninstall union unique unix_timestamp unknown unlock update upgrade upped upper usage use user user_resources using utc_date utc_time utc_timestamp uuid uuid_short validate_password_strength value values var var_pop var_samp variables variance varp version view warnings week weekday weekofyear weight_string when whenever where with work write xml xor year yearweek zon",literal:"true false null",built_in:"array bigint binary bit blob boolean char character date dec decimal float int integer interval number numeric real serial smallint varchar varying int8 serial8 text"},c:[{cN:"string",b:"'",e:"'",c:[e.BE,{b:"''"}]},{cN:"string",b:'"',e:'"',c:[e.BE,{b:'""'}]},{cN:"string",b:"`",e:"`",c:[e.BE]},e.CNM,e.CBCM,t]},e.CBCM,t]}});hljs.registerLanguage("java",function(e){var a=e.UIR+"(<"+e.UIR+">)?",t="false synchronized int abstract float private char boolean static null if const for true while long strictfp finally protected import native final void enum else break transient catch instanceof byte super volatile case assert short package default double public try this switch continue throws protected public private",c="\\b(0[bB]([01]+[01_]+[01]+|[01]+)|0[xX]([a-fA-F0-9]+[a-fA-F0-9_]+[a-fA-F0-9]+|[a-fA-F0-9]+)|(([\\d]+[\\d_]+[\\d]+|[\\d]+)(\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))?|\\.([\\d]+[\\d_]+[\\d]+|[\\d]+))([eE][-+]?\\d+)?)[lLfF]?",r={cN:"number",b:c,r:0};return{aliases:["jsp"],k:t,i:/<\//,c:[e.C("/\\*\\*","\\*/",{r:0,c:[{cN:"doctag",b:"@[A-Za-z]+"}]}),e.CLCM,e.CBCM,e.ASM,e.QSM,{cN:"class",bK:"class interface",e:/[{;=]/,eE:!0,k:"class interface",i:/[:"\[\]]/,c:[{bK:"extends implements"},e.UTM]},{bK:"new throw return else",r:0},{cN:"function",b:"("+a+"\\s+)+"+e.UIR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:t,c:[{b:e.UIR+"\\s*\\(",rB:!0,r:0,c:[e.UTM]},{cN:"params",b:/\(/,e:/\)/,k:t,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]},r,{cN:"annotation",b:"@[A-Za-z]+"}]}});hljs.registerLanguage("ruby",function(e){var c="[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?",r="and false then defined module in return redo if BEGIN retry end for true self when next until do begin unless END rescue nil else break undef not super class case require yield alias while ensure elsif or include attr_reader attr_writer attr_accessor",b={cN:"doctag",b:"@[A-Za-z]+"},a={cN:"value",b:"#<",e:">"},n=[e.C("#","$",{c:[b]}),e.C("^\\=begin","^\\=end",{c:[b],r:10}),e.C("^__END__","\\n$")],s={cN:"subst",b:"#\\{",e:"}",k:r},t={cN:"string",c:[e.BE,s],v:[{b:/'/,e:/'/},{b:/"/,e:/"/},{b:/`/,e:/`/},{b:"%[qQwWx]?\\(",e:"\\)"},{b:"%[qQwWx]?\\[",e:"\\]"},{b:"%[qQwWx]?{",e:"}"},{b:"%[qQwWx]?<",e:">"},{b:"%[qQwWx]?/",e:"/"},{b:"%[qQwWx]?%",e:"%"},{b:"%[qQwWx]?-",e:"-"},{b:"%[qQwWx]?\\|",e:"\\|"},{b:/\B\?(\\\d{1,3}|\\x[A-Fa-f0-9]{1,2}|\\u[A-Fa-f0-9]{4}|\\?\S)\b/}]},i={cN:"params",b:"\\(",e:"\\)",k:r},d=[t,a,{cN:"class",bK:"class module",e:"$|;",i:/=/,c:[e.inherit(e.TM,{b:"[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?"}),{cN:"inheritance",b:"<\\s*",c:[{cN:"parent",b:"("+e.IR+"::)?"+e.IR}]}].concat(n)},{cN:"function",bK:"def",e:" |$|;",r:0,c:[e.inherit(e.TM,{b:c}),i].concat(n)},{cN:"constant",b:"(::)?(\\b[A-Z]\\w*(::)?)+",r:0},{cN:"symbol",b:e.UIR+"(\\!|\\?)?:",r:0},{cN:"symbol",b:":",c:[t,{b:c}],r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{cN:"variable",b:"(\\$\\W)|((\\$|\\@\\@?)(\\w+))"},{b:"("+e.RSR+")\\s*",c:[a,{cN:"regexp",c:[e.BE,s],i:/\n/,v:[{b:"/",e:"/[a-z]*"},{b:"%r{",e:"}[a-z]*"},{b:"%r\\(",e:"\\)[a-z]*"},{b:"%r!",e:"![a-z]*"},{b:"%r\\[",e:"\\][a-z]*"}]}].concat(n),r:0}].concat(n);s.c=d,i.c=d;var o="[>?]>",l="[\\w#]+\\(\\w+\\):\\d+:\\d+>",u="(\\w+-)?\\d+\\.\\d+\\.\\d(p\\d+)?[^>]+>",N=[{b:/^\s*=>/,cN:"status",starts:{e:"$",c:d}},{cN:"prompt",b:"^("+o+"|"+l+"|"+u+")",starts:{e:"$",c:d}}];return{aliases:["rb","gemspec","podspec","thor","irb"],k:r,c:n.concat(N).concat(d)}});hljs.registerLanguage("objectivec",function(e){var t={cN:"built_in",b:"(AV|CA|CF|CG|CI|MK|MP|NS|UI)\\w+"},i={keyword:"int float while char export sizeof typedef const struct for union unsigned long volatile static bool mutable if do return goto void enum else break extern asm case short default double register explicit signed typename this switch continue wchar_t inline readonly assign readwrite self @synchronized id typeof nonatomic super unichar IBOutlet IBAction strong weak copy in out inout bycopy byref oneway __strong __weak __block __autoreleasing @private @protected @public @try @property @end @throw @catch @finally @autoreleasepool @synthesize @dynamic @selector @optional @required",literal:"false true FALSE TRUE nil YES NO NULL",built_in:"BOOL dispatch_once_t dispatch_queue_t dispatch_sync dispatch_async dispatch_once"},o=/[a-zA-Z@][a-zA-Z0-9_]*/,n="@interface @class @protocol @implementation";return{aliases:["mm","objc","obj-c"],k:i,l:o,i:"</",c:[t,e.CLCM,e.CBCM,e.CNM,e.QSM,{cN:"string",v:[{b:'@"',e:'"',i:"\\n",c:[e.BE]},{b:"'",e:"[^\\\\]'",i:"[^\\\\][^']"}]},{cN:"preprocessor",b:"#",e:"$",c:[{cN:"title",v:[{b:'"',e:'"'},{b:"<",e:">"}]}]},{cN:"class",b:"("+n.split(" ").join("|")+")\\b",e:"({|$)",eE:!0,k:n,l:o,c:[e.UTM]},{cN:"variable",b:"\\."+e.UIR,r:0}]}});hljs.registerLanguage("javascript",function(e){return{aliases:["js"],k:{keyword:"in of if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const export super debugger as async await",literal:"true false null undefined NaN Infinity",built_in:"eval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Error EvalError InternalError RangeError ReferenceError StopIteration SyntaxError TypeError URIError Number Math Date String RegExp Array Float32Array Float64Array Int16Array Int32Array Int8Array Uint16Array Uint32Array Uint8Array Uint8ClampedArray ArrayBuffer DataView JSON Intl arguments require module console window document Symbol Set Map WeakSet WeakMap Proxy Reflect Promise"},c:[{cN:"pi",r:10,b:/^\s*['"]use (strict|asm)['"]/},e.ASM,e.QSM,{cN:"string",b:"`",e:"`",c:[e.BE,{cN:"subst",b:"\\$\\{",e:"\\}"}]},e.CLCM,e.CBCM,{cN:"number",v:[{b:"\\b(0[bB][01]+)"},{b:"\\b(0[oO][0-7]+)"},{b:e.CNR}],r:0},{b:"("+e.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[e.CLCM,e.CBCM,e.RM,{b:/</,e:/>\s*[);\]]/,r:0,sL:"xml"}],r:0},{cN:"function",bK:"function",e:/\{/,eE:!0,c:[e.inherit(e.TM,{b:/[A-Za-z$_][0-9A-Za-z$_]*/}),{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,c:[e.CLCM,e.CBCM],i:/["'\(]/}],i:/\[|%/},{b:/\$[(.]/},{b:"\\."+e.IR,r:0},{bK:"import",e:"[;$]",k:"import from as",c:[e.ASM,e.QSM]},{cN:"class",bK:"class",e:/[{;=]/,eE:!0,i:/[:"\[\]]/,c:[{bK:"extends"},e.UTM]}]}});hljs.registerLanguage("nginx",function(e){var r={cN:"variable",v:[{b:/\$\d+/},{b:/\$\{/,e:/}/},{b:"[\\$\\@]"+e.UIR}]},b={eW:!0,l:"[a-z/_]+",k:{built_in:"on off yes no true false none blocked debug info notice warn error crit select break last permanent redirect kqueue rtsig epoll poll /dev/poll"},r:0,i:"=>",c:[e.HCM,{cN:"string",c:[e.BE,r],v:[{b:/"/,e:/"/},{b:/'/,e:/'/}]},{cN:"url",b:"([a-z]+):/",e:"\\s",eW:!0,eE:!0,c:[r]},{cN:"regexp",c:[e.BE,r],v:[{b:"\\s\\^",e:"\\s|{|;",rE:!0},{b:"~\\*?\\s+",e:"\\s|{|;",rE:!0},{b:"\\*(\\.[a-z\\-]+)+"},{b:"([a-z\\-]+\\.)+\\*"}]},{cN:"number",b:"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}(:\\d{1,5})?\\b"},{cN:"number",b:"\\b\\d+[kKmMgGdshdwy]*\\b",r:0},r]};return{aliases:["nginxconf"],c:[e.HCM,{b:e.UIR+"\\s",e:";|{",rB:!0,c:[{cN:"title",b:e.UIR,starts:b}],r:0}],i:"[^\\s\\}]"}});hljs.registerLanguage("markdown",function(e){return{aliases:["md","mkdown","mkd"],c:[{cN:"header",v:[{b:"^#{1,6}",e:"$"},{b:"^.+?\\n[=-]{2,}$"}]},{b:"<",e:">",sL:"xml",r:0},{cN:"bullet",b:"^([*+-]|(\\d+\\.))\\s+"},{cN:"strong",b:"[*_]{2}.+?[*_]{2}"},{cN:"emphasis",v:[{b:"\\*.+?\\*"},{b:"_.+?_",r:0}]},{cN:"blockquote",b:"^>\\s+",e:"$"},{cN:"code",v:[{b:"`.+?`"},{b:"^( {4}|	)",e:"$",r:0}]},{cN:"horizontal_rule",b:"^[-\\*]{3,}",e:"$"},{b:"\\[.+?\\][\\(\\[].*?[\\)\\]]",rB:!0,c:[{cN:"link_label",b:"\\[",e:"\\]",eB:!0,rE:!0,r:0},{cN:"link_url",b:"\\]\\(",e:"\\)",eB:!0,eE:!0},{cN:"link_reference",b:"\\]\\[",e:"\\]",eB:!0,eE:!0}],r:10},{b:"^\\[.+\\]:",rB:!0,c:[{cN:"link_reference",b:"\\[",e:"\\]:",eB:!0,eE:!0,starts:{cN:"link_url",e:"$"}}]}]}});hljs.registerLanguage("json",function(e){var t={literal:"true false null"},i=[e.QSM,e.CNM],l={cN:"value",e:",",eW:!0,eE:!0,c:i,k:t},c={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:!0,eE:!0,c:[e.BE],i:"\\n",starts:l}],i:"\\S"},n={b:"\\[",e:"\\]",c:[e.inherit(l,{cN:null})],i:"\\S"};return i.splice(i.length,0,c,n),{c:i,k:t,i:"\\S"}});hljs.registerLanguage("php",function(e){var c={cN:"variable",b:"\\$+[a-zA-Z_-ÿ][a-zA-Z0-9_-ÿ]*"},a={cN:"preprocessor",b:/<\?(php)?|\?>/},i={cN:"string",c:[e.BE,a],v:[{b:'b"',e:'"'},{b:"b'",e:"'"},e.inherit(e.ASM,{i:null}),e.inherit(e.QSM,{i:null})]},n={v:[e.BNM,e.CNM]};return{aliases:["php3","php4","php5","php6"],cI:!0,k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception default die require __FUNCTION__ enddeclare final try switch continue endfor endif declare unset true false trait goto instanceof insteadof __DIR__ __NAMESPACE__ yield finally",c:[e.CLCM,e.HCM,e.C("/\\*","\\*/",{c:[{cN:"doctag",b:"@[A-Za-z]+"},a]}),e.C("__halt_compiler.+?;",!1,{eW:!0,k:"__halt_compiler",l:e.UIR}),{cN:"string",b:"<<<['\"]?\\w+['\"]?$",e:"^\\w+;",c:[e.BE]},a,c,{b:/(::|->)+[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/},{cN:"function",bK:"function",e:/[;{]/,eE:!0,i:"\\$|\\[|%",c:[e.UTM,{cN:"params",b:"\\(",e:"\\)",c:["self",c,e.CBCM,i,n]}]},{cN:"class",bK:"class interface",e:"{",eE:!0,i:/[:\(\$"]/,c:[{bK:"extends implements"},e.UTM]},{bK:"namespace",e:";",i:/[\.']/,c:[e.UTM]},{bK:"use",e:";",c:[e.UTM]},{b:"=>"},i,n]}});hljs.registerLanguage("diff",function(e){return{aliases:["patch"],c:[{cN:"chunk",r:10,v:[{b:/^@@ +\-\d+,\d+ +\+\d+,\d+ +@@$/},{b:/^\*\*\* +\d+,\d+ +\*\*\*\*$/},{b:/^\-\-\- +\d+,\d+ +\-\-\-\-$/}]},{cN:"header",v:[{b:/Index: /,e:/$/},{b:/=====/,e:/=====$/},{b:/^\-\-\-/,e:/$/},{b:/^\*{3} /,e:/$/},{b:/^\+\+\+/,e:/$/},{b:/\*{5}/,e:/\*{5}$/}]},{cN:"addition",b:"^\\+",e:"$"},{cN:"deletion",b:"^\\-",e:"$"},{cN:"change",b:"^\\!",e:"$"}]}});hljs.registerLanguage("apache",function(e){var r={cN:"number",b:"[\\$%]\\d+"};return{aliases:["apacheconf"],cI:!0,c:[e.HCM,{cN:"tag",b:"</?",e:">"},{cN:"keyword",b:/\w+/,r:0,k:{common:"order deny allow setenv rewriterule rewriteengine rewritecond documentroot sethandler errordocument loadmodule options header listen serverroot servername"},starts:{e:/$/,r:0,k:{literal:"on off all"},c:[{cN:"sqbracket",b:"\\s\\[",e:"\\]$"},{cN:"cbracket",b:"[\\$%]\\{",e:"\\}",c:["self",r]},r,e.QSM]}}],i:/\S/}});hljs.registerLanguage("http",function(t){return{aliases:["https"],i:"\\S",c:[{cN:"status",b:"^HTTP/[0-9\\.]+",e:"$",c:[{cN:"number",b:"\\b\\d{3}\\b"}]},{cN:"request",b:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",rB:!0,e:"$",c:[{cN:"string",b:" ",e:" ",eB:!0,eE:!0}]},{cN:"attribute",b:"^\\w",e:": ",eE:!0,i:"\\n|\\s|=",starts:{cN:"string",e:"$"}},{b:"\\n\\n",starts:{sL:"",eW:!0}}]}});hljs.registerLanguage("css",function(e){var c="[a-zA-Z-][a-zA-Z0-9_-]*",a={cN:"function",b:c+"\\(",rB:!0,eE:!0,e:"\\("},r={cN:"rule",b:/[A-Z\_\.\-]+\s*:/,rB:!0,e:";",eW:!0,c:[{cN:"attribute",b:/\S/,e:":",eE:!0,starts:{cN:"value",eW:!0,eE:!0,c:[a,e.CSSNM,e.QSM,e.ASM,e.CBCM,{cN:"hexcolor",b:"#[0-9A-Fa-f]+"},{cN:"important",b:"!important"}]}}]};return{cI:!0,i:/[=\/|'\$]/,c:[e.CBCM,r,{cN:"id",b:/\#[A-Za-z0-9_-]+/},{cN:"class",b:/\.[A-Za-z0-9_-]+/},{cN:"attr_selector",b:/\[/,e:/\]/,i:"$"},{cN:"pseudo",b:/:(:)?[a-zA-Z0-9\_\-\+\(\)"']+/},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:"font-face page"},{cN:"at_rule",b:"@",e:"[{;]",c:[{cN:"keyword",b:/\S+/},{b:/\s/,eW:!0,eE:!0,r:0,c:[a,e.ASM,e.QSM,e.CSSNM]}]},{cN:"tag",b:c,r:0},{cN:"rules",b:"{",e:"}",i:/\S/,c:[e.CBCM,r]}]}});hljs.registerLanguage("cs",function(e){var r="abstract as base bool break byte case catch char checked const continue decimal dynamic default delegate do double else enum event explicit extern false finally fixed float for foreach goto if implicit in int interface internal is lock long null when object operator out override params private protected public readonly ref sbyte sealed short sizeof stackalloc static string struct switch this true try typeof uint ulong unchecked unsafe ushort using virtual volatile void while async protected public private internal ascending descending from get group into join let orderby partial select set value var where yield",t=e.IR+"(<"+e.IR+">)?";return{aliases:["csharp"],k:r,i:/::/,c:[e.C("///","$",{rB:!0,c:[{cN:"xmlDocTag",v:[{b:"///",r:0},{b:"<!--|-->"},{b:"</?",e:">"}]}]}),e.CLCM,e.CBCM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line region endregion pragma checksum"},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},e.ASM,e.QSM,e.CNM,{bK:"class interface",e:/[{;=]/,i:/[^\s:]/,c:[e.TM,e.CLCM,e.CBCM]},{bK:"namespace",e:/[{;=]/,i:/[^\s:]/,c:[{cN:"title",b:"[a-zA-Z](\\.?\\w)*",r:0},e.CLCM,e.CBCM]},{bK:"new return throw await",r:0},{cN:"function",b:"("+t+"\\s+)+"+e.IR+"\\s*\\(",rB:!0,e:/[{;=]/,eE:!0,k:r,c:[{b:e.IR+"\\s*\\(",rB:!0,c:[e.TM],r:0},{cN:"params",b:/\(/,e:/\)/,eB:!0,eE:!0,k:r,r:0,c:[e.ASM,e.QSM,e.CNM,e.CBCM]},e.CLCM,e.CBCM]}]}});hljs.registerLanguage("xml",function(t){var e="[A-Za-z0-9\\._:-]+",s={b:/<\?(php)?(?!\w)/,e:/\?>/,sL:"php",subLanguageMode:"continuous"},c={eW:!0,i:/</,r:0,c:[s,{cN:"attribute",b:e,r:0},{b:"=",r:0,c:[{cN:"value",c:[s],v:[{b:/"/,e:/"/},{b:/'/,e:/'/},{b:/[^\s\/>]+/}]}]}]};return{aliases:["html","xhtml","rss","atom","xsl","plist"],cI:!0,c:[{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},t.C("<!--","-->",{r:10}),{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[c],starts:{e:"</style>",rE:!0,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[c],starts:{e:"</script>",rE:!0,sL:""}},s,{cN:"pi",b:/<\?\w+/,e:/\?>/,r:10},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:/[^ \/><\n\t]+/,r:0},c]}]}});hljs.registerLanguage("makefile",function(e){var a={cN:"variable",b:/\$\(/,e:/\)/,c:[e.BE]};return{aliases:["mk","mak"],c:[e.HCM,{b:/^\w+\s*\W*=/,rB:!0,r:0,starts:{cN:"constant",e:/\s*\W*=/,eE:!0,starts:{e:/$/,r:0,c:[a]}}},{cN:"title",b:/^[\w]+:\s*$/},{cN:"phony",b:/^\.PHONY:/,e:/$/,k:".PHONY",l:/[\.\w]+/},{b:/^\t+/,e:/$/,r:0,c:[e.QSM,a]}]}});hljs.registerLanguage("ini",function(e){return{cI:!0,i:/\S/,c:[e.C(";","$"),{cN:"title",b:"^\\[",e:"\\]"},{cN:"setting",b:"^[a-z0-9\\[\\]_-]+[ \\t]*=[ \\t]*",e:"$",c:[{cN:"value",eW:!0,k:"on off true false yes no",c:[e.QSM,e.NM],r:0}]}]}});hljs.registerLanguage("perl",function(e){var t="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when",r={cN:"subst",b:"[$@]\\{",e:"\\}",k:t},s={b:"->{",e:"}"},n={cN:"variable",v:[{b:/\$\d/},{b:/[\$%@](\^\w\b|#\w+(::\w+)*|{\w+}|\w+(::\w*)*)/},{b:/[\$%@][^\s\w{]/,r:0}]},i=e.C("^(__END__|__DATA__)","\\n$",{r:5}),o=[e.BE,r,n],a=[n,e.HCM,i,e.C("^\\=\\w","\\=cut",{eW:!0}),s,{cN:"string",c:o,v:[{b:"q[qwxr]?\\s*\\(",e:"\\)",r:5},{b:"q[qwxr]?\\s*\\[",e:"\\]",r:5},{b:"q[qwxr]?\\s*\\{",e:"\\}",r:5},{b:"q[qwxr]?\\s*\\|",e:"\\|",r:5},{b:"q[qwxr]?\\s*\\<",e:"\\>",r:5},{b:"qw\\s+q",e:"q",r:5},{b:"'",e:"'",c:[e.BE]},{b:'"',e:'"'},{b:"`",e:"`",c:[e.BE]},{b:"{\\w+}",c:[],r:0},{b:"-?\\w+\\s*\\=\\>",c:[],r:0}]},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"(\\/\\/|"+e.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[e.HCM,i,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[e.BE],r:0}]},{cN:"sub",bK:"sub",e:"(\\s*\\(.*?\\))?[;{]",r:5},{cN:"operator",b:"-\\w\\b",r:0}];return r.c=a,s.c=a,{aliases:["pl"],k:t,c:a}});hljs.registerLanguage("bash",function(e){var t={cN:"variable",v:[{b:/\$[\w\d#@][\w\d_]*/},{b:/\$\{(.*?)}/}]},s={cN:"string",b:/"/,e:/"/,c:[e.BE,t,{cN:"variable",b:/\$\(/,e:/\)/,c:[e.BE]}]},a={cN:"string",b:/'/,e:/'/};return{aliases:["sh","zsh"],l:/-?[a-z\.]+/,k:{keyword:"if then else elif fi for while in do done case esac function",literal:"true false",built_in:"break cd continue eval exec exit export getopts hash pwd readonly return shift test times trap umask unset alias bind builtin caller command declare echo enable help let local logout mapfile printf read readarray source type typeset ulimit unalias set shopt autoload bg bindkey bye cap chdir clone comparguments compcall compctl compdescribe compfiles compgroups compquote comptags comptry compvalues dirs disable disown echotc echoti emulate fc fg float functions getcap getln history integer jobs kill limit log noglob popd print pushd pushln rehash sched setcap setopt stat suspend ttyctl unfunction unhash unlimit unsetopt vared wait whence where which zcompile zformat zftp zle zmodload zparseopts zprof zpty zregexparse zsocket zstyle ztcp",operator:"-ne -eq -lt -gt -f -d -e -s -l -a"},c:[{cN:"shebang",b:/^#![^\n]+sh\s*$/,r:10},{cN:"function",b:/\w[\w\d_]*\s*\(\s*\)\s*\{/,rB:!0,c:[e.inherit(e.TM,{b:/\w[\w\d_]*/})],r:0},e.HCM,e.NM,s,a,t]}});
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/template.loading.js                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogLoading");                                                                                   // 2
Template["blogLoading"] = new Template("Template.blogLoading", (function() {                                           // 3
  var view = this;                                                                                                     // 4
  return HTML.Raw('<div class="meteor-blog-loading">\n    <div></div>\n    <div></div>\n    <div class="meteor-blog-fakeimg"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-right"></div>\n    <div class="meteor-blog-clear"></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n  </div>');
}));                                                                                                                   // 6
                                                                                                                       // 7
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/admin/template.admin.js                                                              //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogAdmin");                                                                                     // 2
Template["blogAdmin"] = new Template("Template.blogAdmin", (function() {                                               // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    "class": "meteor-blog-admin"                                                                                       // 6
  }, "\n    ", HTML.DIV({                                                                                              // 7
    "class": "container meteor-blog-admin-index"                                                                       // 8
  }, "\n      ", HTML.DIV({                                                                                            // 9
    "class": "row"                                                                                                     // 10
  }, "\n        ", HTML.DIV({                                                                                          // 11
    "class": "col-md-3"                                                                                                // 12
  }, "\n          ", HTML.H1(Blaze.View("lookup:BlogLanguage.adminHeader", function() {                                // 13
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "adminHeader"));                              // 14
  })), "\n        "), "\n        ", HTML.DIV({                                                                         // 15
    "class": "col-md-9"                                                                                                // 16
  }, "\n          ", HTML.A({                                                                                          // 17
    href: "#",                                                                                                         // 18
    "data-action": "new-blog",                                                                                         // 19
    "class": "btn btn-default"                                                                                         // 20
  }, "\n            ", HTML.Raw('<i class="fa fa-plus"></i>'), " ", Blaze.View("lookup:BlogLanguage.addPost", function() {
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "addPost"));                                  // 22
  }), "\n          "), "\n          ", HTML.SELECT({                                                                   // 23
    "data-action": "filtering",                                                                                        // 24
    "class": "form-control"                                                                                            // 25
  }, "\n            ", HTML.OPTION({                                                                                   // 26
    value: "all"                                                                                                       // 27
  }, Blaze.View("lookup:BlogLanguage.allPosts", function() {                                                           // 28
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "allPosts"));                                 // 29
  })), "\n            ", HTML.OPTION({                                                                                 // 30
    value: "mine"                                                                                                      // 31
  }, Blaze.View("lookup:BlogLanguage.myPosts", function() {                                                            // 32
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "myPosts"));                                  // 33
  })), "\n          "), "\n        "), "\n      "), "\n      ", HTML.DIV({                                             // 34
    "class": "row"                                                                                                     // 35
  }, "\n        ", HTML.DIV({                                                                                          // 36
    "class": "col-md-12"                                                                                               // 37
  }, "\n          ", Blaze.If(function() {                                                                             // 38
    return Spacebars.call(view.lookup("subsReady"));                                                                   // 39
  }, function() {                                                                                                      // 40
    return [ "\n            ", Blaze.If(function() {                                                                   // 41
      return Spacebars.call(view.lookup("posts"));                                                                     // 42
    }, function() {                                                                                                    // 43
      return [ "\n              ", Blaze._TemplateWith(function() {                                                    // 44
        return {                                                                                                       // 45
          collection: Spacebars.call(view.lookup("posts")),                                                            // 46
          settings: Spacebars.call(view.lookup("table"))                                                               // 47
        };                                                                                                             // 48
      }, function() {                                                                                                  // 49
        return Spacebars.include(view.lookupTemplate("reactiveTable"));                                                // 50
      }), "\n            " ];                                                                                          // 51
    }, function() {                                                                                                    // 52
      return [ "\n              ", HTML.A({                                                                            // 53
        href: "#",                                                                                                     // 54
        "data-action": "new-blog"                                                                                      // 55
      }, Blaze.View("lookup:BlogLanguage.createFirst", function() {                                                    // 56
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "createFirst"));                          // 57
      })), "\n            " ];                                                                                         // 58
    }), "\n          " ];                                                                                              // 59
  }, function() {                                                                                                      // 60
    return [ "\n            ", Spacebars.include(view.lookupTemplate("blogLoading")), "\n          " ];                // 61
  }), "\n        "), "\n      "), "\n    "), "\n  ");                                                                  // 62
}));                                                                                                                   // 63
                                                                                                                       // 64
Template.__checkName("blogAdminTitleColumn");                                                                          // 65
Template["blogAdminTitleColumn"] = new Template("Template.blogAdminTitleColumn", (function() {                         // 66
  var view = this;                                                                                                     // 67
  return [ HTML.H4(HTML.A({                                                                                            // 68
    target: "_blank",                                                                                                  // 69
    href: function() {                                                                                                 // 70
      return Spacebars.mustache(view.lookup("blogPathFor"), "blogShow");                                               // 71
    }                                                                                                                  // 72
  }, Blaze.View("lookup:title", function() {                                                                           // 73
    return Spacebars.mustache(view.lookup("title"));                                                                   // 74
  }))), "\n  ", HTML.P(Blaze.View("lookup:excerpt", function() {                                                       // 75
    return Spacebars.makeRaw(Spacebars.mustache(view.lookup("excerpt")));                                              // 76
  })) ];                                                                                                               // 77
}));                                                                                                                   // 78
                                                                                                                       // 79
Template.__checkName("blogAdminAuthorColumn");                                                                         // 80
Template["blogAdminAuthorColumn"] = new Template("Template.blogAdminAuthorColumn", (function() {                       // 81
  var view = this;                                                                                                     // 82
  return Blaze.View("lookup:authorName", function() {                                                                  // 83
    return Spacebars.mustache(view.lookup("authorName"));                                                              // 84
  });                                                                                                                  // 85
}));                                                                                                                   // 86
                                                                                                                       // 87
Template.__checkName("blogAdminUpdatedColumn");                                                                        // 88
Template["blogAdminUpdatedColumn"] = new Template("Template.blogAdminUpdatedColumn", (function() {                     // 89
  var view = this;                                                                                                     // 90
  return Blaze.View("lookup:blogFormatDate", function() {                                                              // 91
    return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("updatedAt"));                                // 92
  });                                                                                                                  // 93
}));                                                                                                                   // 94
                                                                                                                       // 95
Template.__checkName("blogAdminPublishedColumn");                                                                      // 96
Template["blogAdminPublishedColumn"] = new Template("Template.blogAdminPublishedColumn", (function() {                 // 97
  var view = this;                                                                                                     // 98
  return Blaze.If(function() {                                                                                         // 99
    return Spacebars.call(view.lookup("publishedAt"));                                                                 // 100
  }, function() {                                                                                                      // 101
    return [ "\n    ", Blaze.View("lookup:blogFormatDate", function() {                                                // 102
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 103
    }), "\n  " ];                                                                                                      // 104
  }, function() {                                                                                                      // 105
    return [ "\n    ", HTML.I({                                                                                        // 106
      "class": "fa fa-ban"                                                                                             // 107
    }), "\n  " ];                                                                                                      // 108
  });                                                                                                                  // 109
}));                                                                                                                   // 110
                                                                                                                       // 111
Template.__checkName("blogAdminVisibleColumn");                                                                        // 112
Template["blogAdminVisibleColumn"] = new Template("Template.blogAdminVisibleColumn", (function() {                     // 113
  var view = this;                                                                                                     // 114
  return HTML.SELECT({                                                                                                 // 115
    "data-action": "visibility",                                                                                       // 116
    "class": "form-control input-sm"                                                                                   // 117
  }, "\n    ", HTML.OPTION({                                                                                           // 118
    value: "draft",                                                                                                    // 119
    selected: function() {                                                                                             // 120
      return Spacebars.mustache(view.lookup("isSelected"), "draft");                                                   // 121
    }                                                                                                                  // 122
  }, Blaze.View("lookup:BlogLanguage.postVisibilityAdmins", function() {                                               // 123
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "postVisibilityAdmins"));                     // 124
  })), "\n    ", HTML.OPTION({                                                                                         // 125
    value: "private",                                                                                                  // 126
    selected: function() {                                                                                             // 127
      return Spacebars.mustache(view.lookup("isSelected"), "private");                                                 // 128
    }                                                                                                                  // 129
  }, Blaze.View("lookup:BlogLanguage.postVisibilityLink", function() {                                                 // 130
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "postVisibilityLink"));                       // 131
  })), "\n    ", HTML.OPTION({                                                                                         // 132
    value: "public",                                                                                                   // 133
    selected: function() {                                                                                             // 134
      return Spacebars.mustache(view.lookup("isSelected"), "public");                                                  // 135
    }                                                                                                                  // 136
  }, Blaze.View("lookup:BlogLanguage.postVisibilityAnyone", function() {                                               // 137
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "postVisibilityAnyone"));                     // 138
  })), "\n  ");                                                                                                        // 139
}));                                                                                                                   // 140
                                                                                                                       // 141
Template.__checkName("blogAdminEditColumn");                                                                           // 142
Template["blogAdminEditColumn"] = new Template("Template.blogAdminEditColumn", (function() {                           // 143
  var view = this;                                                                                                     // 144
  return HTML.A({                                                                                                      // 145
    href: function() {                                                                                                 // 146
      return Spacebars.mustache(view.lookup("blogPathFor"), "blogAdminEdit");                                          // 147
    }                                                                                                                  // 148
  }, HTML.Raw('<i class="fa fa-edit"></i>'));                                                                          // 149
}));                                                                                                                   // 150
                                                                                                                       // 151
Template.__checkName("blogAdminDeleteColumn");                                                                         // 152
Template["blogAdminDeleteColumn"] = new Template("Template.blogAdminDeleteColumn", (function() {                       // 153
  var view = this;                                                                                                     // 154
  return HTML.Raw('<a href="#" data-action="delete"><i class="fa fa-trash-o"></i></a>');                               // 155
}));                                                                                                                   // 156
                                                                                                                       // 157
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/admin/admin.coffee.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.blogAdmin.onCreated(function() {                                                                              // 1
  var authorsSub, postsSub;                                                                                            // 2
  postsSub = this.subscribe('blog.postForAdmin');                                                                      //
  authorsSub = this.subscribe('blog.authors');                                                                         //
  this.subsReady = new ReactiveVar(false);                                                                             //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      if (postsSub.ready() && authorsSub.ready() && !Meteor.loggingIn()) {                                             //
        return _this.subsReady.set(true);                                                                              //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
  return this.autorun(function() {                                                                                     //
    if (!Meteor.userId()) {                                                                                            //
      return Blog.Router.go('blogIndex');                                                                              //
    }                                                                                                                  //
  });                                                                                                                  //
});                                                                                                                    // 1
                                                                                                                       //
Template.blogAdmin.onRendered(function() {                                                                             // 13
  return Meteor.call('isBlogAuthorized', (function(_this) {                                                            //
    return function(err, authorized) {                                                                                 //
      if (!authorized) {                                                                                               //
        return Blog.Router.go('/blog');                                                                                // 16
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
});                                                                                                                    // 13
                                                                                                                       //
Template.blogAdmin.helpers({                                                                                           // 18
  subsReady: function() {                                                                                              //
    return Template.instance().subsReady.get();                                                                        //
  },                                                                                                                   //
  posts: function() {                                                                                                  //
    var results;                                                                                                       // 23
    results = Blog.Post.all({                                                                                          //
      sort: {                                                                                                          //
        updatedAt: -1                                                                                                  //
      }                                                                                                                //
    }).toArray();                                                                                                      //
    if (_.size(Session.get('filters'))) {                                                                              //
      results = _(results).where(Session.get('filters'));                                                              //
    }                                                                                                                  //
    return results;                                                                                                    //
  },                                                                                                                   //
  table: function() {                                                                                                  //
    return {                                                                                                           //
      rowsPerPage: 20,                                                                                                 //
      showFilter: false,                                                                                               //
      showNavigation: 'auto',                                                                                          //
      useFontAwesome: true,                                                                                            //
      'class': 'table table-striped table-hover col-sm-12 table-bordered',                                             //
      fields: [                                                                                                        //
        {                                                                                                              //
          key: 'title',                                                                                                //
          label: Blog.settings.language.title,                                                                         //
          tmpl: Template.blogAdminTitleColumn                                                                          //
        }, {                                                                                                           //
          key: 'userId',                                                                                               //
          label: Blog.settings.language.author,                                                                        //
          tmpl: Template.blogAdminAuthorColumn                                                                         //
        }, {                                                                                                           //
          key: 'updatedAt',                                                                                            //
          label: Blog.settings.language.updatedAt,                                                                     //
          tmpl: Template.blogAdminUpdatedColumn,                                                                       //
          sort: 'descending',                                                                                          //
          sortByValue: true                                                                                            //
        }, {                                                                                                           //
          key: 'publishedAt',                                                                                          //
          label: Blog.settings.language.publishedAt,                                                                   //
          tmpl: Template.blogAdminPublishedColumn,                                                                     //
          sortByValue: true                                                                                            //
        }, {                                                                                                           //
          key: 'visibleTo',                                                                                            //
          label: Blog.settings.language.visibleTo,                                                                     //
          tmpl: Template.blogAdminVisibleColumn                                                                        //
        }, {                                                                                                           //
          key: 'id',                                                                                                   //
          label: Blog.settings.language.edit,                                                                          //
          tmpl: Template.blogAdminEditColumn                                                                           //
        }, {                                                                                                           //
          key: 'id',                                                                                                   //
          label: Blog.settings.language["delete"],                                                                     //
          tmpl: Template.blogAdminDeleteColumn                                                                         //
        }                                                                                                              //
      ]                                                                                                                //
    };                                                                                                                 //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogAdmin.events({                                                                                            // 46
  'click [data-action=new-blog]': function(e, tpl) {                                                                   //
    e.preventDefault();                                                                                                //
    return Blog.Router.go('blogAdminEdit', {                                                                           //
      id: 'new'                                                                                                        //
    });                                                                                                                //
  },                                                                                                                   //
  'change [data-action=filtering]': function(e) {                                                                      //
    var filters;                                                                                                       // 52
    e.preventDefault();                                                                                                //
    filters = {};                                                                                                      //
    if ($(e.currentTarget).val() === 'mine') {                                                                         //
      filters.userId = Meteor.userId();                                                                                //
    }                                                                                                                  //
    return Session.set('filters', filters);                                                                            //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogAdminVisibleColumn.helpers({                                                                              // 63
  isSelected: function(mode) {                                                                                         //
    return mode === this.mode;                                                                                         //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogAdminVisibleColumn.events({                                                                               // 66
  'change [data-action=visibility]': function(e, tpl) {                                                                //
    var mode, publishedAt;                                                                                             // 68
    e.preventDefault();                                                                                                //
    mode = e.currentTarget.value;                                                                                      //
    publishedAt = mode === 'draft' ? null : new Date();                                                                //
    return this.update({                                                                                               //
      mode: mode,                                                                                                      //
      publishedAt: publishedAt                                                                                         //
    });                                                                                                                //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogAdminDeleteColumn.events({                                                                                // 75
  'click [data-action=delete]': function(e, tpl) {                                                                     //
    e.preventDefault();                                                                                                //
    console.log(Blog.settings);                                                                                        //
    if (confirm(Blog.settings.language.areYouSure)) {                                                                  //
      return $(e.currentTarget).parents('tr').fadeOut((function(_this) {                                               //
        return function() {                                                                                            //
          return _this.destroy();                                                                                      //
        };                                                                                                             //
      })(this));                                                                                                       //
    }                                                                                                                  //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/admin/template.edit.js                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogAdminEdit");                                                                                 // 2
Template["blogAdminEdit"] = new Template("Template.blogAdminEdit", (function() {                                       // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    "class": "meteor-blog-admin"                                                                                       // 6
  }, "\n    ", HTML.DIV({                                                                                              // 7
    "class": "container meteor-blog-admin-edit"                                                                        // 8
  }, "\n      ", HTML.DIV({                                                                                            // 9
    "class": "row"                                                                                                     // 10
  }, "\n        ", HTML.DIV({                                                                                          // 11
    "class": "col-md-8 col-md-offset-2"                                                                                // 12
  }, "\n          ", HTML.H1("\n            ", HTML.STRONG("\n              ", Blaze.If(function() {                   // 13
    return Spacebars.call(Spacebars.dot(view.lookup("post"), "_id"));                                                  // 14
  }, function() {                                                                                                      // 15
    return [ "\n                ", Blaze.View("lookup:BlogLanguage.editPost", function() {                             // 16
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "editPost"));                               // 17
    }), "\n              " ];                                                                                          // 18
  }, function() {                                                                                                      // 19
    return [ "\n                ", Blaze.View("lookup:BlogLanguage.addPost", function() {                              // 20
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "addPost"));                                // 21
    }), "\n              " ];                                                                                          // 22
  }), "\n            "), "\n          "), "\n\n          ", Blaze.If(function() {                                      // 23
    return Spacebars.call(view.lookup("subsReady"));                                                                   // 24
  }, function() {                                                                                                      // 25
    return [ "\n            ", Spacebars.With(function() {                                                             // 26
      return Spacebars.call(view.lookup("post"));                                                                      // 27
    }, function() {                                                                                                    // 28
      return [ "\n              ", HTML.FORM("\n                ", HTML.DIV({                                          // 29
        "class": "row form-group"                                                                                      // 30
      }, "\n                  ", HTML.DIV({                                                                            // 31
        "class": "col-md-9"                                                                                            // 32
      }, "\n                    ", HTML.LABEL(Blaze.View("lookup:BlogLanguage.title", function() {                     // 33
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "title"));                                // 34
      })), "\n                    ", HTML.INPUT({                                                                      // 35
        tabindex: "1",                                                                                                 // 36
        type: "text",                                                                                                  // 37
        "class": "form-control",                                                                                       // 38
        name: "title",                                                                                                 // 39
        placeholder: function() {                                                                                      // 40
          return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "title"));                              // 41
        },                                                                                                             // 42
        value: function() {                                                                                            // 43
          return Spacebars.mustache(view.lookup("title"));                                                             // 44
        }                                                                                                              // 45
      }), "\n                  "), "\n                  ", HTML.DIV({                                                  // 46
        "class": "col-md-3"                                                                                            // 47
      }, "\n                  ", HTML.LABEL({                                                                          // 48
        "for": "featured-image"                                                                                        // 49
      }, Blaze.View("lookup:BlogLanguage.featuredImage", function() {                                                  // 50
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "featuredImage"));                        // 51
      })), "\n                    ", HTML.INPUT({                                                                      // 52
        type: "file",                                                                                                  // 53
        id: "input-featured-image",                                                                                    // 54
        name: "featured-image",                                                                                        // 55
        "class": "hidden"                                                                                              // 56
      }), "\n                    ", HTML.LABEL({                                                                       // 57
        "class": "btn btn-info",                                                                                       // 58
        "for": "input-featured-image"                                                                                  // 59
      }, "\n                      ", Blaze.If(function() {                                                             // 60
        return Spacebars.call(view.lookup("featuredImage"));                                                           // 61
      }, function() {                                                                                                  // 62
        return [ "\n                        ", Blaze.View("lookup:featuredImageName", function() {                     // 63
          return Spacebars.mustache(view.lookup("featuredImageName"));                                                 // 64
        }), "\n                      " ];                                                                              // 65
      }, function() {                                                                                                  // 66
        return [ "\n                        ", Blaze.View("lookup:BlogLanguage.selectFile", function() {               // 67
          return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "selectFile"));                         // 68
        }), "\n                      " ];                                                                              // 69
      }), "\n                    "), "\n                    ", Blaze.If(function() {                                   // 70
        return Spacebars.call(view.lookup("featuredImage"));                                                           // 71
      }, function() {                                                                                                  // 72
        return [ "\n                      ", HTML.CharRef({                                                            // 73
          html: "&nbsp;",                                                                                              // 74
          str: " "                                                                                                     // 75
        }), HTML.A({                                                                                                   // 76
          href: "#",                                                                                                   // 77
          "data-action": "delete-featured"                                                                             // 78
        }, HTML.I({                                                                                                    // 79
          "class": "fa fa-trash-o"                                                                                     // 80
        })), "\n                    " ];                                                                               // 81
      }), "\n                    ", HTML.P({                                                                           // 82
        "class": "help-block"                                                                                          // 83
      }, "\n                      ", HTML.DIV({                                                                        // 84
        "class": "checkbox"                                                                                            // 85
      }, "\n                        ", HTML.LABEL({                                                                    // 86
        "for": "background-title"                                                                                      // 87
      }, "\n                          ", HTML.INPUT({                                                                  // 88
        type: "checkbox",                                                                                              // 89
        name: "background-title",                                                                                      // 90
        id: "background-title",                                                                                        // 91
        checked: function() {                                                                                          // 92
          return Blaze.If(function() {                                                                                 // 93
            return Spacebars.call(view.lookup("titleBackground"));                                                     // 94
          }, function() {                                                                                              // 95
            return "checked";                                                                                          // 96
          });                                                                                                          // 97
        }                                                                                                              // 98
      }), " ", Blaze.View("lookup:BlogLanguage.imageAsBackground", function() {                                        // 99
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "imageAsBackground"));                    // 100
      }), "\n                        "), "\n                      "), "\n                    "), "\n                  "), "\n                "), "\n                ", HTML.DIV({
        "class": "row form-group"                                                                                      // 102
      }, "\n                  ", HTML.DIV({                                                                            // 103
        "class": "col-md-4"                                                                                            // 104
      }, "\n                    ", HTML.LABEL(Blaze.View("lookup:BlogLanguage.tags", function() {                      // 105
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "tags"));                                 // 106
      })), "\n                    ", HTML.INPUT({                                                                      // 107
        tabindex: "2",                                                                                                 // 108
        type: "text",                                                                                                  // 109
        "class": "form-control",                                                                                       // 110
        name: "tags",                                                                                                  // 111
        placeholder: function() {                                                                                      // 112
          return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "enterTag"));                           // 113
        },                                                                                                             // 114
        value: function() {                                                                                            // 115
          return Spacebars.mustache(view.lookup("blogJoinTags"), view.lookup("tags"));                                 // 116
        },                                                                                                             // 117
        "data-role": "tagsinput"                                                                                       // 118
      }), "\n                  "), "\n                  ", HTML.DIV({                                                  // 119
        "class": "col-md-4"                                                                                            // 120
      }, "\n                    ", HTML.LABEL(Blaze.View("lookup:BlogLanguage.slug", function() {                      // 121
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "slug"));                                 // 122
      })), "\n                    ", HTML.INPUT({                                                                      // 123
        type: "text",                                                                                                  // 124
        "class": "form-control",                                                                                       // 125
        name: "slug",                                                                                                  // 126
        placeholder: function() {                                                                                      // 127
          return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "slug"));                               // 128
        },                                                                                                             // 129
        value: function() {                                                                                            // 130
          return Spacebars.mustache(view.lookup("slug"));                                                              // 131
        }                                                                                                              // 132
      }), "\n                  "), "\n                  ", HTML.DIV({                                                  // 133
        "class": "col-md-4"                                                                                            // 134
      }, "\n                    ", HTML.LABEL(Blaze.View("lookup:BlogLanguage.metaDescription", function() {           // 135
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaDescription"));                      // 136
      })), "\n                    ", HTML.INPUT({                                                                      // 137
        type: "text",                                                                                                  // 138
        "class": "form-control",                                                                                       // 139
        name: "description",                                                                                           // 140
        placeholder: function() {                                                                                      // 141
          return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaDescription"));                    // 142
        },                                                                                                             // 143
        value: function() {                                                                                            // 144
          return Spacebars.mustache(view.lookup("description"));                                                       // 145
        }                                                                                                              // 146
      }), "\n                  "), "\n                "), "\n                ", HTML.DIV({                             // 147
        "class": "row form-group"                                                                                      // 148
      }, "\n                  ", HTML.DIV({                                                                            // 149
        "class": "col-md-12"                                                                                           // 150
      }, "\n                    ", HTML.LABEL(Blaze.View("lookup:BlogLanguage.body", function() {                      // 151
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "body"));                                 // 152
      })), "\n                    ", HTML.DIV({                                                                        // 153
        "class": "edit-mode"                                                                                           // 154
      }, "\n                      ", HTML.A({                                                                          // 155
        href: "#",                                                                                                     // 156
        "data-action": "toggle-visual",                                                                                // 157
        "class": "selected"                                                                                            // 158
      }, Blaze.View("lookup:BlogLanguage.showAsVisual", function() {                                                   // 159
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "showAsVisual"));                         // 160
      })), "\n                      -\n                      ", HTML.A({                                               // 161
        href: "#",                                                                                                     // 162
        "data-action": "toggle-html"                                                                                   // 163
      }, Blaze.View("lookup:BlogLanguage.showAsHtml", function() {                                                     // 164
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "showAsHtml"));                           // 165
      })), "\n                    "), "\n                    ", HTML.TEXTAREA({                                        // 166
        hidden: "",                                                                                                    // 167
        "class": "html-editor col-xs-12"                                                                               // 168
      }), "\n                    ", HTML.DIV({                                                                         // 169
        "class": "editable",                                                                                           // 170
        tabindex: "3"                                                                                                  // 171
      }), "\n                    ", HTML.BUTTON({                                                                      // 172
        type: "submit",                                                                                                // 173
        "class": "btn btn-default"                                                                                     // 174
      }, "\n                      ", HTML.I({                                                                          // 175
        "class": "fa fa-save"                                                                                          // 176
      }), " ", Blaze.View("lookup:BlogLanguage.save", function() {                                                     // 177
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "save"));                                 // 178
      }), "\n                    "), "\n                    ", HTML.A({                                                // 179
        href: function() {                                                                                             // 180
          return Spacebars.mustache(view.lookup("blogPathFor"), "blogAdmin");                                          // 181
        },                                                                                                             // 182
        "class": "btn btn-default"                                                                                     // 183
      }, "\n                      ", HTML.I({                                                                          // 184
        "class": "fa fa-ban"                                                                                           // 185
      }), " ", Blaze.View("lookup:BlogLanguage.cancel", function() {                                                   // 186
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "cancel"));                               // 187
      }), "\n                    "), "\n                  "), "\n                "), "\n              "), "\n            " ];
    }), "\n          " ];                                                                                              // 189
  }, function() {                                                                                                      // 190
    return [ "\n            ", Spacebars.include(view.lookupTemplate("blogLoading")), "\n          " ];                // 191
  }), "\n        "), "\n      "), "\n    "), "\n  ");                                                                  // 192
}));                                                                                                                   // 193
                                                                                                                       // 194
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/admin/editor.coffee.js                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;                                                                                         //
                                                                                                                       //
this.BlogEditor = (function(superClass) {                                                                              // 1
  extend(BlogEditor, superClass);                                                                                      //
                                                                                                                       //
  BlogEditor.make = function(tpl) {                                                                                    //
    var $editable, editor;                                                                                             // 5
    $editable = $('.editable');                                                                                        //
    if ($editable.data('mediumEditor')) {                                                                              //
      return $editable.data('mediumEditor');                                                                           // 8
    }                                                                                                                  //
    editor = new BlogEditor($editable[0], {                                                                            //
      buttonLabels: 'fontawesome',                                                                                     //
      extensions: {                                                                                                    //
        placeholder: {                                                                                                 //
          text: ''                                                                                                     //
        }                                                                                                              //
      },                                                                                                               //
      toolbar: {                                                                                                       //
        buttons: ['bold', 'italic', 'underline', 'anchor', 'pre', 'h1', 'h2', 'orderedlist', 'unorderedlist', 'quote', 'image']
      }                                                                                                                //
    });                                                                                                                //
    editor.subscribe('showToolbar', (function(_this) {                                                                 //
      return function(e) {                                                                                             //
        if (_this.inPreformatted()) {                                                                                  //
          return editor.toolbar.hideToolbar();                                                                         //
        }                                                                                                              //
      };                                                                                                               //
    })(this));                                                                                                         //
    tpl.$('.editable').mediumInsert({                                                                                  //
      editor: editor,                                                                                                  //
      enabled: true,                                                                                                   //
      addons: {                                                                                                        //
        images: {                                                                                                      //
          fileUploadOptions: {                                                                                         //
            submit: function(e, data) {                                                                                //
              var file, files, j, k, len, len1, ref, ref1, ref2, results, results1, self;                              // 32
              self = tpl.$('.editable').data('plugin_mediumInsertImages');                                             //
              files = data.files;                                                                                      //
              if ((ref = Meteor.settings) != null ? (ref1 = ref["public"]) != null ? (ref2 = ref1.blog) != null ? ref2.useS3 : void 0 : void 0 : void 0) {
                results = [];                                                                                          // 36
                for (j = 0, len = files.length; j < len; j++) {                                                        //
                  file = files[j];                                                                                     //
                  results.push(Blog.S3Files.insert(file, function(err, fileObj) {                                      //
                    return Tracker.autorun(function(c) {                                                               //
                      var theFile;                                                                                     // 39
                      theFile = Blog.S3Files.find({                                                                    //
                        _id: fileObj._id                                                                               //
                      }).fetch()[0];                                                                                   //
                      if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {      //
                        self.uploadDone(e, {                                                                           //
                          result: {                                                                                    //
                            files: [                                                                                   //
                              {                                                                                        //
                                url: theFile.url()                                                                     //
                              }                                                                                        //
                            ]                                                                                          //
                          },                                                                                           //
                          context: data.context                                                                        //
                        });                                                                                            //
                        return c.stop();                                                                               //
                      }                                                                                                //
                    });                                                                                                //
                  }));                                                                                                 //
                }                                                                                                      // 36
                return results;                                                                                        //
              } else {                                                                                                 //
                results1 = [];                                                                                         // 50
                for (k = 0, len1 = files.length; k < len1; k++) {                                                      //
                  file = files[k];                                                                                     //
                  results1.push(Blog.FilesLocal.insert(file, function(err, fileObj) {                                  //
                    return Tracker.autorun(function(c) {                                                               //
                      var theFile;                                                                                     // 53
                      theFile = Blog.FilesLocal.find({                                                                 //
                        _id: fileObj._id                                                                               //
                      }).fetch()[0];                                                                                   //
                      if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {      //
                        self.uploadDone(e, {                                                                           //
                          result: {                                                                                    //
                            files: [                                                                                   //
                              {                                                                                        //
                                url: theFile.url()                                                                     //
                              }                                                                                        //
                            ]                                                                                          //
                          },                                                                                           //
                          context: data.context                                                                        //
                        });                                                                                            //
                        return c.stop();                                                                               //
                      }                                                                                                //
                    });                                                                                                //
                  }));                                                                                                 //
                }                                                                                                      // 50
                return results1;                                                                                       //
              }                                                                                                        //
            }                                                                                                          //
          }                                                                                                            //
        }                                                                                                              //
      }                                                                                                                //
    });                                                                                                                //
    $editable.data('mediumEditor', editor);                                                                            //
    return editor;                                                                                                     //
  };                                                                                                                   //
                                                                                                                       //
  function BlogEditor() {                                                                                              //
    this.init.apply(this, arguments);                                                                                  //
  }                                                                                                                    //
                                                                                                                       //
  BlogEditor.prototype.contents = function() {                                                                         //
    return this.serialize()['element-0'].value;                                                                        //
  };                                                                                                                   //
                                                                                                                       //
  BlogEditor.prototype.pretty = function() {                                                                           //
    return html_beautify(this.contents(), {                                                                            //
      preserve_newlines: false,                                                                                        //
      indent_size: 2,                                                                                                  //
      wrap_line_length: 0                                                                                              //
    });                                                                                                                //
  };                                                                                                                   //
                                                                                                                       //
  BlogEditor.prototype.highlightSyntax = function() {                                                                  //
    var br2nl;                                                                                                         // 87
    hljs.configure({                                                                                                   //
      userBR: true                                                                                                     //
    });                                                                                                                //
    br2nl = function(i, html) {                                                                                        //
      return html.replace(/<br>/g, "\n").replace(/<[^>]+>/g, '');                                                      //
    };                                                                                                                 //
    return $(this.elements[0]).find('pre').removeClass('hljs').html(br2nl).each(function(i, block) {                   //
      return hljs.highlightBlock(block);                                                                               //
    });                                                                                                                //
  };                                                                                                                   //
                                                                                                                       //
  BlogEditor.inPreformatted = function() {                                                                             //
    var current, node;                                                                                                 // 102
    node = document.getSelection().anchorNode;                                                                         //
    current = node && node.nodeType === 3 ? node.parentNode : node;                                                    //
    while (true) {                                                                                                     // 105
      if (current.nodeType === 1) {                                                                                    //
        if (current.tagName.toLowerCase() === 'pre') {                                                                 //
          return true;                                                                                                 // 108
        }                                                                                                              //
        if (current.getAttribute('data-medium-element')) {                                                             //
          return false;                                                                                                // 112
        }                                                                                                              //
      }                                                                                                                //
      current = current.parentNode;                                                                                    //
      if (!current) {                                                                                                  //
        break;                                                                                                         // 115
      }                                                                                                                //
    }                                                                                                                  //
    return false;                                                                                                      //
  };                                                                                                                   //
                                                                                                                       //
  return BlogEditor;                                                                                                   //
                                                                                                                       //
})(MediumEditor);                                                                                                      //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/admin/edit.coffee.js                                                                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var getBlogTags, readImageDimensions, save, setEditMode, substringMatcher;                                             // 5
                                                                                                                       //
getBlogTags = function(tags) {                                                                                         // 5
  if (typeof tags === 'string') {                                                                                      //
    return [];                                                                                                         //
  } else {                                                                                                             //
    return tags;                                                                                                       //
  }                                                                                                                    //
};                                                                                                                     // 5
                                                                                                                       //
readImageDimensions = function(file, cb) {                                                                             // 14
  var image, reader;                                                                                                   // 15
  reader = new FileReader;                                                                                             //
  image = new Image;                                                                                                   //
  reader.readAsDataURL(file);                                                                                          //
  return reader.onload = function(_file) {                                                                             //
    image.src = _file.target.result;                                                                                   //
    image.onload = function() {                                                                                        //
      var h, n, w;                                                                                                     // 23
      w = this.width;                                                                                                  //
      h = this.height;                                                                                                 //
      n = file.name;                                                                                                   //
      cb(w, h, n);                                                                                                     //
    };                                                                                                                 //
    return image.onerror = function() {                                                                                //
      return alert('Invalid file type: ' + file.type);                                                                 //
    };                                                                                                                 //
  };                                                                                                                   //
};                                                                                                                     // 14
                                                                                                                       //
substringMatcher = function(strs) {                                                                                    // 34
  return function(q, cb) {                                                                                             //
    var matches, pattern;                                                                                              // 36
    matches = [];                                                                                                      //
    pattern = new RegExp(q, 'i');                                                                                      //
    _.each(strs, function(ele) {                                                                                       //
      if (pattern.test(ele)) {                                                                                         //
        return matches.push({                                                                                          //
          val: ele                                                                                                     //
        });                                                                                                            //
      }                                                                                                                //
    });                                                                                                                //
    return cb(matches);                                                                                                //
  };                                                                                                                   //
};                                                                                                                     // 34
                                                                                                                       //
setEditMode = function(tpl, mode) {                                                                                    // 47
  tpl.$('.editable').toggle();                                                                                         //
  tpl.$('.html-editor').toggle();                                                                                      //
  tpl.$('.edit-mode a').removeClass('selected');                                                                       //
  return tpl.$("." + mode + "-toggle").addClass('selected');                                                           //
};                                                                                                                     // 47
                                                                                                                       //
save = function(tpl, cb) {                                                                                             // 54
  var $editable, $form, attrs, body, editor, i, post, slug;                                                            // 55
  $form = tpl.$('form');                                                                                               //
  $editable = $('.editable', $form);                                                                                   //
  editor = BlogEditor.make(tpl);                                                                                       //
  $editable.find('p[data-section-id]').each(function() {                                                               //
    var sec_id;                                                                                                        // 62
    sec_id = $(this).attr('data-section-id');                                                                          //
    if ($editable.find("p[data-section-id=" + sec_id + "]").length > 1) {                                              //
      return $editable.find("p[data-section-id=" + sec_id + "]:gt(0)").removeAttr('data-section-id');                  //
    }                                                                                                                  //
  });                                                                                                                  //
  i = $editable.find('p[data-section-id]').length + 1;                                                                 //
  $editable.find('p:not([data-section-id])').each(function() {                                                         //
    $(this).addClass('commentable-section').attr('data-section-id', i);                                                //
    return i++;                                                                                                        //
  });                                                                                                                  //
  editor.highlightSyntax();                                                                                            //
  if ($editable.is(':visible')) {                                                                                      //
    body = editor.contents();                                                                                          //
  } else {                                                                                                             //
    body = $('.html-editor', $form).val().trim();                                                                      //
  }                                                                                                                    //
  if (!body) {                                                                                                         //
    return cb(null, new Error(Blog.settings.language.editErrorBodyRequired));                                          // 80
  }                                                                                                                    //
  slug = $('[name=slug]', $form).val();                                                                                //
  attrs = {                                                                                                            //
    title: $('[name=title]', $form).val(),                                                                             //
    tags: getBlogTags($('[name=tags]', $form).val().split(',')),                                                       //
    slug: slug,                                                                                                        //
    description: $('[name=description]', $form).val(),                                                                 //
    body: body,                                                                                                        //
    updatedAt: new Date(),                                                                                             //
    titleBackground: $('[name=background-title]', $form).is(':checked')                                                //
  };                                                                                                                   //
  attrs.featuredImageWidth = Session.get('blog.featuredImageWidth');                                                   //
  attrs.featuredImageHeight = Session.get('blog.featuredImageHeight');                                                 //
  attrs.featuredImageName = Session.get('blog.featuredImageName');                                                     //
  attrs.featuredImage = Session.get('blog.featuredImage');                                                             //
  post = Blog.Post.first(tpl.id.get());                                                                                //
  if (post != null) {                                                                                                  //
    post.update(attrs);                                                                                                //
    if (post.errors) {                                                                                                 //
      return cb(null, new Error(_(post.errors[0]).values()[0]));                                                       // 102
    }                                                                                                                  //
    return cb(null);                                                                                                   //
  } else {                                                                                                             //
    return Meteor.call('doesBlogExist', slug, function(err, exists) {                                                  //
      if (!exists) {                                                                                                   //
        attrs.userId = Meteor.userId();                                                                                //
        post = Blog.Post.create(attrs);                                                                                //
        if (post.errors) {                                                                                             //
          return cb(null, new Error(_(post.errors[0]).values()[0]));                                                   // 111
        }                                                                                                              //
        return cb(post.id);                                                                                            //
      } else {                                                                                                         //
        return cb(null, new Error(Blog.settings.language.editErrorSlugExists));                                        // 114
      }                                                                                                                //
    });                                                                                                                //
  }                                                                                                                    //
};                                                                                                                     // 54
                                                                                                                       //
Template.blogAdminEdit.onCreated(function() {                                                                          // 121
  var authorsSub, postSub, tagsSub;                                                                                    // 122
  this.id = new ReactiveVar(null);                                                                                     //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      return _this.id.set(Blog.Router.getParam('id'));                                                                 //
    };                                                                                                                 //
  })(this));                                                                                                           //
  postSub = null;                                                                                                      //
  authorsSub = this.subscribe('blog.authors');                                                                         //
  tagsSub = this.subscribe('blog.postTags');                                                                           //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      return postSub = _this.subscribe('blog.singlePostById', _this.id.get());                                         //
    };                                                                                                                 //
  })(this));                                                                                                           //
  this.subsReady = new ReactiveVar(false);                                                                             //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      if (postSub.ready() && authorsSub.ready() && tagsSub.ready() && !Meteor.loggingIn()) {                           //
        return _this.subsReady.set(true);                                                                              //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
  this.autorun(function() {                                                                                            //
    if (!Meteor.userId()) {                                                                                            //
      return Blog.Router.go('blogIndex');                                                                              //
    }                                                                                                                  //
  });                                                                                                                  //
  Session.set('blog.featuredImageWidth', null);                                                                        //
  Session.set('blog.featuredImageHeight', null);                                                                       //
  Session.set('blog.featuredImageName', null);                                                                         //
  return Session.set('blog.featuredImage', null);                                                                      //
});                                                                                                                    // 121
                                                                                                                       //
Template.blogAdminEdit.onRendered(function() {                                                                         // 147
  Meteor.call('isBlogAuthorized', this.id.get(), (function(_this) {                                                    //
    return function(err, authorized) {                                                                                 //
      if (!authorized) {                                                                                               //
        return Blog.Router.go('/blog');                                                                                // 150
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
  return this.autorun((function(_this) {                                                                               //
    return function() {                                                                                                //
      if (_this.subsReady.get()) {                                                                                     //
        return Meteor.defer(function() {                                                                               //
          var $tags, post;                                                                                             // 160
          post = Blog.Post.first(_this.id.get());                                                                      //
          if (post != null) {                                                                                          //
            _this.$('.editable').html(post.body);                                                                      //
            _this.$('.html-editor').html(post.body);                                                                   //
          }                                                                                                            //
          $tags = _this.$('[data-role=tagsinput]');                                                                    //
          $tags.tagsinput({                                                                                            //
            confirmKeys: [13, 44, 9]                                                                                   //
          });                                                                                                          //
          $tags.tagsinput('input').typeahead({                                                                         //
            highlight: true,                                                                                           //
            hint: false                                                                                                //
          }, {                                                                                                         //
            name: 'tags',                                                                                              //
            displayKey: 'val',                                                                                         //
            source: substringMatcher(Blog.Tag.first().tags)                                                            //
          }).bind('typeahead:selected', function(obj, datum) {                                                         //
            $tags.tagsinput('add', datum.val);                                                                         //
            return $tags.tagsinput('input').typeahead('val', '');                                                      //
          });                                                                                                          //
          return BlogEditor.make(_this);                                                                               //
        });                                                                                                            //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
});                                                                                                                    // 147
                                                                                                                       //
Template.blogAdminEdit.helpers({                                                                                       // 183
  post: function() {                                                                                                   //
    var post;                                                                                                          // 185
    post = Blog.Post.first(Template.instance().id.get());                                                              //
    if (post) {                                                                                                        //
      Session.set('blog.featuredImageWidth', post.featuredImageWidth);                                                 //
      Session.set('blog.featuredImageHeight', post.featuredImageHeight);                                               //
      Session.set('blog.featuredImageName', post.featuredImageName);                                                   //
      Session.set('blog.featuredImage', post.featuredImage);                                                           //
      return post;                                                                                                     //
    } else {                                                                                                           //
      return {};                                                                                                       //
    }                                                                                                                  //
  },                                                                                                                   //
  subsReady: function() {                                                                                              //
    return Template.instance().subsReady.get();                                                                        //
  },                                                                                                                   //
  featuredImage: function() {                                                                                          //
    return Session.get('blog.featuredImage');                                                                          //
  },                                                                                                                   //
  featuredImageName: function() {                                                                                      //
    return Session.get('blog.featuredImageName');                                                                      //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogAdminEdit.events({                                                                                        // 199
  'click [data-action=toggle-visual]': function(e, tpl) {                                                              //
    if (tpl.$('.editable').is(':visible')) {                                                                           //
      return;                                                                                                          // 203
    }                                                                                                                  //
    BlogEditor.make(tpl).highlightSyntax();                                                                            //
    return setEditMode(tpl, 'visual');                                                                                 //
  },                                                                                                                   //
  'click [data-action=toggle-html]': function(e, tpl) {                                                                //
    var $editable, $html;                                                                                              // 209
    $editable = tpl.$('.editable');                                                                                    //
    $html = tpl.$('.html-editor');                                                                                     //
    if ($html.is(':visible')) {                                                                                        //
      return;                                                                                                          // 212
    }                                                                                                                  //
    $html.val(BlogEditor.make(tpl).pretty());                                                                          //
    setEditMode(tpl, 'html');                                                                                          //
    return $html.height($editable.height());                                                                           //
  },                                                                                                                   //
  'keyup .html-editor': function(e, tpl) {                                                                             //
    var $editable, $html, ref;                                                                                         // 220
    $editable = tpl.$('.editable');                                                                                    //
    $html = tpl.$('.html-editor');                                                                                     //
    $editable.html((ref = $html.val()) != null ? ref.trim() : void 0);                                                 //
    return $html.height($editable.height());                                                                           //
  },                                                                                                                   //
  'input .editable, keydown .editable, keydown .html-editor': _.debounce(function(e, tpl) {                            //
    return save(tpl, function(id, err) {                                                                               //
      var path;                                                                                                        // 229
      if (err) {                                                                                                       //
        return toastr.error(err.message);                                                                              // 230
      }                                                                                                                //
      if (id) {                                                                                                        //
        tpl.id.set(id);                                                                                                //
        path = Blog.Router.pathFor('blogAdminEdit', {                                                                  //
          id: id                                                                                                       //
        });                                                                                                            //
        Blog.Router.replaceState(path);                                                                                //
      }                                                                                                                //
      return toastr.success(Blog.settings.language.saved);                                                             //
    });                                                                                                                //
  }, 8000),                                                                                                            //
  'blur [name=title]': function(e, tpl) {                                                                              //
    var slug, title;                                                                                                   // 242
    slug = tpl.$('[name=slug]');                                                                                       //
    title = $(e.currentTarget).val();                                                                                  //
    if (!slug.val()) {                                                                                                 //
      return slug.val(Blog.Post.slugify(title));                                                                       //
    }                                                                                                                  //
  },                                                                                                                   //
  'click [data-action=delete-featured]': function(e, tpl) {                                                            //
    e.preventDefault();                                                                                                //
    Session.set('blog.featuredImageWidth', null);                                                                      //
    Session.set('blog.featuredImageHeight', null);                                                                     //
    Session.set('blog.featuredImageName', null);                                                                       //
    return Session.set('blog.featuredImage', null);                                                                    //
  },                                                                                                                   //
  'change [name=featured-image]': function(e, tpl) {                                                                   //
    var post, ref, ref1, ref2, the_file;                                                                               // 256
    the_file = $(e.currentTarget)[0].files[0];                                                                         //
    post = this;                                                                                                       //
    readImageDimensions(the_file, function(width, height, name) {                                                      //
      Session.set('blog.featuredImageWidth', width);                                                                   //
      Session.set('blog.featuredImageHeight', height);                                                                 //
      return Session.set('blog.featuredImageName', name);                                                              //
    });                                                                                                                //
    if ((ref = Meteor.settings) != null ? (ref1 = ref["public"]) != null ? (ref2 = ref1.blog) != null ? ref2.useS3 : void 0 : void 0 : void 0) {
      return Blog.S3Files.insert(the_file, function(err, fileObj) {                                                    //
        return Tracker.autorun(function(c) {                                                                           //
          var theFile;                                                                                                 // 268
          theFile = Blog.S3Files.find({                                                                                //
            _id: fileObj._id                                                                                           //
          }).fetch()[0];                                                                                               //
          if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {                  //
            Session.set('blog.featuredImage', theFile.url());                                                          //
            toastr.success(Blog.settings.language.editFeaturedImageSaved);                                             //
            return c.stop();                                                                                           //
          }                                                                                                            //
        });                                                                                                            //
      });                                                                                                              //
    } else {                                                                                                           //
      return Blog.FilesLocal.insert(the_file, function(err, fileObj) {                                                 //
        return Tracker.autorun(function(c) {                                                                           //
          var theFile;                                                                                                 // 277
          theFile = Blog.FilesLocal.find({                                                                             //
            _id: fileObj._id                                                                                           //
          }).fetch()[0];                                                                                               //
          if (theFile.isUploaded() && (typeof theFile.url === "function" ? theFile.url() : void 0)) {                  //
            Session.set('blog.featuredImage', theFile.url());                                                          //
            toastr.success(Blog.settings.language.editFeaturedImageSaved);                                             //
            return c.stop();                                                                                           //
          }                                                                                                            //
        });                                                                                                            //
      });                                                                                                              //
    }                                                                                                                  //
  },                                                                                                                   //
  'submit form': function(e, tpl) {                                                                                    //
    e.preventDefault();                                                                                                //
    return save(tpl, function(id, err) {                                                                               //
      if (err) {                                                                                                       //
        return toastr.error(err.message);                                                                              // 287
      }                                                                                                                //
      return Blog.Router.go('blogAdmin');                                                                              //
    });                                                                                                                //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/blog/template.blog.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogIndex");                                                                                     // 2
Template["blogIndex"] = new Template("Template.blogIndex", (function() {                                               // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    "class": "meteor-blog-index"                                                                                       // 6
  }, "\n    ", Blaze.If(function() {                                                                                   // 7
    return Spacebars.call(view.lookup("blogReady"));                                                                   // 8
  }, function() {                                                                                                      // 9
    return [ "\n      ", Blaze._TemplateWith(function() {                                                              // 10
      return {                                                                                                         // 11
        posts: Spacebars.call(view.lookup("posts"))                                                                    // 12
      };                                                                                                               // 13
    }, function() {                                                                                                    // 14
      return Spacebars.include(view.lookupTemplate("blogIndexLoop"));                                                  // 15
    }), "\n      ", Blaze.View("lookup:blogPager", function() {                                                        // 16
      return Spacebars.mustache(view.lookup("blogPager"));                                                             // 17
    }), "\n    " ];                                                                                                    // 18
  }, function() {                                                                                                      // 19
    return [ "\n      ", Spacebars.include(view.lookupTemplate("blogLoading")), "\n    " ];                            // 20
  }), "\n  ");                                                                                                         // 21
}));                                                                                                                   // 22
                                                                                                                       // 23
Template.__checkName("blogIndexLoop");                                                                                 // 24
Template["blogIndexLoop"] = new Template("Template.blogIndexLoop", (function() {                                       // 25
  var view = this;                                                                                                     // 26
  return Blaze.Each(function() {                                                                                       // 27
    return Spacebars.call(view.lookup("posts"));                                                                       // 28
  }, function() {                                                                                                      // 29
    return [ "\n    ", HTML.DIV({                                                                                      // 30
      "class": "meteor-blog-post"                                                                                      // 31
    }, "\n      ", Blaze.If(function() {                                                                               // 32
      return Spacebars.call(view.lookup("featuredImage"));                                                             // 33
    }, function() {                                                                                                    // 34
      return [ "\n        ", HTML.DIV({                                                                                // 35
        "class": "meteor-blog-post-thumbnail"                                                                          // 36
      }, "\n          ", HTML.A({                                                                                      // 37
        href: function() {                                                                                             // 38
          return Spacebars.mustache(view.lookup("blogPathFor"), "blogShow");                                           // 39
        }                                                                                                              // 40
      }, "\n            ", HTML.IMG({                                                                                  // 41
        src: function() {                                                                                              // 42
          return Spacebars.mustache(view.lookup("featuredImage"));                                                     // 43
        },                                                                                                             // 44
        alt: function() {                                                                                              // 45
          return Spacebars.mustache(view.lookup("title"));                                                             // 46
        }                                                                                                              // 47
      }), "\n          "), "\n        "), "\n      " ];                                                                // 48
    }), "\n      ", HTML.DIV({                                                                                         // 49
      "class": "meteor-blog-post-excerpt"                                                                              // 50
    }, "\n        ", HTML.H2("\n          ", HTML.A({                                                                  // 51
      href: function() {                                                                                               // 52
        return Spacebars.mustache(view.lookup("blogPathFor"), "blogShow");                                             // 53
      }                                                                                                                // 54
    }, Blaze.View("lookup:title", function() {                                                                         // 55
      return Spacebars.mustache(view.lookup("title"));                                                                 // 56
    })), "\n        "), "\n        ", HTML.DIV({                                                                       // 57
      "class": "meteor-blog-post-meta"                                                                                 // 58
    }, "\n          ", Blaze.View("lookup:BlogLanguage.metaAuthorBy", function() {                                     // 59
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorBy"));                           // 60
    }), " ", Blaze.View("lookup:authorName", function() {                                                              // 61
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 62
    }), " ", Blaze.View("lookup:BlogLanguage.metaAuthorOn", function() {                                               // 63
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorOn"));                           // 64
    }), " ", Blaze.View("lookup:blogFormatDate", function() {                                                          // 65
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 66
    }), "\n          ", Spacebars.include(view.lookupTemplate("blogTags")), "\n        "), "\n        ", HTML.DIV({    // 67
      "class": "meteor-blog-post-excerpt"                                                                              // 68
    }, "\n          ", HTML.SMALL(Blaze.View("lookup:excerpt", function() {                                            // 69
      return Spacebars.makeRaw(Spacebars.mustache(view.lookup("excerpt")));                                            // 70
    })), "\n        "), "\n      "), "\n    "), "\n  " ];                                                              // 71
  }, function() {                                                                                                      // 72
    return [ "\n    ", Blaze.View("lookup:BlogLanguage.blogEmpty", function() {                                        // 73
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "blogEmpty"));                              // 74
    }), "\n  " ];                                                                                                      // 75
  });                                                                                                                  // 76
}));                                                                                                                   // 77
                                                                                                                       // 78
Template.__checkName("blogTags");                                                                                      // 79
Template["blogTags"] = new Template("Template.blogTags", (function() {                                                 // 80
  var view = this;                                                                                                     // 81
  return Blaze.If(function() {                                                                                         // 82
    return Spacebars.call(view.lookup("tags"));                                                                        // 83
  }, function() {                                                                                                      // 84
    return [ "\n    ", HTML.DIV({                                                                                      // 85
      "class": "meteor-blog-post-tags"                                                                                 // 86
    }, "\n      ", HTML.P(" ", HTML.CharRef({                                                                          // 87
      html: "&ndash;",                                                                                                 // 88
      str: "–"                                                                                                         // 89
    }), " ", Blaze.View("lookup:BlogLanguage.tags", function() {                                                       // 90
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "tags"));                                   // 91
    }), ": ", Blaze.View("lookup:blogFormatTags", function() {                                                         // 92
      return Spacebars.mustache(view.lookup("blogFormatTags"), view.lookup("tags"));                                   // 93
    })), "\n    "), "\n  " ];                                                                                          // 94
  });                                                                                                                  // 95
}));                                                                                                                   // 96
                                                                                                                       // 97
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/blog/template.show.js                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogShow");                                                                                      // 2
Template["blogShow"] = new Template("Template.blogShow", (function() {                                                 // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    "class": "meteor-blog-single"                                                                                      // 6
  }, "\n    ", Spacebars.With(function() {                                                                             // 7
    return Spacebars.call(view.lookup("post"));                                                                        // 8
  }, function() {                                                                                                      // 9
    return [ "\n      ", Blaze.If(function() {                                                                         // 10
      return Spacebars.call(view.lookup("featuredImage"));                                                             // 11
    }, function() {                                                                                                    // 12
      return [ "\n        ", Spacebars.include(view.lookupTemplate("blogShowFeaturedImage")), "\n      " ];            // 13
    }), "\n    " ];                                                                                                    // 14
  }), "\n    ", Blaze.If(function() {                                                                                  // 15
    return Spacebars.call(view.lookup("blogReady"));                                                                   // 16
  }, function() {                                                                                                      // 17
    return [ "\n      ", Spacebars.With(function() {                                                                   // 18
      return Spacebars.call(view.lookup("post"));                                                                      // 19
    }, function() {                                                                                                    // 20
      return [ "\n        ", Spacebars.include(view.lookupTemplate("blogShowBody")), "\n      " ];                     // 21
    }, function() {                                                                                                    // 22
      return [ "\n        ", Blaze._TemplateWith(function() {                                                          // 23
        return {                                                                                                       // 24
          template: Spacebars.call(view.lookup("notFound"))                                                            // 25
        };                                                                                                             // 26
      }, function() {                                                                                                  // 27
        return Spacebars.include(function() {                                                                          // 28
          return Spacebars.call(Template.__dynamic);                                                                   // 29
        });                                                                                                            // 30
      }), "\n      " ];                                                                                                // 31
    }), "\n    " ];                                                                                                    // 32
  }, function() {                                                                                                      // 33
    return [ "\n      ", Spacebars.include(view.lookupTemplate("blogLoading")), "\n    " ];                            // 34
  }), "\n  ");                                                                                                         // 35
}));                                                                                                                   // 36
                                                                                                                       // 37
Template.__checkName("blogShowBody");                                                                                  // 38
Template["blogShowBody"] = new Template("Template.blogShowBody", (function() {                                         // 39
  var view = this;                                                                                                     // 40
  return HTML.DIV({                                                                                                    // 41
    "class": "meteor-blog-post"                                                                                        // 42
  }, "\n    ", HTML.DIV({                                                                                              // 43
    "class": "meteor-blog-post-main"                                                                                   // 44
  }, "\n      ", Blaze.Unless(function() {                                                                             // 45
    return Spacebars.call(view.lookup("titleBackground"));                                                             // 46
  }, function() {                                                                                                      // 47
    return [ "\n        ", HTML.H1({                                                                                   // 48
      "class": "meteor-blog-post-title text-center"                                                                    // 49
    }, "\n          ", Blaze.View("lookup:title", function() {                                                         // 50
      return Spacebars.mustache(view.lookup("title"));                                                                 // 51
    }), "\n        "), "\n        ", HTML.DIV({                                                                        // 52
      "class": "meteor-blog-post-meta text-center"                                                                     // 53
    }, "\n          ", Blaze.If(function() {                                                                           // 54
      return Spacebars.call(view.lookup("isAdmin"));                                                                   // 55
    }, function() {                                                                                                    // 56
      return [ "\n             ", HTML.SMALL(HTML.A({                                                                  // 57
        href: "#",                                                                                                     // 58
        "data-action": "edit-post"                                                                                     // 59
      }, Blaze.View("lookup:BlogLanguage.edit", function() {                                                           // 60
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "edit"));                                 // 61
      }))), "\n             --\n          " ];                                                                         // 62
    }), "\n          ", Blaze.View("lookup:BlogLanguage.metaAuthorBy", function() {                                    // 63
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorBy"));                           // 64
    }), " ", Blaze.View("lookup:authorName", function() {                                                              // 65
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 66
    }), " ", Blaze.View("lookup:BlogLanguage.metaAuthorOn", function() {                                               // 67
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorOn"));                           // 68
    }), " ", Blaze.View("lookup:blogFormatDate", function() {                                                          // 69
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 70
    }), "\n          ", Spacebars.include(view.lookupTemplate("blogTags")), "\n        "), "\n      " ];               // 71
  }), "\n      ", HTML.DIV({                                                                                           // 72
    id: "commentable-area"                                                                                             // 73
  }, "\n        ", Blaze.View("lookup:html", function() {                                                              // 74
    return Spacebars.makeRaw(Spacebars.mustache(view.lookup("html")));                                                 // 75
  }), "\n      "), "\n    "), "\n    ", HTML.DIV({                                                                     // 76
    "class": "meteor-blog-back-link pull-left"                                                                         // 77
  }, "\n      ", HTML.A({                                                                                              // 78
    href: function() {                                                                                                 // 79
      return Spacebars.mustache(view.lookup("blogPathFor"), "blogIndex");                                              // 80
    }                                                                                                                  // 81
  }, HTML.Raw('<i class="fa fa-caret-left"></i>'), Blaze.View("lookup:BlogLanguage.backToBlogIndex", function() {      // 82
    return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "backToBlogIndex"));                          // 83
  })), "\n    "), "\n    ", Blaze._TemplateWith(function() {                                                           // 84
    return Spacebars.call(view.lookup("shareData"));                                                                   // 85
  }, function() {                                                                                                      // 86
    return Spacebars.include(view.lookupTemplate("shareit"));                                                          // 87
  }), "\n    ", Blaze._TemplateWith(function() {                                                                       // 88
    return Spacebars.call(view.lookup("."));                                                                           // 89
  }, function() {                                                                                                      // 90
    return Spacebars.include(view.lookupTemplate("disqus"));                                                           // 91
  }), "\n  ");                                                                                                         // 92
}));                                                                                                                   // 93
                                                                                                                       // 94
Template.__checkName("blogShowFeaturedImage");                                                                         // 95
Template["blogShowFeaturedImage"] = new Template("Template.blogShowFeaturedImage", (function() {                       // 96
  var view = this;                                                                                                     // 97
  return [ HTML.DIV({                                                                                                  // 98
    "class": function() {                                                                                              // 99
      return [ "meteor-blog-featured-image ", Blaze.If(function() {                                                    // 100
        return Spacebars.call(view.lookup("fullWidthFeaturedImage"));                                                  // 101
      }, function() {                                                                                                  // 102
        return "meteor-blog-full-width-image";                                                                         // 103
      }, function() {                                                                                                  // 104
        return "meteor-blog-regular-image";                                                                            // 105
      }) ];                                                                                                            // 106
    }                                                                                                                  // 107
  }, "\n    ", HTML.DIV({                                                                                              // 108
    "class": "meteor-blog-aspect-ratio-placeholder",                                                                   // 109
    style: function() {                                                                                                // 110
      return Blaze.Unless(function() {                                                                                 // 111
        return Spacebars.call(view.lookup("fullWidthFeaturedImage"));                                                  // 112
      }, function() {                                                                                                  // 113
        return [ "width: ", Blaze.View("lookup:featuredImageWidth", function() {                                       // 114
          return Spacebars.mustache(view.lookup("featuredImageWidth"));                                                // 115
        }), "px; height: ", Blaze.View("lookup:featuredImageHeight", function() {                                      // 116
          return Spacebars.mustache(view.lookup("featuredImageHeight"));                                               // 117
        }), "px;" ];                                                                                                   // 118
      });                                                                                                              // 119
    }                                                                                                                  // 120
  }, "\n      ", HTML.IMG({                                                                                            // 121
    src: function() {                                                                                                  // 122
      return Spacebars.mustache(view.lookup("featuredImage"));                                                         // 123
    },                                                                                                                 // 124
    alt: "",                                                                                                           // 125
    "class": "img-responsive center-block"                                                                             // 126
  }), "\n      ", Blaze.If(function() {                                                                                // 127
    return Spacebars.call(view.lookup("titleBackground"));                                                             // 128
  }, function() {                                                                                                      // 129
    return [ "\n        ", HTML.DIV({                                                                                  // 130
      "class": "meteor-blog-background-title"                                                                          // 131
    }, "\n          ", HTML.DIV({                                                                                      // 132
      "class": "center-block"                                                                                          // 133
    }, "\n            ", HTML.H1({                                                                                     // 134
      "class": "text-center"                                                                                           // 135
    }, "\n              ", Blaze.View("lookup:title", function() {                                                     // 136
      return Spacebars.mustache(view.lookup("title"));                                                                 // 137
    }), "\n              ", Blaze.If(function() {                                                                      // 138
      return Spacebars.call(view.lookup("isAdmin"));                                                                   // 139
    }, function() {                                                                                                    // 140
      return [ "\n                 ", HTML.SMALL(HTML.A({                                                              // 141
        href: "#",                                                                                                     // 142
        "data-action": "edit-post"                                                                                     // 143
      }, Blaze.View("lookup:BlogLanguage.edit", function() {                                                           // 144
        return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "edit"));                                 // 145
      }))), "\n              " ];                                                                                      // 146
    }), "\n            "), "\n            ", HTML.DIV({                                                                // 147
      "class": "meteor-blog-post-meta text-center"                                                                     // 148
    }, "\n              ", Blaze.View("lookup:BlogLanguage.metaAuthorBy", function() {                                 // 149
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorBy"));                           // 150
    }), " ", Blaze.View("lookup:authorName", function() {                                                              // 151
      return Spacebars.mustache(view.lookup("authorName"));                                                            // 152
    }), " ", Blaze.View("lookup:BlogLanguage.metaAuthorOn", function() {                                               // 153
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "metaAuthorOn"));                           // 154
    }), " ", Blaze.View("lookup:blogFormatDate", function() {                                                          // 155
      return Spacebars.mustache(view.lookup("blogFormatDate"), view.lookup("publishedAt"));                            // 156
    }), "\n              ", Spacebars.include(view.lookupTemplate("blogTags")), "\n            "), "\n          "), "\n        "), "\n      " ];
  }), "\n    "), "\n  "), "\n  ", Blaze.If(function() {                                                                // 158
    return Spacebars.call(view.lookup("fullWidthFeaturedImage"));                                                      // 159
  }, function() {                                                                                                      // 160
    return [ "\n    ", HTML.DIV({                                                                                      // 161
      "class": "meteor-blog-aspect-ratio-fill",                                                                        // 162
      style: function() {                                                                                              // 163
        return [ "height: ", Spacebars.mustache(view.lookup("fullWidthFeaturedImageHeight")), "px;" ];                 // 164
      }                                                                                                                // 165
    }), "\n  " ];                                                                                                      // 166
  }) ];                                                                                                                // 167
}));                                                                                                                   // 168
                                                                                                                       // 169
Template.__checkName("disqus");                                                                                        // 170
Template["disqus"] = new Template("Template.disqus", (function() {                                                     // 171
  var view = this;                                                                                                     // 172
  return Blaze.If(function() {                                                                                         // 173
    return Spacebars.call(view.lookup("useDisqus"));                                                                   // 174
  }, function() {                                                                                                      // 175
    return [ "\n    ", HTML.DIV({                                                                                      // 176
      id: "disqus_thread"                                                                                              // 177
    }), "\n    ", HTML.NOSCRIPT("Please enable JavaScript to view the ", HTML.A({                                      // 178
      href: "http://disqus.com/?ref_noscript"                                                                          // 179
    }, "comments powered by Disqus.")), "\n    ", HTML.A({                                                             // 180
      href: "http://disqus.com",                                                                                       // 181
      "class": "dsq-brlink"                                                                                            // 182
    }, Blaze.View("lookup:BlogLanguage.disqusPoweredBy", function() {                                                  // 183
      return Spacebars.mustache(Spacebars.dot(view.lookup("BlogLanguage"), "disqusPoweredBy"));                        // 184
    }), " ", HTML.SPAN({                                                                                               // 185
      "class": "logo-disqus"                                                                                           // 186
    }, "Disqus")), "\n  " ];                                                                                           // 187
  });                                                                                                                  // 188
}));                                                                                                                   // 189
                                                                                                                       // 190
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/blog/blog.coffee.js                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
var editPost, renderSideComments;                                                                                      // 6
                                                                                                                       //
Template.blogIndex.onCreated(function() {                                                                              // 6
  var authorsSub, postsSub;                                                                                            // 7
  this.tag = new ReactiveVar(null);                                                                                    //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      return _this.tag.set(Blog.Router.getParam('tag'));                                                               //
    };                                                                                                                 //
  })(this));                                                                                                           //
  if (!Session.get('blog.postLimit')) {                                                                                //
    if (Blog.settings.pageSize) {                                                                                      //
      Session.set('blog.postLimit', Blog.settings.pageSize);                                                           //
    }                                                                                                                  //
  }                                                                                                                    //
  authorsSub = Blog.subs.subscribe('blog.authors');                                                                    //
  postsSub = null;                                                                                                     //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      if (_this.tag.get()) {                                                                                           //
        return postsSub = Blog.subs.subscribe('blog.taggedPosts', _this.tag.get());                                    //
      } else {                                                                                                         //
        return postsSub = Blog.subs.subscribe('blog.posts', Session.get('blog.postLimit'));                            //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
  this.blogReady = new ReactiveVar(false);                                                                             //
  return this.autorun((function(_this) {                                                                               //
    return function() {                                                                                                //
      if (authorsSub.ready() && postsSub.ready()) {                                                                    //
        return _this.blogReady.set(true);                                                                              //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
});                                                                                                                    // 6
                                                                                                                       //
Template.blogIndex.onRendered(function() {                                                                             // 29
  document.title = "Blog";                                                                                             //
  if (Blog.settings.title) {                                                                                           //
    return document.title += " | " + Blog.settings.title;                                                              //
  }                                                                                                                    //
});                                                                                                                    // 29
                                                                                                                       //
Template.blogIndex.helpers({                                                                                           // 35
  blogReady: function() {                                                                                              //
    return Template.instance().blogReady.get();                                                                        //
  },                                                                                                                   //
  posts: function() {                                                                                                  //
    var tag;                                                                                                           // 38
    tag = Template.instance().tag.get();                                                                               //
    if (tag) {                                                                                                         //
      return Blog.Post.where({                                                                                         //
        tags: tag                                                                                                      //
      }, {                                                                                                             //
        sort: {                                                                                                        //
          publishedAt: -1                                                                                              //
        }                                                                                                              //
      });                                                                                                              //
    } else {                                                                                                           //
      return Blog.Post.where({}, {                                                                                     //
        sort: {                                                                                                        //
          publishedAt: -1                                                                                              //
        }                                                                                                              //
      });                                                                                                              //
    }                                                                                                                  //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Meteor.startup(function() {                                                                                            // 45
  var customIndex;                                                                                                     // 46
  if (Blog.settings.blogIndexTemplate) {                                                                               //
    customIndex = Blog.settings.blogIndexTemplate;                                                                     //
    Template[customIndex].onCreated(Template.blogIndex._callbacks.created[0]);                                         //
    return Template[customIndex].helpers({                                                                             //
      posts: Template.blogIndex.__helpers.get('posts'),                                                                //
      blogReady: Template.blogIndex.__helpers.get('blogReady')                                                         //
    });                                                                                                                //
  }                                                                                                                    //
});                                                                                                                    // 45
                                                                                                                       //
Template.blogShow.onCreated(function() {                                                                               // 58
  var authorsSub, commentsSub, postSub;                                                                                // 59
  this.slug = new ReactiveVar(null);                                                                                   //
  this.autorun((function(_this) {                                                                                      //
    return function() {                                                                                                //
      return _this.slug.set(Blog.Router.getParam('slug'));                                                             //
    };                                                                                                                 //
  })(this));                                                                                                           //
  postSub = Blog.subs.subscribe('blog.singlePostBySlug', this.slug.get());                                             //
  commentsSub = Blog.subs.subscribe('blog.commentsBySlug', this.slug.get());                                           //
  authorsSub = Blog.subs.subscribe('blog.authors');                                                                    //
  this.blogReady = new ReactiveVar(false);                                                                             //
  return this.autorun((function(_this) {                                                                               //
    return function() {                                                                                                //
      if (postSub.ready() && commentsSub.ready() && authorsSub.ready() && !Meteor.loggingIn()) {                       //
        return _this.blogReady.set(true);                                                                              //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
});                                                                                                                    // 58
                                                                                                                       //
Template.blogShow.helpers({                                                                                            // 72
  blogReady: function() {                                                                                              //
    return Template.instance().blogReady.get();                                                                        //
  },                                                                                                                   //
  post: function() {                                                                                                   //
    return Blog.Post.first({                                                                                           //
      slug: Template.instance().slug.get()                                                                             //
    });                                                                                                                //
  },                                                                                                                   //
  notFound: function() {                                                                                               //
    var notFound;                                                                                                      // 76
    if (Blog.settings.blogNotFoundTemplate) {                                                                          //
      return Blog.settings.blogNotFoundTemplate;                                                                       //
    } else {                                                                                                           //
      notFound = Blog.Router.getNotFoundTemplate();                                                                    //
      if (notFound) {                                                                                                  //
        return notFound;                                                                                               // 81
      } else if (Blog.Router.getParam('slug')) {                                                                       //
        return Blog.Router.notFound();                                                                                 //
      }                                                                                                                //
    }                                                                                                                  //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Meteor.startup(function() {                                                                                            // 86
  var customShow;                                                                                                      // 87
  if (Blog.settings.blogShowTemplate) {                                                                                //
    customShow = Blog.settings.blogShowTemplate;                                                                       //
    Template[customShow].onCreated(Template.blogShow._callbacks.created[0]);                                           //
    return Template[customShow].helpers({                                                                              //
      post: Template.blogShow.__helpers.get('post'),                                                                   //
      blogReady: Template.blogShow.__helpers.get('blogReady')                                                          //
    });                                                                                                                //
  }                                                                                                                    //
});                                                                                                                    // 86
                                                                                                                       //
renderSideComments = null;                                                                                             // 95
                                                                                                                       //
Template.blogShowBody.onRendered(function() {                                                                          // 98
  Meteor.call('isBlogAuthorized', this.data.id, (function(_this) {                                                     //
    return function(err, authorized) {                                                                                 //
      if (_this.data.mode === 'draft') {                                                                               //
        if (!authorized) {                                                                                             //
          return Blog.Router.go('/blog');                                                                              // 102
        }                                                                                                              //
      }                                                                                                                //
      if (authorized) {                                                                                                //
        return Session.set('blog.canEditPost', authorized);                                                            //
      }                                                                                                                //
    };                                                                                                                 //
  })(this));                                                                                                           //
  document.title = "" + this.data.title;                                                                               //
  if (Blog.settings.title) {                                                                                           //
    document.title += " | " + Blog.settings.title;                                                                     //
  }                                                                                                                    //
  if (this.data.mode !== 'public') {                                                                                   //
    $('<meta>', {                                                                                                      //
      name: 'robots',                                                                                                  //
      content: 'noindex,nofollow'                                                                                      //
    }).appendTo('head');                                                                                               //
  }                                                                                                                    //
  if (this.data.featuredImage) {                                                                                       //
    $(window).resize((function(_this) {                                                                                //
      return function() {                                                                                              //
        Session.set("blog.fullWidthFeaturedImage", $(window).width() < _this.data.featuredImageWidth);                 //
        if (Session.get("blog.fullWidthFeaturedImage")) {                                                              //
          return Session.set("blog.fullWidthFeaturedImageHeight", ($(window).width() / _this.data.featuredImageWidth) * _this.data.featuredImageHeight);
        }                                                                                                              //
      };                                                                                                               //
    })(this));                                                                                                         //
    $(window).trigger("resize");                                                                                       //
  }                                                                                                                    //
  return renderSideComments.call(this, this.data.slug);                                                                //
});                                                                                                                    // 98
                                                                                                                       //
editPost = function(e, tpl) {                                                                                          // 128
  var postId;                                                                                                          // 129
  e.preventDefault();                                                                                                  //
  postId = Blog.Post.first({                                                                                           //
    slug: this.slug                                                                                                    //
  })._id;                                                                                                              //
  return Blog.Router.go('blogAdminEdit', {                                                                             //
    id: postId                                                                                                         //
  });                                                                                                                  //
};                                                                                                                     // 128
                                                                                                                       //
Template.blogShowBody.events({                                                                                         // 133
  'click [data-action=edit-post]': editPost                                                                            //
});                                                                                                                    //
                                                                                                                       //
Template.blogShowBody.helpers({                                                                                        // 136
  isAdmin: function() {                                                                                                //
    return Session.get("blog.canEditPost");                                                                            //
  },                                                                                                                   //
  shareData: function() {                                                                                              //
    var post;                                                                                                          // 139
    post = Blog.Post.first({                                                                                           //
      slug: this.slug                                                                                                  //
    });                                                                                                                //
    return {                                                                                                           //
      title: post.title,                                                                                               //
      excerpt: post.excerpt,                                                                                           //
      description: post.description,                                                                                   //
      author: post.authorName(),                                                                                       //
      thumbnail: post.thumbnail()                                                                                      //
    };                                                                                                                 //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Template.blogShowFeaturedImage.events({                                                                                // 146
  'click [data-action=edit-post]': editPost                                                                            //
});                                                                                                                    //
                                                                                                                       //
Template.blogShowFeaturedImage.helpers({                                                                               // 149
  isAdmin: function() {                                                                                                //
    return Session.get("blog.canEditPost");                                                                            //
  },                                                                                                                   //
  fullWidthFeaturedImage: function() {                                                                                 //
    return Session.get("blog.fullWidthFeaturedImage");                                                                 //
  },                                                                                                                   //
  fullWidthFeaturedImageHeight: function() {                                                                           //
    return Session.get("blog.fullWidthFeaturedImageHeight");                                                           //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
renderSideComments = function(slug) {                                                                                  // 159
  var SideComments, avatar, chosen_name, commentUser, existingComments, possible_names, ref, ref1, ref2, ref3, ref4, settings, sideComments, the_user;
  settings = Blog.settings.comments;                                                                                   //
  if (settings.useSideComments) {                                                                                      //
    SideComments = require('side-comments');                                                                           //
    if (settings.allowAnonymous && !Meteor.user()) {                                                                   //
      commentUser = {                                                                                                  //
        name: 'Anonymous',                                                                                             //
        avatarUrl: settings.defaultImg,                                                                                //
        id: 0                                                                                                          //
      };                                                                                                               //
    } else if (Meteor.user()) {                                                                                        //
      the_user = Meteor.user();                                                                                        //
      possible_names = [the_user.username, (ref = the_user.services) != null ? (ref1 = ref.google) != null ? ref1.name : void 0 : void 0, (ref2 = the_user.profile) != null ? ref2.name : void 0, (ref3 = the_user.emails) != null ? ref3[0].address : void 0];
      chosen_name = null;                                                                                              //
      possible_names.every(function(name) {                                                                            //
        if (name != null) {                                                                                            //
          if (typeof name === "string" && name.length > 0) {                                                           //
            chosen_name = name;                                                                                        //
            return false;                                                                                              //
          }                                                                                                            //
        } else {                                                                                                       //
          return true;                                                                                                 //
        }                                                                                                              //
      });                                                                                                              //
      if ((ref4 = Meteor.user().profile) != null ? ref4[settings.userImg] : void 0) {                                  //
        avatar = Meteor.user().profile[settings.userImg];                                                              //
      } else {                                                                                                         //
        avatar = settings.defaultImg;                                                                                  //
      }                                                                                                                //
      commentUser = {                                                                                                  //
        name: chosen_name,                                                                                             //
        avatarUrl: avatar,                                                                                             //
        id: Meteor.userId()                                                                                            //
      };                                                                                                               //
    } else {                                                                                                           //
      commentUser = {                                                                                                  //
        name: 'Login to Comment',                                                                                      //
        avatarUrl: settings.defaultImg,                                                                                //
        id: 0                                                                                                          //
      };                                                                                                               //
    }                                                                                                                  //
    existingComments = [];                                                                                             //
    Blog.Comment.where({                                                                                               //
      slug: slug                                                                                                       //
    }).forEach(function(comment) {                                                                                     //
      var sec;                                                                                                         // 206
      comment.comment.id = comment._id;                                                                                //
      sec = _(existingComments).findWhere({                                                                            //
        sectionId: comment.sectionId.toString()                                                                        //
      });                                                                                                              //
      if (sec) {                                                                                                       //
        return sec.comments.push(comment.comment);                                                                     //
      } else {                                                                                                         //
        return existingComments.push({                                                                                 //
          sectionId: comment.sectionId.toString(),                                                                     //
          comments: [comment.comment]                                                                                  //
        });                                                                                                            //
      }                                                                                                                //
    });                                                                                                                //
    sideComments = new SideComments('#commentable-area', commentUser, existingComments);                               //
    sideComments.on('commentPosted', function(comment) {                                                               //
      var attrs, commentId;                                                                                            // 221
      if (settings.allowAnonymous || Meteor.user()) {                                                                  //
        attrs = {                                                                                                      //
          slug: slug,                                                                                                  //
          sectionId: comment.sectionId,                                                                                //
          comment: {                                                                                                   //
            authorAvatarUrl: comment.authorAvatarUrl,                                                                  //
            authorName: comment.authorName,                                                                            //
            authorId: comment.authorId,                                                                                //
            comment: comment.comment                                                                                   //
          }                                                                                                            //
        };                                                                                                             //
        commentId = Blog.Comment.create(attrs);                                                                        //
        comment.id = commentId;                                                                                        //
        return sideComments.insertComment(comment);                                                                    //
      } else {                                                                                                         //
        comment.id = -1;                                                                                               //
        return sideComments.insertComment({                                                                            //
          sectionId: comment.sectionId,                                                                                //
          authorName: comment.authorName,                                                                              //
          comment: 'Please login to post comments'                                                                     //
        });                                                                                                            //
      }                                                                                                                //
    });                                                                                                                //
    return sideComments.on('commentDeleted', function(comment) {                                                       //
      if (Meteor.user()) {                                                                                             //
        Blog.Comment.destroyAll(comment.id);                                                                           //
        return sideComments.removeComment(comment.sectionId, comment.id);                                              //
      }                                                                                                                //
    });                                                                                                                //
  }                                                                                                                    //
};                                                                                                                     // 159
                                                                                                                       //
Template.disqus.onRendered(function() {                                                                                // 250
  var disqus_developer, disqus_identifier, disqus_shortname, disqus_title, disqus_url, dsq, post;                      // 252
  if (Blog.settings.comments.disqusShortname) {                                                                        //
    if (window.DISQUS) {                                                                                               //
      post = this.data;                                                                                                //
      return window.DISQUS.reset({                                                                                     //
        reload: true,                                                                                                  //
        config: function() {                                                                                           //
          this.page.identifier = post.id;                                                                              //
          this.page.title = post.title;                                                                                //
          return this.page.url = window.location.href;                                                                 //
        }                                                                                                              //
      });                                                                                                              //
    } else {                                                                                                           //
      disqus_shortname = Blog.settings.comments.disqusShortname;                                                       //
      disqus_identifier = this.data.id;                                                                                //
      disqus_title = this.data.title;                                                                                  //
      disqus_url = window.location.href;                                                                               //
      disqus_developer = 1;                                                                                            //
      dsq = document.createElement("script");                                                                          //
      dsq.type = "text/javascript";                                                                                    //
      dsq.async = true;                                                                                                //
      dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";                                                      //
      return (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);  //
    }                                                                                                                  //
  }                                                                                                                    //
});                                                                                                                    // 250
                                                                                                                       //
Template.disqus.helpers({                                                                                              // 279
  useDisqus: function() {                                                                                              //
    return Blog.settings.comments.disqusShortname;                                                                     //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/widget/template.latest.js                                                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
                                                                                                                       // 1
Template.__checkName("blogLatest");                                                                                    // 2
Template["blogLatest"] = new Template("Template.blogLatest", (function() {                                             // 3
  var view = this;                                                                                                     // 4
  return HTML.DIV({                                                                                                    // 5
    "class": "meteor-blog-latest"                                                                                      // 6
  }, HTML.Raw('\n    <div class="meteor-blog-latest-heading">\n      <span>Latest Posts</span>\n    </div>\n    '), HTML.UL({
    "class": "meteor-blog-latest-posts"                                                                                // 8
  }, "\n      ", Blaze.Each(function() {                                                                               // 9
    return Spacebars.call(view.lookup("latest"));                                                                      // 10
  }, function() {                                                                                                      // 11
    return [ "\n        ", HTML.LI({                                                                                   // 12
      "class": "meteor-blog-latest-post"                                                                               // 13
    }, "\n          ", HTML.A({                                                                                        // 14
      href: function() {                                                                                               // 15
        return Spacebars.mustache(view.lookup("blogPathFor"), "blogShow");                                             // 16
      }                                                                                                                // 17
    }, "\n            ", HTML.DIV({                                                                                    // 18
      "class": "meteor-blog-latest-post-title"                                                                         // 19
    }, "\n              ", Blaze.View("lookup:title", function() {                                                     // 20
      return Spacebars.makeRaw(Spacebars.mustache(view.lookup("title")));                                              // 21
    }), "\n            "), "\n            ", HTML.DIV({                                                                // 22
      "class": "meteor-blog-latest-post-date"                                                                          // 23
    }, "\n              ", HTML.TIME({                                                                                 // 24
      datetime: function() {                                                                                           // 25
        return Spacebars.mustache(view.lookup("publishedAt"));                                                         // 26
      }                                                                                                                // 27
    }, Blaze.View("lookup:date", function() {                                                                          // 28
      return Spacebars.mustache(view.lookup("date"), view.lookup("publishedAt"));                                      // 29
    })), "\n            "), "\n          "), "\n        "), "\n      " ];                                              // 30
  }, function() {                                                                                                      // 31
    return [ "\n        ", HTML.LI("Loading..."), "\n      " ];                                                        // 32
  }), "\n    "), "\n    ", HTML.A({                                                                                    // 33
    href: function() {                                                                                                 // 34
      return Spacebars.mustache(view.lookup("blogPathFor"), "blogIndex");                                              // 35
    }                                                                                                                  // 36
  }, "View all posts", HTML.Raw("&nbsp;"), " ", HTML.Raw("&rsaquo;")), "\n  ");                                        // 37
}));                                                                                                                   // 38
                                                                                                                       // 39
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);






(function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// packages/ryw_blog/client/views/widget/latest.coffee.js                                                              //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;
Template.blogLatest.onRendered(function() {                                                                            // 1
  var num, ref;                                                                                                        // 2
  num = ((ref = this.data) != null ? ref.num : void 0) ? this.data.num : 3;                                            //
  return this.autorun(function() {                                                                                     //
    return Meteor.subscribe('blog.posts', num);                                                                        //
  });                                                                                                                  //
});                                                                                                                    // 1
                                                                                                                       //
Template.blogLatest.helpers({                                                                                          // 7
  latest: function() {                                                                                                 //
    var num;                                                                                                           // 9
    num = this.num ? this.num : 3;                                                                                     //
    return Blog.Post.all({                                                                                             //
      limit: num                                                                                                       //
    });                                                                                                                //
  },                                                                                                                   //
  date: function(date) {                                                                                               //
    if (date) {                                                                                                        //
      date = new Date(date);                                                                                           //
      return moment(date).format('MMMM Do, YYYY');                                                                     //
    }                                                                                                                  //
  }                                                                                                                    //
});                                                                                                                    //
                                                                                                                       //
Meteor.startup(function() {                                                                                            // 21
  var customLatest;                                                                                                    // 22
  if (Blog.settings.blogLatestTemplate) {                                                                              //
    customLatest = Blog.settings.blogLatestTemplate;                                                                   //
    Template[customLatest].onRendered(Template.blogLatest._callbacks.rendered[0]);                                     //
    return Template[customLatest].helpers({                                                                            //
      latest: Template.blogLatest.__helpers.get('latest'),                                                             //
      date: Template.blogLatest.__helpers.get('date')                                                                  //
    });                                                                                                                //
  }                                                                                                                    //
});                                                                                                                    // 21
                                                                                                                       //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}).call(this);


/* Exports */
if (typeof Package === 'undefined') Package = {};
Package['ryw:blog'] = {};

})();
