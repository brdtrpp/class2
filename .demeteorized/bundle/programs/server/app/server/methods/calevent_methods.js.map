{"version":3,"sources":["meteor://ðŸ’»app/server/methods/calevent_methods.js"],"names":[],"mappings":"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","file":"/server/methods/calevent_methods.js","sourcesContent":["Meteor.methods({\n  removeCal: function(doc) {\n    //refund to antendees\n    if (doc.owner === Meteor.userId()){\n      if (moment(moment(doc.start).toISOString()).isBefore(moment())) {\n        console.log(Meteor.userId() + \" tried to delete event after current date\");\n      } else {\n        if (CalEvent.findOne({_id: doc._id}).owner === Meteor.userId()) {\n          Meteor.call('refundEvent', doc);\n          CalEvent.remove({_id: doc._id});\n          Router.route('/my-classes');\n        }\n      }\n    }\n  },\n\n  removeCourse: function(doc) {\n    var course = CalEvent.find({courseId: doc.courseId}).fetch();\n    _.forEach(course, function(item) {\n      var doc = item;\n      Meteor.call(\"removeCal\", doc);\n    });\n  },\n\n  edit: function(doc) {\n    console.log(\"editing \" + doc._id);\n  },\n\n  recur:function(doc){\n    var startTime = moment(doc.start).format(\"hh:mm a [GMT] ZZ\");\n    var recur = moment(doc.start).recur().every(doc.recur.intervalNumber, doc.recur.intervalType);\n    var dates = recur.next((doc.recur.intervalStop - 1), \"L\");\n    var dur = moment(doc.end).diff(moment(doc.start));\n    var courseId = Random.id();\n\n    //Recurring individual events\n    if (doc.recur.type === \"lesson\") {\n      Meteor.call('saveCalEvent', doc);\n      _.forEach(dates, function(item){\n        var newStart = moment(item + \" \" + startTime);\n        var newEnd = moment(newStart).add(dur, 'ms');\n        doc.start = moment(newStart).toISOString();\n        doc.end = moment(newEnd).toISOString();\n        Meteor.call('saveCalEvent', doc);\n      });\n    }\n\n    if (doc.recur.type === \"course\") {\n      doc.courseId = courseId;\n      Meteor.call('saveCalEvent', doc);\n      _.forEach(dates, function(item){\n        var newStart = moment(item + \" \" + startTime);\n        var newEnd = moment(newStart).add(dur, 'ms');\n        doc.start = moment(newStart).toISOString();\n        doc.end = moment(newEnd).toISOString();\n        // console.log(doc);\n        Meteor.call('saveCalEvent', doc);\n      });\n    }\n  },\n\n  saveCalEvent:function(doc){\n    //check if user is signed in or if the start date of the event is before now\n    if (!this.userId || moment(moment(doc.start).toISOString()).isBefore(moment())) {\n      return null;\n    } else {\n      //save event and dates are saved into ISO format\n      return CalEvent.insert({\n        createdAt: doc.createdAt,\n        title: doc.title,\n        start: moment(doc.start).toISOString(),\n        end: moment(doc.end).toISOString(),\n        category: doc.category,\n        description: doc.description,\n        owner: doc.owner,\n        allDay: doc.allDay,\n        price: doc.price,\n        attendeeCount: doc.attendeeCount,\n        street: doc.street,\n        city: doc.city,\n        state: doc.state,\n        zip: doc.zip,\n        courseId: doc.courseId,\n      });\n    }\n  },\n\n  updateCalEvent: function(doc, id) {\n    if (CalEvent.findOne({_id: id}) && moment(doc.$set.start).isAfter(moment())) {\n      CalEvent.update({_id: id}, {$set: {\n        title: doc.$set.title,\n        start: moment(doc.$set.start).toISOString(),\n        end: moment(doc.$set.end).toISOString(),\n        category: doc.$set.category,\n        description: doc.$set.description,\n        owner: doc.$set.owner,\n        allDay: doc.$set.allDay,\n        price: doc.$set.price,\n        attendeeCount: doc.$set.attendeeCount,\n        street: doc.$set.street,\n        city: doc.$set.city,\n        state: doc.$set.state,\n        zip: doc.$set.zip,\n        courseId: doc.$set.courseId,\n      }});\n    }\n  },\n\n  resizeCalEvent:function(id, delta) {\n    if (!this.userId) {\n      return null;\n    } else {\n      var event = CalEvent.findOne({_id: id});\n      var add = moment(event.end).add({\n        years: delta._data.years,\n        months: delta._data.months,\n        days: delta._data.days,\n        hours: delta._data.hours,\n        minutes: delta._data.minutes,\n      });\n      var end = add._d;\n      CalEvent.update({_id: id}, {$set: {\n        end: moment(end).toISOString(),\n      }});\n    }\n  },\n\n  moveEvent:function(id, delta){\n    if (!this.userId) {\n      return null;\n    } else {\n      var event = CalEvent.findOne({_id: id});\n      var startAdd = moment(event.start).add({\n        years: delta._data.years,\n        months: delta._data.months,\n        days: delta._data.days,\n        hours: delta._data.hours,\n        minutes: delta._data.minutes,\n      });\n      var endAdd = moment(event.end).add({\n        years: delta._data.years,\n        months: delta._data.months,\n        days: delta._data.days,\n        hours: delta._data.hours,\n        minutes: delta._data.minutes,\n      });\n      var start = startAdd._d;\n      var end = endAdd._d;\n      if (moment(start).isAfter(moment()) && moment(event.start).isAfter(moment())) {\n        CalEvent.update({_id: id}, {$set: {\n          start: moment(start).toISOString(),\n          end: moment(end).toISOString(),\n        }});\n      }\n    }\n  },\n});"]}